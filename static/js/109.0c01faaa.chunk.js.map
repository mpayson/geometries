{"version":3,"sources":["../node_modules/@arcgis/core/views/2d/layers/TileLayerView2D.js","../node_modules/@arcgis/core/views/layers/TileLayerView.js","../node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","../node_modules/@arcgis/core/views/support/drapedUtils.js"],"names":["w","i","getLogger","_","I","arguments","_tileStrategy","_fetchQueue","layer","e","this","tileInfo","t","spatialReference","a","equals","view","watch","refresh","addResolvingPromise","l","resampling","pause","state","update","resume","notifyChange","tileServers","_tileInfoView","c","fullExtent","u","tileInfoView","concurrency","length","process","fetchTile","p","cachePolicy","acquireTile","releaseTile","requestUpdate","container","requestRender","destroy","clear","removeAllChildren","f","updateRequested","suspended","reset","tiles","forEach","_enqueueTileFetch","_bitmapView","createTile","bitmap","getTileCoords","key","x","y","resolution","getTileResolution","size","width","height","addChild","abort","id","removeChild","once","r","tilemapCache","s","signal","_fetchImage","o","_createBlankImage","n","fetchAvailabilityUpsample","level","row","col","h","_resampleImage","has","push","source","error","timestamp","refreshTimestamp","getLODInfoAt","getXForColumn","getYForRow","m","g","Math","round","d","getContext","drawImage","document","createElement","type","get","allSublayers","toArray","filter","minScale","maxScale","popupTemplate","popupEnabled","visible","map","createQuery","event","renderer","geometry","createFetchPopupFeaturesQueryGeometry","getRequiredFields","outFields","queryFeatures","features","then","concat","value","Boolean","prototype","dependsOn","T","xoffset","max","abs","yoffset","stops","pointerType","maxSize","minSize","floor","visualVariables","symbol","uniqueValueInfos","classBreakInfos","overlayPixelSizeInMapUnits","basemapSpatialReference","xmin","min","ymin","xmax","ymax","toMap","intersects"],"mappings":"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","file":"static/js/109.0c01faaa.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import{isNone as t}from\"../../../core/maybe.js\";import i from\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import a from\"../../../core/Error.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{reject as l,isAbortError as o}from\"../../../core/promiseUtils.js\";import{RefreshableLayerView as h}from\"../../layers/RefreshableLayerView.js\";import n from\"../tiling/TileKey.js\";import c from\"../tiling/TileInfoView.js\";import u from\"../tiling/TileQueue.js\";import p from\"../tiling/TileStrategy.js\";import m from\"../../layers/LayerView.js\";import{createQueryGeometry as f}from\"../../support/drapedUtils.js\";import{TileLayerView as g}from\"../../layers/TileLayerView.js\";import{LayerView2DMixin as y}from\"./LayerView2D.js\";import{BitmapTileLayerView2D as d}from\"./BitmapTileLayerView2D.js\";const w=i.getLogger(\"esri.views.2d.layers.TileLayerView2D\"),_=[0,0];let I=class extends(g(h(d(y(m))))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}initialize(){const e=this.layer.tileInfo,t=e&&e.spatialReference;let i;t||(i=new a(\"layerview:tiling-information-missing\",\"The layer doesn't provide tiling information\",{layer:this.layer})),t.equals(this.view.spatialReference)||(i=new a(\"layerview:spatial-reference-incompatible\",\"The spatial reference of this layer does not meet the requirements of the view\",{layer:this.layer})),this.watch(\"resampling\",(()=>{this.refresh()})),i&&this.addResolvingPromise(l(i))}get resampling(){return!(\"resampling\"in this.layer)||!1!==this.layer.resampling}hitTest(){return null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange(\"updating\")}attach(){const e=\"tileServers\"in this.layer?this.layer.tileServers:null;this._tileInfoView=new c(this.layer.tileInfo,this.layer.fullExtent),this._fetchQueue=new u({tileInfoView:this._tileInfoView,concurrency:e&&10*e.length||10,process:(e,t)=>this.fetchTile(e,t)}),this._tileStrategy=new p({cachePolicy:\"keep\",resampling:this.resampling,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this.requestUpdate(),this.container.requestRender(),super.attach()}detach(){super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,t){return f(e,t,this.view)}async doRefresh(){this.updateRequested||this.suspended||(this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((e=>this._enqueueTileFetch(e))),this.notifyChange(\"updating\"))}isUpdating(){var e;return(null==(e=this._fetchQueue)?void 0:e.length)>0}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(_,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(t),this._bitmapView.addChild(t),this.requestUpdate(),t}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e,i){const r=\"tilemapCache\"in this.layer?this.layer.tilemapCache:null,s=!t(i)&&i.signal;if(!r)try{return await this._fetchImage(e,s)}catch(e){if(!o(e)&&!this.resampling)return this._createBlankImage();throw e}const a=new n(0,0,0,0);let l;try{if(await r.fetchAvailabilityUpsample(e.level,e.row,e.col,a,{signal:s}),a.level!==e.level&&!this.resampling)return this._createBlankImage();l=await this._fetchImage(a,s)}catch(t){if(o(t))throw t;l=await this._fetchImage(e,s)}const{level:h,row:c,col:u}=a;return this.resampling&&h!==e.level?this._resampleImage(l,h,c,u,e.level,e.row,e.col):l}async _enqueueTileFetch(e){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key);e.bitmap.source=t,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.once(\"attach\",(()=>this.requestUpdate()))}catch(e){o(e)||w.error(e)}this.requestUpdate()}}async _fetchImage(e,t){return this.layer.fetchTile(e.level,e.row,e.col,{timestamp:this.refreshTimestamp,signal:t})}_resampleImage(e,t,i,r,s,a,l){const o=this._tileInfoView.tileInfo.size,h=this._tileInfoView.getTileResolution(t),n=this._tileInfoView.getTileResolution(s);let c=this._tileInfoView.getLODInfoAt(s);const u=c.getXForColumn(l),p=c.getYForRow(a);c=this._tileInfoView.getLODInfoAt(t);const m=c.getXForColumn(r),f=c.getYForRow(i),g=Math.round((u-m)/h),y=Math.round(-(p-f)/h),d=Math.round(o[0]*(n/h)),w=Math.round(o[1]*(n/h)),_=this._createBlankImage();return _.getContext(\"2d\").drawImage(e,g,y,d,w,0,0,o[0],o[1]),_}_createBlankImage(){const e=this._tileInfoView.tileInfo.size,t=document.createElement(\"canvas\");return[t.width,t.height]=e,t}};e([r({dependsOn:[\"layer.resampling?\"]})],I.prototype,\"resampling\",null),I=e([s(\"esri.views.2d.layers.TileLayerView2D\")],I);var T=I;export default T;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import{isSome as r}from\"../../core/maybe.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as o}from\"../../core/accessorSupport/decorators/subclass.js\";import s from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import{reject as p,eachAlways as a}from\"../../core/promiseUtils.js\";import{calculateTolerance as i}from\"../../renderers/support/clickToleranceUtils.js\";const c=c=>{let l=class extends c{async fetchPopupFeatures(e,t){const{layer:o}=this;if(!e)return p(new s(\"tilelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:o}));if(\"tile\"!==o.type)return p(new s(\"tilelayerview:fetchPopupFeatures\",\"Layer type should be 'tile'\",{type:o.type}));const c=this.get(\"view.scale\"),l=o.allSublayers.toArray().filter((e=>{const r=0===e.minScale||c<=e.minScale,t=0===e.maxScale||c>=e.maxScale;return e.popupTemplate&&e.popupEnabled&&e.visible&&r&&t}));return a(l.map((async o=>{const s=o.createQuery(),p=r(t)?t.event:null,a=i({renderer:o.renderer,event:p});s.geometry=this.createFetchPopupFeaturesQueryGeometry(e,a),s.outFields=await o.popupTemplate.getRequiredFields();return(await o.queryFeatures(s)).features}))).then((e=>[].concat(...e.map((e=>e.value)).filter(Boolean))))}};return e([t()],l.prototype,\"layer\",void 0),l=e([o(\"esri.layers.mixins.TileLayerView\")],l),l};export{c as TileLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t,e){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?function(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}(t.stops):e}function n(n){const r=n&&n.renderer,s=\"touch\"===(n&&n.event&&n.event.pointerType)?9:6;if(!r)return s;const o=\"visualVariables\"in r?function(t,n){if(!n)return t;const r=n.filter((t=>\"size\"===t.type)).map((n=>{const{maxSize:r,minSize:s}=n;return(e(r,t)+e(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let t=0;t<o;t++)s+=r[t];const f=Math.floor(s/o);return Math.max(f,t)}(s,r.visualVariables):s;if(\"simple\"===r.type)return t(o,r.symbol);if(\"unique-value\"===r.type){let e=o;return r.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===r.type){let e=o;return r.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return r.type,o}export{n as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../core/maybe.js\";import r from\"../../geometry/Extent.js\";import\"../../geometry.js\";import{getMetersPerUnitForSR as n}from\"../../core/unitUtils.js\";import{calculateTolerance as i}from\"../../renderers/support/clickToleranceUtils.js\";function a(t,i,a,o=new r){let s;if(\"2d\"===a.type)s=i*a.resolution;else if(\"3d\"===a.type){const r=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?n(o)/n(a.spatialReference):i*r}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,n){const o=n.toMap(e);if(t(o))return!1;return a(o,i(),n,s).intersects(r)}const s=new r;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n"],"sourceRoot":""}