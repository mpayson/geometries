(this.webpackJsonpgeometries=this.webpackJsonpgeometries||[]).push([[76],{1307:function(e,t,r){"use strict";r.r(t);var n=r(9),a=r(10),i=r.n(a),s=r(21),u=r(2),o=r(3),c=r(5),l=r(6),f=r(0),y=(r(13),r(14)),p=(r(15),r(1)),b=r(8),d=(r(11),r(19),r(20),r(16)),h=r(30),m=r(316),v=r(995),O=r(829),g=r(916),j=r(41),w=r(60),x=r(55),S=r(4),I=r(23),k=r(243),E=r(896),D=r(954),P=r(955),L=r(830),V=r(1012),M=y.a.getLogger("esri.views.2d.layers.MapImageLayerView2D"),_=function(e){Object(c.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(u.a)(this,r),(e=t.apply(this,arguments))._exportImageVersion=-1,e}return Object(o.a)(r,[{key:"hitTest",value:function(){return null}},{key:"update",value:function(e){this.strategy.update(e).catch((function(e){Object(d.n)(e)||M.error(e)}))}},{key:"attach",value:function(){var e=this,t=this.layer,r=t.imageMaxWidth,n=t.imageMaxHeight,a=t.version,i=a>=10.3,s=a>=10;this._bitmapContainer=new P.a,this.container.addChild(this._bitmapContainer),this.strategy=new V.a({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:r,imageMaxHeight:n,imageRotationSupported:i,imageNormalizationSupported:s,hidpi:!0}),this.imageParameters=new v.a({view:this.view,layer:this.layer}),this.handles.add(Object(h.a)(this.imageParameters,"version",(function(t){e._exportImageVersion!==t&&(e._exportImageVersion=t,e.requestUpdate())})),"mapimagelayerview-update")}},{key:"detach",value:function(){this.strategy.destroy(),this.handles.remove("mapimagelayerview-update"),this.imageParameters.destroy(),this.imageParameters=null,this._exportImageVersion=-1,this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}},{key:"moveStart",value:function(){}},{key:"viewChange",value:function(){}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"createFetchPopupFeaturesQueryGeometry",value:function(e,t){return Object(g.a)(e,t,this.view)}},{key:"doRefresh",value:function(){var e=Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.requestUpdate();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isUpdating",value:function(){return this.strategy.updating||this.updateRequested}},{key:"fetchImage",value:function(e,t,r,a){return this.layer.fetchImage(e,t,r,Object(n.a)({timeExtent:this.imageParameters.timeExtent,timestamp:this.refreshTimestamp},a))}}]),r}(function(e){var t=function(e){Object(c.a)(r,e);var t=Object(l.a)(r);function r(){return Object(u.a)(this,r),t.apply(this,arguments)}return Object(o.a)(r,[{key:"fetchPopupFeatures",value:function(){var e=Object(s.a)(i.a.mark((function e(t,r){var a,u,o,c,l,f,y=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.layer,t){e.next=3;break}return e.abrupt("return",Object(d.t)(new I.a("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:a})));case 3:return u=this.get("view.scale"),o=[],c=function(){var e=Object(s.a)(i.a.mark((function e(t){var a,s,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0===t.minScale||u<=t.minScale,s=0===t.maxScale||u>=t.maxScale,t.visible&&a&&s&&(t.sublayers?t.sublayers.forEach(c):t.popupEnabled&&(l=Object(D.a)(t,Object(n.a)(Object(n.a)({},r),{},{defaultPopupTemplateEnabled:!1})),Object(S.i)(l)&&o.push({sublayer:t,popupTemplate:l})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=a.sublayers.toArray().map(c),e.next=6,Object(d.b)(l);case 6:return f=o.map(function(){var e=Object(s.a)(i.a.mark((function e(n){var a,s,u,o,c,l,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.sublayer,s=n.popupTemplate,e.next=3,a.load().catch((function(){}));case 3:return u=a.createQuery(),o=Object(S.i)(r)?r.event:null,c=Object(E.a)({renderer:a.renderer,event:o}),l=y.createFetchPopupFeaturesQueryGeometry(t,c),u.geometry=l,e.next=7,Object(D.b)(a,s);case 7:return u.outFields=e.sent,e.next=10,y._loadArcadeModules(s);case 10:return(f=e.sent)&&f.arcadeUtils.hasGeometryOperations(s)||(u.maxAllowableOffset=l.width/c),e.next=14,a.queryFeatures(u);case 14:return e.abrupt("return",e.sent.features);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=9,Object(d.j)(f);case 9:return e.abrupt("return",e.sent.reduce((function(e,t){return t.value?[].concat(Object(j.a)(e),Object(j.a)(t.value)):e}),[]).filter((function(e){return null!=e})));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){var e,t;return!!Object(w.a)(Object(x.a)(r.prototype),"canResume",this).call(this)&&(null==(e=this.imageParameters)||null==(t=e.timeExtent)||!t.isEmpty)}},{key:"_loadArcadeModules",value:function(e){if(e.get("expressionInfos.length"))return Object(k.e)()}}]),r}(e);return Object(f.a)([Object(p.b)()],t.prototype,"imageParameters",void 0),Object(f.a)([Object(p.b)()],t.prototype,"layer",void 0),Object(f.a)([Object(p.b)({dependsOn:["imageParameters.timeExtent"]})],t.prototype,"suspended",void 0),t=Object(f.a)([Object(b.a)("esri.views.layers.MapImageLayerView")],t)}(Object(m.a)(Object(L.a)(O.a))));Object(f.a)([Object(p.b)()],_.prototype,"strategy",void 0),Object(f.a)([Object(p.b)({dependsOn:["strategy.updating"]})],_.prototype,"updating",void 0);var T=_=Object(f.a)([Object(b.a)("esri.views.2d.layers.MapImageLayerView2D")],_);t.default=T},787:function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return y})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return m})),r.d(t,"f",(function(){return v})),r.d(t,"g",(function(){return f})),r.d(t,"h",(function(){return h})),r.d(t,"i",(function(){return l})),r.d(t,"j",(function(){return p}));var n=r(9),a=r(98),i=r(119),s=r(377),u=r(246),o=r(303),c=r(387),l={type:Boolean,value:!0,json:{origins:{"web-scene":{read:{source:["id","url","layerType"],reader:function(e,t){if(null!=t.screenSizePerspective||"defaults"!==this.originOf("screenSizePerspectiveEnabled"))return t.screenSizePerspective;Object(a.a)(this).store.set("screenSizePerspectiveEnabled",!1,0)}},write:{ignoreOrigin:!0,target:"screenSizePerspective",writer:function(e,t,r,n){("defaults"===this.originOf("screenSizePerspectiveEnabled")&&e||Object(s.a)(this,"screenSizePerspectiveEnabled",{},n))&&(t[r]=e)}}}}}},f={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:function(e,t){return!t.disablePopup}},write:{enabled:!0,writer:function(e,t,r){t[r]=!e}}}},y={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},p={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:i.f}}},b={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},d={value:null,type:c.a,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function h(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}var m={type:Number,json:{origins:{"web-document":{default:1,write:!0,read:!0},"portal-item":{write:!0}}}},v=Object(n.a)(Object(n.a)({},m),{},{json:Object(n.a)(Object(n.a)({},m.json),{},{origins:{"web-document":Object(n.a)(Object(n.a)({},m.json.origins["web-document"]),{},{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:function(e,t,r){return r&&"service"!==r.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?Object(u.b)(t.layerDefinition.drawingInfo.transparency):void 0:Object(u.b)(t.drawingInfo.transparency)}}})}),O={type:o.a,dependsOn:["view.timeExtent","layer.timeExtent","layer.timeInfo","layer.timeOffset","layer.timeOffset.value","layer.timeOffset.unit","layer.useViewTime"],readOnly:!0,get:function(){var e,t;if(null==(e=this.layer)||!e.timeInfo)return null;var r=null==(t=this.view)?void 0:t.timeExtent,n=this.layer.timeExtent,a=this.layer.useViewTime?r&&n?r.intersection(n):r||n:n;if(!a||a.isEmpty)return a;var i=this.layer.timeOffset,s=i?a.offset(-i.value,i.unit):a,u=this._get("timeExtent");return s.equals(u)?u:s}}},896:function(e,t,r){"use strict";function n(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function a(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,r=0,n=0;n<e.length;n++){var a=e[n].size;"number"==typeof a&&(t+=a,r++)}return t/r}(e.stops):t}function i(e){var t=e&&e.renderer,r="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return r;var i="visualVariables"in t?function(e,t){if(!t)return e;var r=t.filter((function(e){return"size"===e.type})).map((function(t){var r=t.maxSize,n=t.minSize;return(a(r,e)+a(n,e))/2})),n=0,i=r.length;if(0===i)return e;for(var s=0;s<i;s++)n+=r[s];var u=Math.floor(n/i);return Math.max(u,e)}(r,t.visualVariables):r;if("simple"===t.type)return n(i,t.symbol);if("unique-value"===t.type){var s=i;return t.uniqueValueInfos.forEach((function(e){s=n(s,e.symbol)})),s}if("class-breaks"===t.type){var u=i;return t.classBreakInfos.forEach((function(e){u=n(u,e.symbol)})),u}return t.type,i}r.d(t,"a",(function(){return i}))},916:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return o}));var n=r(4),a=r(61),i=(r(75),r(54)),s=r(896);function u(e,t,r){var s,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.a;if("2d"===r.type)s=t*r.resolution;else if("3d"===r.type){var o=r.overlayPixelSizeInMapUnits(e),c=r.basemapSpatialReference;s=Object(n.i)(c)&&!c.equals(r.spatialReference)?Object(i.c)(c)/Object(i.c)(r.spatialReference):t*o}var l=e.x-s,f=e.y-s,y=e.x+s,p=e.y+s,b=r.spatialReference;return u.xmin=Math.min(l,y),u.ymin=Math.min(f,p),u.xmax=Math.max(l,y),u.ymax=Math.max(f,p),u.spatialReference=b,u}function o(e,t,r){var a=r.toMap(e);return!Object(n.h)(a)&&u(a,Object(s.a)(),r,c).intersects(t)}var c=new a.a},925:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return a}));var n=r(12);function a(e,t,r){return t.flatten((function(e){return e.sublayers})).length!==e.length||(!!e.some((function(e){return e.originIdOf("minScale")>r||e.originIdOf("maxScale")>r||e.originIdOf("renderer")>r||e.originIdOf("labelingInfo")>r||e.originIdOf("opacity")>r||e.originIdOf("labelsVisible")>r||e.originIdOf("source")>r}))||!s(e,t))}function i(e,t,r){return!!e.some((function(e){var t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&(!t.gdbVersion||t.gdbVersion===r.gdbVersion))||e.originIdOf("renderer")>2||e.originIdOf("labelingInfo")>2||e.originIdOf("opacity")>2||e.originIdOf("labelsVisible")>2}))||!s(e,t)}function s(e,t){if(!e||!e.length)return!0;var r=t.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).map((function(e){return e.id})).toArray();if(e.length>r.length)return!1;var a,i=0,s=r.length,u=Object(n.a)(e);try{for(u.s();!(a=u.n()).done;){for(var o=a.value.id;i<s&&r[i]!==o;)i++;if(i>=s)return!1}}catch(c){u.e(c)}finally{u.f()}return!0}function u(e){return!!e&&e.some((function(e){return null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale}))}},954:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return c}));var n=r(10),a=r.n(n),i=r(41),s=r(21),u=r(4),o=r(157);function c(e){return l.apply(this,arguments)}function l(){return(l=Object(s.a)(a.a.mark((function e(t){var r,n,s,c,l,f,y,p,b,d=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.length>1&&void 0!==d[1]?d[1]:t.popupTemplate,Object(u.i)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fields);case 5:if(n=e.sent,s=r.lastEditInfoEnabled,c=t.objectIdField,l=t.typeIdField,f=t.globalIdField,y=t.relationships,!n.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!s){e.next=19;break}return e.next=16,Object(o.m)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return p=e.t0,b=Object(o.i)(t.fields,[].concat(Object(i.a)(n),Object(i.a)(p))),e.abrupt("return",(l&&b.push(l),b&&c&&Object(o.p)(t.fields,c)&&-1===b.indexOf(c)&&b.push(c),b&&f&&Object(o.p)(t.fields,f)&&-1===b.indexOf(f)&&b.push(f),y&&y.forEach((function(e){var r=e.keyField;b&&r&&Object(o.p)(t.fields,r)&&-1===b.indexOf(r)&&b.push(r)})),b));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e,t){return e.popupTemplate?e.popupTemplate:Object(u.i)(t)&&t.defaultPopupTemplateEnabled&&Object(u.i)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},995:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var n=r(9),a=r(2),i=r(3),s=r(5),u=r(6),o=r(0),c=(r(13),r(14),r(15),r(1)),l=r(8),f=(r(11),r(19),r(20),r(33)),y=r(787),p=r(158),b=r(925),d=r(412),h={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"},m=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments))._scale=null,e.view=null,e}return Object(i.a)(r,[{key:"destroy",value:function(){this.layer=this.view=null}},{key:"dynamicLayers",get:function(){if(!this.hasDynamicLayers)return null;var e=this.visibleSublayers.map((function(e){return e.toExportImageJSON()}));return e.length?JSON.stringify(e):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&Object(b.a)(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}},{key:"layer",set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("sublayer-update",(function(e){return t.notifyChange(h[e.propertyName])}))],"layer"))}},{key:"layers",get:function(){var e=this.visibleSublayers;return e?e.length?"show:"+e.map((function(e){return e.id})).join(","):"show:-1":null}},{key:"layerDefs",get:function(){var e=this.visibleSublayers.filter((function(e){return null!=e.definitionExpression}));return e.length?JSON.stringify(e.reduce((function(e,t){return e[t.id]=t.definitionExpression,e}),{})):null}},{key:"scale",get:function(){return null!=this._scale?this._scale:this.view&&this.view.scale||0},set:function(e){this.view||(this._scale=e,this.notifyChange("scale"))}},{key:"version",get:function(){var e=this;e.layers,e.layerDefs,e.dynamicLayers,e.timeExtent;var t=e.layer;return t&&(t.dpi,t.imageFormat,t.imageTransparency,t.gdbVersion),(this._get("version")||0)+1},set:function(e){this._set("version",e)}},{key:"visibleSublayers",get:function(){var e=this,t=[];if(!this.layer)return t;var r=this.layer.sublayers;r&&r.forEach((function r(n){var a=e.scale,i=0===a,s=0===n.minScale||a<=n.minScale,u=0===n.maxScale||a>=n.maxScale;n.visible&&(i||s&&u)&&(n.sublayers?n.sublayers.forEach(r):t.unshift(n))}));var n=this._get("visibleSublayers");return!n||n.length!==t.length||n.some((function(e,r){return t[r]!==e}))?t:n}},{key:"toJSON",value:function(){var e=this.layer,t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=Object(n.a)(Object(n.a)({},t),{},{layers:this.layers,layerDefs:this.layerDefs}),t}}]),r}(Object(p.b)(f.a));Object(o.a)([Object(c.b)({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],m.prototype,"dynamicLayers",null),Object(o.a)([Object(c.b)({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],m.prototype,"hasDynamicLayers",null),Object(o.a)([Object(c.b)()],m.prototype,"layer",null),Object(o.a)([Object(c.b)({readOnly:!0,dependsOn:["visibleSublayers"]})],m.prototype,"layers",null),Object(o.a)([Object(c.b)({readOnly:!0,dependsOn:["visibleSublayers"]})],m.prototype,"layerDefs",null),Object(o.a)([Object(c.b)({type:Number,dependsOn:["view.scale"]})],m.prototype,"scale",null),Object(o.a)([Object(c.b)(y.a)],m.prototype,"timeExtent",void 0),Object(o.a)([Object(c.b)({dependsOn:["layers","layerDefs","dynamicLayers","layer.dpi","layer.imageFormat","layer.imageTransparency","layer.gdbVersion","timeExtent"]})],m.prototype,"version",null),Object(o.a)([Object(c.b)({type:d.a})],m.prototype,"view",void 0),Object(o.a)([Object(c.b)({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],m.prototype,"visibleSublayers",null),m=Object(o.a)([Object(l.a)("esri.layers.mixins.ExportImageParameters")],m)}}]);
//# sourceMappingURL=76.adabe411.chunk.js.map