(this.webpackJsonpgeometries=this.webpackJsonpgeometries||[]).push([[27],{1054:function(e,t,i){"use strict";i.r(t);var a=i(10),n=i.n(a),r=i(21),s=i(9),c=i(2),o=i(3),l=i(5),u=i(6),h=i(0),v=(i(13),i(4)),f=i(14),p=(i(15),i(1)),b=i(63),d=i(8),y=i(23),m=i(11),_=(i(19),i(20),i(16)),O=i(81),g=i(244),j=i(801),w=i(235),k=i(793),S=i(815),z=i(872),x=i(808),T=i(990),A=i(384),L=f.a.getLogger("esri.views.3d.support.WorkerHandle"),D=function(e){Object(l.a)(i,e);var t=Object(u.a)(i);function i(e){var a;return Object(c.a)(this,i),(a=t.call(this,"LercWorker","_decode",e,{strategy:"dedicated"})).scheduler=e,a}return Object(o.a)(i,[{key:"decode",value:function(e,t,i){return e&&0!==e.byteLength?this.invoke({buffer:e,options:t},i):Object(_.u)(null)}},{key:"getTransferList",value:function(e){return[e.buffer]}}]),i}(function(){function e(t,i,a){var n=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(c.a)(this,e),this._methodName=i,this._promise=Object(A.b)(t,Object(s.a)(Object(s.a)({},r),{},{scheduler:a})).then((function(e){void 0===n._thread?(n._thread=e,n._promise=null,r.hasInitialize&&n.broadcast({},"initialize")):e.close()})),this._promise.catch((function(e){return L.error("Failed to initialize ".concat(t," worker: ").concat(e))}))}return Object(o.a)(e,[{key:"destroy",value:function(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}},{key:"invoke",value:function(e,t){var i=this;if(this._thread){var a=this.getTransferList(e);return this._thread.invoke(this._methodName,e,{transferList:a,signal:t})}return this._promise?this._promise.then((function(){return Object(_.w)(t),i.invoke(e,t)})):Object(_.t)(null)}},{key:"broadcast",value:function(e,t){var i=this;return this._thread?Object(_.b)(this._thread.broadcast(t,e)).then((function(){})):this._promise?this._promise.then((function(){return i.broadcast(e,t)})):Object(_.t)()}},{key:"promise",get:function(){return this._promise}}]),e}()),R=new Map;function C(e){var t=R.get(e);return t||(t={instance:new D(e),ref:0},R.set(e,t)),++t.ref,t.instance}var E=f.a.getLogger("esri.layers.ElevationLayer"),I=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(c.a)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).copyright=null,e.heightModelInfo=null,e.path=null,e.opacity=1,e.operationalLayerType="ArcGISTiledElevationServiceLayer",e.sourceJSON=null,e.type="elevation",e.url=null,e.version=null,e._lercDecoder=C(),e}return Object(o.a)(a,[{key:"normalizeCtorArgs",value:function(e,t){return"string"==typeof e?Object(s.a)({url:e},t):e}},{key:"destroy",value:function(){(function(e){if(null!=e){var t=e.scheduler,i=R.get(t);i&&--i.ref<=0&&(i.instance.destroy(),R.delete(t))}})(this._lercDecoder),this._lercDecoder=null}},{key:"minScale",get:function(){},set:function(e){this.constructed&&E.warn("".concat(this.declaredClass,".minScale support has been removed (since 4.5)"))}},{key:"maxScale",get:function(){},set:function(e){this.constructed&&E.warn("".concat(this.declaredClass,".maxScale support has been removed (since 4.5)"))}},{key:"readVersion",value:function(e,t){var i=t.currentVersion;return i||(i=9.3),i}},{key:"load",value:function(e){var t=this,i=Object(v.i)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(e){for(var t=0;t<e.typeKeywords.length;t++)if("elevation 3d layer"===e.typeKeywords[t].toLowerCase())return!0;throw new y.a("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"})}},e).then((function(){return t._fetchImageService(i)}),(function(){return t._fetchImageService(i)}))),Object(_.u)(this)}},{key:"fetchTile",value:function(e,t,i,a){var n=this,r=Object(v.i)((a=a||{signal:null}).signal)?a.signal:a.signal=Object(_.d)().signal,s={responseType:"array-buffer",signal:r},c={noDataValue:a.noDataValue,returnFileInfo:!0};return this.load().then((function(){return n._fetchTileAvailability(e,t,i,a)})).then((function(){return Object(O.default)(n.getTileUrl(e,t,i),s)})).then((function(e){return n._lercDecoder.decode(e.data,c,r)})).then((function(e){return{values:e.pixelData,width:e.width,height:e.height,maxZError:e.fileInfo.maxZError,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue}}))}},{key:"getTileUrl",value:function(e,t,i){var a=!this.tilemapCache&&this.supportsBlankTile,n=Object(m.C)(Object(s.a)(Object(s.a)({},this.parsedUrl.query),{},{blankTile:!a&&null}));return"".concat(this.parsedUrl.path,"/tile/").concat(e,"/").concat(t,"/").concat(i).concat(n?"?"+n:"")}},{key:"queryElevation",value:function(){var e=Object(r.a)(n.a.mark((function e(t,a){var r,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.e(15).then(i.bind(null,1306));case 2:return r=e.sent,s=r.ElevationQuery,Object(_.w)(a),e.abrupt("return",(new s).query(this,t,a));case 6:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"createElevationSampler",value:function(){var e=Object(r.a)(n.a.mark((function e(t,a){var r,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.e(15).then(i.bind(null,1306));case 2:return r=e.sent,s=r.ElevationQuery,Object(_.w)(a),e.abrupt("return",(new s).createSampler(this,t,a));case 6:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_fetchTileAvailability",value:function(e,t,i,a){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,t,i,a):Object(_.u)("unknown")}},{key:"_fetchImageService",value:function(){var e=Object(r.a)(n.a.mark((function e(t){var i,a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.sourceJSON){e.next=2;break}return e.abrupt("return",this.sourceJSON);case 2:return i={query:Object(s.a)({f:"json"},this.parsedUrl.query),responseType:"json",signal:t},e.next=5,Object(O.default)(this.parsedUrl.path,i);case 5:(a=e.sent).ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=a.data,this.read(a.data,{origin:"service",url:this.parsedUrl});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(Object(T.a)(Object(z.a)(Object(S.a)(Object(x.a)(Object(j.a)(g.a))))));Object(h.a)([Object(p.b)({json:{read:{source:"copyrightText"}}})],I.prototype,"copyright",void 0),Object(h.a)([Object(p.b)({readOnly:!0,type:w.a})],I.prototype,"heightModelInfo",void 0),Object(h.a)([Object(p.b)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],I.prototype,"path",void 0),Object(h.a)([Object(p.b)({type:["show","hide"]})],I.prototype,"listMode",void 0),Object(h.a)([Object(p.b)({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],I.prototype,"minScale",null),Object(h.a)([Object(p.b)({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],I.prototype,"maxScale",null),Object(h.a)([Object(p.b)({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],I.prototype,"opacity",void 0),Object(h.a)([Object(p.b)({type:["ArcGISTiledElevationServiceLayer"]})],I.prototype,"operationalLayerType",void 0),Object(h.a)([Object(p.b)()],I.prototype,"sourceJSON",void 0),Object(h.a)([Object(p.b)({json:{read:!1},value:"elevation",readOnly:!0})],I.prototype,"type",void 0),Object(h.a)([Object(p.b)(k.j)],I.prototype,"url",void 0),Object(h.a)([Object(p.b)()],I.prototype,"version",void 0),Object(h.a)([Object(b.a)("version",["currentVersion"])],I.prototype,"readVersion",null);var M=I=Object(h.a)([Object(d.a)("esri.layers.ElevationLayer")],I);t.default=M},812:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return u}));var a=i(32),n=i(12),r=i(2),s=i(3),c=i(129),o=-3,l=function(){function e(t,i,a){Object(r.a)(this,e),this._namespace=t,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",a&&(this._storage.registerRemoveFunc(this._namespace,a),this._removeFunc=!0)}return Object(s.a)(e,[{key:"namespace",get:function(){return this._namespace.slice(0,-1)}},{key:"hitRate",get:function(){return this._hit/(this._hit+this._miss)}},{key:"size",get:function(){return this._storage.size}},{key:"maxSize",get:function(){return this._storage.maxSize}},{key:"resetHitRate",value:function(){this._hit=this._miss=0}},{key:"destroy",value:function(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this)}},{key:"put",value:function(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._storage.put(this._namespace+e,t,i,a)}},{key:"get",value:function(e){var t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}},{key:"pop",value:function(e){var t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}},{key:"updateSize",value:function(e,t,i){this._storage.updateSize(this._namespace+e,t,i)}},{key:"clear",value:function(){this._storage.clear(this._namespace)}},{key:"clearAll",value:function(){this._storage.clearAll()}},{key:"getStats",value:function(){return this._storage.getStats()}},{key:"resetStats",value:function(){this._storage.resetStats()}}]),e}(),u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10485760;Object(r.a)(this,e),this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=[],this._users=new c.a}return Object(s.a)(e,[{key:"register",value:function(e){this._users.push(e)}},{key:"deregister",value:function(e){this._users.removeUnordered(e)}},{key:"registerRemoveFunc",value:function(e,t){this._removeFuncs.push([e,t])}},{key:"deregisterRemoveFunc",value:function(e){this._removeFuncs=this._removeFuncs.filter((function(t){return t[0]!==e}))}},{key:"size",get:function(){return this._size}},{key:"maxSize",get:function(){return this._maxSize},set:function(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}},{key:"put",value:function(e,t,i,a){var n=this._db.get(e);if(n&&(this._size-=n.size,this._db.delete(e),n.entry!==t&&this._notifyRemoved(e,n.entry)),i>this._maxSize)this._notifyRemoved(e,t);else if(void 0!==t)if(!i||i<0)console.warn("Refusing to cache entry with invalid size "+i);else{var r=1+Math.max(a,-3)- -3;this._db.set(e,{entry:t,size:i,lifetime:r,lives:r}),this._size+=i,this._checkSizeLimit()}else console.warn("Refusing to cache undefined entry ")}},{key:"updateSize",value:function(e,t,i){var a=this._db.get(e);a&&a.entry===t&&(this._size-=a.size,i>this._maxSize?this._notifyRemoved(e,t):(a.size=i,this._size+=i,this._checkSizeLimit()))}},{key:"pop",value:function(e){var t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss}},{key:"get",value:function(e){var t=this._db.get(e);if(void 0!==t)return this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry;++this._miss}},{key:"getStats",value:function(){var e=this,t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},a=new Array;this._db.forEach((function(t,n){var r=t.lifetime;a[r]=(a[r]||0)+t.size,e._users.forAll((function(e){var a=e.namespace;if(n.startsWith(a)){var r=i[a]||0;i[a]=r+t.size}}))}));var n={};this._users.forAll((function(e){var t=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){var a=i[t]||0;i[t]=a,n[t]=Math.round(100*e.hitRate)+"%"}else n[t]="0%"}));var r=Object.keys(i);r.forEach((function(t){return i[t]=i[t]/e._size*100})),r.sort((function(e,t){return i[t]-i[e]})),r.forEach((function(e){return t[e]=Math.round(i[e])+"% / "+n[e]}));for(var s=a.length-1;s>=0;--s){var c=a[s];c&&(t["Priority "+(s+-3-1)]=Math.round(c/this.size*100)+"%")}return t}},{key:"resetStats",value:function(){this._hit=this._miss=0,this._users.forAll((function(e){return e.resetHitRate()}))}},{key:"clear",value:function(e){var t=this;this._db.forEach((function(i,a){a.startsWith(e)&&(t._size-=i.size,t._db.delete(a),t._notifyRemoved(a,i.entry))}))}},{key:"clearAll",value:function(){var e=this;this._db.forEach((function(t,i){return e._notifyRemoved(i,t.entry)})),this._size=0,this._db.clear()}},{key:"_getHitRate",value:function(){return this._hit/(this._hit+this._miss)}},{key:"_notifyRemoved",value:function(e,t){this._removeFuncs.forEach((function(i){e.startsWith(i[0])&&i[1](t)}))}},{key:"_checkSizeLimit",value:function(){if(!(this._size<=this._maxSize)){var e,t=Object(n.a)(this._db);try{for(t.s();!(e=t.n()).done;){var i=Object(a.a)(e.value,2),r=i[0],s=i[1];if(this._db.delete(r),s.lives<=1?(this._size-=s.size,this._notifyRemoved(r,s.entry)):(--s.lives,this._db.set(r,s)),this._size<=.9*this.maxSize)return}}catch(c){t.e(c)}finally{t.f()}}}}]),e}()},825:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var a=i(2),n=i(3),r=i(812),s=function(){function e(t,i){Object(a.a)(this,e),this._storage=new r.c,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}return Object(n.a)(e,[{key:"put",value:function(e,t,i){this._storage.put(e,t,i,1)}},{key:"pop",value:function(e){return this._storage.pop(e)}},{key:"get",value:function(e){return this._storage.get(e)}},{key:"clear",value:function(){this._storage.clearAll()}},{key:"destroy",value:function(){this._storage.clearAll()}},{key:"maxSize",get:function(){return this._storage.maxSize},set:function(e){this._storage.maxSize=e}}]),e}()},926:function(e,t,i){"use strict";i.d(t,"a",(function(){return R}));var a=i(10),n=i.n(a),r=i(21),s=i(9),c=i(2),o=i(3),l=i(5),u=i(6),h=i(0),v=(i(13),i(14)),f=i(1),p=i(73),b=i(8),d=i(23),y=i(11),m=(i(19),i(20),i(129)),_=i(16),O=i(102),g=i(33),j=i(81),w=i(57),k=i(30),S=i(825),z=i(24),x=i(134),T=function(){function e(){Object(c.a)(this,e),this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}return Object(o.a)(e,[{key:"getAvailability",value:function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;var i=(e-this.location.top)*this.location.width+(t-this.location.left),a=i%8,n=i>>3,r=this._tileAvailabilityBitSet;return n<0||n>r.length?"unknown":r[n]&1<<a?"available":"unavailable"}},{key:"_updateFromData",value:function(e){for(var t=this.location.width,i=this.location.height,a=!0,n=!0,r=Math.ceil(t*i/8),s=new Uint8Array(r),c=0,o=0;o<e.length;o++){var l=o%8;e[o]?(n=!1,s[c]|=1<<l):a=!1,7===l&&++c}n?this._allAvailability="unavailable":a?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=s,this.byteSize+=s.length)}}],[{key:"fromDefinition",value:function(t,i){var a=t.service.request||j.default,n=t.row,r=t.col,c=t.width,o=t.height,l={query:{f:"json"}};return i=i?Object(s.a)(Object(s.a)({},l),i):l,a(function(e){var t;if("vector-tile"===e.service.type)t="".concat(e.service.url,"/tilemap/").concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height);else{var i=e.service.tileServers;t="".concat(i&&i.length?i[e.row%i.length]:e.service.url,"/tilemap/").concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height)}var a=e.service.query;return a&&(t="".concat(t,"?").concat(a)),t}(t),i).then((function(e){return e.data})).catch((function(e){if(e&&e.details&&422===e.details.httpStatus)return{location:{top:n,left:r,width:c,height:o},valid:!0,data:Object(x.b)(c*o,0)};throw e})).then((function(t){if(t.location&&(t.location.top!==n||t.location.left!==r||t.location.width!==c||t.location.height!==o))throw new d.a("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:n,left:r,width:c,height:o}});return e.fromJSON(t)}))}},{key:"fromJSON",value:function(t){e.validateJSON(t);var i=new e;return i.location=Object.freeze(Object(z.a)(t.location)),i._updateFromData(t.data),Object.freeze(i)}},{key:"validateJSON",value:function(e){if(!e||!e.location)throw new d.a("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new d.a("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new d.a("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new d.a("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new d.a("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}}]),e}();function A(e){return"".concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height)}var L,D=v.a.getLogger("esri.layers.support.TilemapCache"),R=L=function(e){Object(l.a)(i,e);var t=Object(u.a)(i);function i(e){var a;return Object(c.a)(this,i),(a=t.call(this,e))._handles=new w.a,a._pendingTilemapRequests={},a._availableLevels={},a.levels=5,a.cacheByteSize=2097152,a.request=j.default,a._prefetchingEnabled=!0,a}return Object(o.a)(i,[{key:"initialize",value:function(){var e=this;this._tilemapCache=new S.a(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(function(){return e._initializeTilemapDefinition()})),Object(k.a)(this,"layer.tileInfo.lods",(function(t){return e._initializeAvailableLevels(t)}),!0)]),this._initializeTilemapDefinition()}},{key:"destroy",value:function(){this._handles&&(this._handles.destroy(),this._handles=null)}},{key:"castLevels",value:function(e){return e<=2?(D.error("Minimum levels for Tilemap is 3, but got ",e),3):e}},{key:"size",get:function(){return 1<<this.levels}},{key:"fetchTilemap",value:function(e,t,i,a){var n=this;if(!this._availableLevels[e])return Object(_.t)(new d.a("tilemap-cache:level-unavailable","Level ".concat(e," is unavailable in the service")));var r=this._tmpTilemapDefinition,c=this._tilemapFromCache(e,t,i,r);if(c)return Object(_.u)(c);var o=a&&a.signal;return a=Object(s.a)(Object(s.a)({},a),{},{signal:null}),Object(_.c)((function(e,t){Object(_.r)(o,(function(){return t(Object(_.e)())}));var i=A(r),s=n._pendingTilemapRequests[i];if(!s){s=T.fromDefinition(r,a).then((function(e){return n._tilemapCache.put(i,e,e.byteSize),e}));var c=function(){return delete n._pendingTilemapRequests[i]};n._pendingTilemapRequests[i]=s,s.then(c,c)}s.then(e,t)}))}},{key:"getAvailability",value:function(e,t,i){if(!this._availableLevels[e])return"unavailable";var a=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return a?a.getAvailability(t,i):"unknown"}},{key:"getAvailabilityUpsample",value:function(e,t,i,a){a.level=e,a.row=t,a.col=i;var n=this.layer.tileInfo;for(n.updateTileInfo(a);;){var r=this.getAvailability(a.level,a.row,a.col);if("unavailable"!==r)return r;if(!n.upsampleTile(a))return"unavailable"}}},{key:"fetchAvailability",value:function(e,t,i,a){return this._availableLevels[e]?this.fetchTilemap(e,t,i,a).catch((function(e){return e})).then((function(a){if(a instanceof T){var n=a.getAvailability(t,i);return"unavailable"===n?Object(_.t)(new d.a("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):n}if(Object(_.n)(a))throw a;return"unknown"})):Object(_.t)(new d.a("tilemap-cache:level-unavailable","Level ".concat(e," is unavailable in the service")))}},{key:"fetchAvailabilityUpsample",value:function(e,t,i,a,n){var r=this;a.level=e,a.row=t,a.col=i;var s=this.layer.tileInfo;s.updateTileInfo(a);var c=this.fetchAvailability(e,t,i,n).catch((function(e){if(Object(_.n)(e))throw e;if(s.upsampleTile(a))return r.fetchAvailabilityUpsample(a.level,a.row,a.col,a);throw e}));return this._fetchAvailabilityUpsamplePrefetch(a.id,e,t,i,n,c),c}},{key:"_fetchAvailabilityUpsamplePrefetch",value:function(){var e=Object(r.a)(n.a.mark((function e(t,i,a,r,c,o){var l,u,h,v,f,p,b,d,y,m=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._prefetchingEnabled){e.next=2;break}return e.abrupt("return");case 2:if(l="prefetch-".concat(t),!this._handles.has(l)){e.next=5;break}return e.abrupt("return");case 5:return u=Object(_.d)(),o.then((function(){return u.abort()}),(function(){return u.abort()})),h=!1,v={remove:function(){h||(h=!0,u.abort())}},this._handles.add(v,l),e.next=12,Object(O.c)(10,u.signal).catch((function(){}));case 12:if(h||(h=!0,this._handles.remove(l)),!Object(_.o)(u)){e.next=15;break}return e.abrupt("return");case 15:for(f={id:t,level:i,row:a,col:r},p=Object(s.a)(Object(s.a)({},c),{},{signal:u.signal}),b=this.layer.tileInfo,d=function(e){var t=m.fetchAvailability(f.level,f.row,f.col,p);L._prefetches.push(t);var i=function(){L._prefetches.removeUnordered(t)};t.then(i,i)},y=0;L._prefetches.length<L._maxPrefetch&&b.upsampleTile(f);++y)d();case 18:case"end":return e.stop()}}),e,this)})));return function(t,i,a,n,r,s){return e.apply(this,arguments)}}()},{key:"_initializeTilemapDefinition",value:function(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?Object(y.C)(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}}},{key:"_tilemapFromCache",value:function(e,t,i,a){a.level=e,a.row=t-t%this.size,a.col=i-i%this.size;var n=A(a);return this._tilemapCache.get(n)}},{key:"_initializeAvailableLevels",value:function(e){var t=this;this._availableLevels={},e&&e.forEach((function(e){return t._availableLevels[e.level]=!0}))}},{key:"test",get:function(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:function(t,i,a){return!!e._tilemapFromCache(t,i,a,e._tmpTilemapDefinition)}}}}]),i}(g.a);R._maxPrefetch=4,R._prefetches=new m.a({initialSize:L._maxPrefetch}),Object(h.a)([Object(f.b)({constructOnly:!0,type:Number})],R.prototype,"levels",void 0),Object(h.a)([Object(p.a)("levels")],R.prototype,"castLevels",null),Object(h.a)([Object(f.b)({readOnly:!0,dependsOn:["levels"],type:Number})],R.prototype,"size",null),Object(h.a)([Object(f.b)({constructOnly:!0,type:Number})],R.prototype,"cacheByteSize",void 0),Object(h.a)([Object(f.b)({constructOnly:!0})],R.prototype,"layer",void 0),Object(h.a)([Object(f.b)({constructOnly:!0})],R.prototype,"request",void 0),R=L=Object(h.a)([Object(b.a)("esri.layers.support.TilemapCache")],R)},950:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return r}));var a=i(9),n=i(383),r={type:n.a,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:s}}}}};function s(e,t,i,r){if(!e)return null;var s=t.minScale,c=t.maxScale,o=t.minLOD,l=t.maxLOD;if(null!=o&&null!=l)return r&&r.ignoreMinMaxLOD?n.a.fromJSON(e):n.a.fromJSON(Object(a.a)(Object(a.a)({},e),{},{lods:e.lods.filter((function(e){var t=e.level;return null!=t&&t>=o&&t<=l}))}));if(0!==s&&0!==c){var u=function(e){return Math.round(1e4*e)/1e4},h=s?u(s):1/0,v=c?u(c):-1/0;return n.a.fromJSON(Object(a.a)(Object(a.a)({},e),{},{lods:e.lods.filter((function(e){var t=u(e.scale);return t<=h&&t>=v}))}))}return n.a.fromJSON(e)}},990:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var a=i(2),n=i(3),r=i(5),s=i(6),c=i(0),o=(i(13),i(14),i(15),i(1)),l=i(63),u=i(8),h=(i(11),i(19),i(20),i(44)),v=(i(77),i(950)),f=i(926),p=function(e){var t=function(e){Object(r.a)(i,e);var t=Object(s.a)(i);function i(){var e;return Object(a.a)(this,i),(e=t.apply(this,arguments)).copyright=null,e.minScale=0,e.maxScale=0,e.spatialReference=null,e.tileInfo=null,e.tilemapCache=null,e}return Object(n.a)(i,[{key:"readMinScale",value:function(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}},{key:"readMaxScale",value:function(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}},{key:"supportsBlankTile",get:function(){return this.version>=10.2}},{key:"readTilemapCache",value:function(e,t){return t.capabilities&&t.capabilities.indexOf("Tilemap")>-1?new f.a({layer:this}):null}}]),i}(e);return Object(c.a)([Object(o.b)({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),Object(c.a)([Object(o.b)()],t.prototype,"minScale",void 0),Object(c.a)([Object(l.a)("service","minScale")],t.prototype,"readMinScale",null),Object(c.a)([Object(o.b)()],t.prototype,"maxScale",void 0),Object(c.a)([Object(l.a)("service","maxScale")],t.prototype,"readMaxScale",null),Object(c.a)([Object(o.b)({type:h.a})],t.prototype,"spatialReference",void 0),Object(c.a)([Object(o.b)({readOnly:!0,dependsOn:["version"]})],t.prototype,"supportsBlankTile",null),Object(c.a)([Object(o.b)(v.b)],t.prototype,"tileInfo",void 0),Object(c.a)([Object(o.b)()],t.prototype,"tilemapCache",void 0),Object(c.a)([Object(l.a)("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),Object(c.a)([Object(o.b)()],t.prototype,"version",void 0),t=Object(c.a)([Object(u.a)("esri.layers.mixins.ArcGISCachedService")],t)}}}]);
//# sourceMappingURL=27.28164719.chunk.js.map