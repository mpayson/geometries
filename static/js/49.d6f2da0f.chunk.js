(this.webpackJsonpgeometries=this.webpackJsonpgeometries||[]).push([[49,9,50,70],{1005:function(e,t,r){"use strict";var n=r(2),a=r(3),i=r(5),s=r(6),u=r(16),l=r(809),o=r(927),c=r(835),d=r(848),f=r(961),p=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._relation="",a._relationGeom=null,a._relationString="",a.declaredClass="esri.arcade.featureset.actions.SpatialFilter",a._relationString=e.relationString,a._parent=e.parentfeatureset,a._maxProcessing=40,a._relation=e.relation,a._relationGeom=e.relationGeom,a}return Object(a.a)(r,[{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._parent._getFilteredSet("esriSpatialRelRelation"!==t._relation?t._relation:t._relation+":"+t._relationString,t._relationGeom,null,null,e)})).then((function(r){return t._checkCancelled(e),t._wset=new c.a(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset})):Object(u.u)(this._wset)}},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);return t===l.b.NotInFeatureSet?t:void 0===(t=this._idstates[e])?l.b.Unknown:t}},{key:"_getFeature",value:function(e,t,r){return this._parent._getFeature(e,t,r)}},{key:"_getFeatures",value:function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}},{key:"_featureFromCache",value:function(e){return this._parent._featureFromCache(e)}},{key:"executeSpatialRelationTest",value:function(e){if(null===e.geometry)return Object(u.u)(!1);switch(this._relation){case"esriSpatialRelEnvelopeIntersects":var t=Object(l.p)(this._relationGeom),r=Object(l.p)(e.geometry);return Object(o.q)(t,r);case"esriSpatialRelIntersects":return Object(o.q)(this._relationGeom,e.geometry);case"esriSpatialRelContains":return Object(o.c)(this._relationGeom,e.geometry);case"esriSpatialRelOverlaps":return Object(o.t)(this._relationGeom,e.geometry);case"esriSpatialRelWithin":return Object(o.C)(this._relationGeom,e.geometry);case"esriSpatialRelTouches":return Object(o.A)(this._relationGeom,e.geometry);case"esriSpatialRelCrosses":return Object(o.d)(this._relationGeom,e.geometry);case"esriSpatialRelRelation":return Object(o.w)(this._relationGeom,e.geometry,this._relationString)}}},{key:"_fetchAndRefineFeatures",value:function(e,t,r){var n=this,a=new c.a([],e,!1,null),i=Math.min(t,e.length);return this._parent._getFeatures(a,-1,i,r).then((function(){n._checkCancelled(r);for(var t=[],a=0;a<i;a++){var s=n._parent._featureFromCache(e[a]);t.push(n.executeSpatialRelationTest(s))}return Object(u.b)(t)})).then((function(r){for(var a=0;a<t;a++)!0===r[a]?n._idstates[e[a]]=l.b.InFeatureSet:n._idstates[e[a]]=l.b.NotInFeatureSet;return"success"}))}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this._ensureLoaded().then((function(){return i._parent._getFilteredSet("esriSpatialRelRelation"!==i._relation?i._relation:i._relation+":"+i._relationString,i._relationGeom,r,n,a)})).then((function(e){return i._checkCancelled(a),null!==t?new c.a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,i._clonePageDefinition(e.pagesDefinition)):new c.a(e._candidates.slice(0),e._known.slice(0),e._ordered,i._clonePageDefinition(e.pagesDefinition))}))}},{key:"_stat",value:function(e,t,r,n,a,i,s){var l=this;return""!==r?Object(u.u)({calculated:!1}):this._parent._stat(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,i,s).then((function(u){return!1===u.calculated?null===a&&""===r&&null===n?l._manualStat(e,t,i,s):{calculated:!1}:u}))}},{key:"_canDoAggregates",value:function(e,t,r,n,a){return""!==r||null!==n||null===this._parent?Object(u.u)(!1):this._parent._canDoAggregates(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a)}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,s){return null===this._parent?Object(u.t)(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,i,s)}}],[{key:"registerAction",value:function(){d.a._featuresetFunctions.intersects=function(e){return null==e?new f.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:e})},d.a._featuresetFunctions.envelopeIntersects=function(e){return null==e?new f.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:e})},d.a._featuresetFunctions.contains=function(e){return null==e?new f.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:e})},d.a._featuresetFunctions.overlaps=function(e){return null==e?new f.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:e})},d.a._featuresetFunctions.within=function(e){return null==e?new f.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:e})},d.a._featuresetFunctions.touches=function(e){return null==e?new f.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:e})},d.a._featuresetFunctions.crosses=function(e){return null==e?new f.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:e})},d.a._featuresetFunctions.relate=function(e,t){return null==e?new f.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:e,relationString:t})}}}]),r}(d.a);t.a=p},1033:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(2),a=r(3),i=r(16),s=function(){function e(){Object(n.a)(this,e),this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}return Object(a.a)(e,[{key:"add",value:function(e,t,r){this._layerById[t]=r,this._layerByName[e]=r}},{key:"featureSetByName",value:function(e){return void 0===this._layerByName[e]?this.resolvePromise(null):this.resolvePromise(this._layerByName[e])}},{key:"featureSetById",value:function(e){return void 0===this._layerById[e]?this.resolvePromise(null):this.resolvePromise(this._layerById[e])}},{key:"castToText",value:function(){return"object, FeatureSetCollection"}},{key:"resolvePromise",value:function(e){return Object(i.u)(e)}}]),e}()},1034:function(e,t,r){"use strict";r.d(t,"a",(function(){return j})),r.d(t,"b",(function(){return g})),r.d(t,"c",(function(){return m})),r.d(t,"d",(function(){return O})),r.d(t,"e",(function(){return _}));var n=r(12),a=r(5),i=r(6),s=r(2),u=r(3),l=r(16),o=r(44),c=r(75),d=r(809),f=r(990),p=r(835),h=r(710),y=r(885),v=r(848),b=function(){function e(){Object(s.a)(this,e),this.sqlRewritable=!1}return Object(u.a)(e,[{key:"postInitialization",value:function(e,t){}}]),e}(),m=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e){var n;return Object(s.a)(this,r),(n=t.call(this)).field=e,n.sqlRewritable=!0,n}return Object(u.a)(r,[{key:"extractValue",value:function(e){return e.attributes[this.field.name]}},{key:"rewriteSql",value:function(e){return{rewritten:this.sqlRewritable,where:e}}}]),r}(b),g=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e,n,a){var i;return Object(s.a)(this,r),(i=t.call(this)).originalField=e,i.sqlRewritable=!0,i.field=Object(d.c)(e),i.field.name=n,i.field.alias=a,i}return Object(u.a)(r,[{key:"rewriteSql",value:function(e,t){return{rewritten:this.sqlRewritable,where:Object(y.g)(e,this.field.name,this.originalField.name,t.getFieldsIndex())}}},{key:"extractValue",value:function(e){return e.attributes[this.originalField.name]}}]),r}(b),_=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e,n,a){var i;for(var u in Object(s.a)(this,r),(i=t.call(this)).field=e,i.codefield=n,i.lkp=a,i.reverseLkp={},a)i.reverseLkp[a[u]]=u;return i.sqlRewritable=!0,i}return Object(u.a)(r,[{key:"rewriteSql",value:function(e,t){var n=this.evaluateNodeToWhereClause(e.parseTree,d.a.Standardised,this.field.name,this.codefield instanceof h.WhereClause?Object(y.i)(this.codefield,d.a.Standardised):this.codefield,e.parameters);return n.indexOf(r.BADNESS)>=0?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:h.WhereClause.create(n,t._parent.getFieldsIndex())}}},{key:"evaluateNodeToWhereClause",value:function(e,t){var a,i,s,u,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4?arguments[4]:void 0;switch(e.type){case"interval":return Object(y.b)(this.evaluateNodeToWhereClause(e.value,t,l,o,c),e.qualifier,e.op);case"case_expression":var d=" CASE ";"simple"===e.format&&(d+=this.evaluateNodeToWhereClause(e.operand,t,l,r.BADNESS,c));for(var f=0;f<e.clauses.length;f++)d+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[f].operand,t,l,r.BADNESS,c)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[f].value,t,l,r.BADNESS,c);return null!==e.else&&(d+=" ELSE "+this.evaluateNodeToWhereClause(e.else,t,l,r.BADNESS,c)),d+=" END ";case"param":var p=c[e.value.toLowerCase()];if("string"==typeof p)return"'"+c[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(p instanceof Date)return Object(y.d)(p,t);if(p instanceof Array){for(var h=[],v=0;v<p.length;v++)"string"==typeof p[v]?h.push("'"+p[v].toString().replace(/'/g,"''")+"'"):p[v]instanceof Date?h.push(Object(y.d)(p[v],t)):h.push(p[v].toString());return h}return p.toString();case"expr_list":i=[];var b,m=Object(n.a)(e.value);try{for(m.s();!(b=m.n()).done;){var g=b.value;i.push(this.evaluateNodeToWhereClause(g,t,l,o,c))}}catch(C){m.e(C)}finally{m.f()}return i;case"unary_expr":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,t,l,r.BADNESS,c)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" AND "+this.evaluateNodeToWhereClause(e.right,t,l,o,c)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" OR "+this.evaluateNodeToWhereClause(e.right,t,l,o,c)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IS NOT NULL )";case"IN":if(a=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){var _,O=[],j=!0,w=Object(n.a)(e.right.value);try{for(w.s();!(_=w.n()).done;){var S=_.value;if("string"!==S.type){j=!1;break}if(void 0===this.lkp[S.value]){j=!1;break}O.push(this.lkp[S.value].toString())}}catch(C){w.e(C)}finally{w.f()}if(j)return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+O.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,t,l,o,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+a.join(",")+")) "}return(u=this.evaluateNodeToWhereClause(e.right,t,l,o,c))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+u.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+u+")) ";case"NOT IN":if(a=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){var F,I=[],k=!0,x=Object(n.a)(e.right.value);try{for(x.s();!(F=x.n()).done;){var T=F.value;if("string"!==T.type){k=!1;break}if(void 0===this.lkp[T.value]){k=!1;break}I.push(this.lkp[T.value].toString())}}catch(C){x.e(C)}finally{x.f()}if(k)return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+I.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,t,l,o,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+a.join(",")+")) "}return(u=this.evaluateNodeToWhereClause(e.right,t,l,o,c))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+u.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+u+")) ";case"BETWEEN":return s=this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"NOTBETWEEN":return s=this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" NOT BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") ";case"<>":case"=":if("column_ref"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+o+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column_ref"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+o+") ";return" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return Object(y.d)(e.value,t);case"number":return e.value.toString();case"current_time":return Object(y.e)("date"===e.mode,t);case"column_ref":return l&&l.toLowerCase()===e.column.toLowerCase()?"("+o+")":e.column;case"function":var E=this.evaluateNodeToWhereClause(e.args,t,l,r.BADNESS,c);return Object(y.k)(e.name,E,t)}throw new Error("Unsupported sql syntax "+e.type)}},{key:"extractValue",value:function(e){return this.codefield instanceof h.WhereClause?this.reverseLkp[this.codefield.calculateValueCompiled(e)]:this.reverseLkp[e.attributes[this.codefield]]}}]),r}(b);_.BADNESS="_!!!_BAD_LKP_!!!!";var O=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e,n){var a;return Object(s.a)(this,r),(a=t.call(this)).field=e,a.sql=n,a}return Object(u.a)(r,[{key:"rewriteSql",value:function(e,t){return{rewritten:!0,where:Object(y.g)(e,this.field.name,Object(y.i)(this.sql,d.a.Standardised),t.getFieldsIndex())}}},{key:"extractValue",value:function(e){return this.sql.calculateValueCompiled(e)}}]),r}(b),j=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e){var n;return Object(s.a)(this,r),(n=t.call(this,e))._calcFunc=null,n.declaredClass="esri.arcade.featureset.actions.Adapted",n.adaptedFields=null,n._extraFilter=null,n._extraFilter=e.extraFilter,n._parent=e.parentfeatureset,n._maxProcessing=30,n.adaptedFields=e.adaptedFields,n}return Object(u.a)(r,[{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new o.a({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=d.m.point,this.typeIdField="",this.types=null),this.fields=[];var e,t=Object(n.a)(this.adaptedFields);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.postInitialization(this,this._parent),this.fields.push(r.field)}}catch(a){t.e(a)}finally{t.f()}}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._extraFilter?t._getFilteredSet("",null,null,null,e):t._parent._getSet(e)})).then((function(r){return t._checkCancelled(e),t._wset=new p.a(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset})):Object(l.u)(this._wset)}},{key:"_isInFeatureSet",value:function(e){return this._parent._isInFeatureSet(e)}},{key:"_getFeatures",value:function(e,t,r,a){var i=this,s=[];-1!==t&&void 0===this._featureCache[t]&&s.push(t);var u=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,u))return this._expandPagedSet(e,u,0,0,a).then((function(){return i._getFeatures(e,t,r,a)}));for(var o=0,d=e._lastFetchedIndex;d<e._known.length&&(++o<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[d]]&&(e._known[d]!==t&&s.push(e._known[d]),s.length>=u-1)));d++);if(0===s.length)return Object(l.u)("success");e=new p.a([],s,e._ordered,null);var h=Math.min(s.length,r);return this._parent._getFeatures(e,-1,h,a).then((function(){i._checkCancelled(a);for(var e=[],t=0;t<h;t++){var r=i._parent._featureFromCache(s[t]);void 0!==r&&e.push({geometry:r.geometry,attributes:r.attributes,id:s[t]})}for(var u=0,l=e;u<l.length;u++){var o,d=l[u],p=[],y=Object(n.a)(i.adaptedFields);try{for(y.s();!(o=y.n()).done;){var v=o.value;p[v.field.name]=v.extractValue(d)}}catch(b){y.e(b)}finally{y.f()}i._featureCache[d.id]=new c.a({attributes:p,geometry:Object(f.a)(d.geometry)})}return"success"}))}},{key:"_fetchAndRefineFeatures",value:function(){return Object(l.t)(new Error("Fetch and Refine should not be called in this featureset"))}},{key:"_getFilteredSet",value:function(e,t,r,a,i){var s,u=this,l=this.reformulateWithoutAdaptions(r);s=l.cannot,r=l.where;var o=!1;if(null!==a){o=!0;var c,d=[],f=Object(n.a)(this.adaptedFields);try{for(f.s();!(c=f.n()).done;){var h=c.value;if(!(h instanceof m)&&!0===a.scanForField(h.field.name)){if(!(h instanceof g)){a=null,o=!1;break}d.push({field:h.field.name,newfield:h.originalField.name})}}}catch(v){f.e(v)}finally{f.f()}a&&d.length>0&&(a=a.replaceFields(d))}return null!==r?null!==this._extraFilter&&(r=Object(y.a)(this._extraFilter,r)):r=this._extraFilter,this._ensureLoaded().then((function(){return u._parent._getFilteredSet(e,t,r,a,i)})).then((function(e){return u._checkCancelled(i),!0===s?new p.a(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===o&&e._ordered,u._clonePageDefinition(e.pagesDefinition)):new p.a(e._candidates.slice(0),e._known.slice(0),!0===o&&e._ordered,u._clonePageDefinition(e.pagesDefinition))}))}},{key:"reformulateWithoutAdaptions",value:function(e){var t={cannot:!1,where:e};if(null!==e){var r,a=Object(n.a)(this.adaptedFields);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(!0===Object(y.h)(e,i.field.name)){var s=i.rewriteSql(e,this);if(!0!==s.rewritten){t.cannot=!0,t.where=null;break}t.where=s.where}}}catch(u){a.e(u)}finally{a.f()}}return t}},{key:"_stat",value:function(e,t,r,n,a,i,s){var u=this,o=!1,c=this.reformulateWithoutAdaptions(t);return o=c.cannot,t=c.where,c=this.reformulateWithoutAdaptions(a),o=o||c.cannot,null!==(a=c.where)?null!==this._extraFilter&&(a=Object(y.a)(this._extraFilter,a)):a=this._extraFilter,!0===o?null===a&&""===r&&null===n?this._manualStat(e,t,i,s):Object(l.u)({calculated:!1}):this._parent._stat(e,t,r,n,a,i,s).then((function(l){return!1===l.calculated?null===a&&""===r&&null===n?u._manualStat(e,t,i,s):{calculated:!1}:l}))}},{key:"_canDoAggregates",value:function(e,t,r,a,i){if(null===this._parent)return Object(l.u)(!1);for(var s=0;s<e.length;s++){var u,o=Object(n.a)(this.adaptedFields);try{for(o.s();!(u=o.n()).done;){var c=u.value;if(e[s].toLowerCase()===c.field.name.toLowerCase()&&!(c instanceof m))return Object(l.u)(!1)}}catch(g){o.e(g)}finally{o.f()}}for(var d=[],f=0;f<t.length;f++){var p=t[f];if(null!==p.workingexpr){var h=this.reformulateWithoutAdaptions(p.workingexpr);if(h.cannot)return Object(l.u)(!1);var v=p.clone();v.workingexpr=h.where,d.push(v)}else d.push(p)}var b=this.reformulateWithoutAdaptions(i);return b.cannot?Object(l.u)(!1):(null!==(i=b.where)?null!==this._extraFilter&&(i=Object(y.a)(this._extraFilter,i)):i=this._extraFilter,this._parent._canDoAggregates(e,d,r,a,i))}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,s){if(null===this._parent)return Object(l.t)(new Error("Should never be called"));for(var u=[],o=0;o<t.length;o++){var c=t[o];if(null!==c.workingexpr){var d=this.reformulateWithoutAdaptions(c.workingexpr);if(d.cannot)return Object(l.t)(new Error("Should never be called"));var f=c.clone();f.workingexpr=d.where,u.push(f)}else u.push(c)}var p=this.reformulateWithoutAdaptions(a);return p.cannot?Object(l.t)(new Error("Should never be called")):(null!==(a=p.where)?null!==this._extraFilter&&(a=Object(y.a)(this._extraFilter,a)):a=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(e,u,r,n,a,i,s))}}],[{key:"findField",value:function(e,t){var r,a=Object(n.a)(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i.name.toLowerCase()===t.toString().toLowerCase())return i}}catch(s){a.e(s)}finally{a.f()}return null}}]),r}(v.a)},1035:function(e,t,r){"use strict";var n=r(2),a=r(3),i=r(5),s=r(6),u=r(16),l=r(809),o=r(835),c=r(848),d=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._topnum=0,a.declaredClass="esri.arcade.featureset.actions.Top",a._countedin=0,a._maxProcessing=100,a._topnum=e.topnum,a._parent=e.parentfeatureset,a}return Object(a.a)(r,[{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._parent._getSet(e)})).then((function(e){return t._wset=new o.a(e._candidates.slice(0),e._known.slice(0),!1,t._clonePageDefinition(e.pagesDefinition)),t._setKnownLength(t._wset)>t._topnum&&(t._wset._known=t._wset._known.slice(0,t._topnum)),t._setKnownLength(t._wset)>=t._topnum&&(t._wset._candidates=[]),t._wset})):Object(u.u)(this._wset)}},{key:"_setKnownLength",value:function(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length}},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);if(t===l.b.NotInFeatureSet)return t;var r=this._idstates[e];return r===l.b.InFeatureSet||r===l.b.NotInFeatureSet?r:t===l.b.InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=l.b.InFeatureSet,this._countedin++,l.b.InFeatureSet):(this._idstates[e]=l.b.NotInFeatureSet,l.b.NotInFeatureSet):l.b.Unknown}},{key:"_expandPagedSet",value:function(e,t,r,n,a){var i=this;if(null===this._parent)return Object(u.t)(new Error("Parent Paging not implemented"));if(t>this._topnum&&(t=this._topnum),this._countedin>=this._topnum&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset){var s=e._known.length;return s>0&&"GETPAGES"===e._known[s-1]&&(e._known.length=s-1),(s=e._candidates.length)>0&&"GETPAGES"===e._candidates[s-1]&&(e._candidates.length=s-1),Object(u.u)("success")}return this._parent._expandPagedSet(e,t,r,n,a).then((function(t){return i._setKnownLength(e)>i._topnum&&(e._known.length=i._topnum),i._setKnownLength(e)>=i._topnum&&(e._candidates.length=0),t}))}},{key:"_getFeatures",value:function(e,t,r,n){var a=this,i=[],s=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,s))return this._expandPagedSet(e,s,0,0,n).then((function(){return a._getFeatures(e,t,r,n)}));-1!==t&&void 0===this._featureCache[t]&&i.push(t);for(var l=0,c=e._lastFetchedIndex;c<e._known.length&&(++l<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[c]]&&(e._known[c]!==t&&i.push(e._known[c]),i.length>s-1)));c++);if(0===i.length)return Object(u.u)("success");var d=new o.a([],i,!1,null),f=Math.min(i.length,r);return this._parent._getFeatures(d,-1,f,n).then((function(){for(var e=0;e<f;e++){var t=a._parent._featureFromCache(i[e]);void 0!==t&&(a._featureCache[i[e]]=t)}return"success"}))}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this._ensureLoaded().then((function(){return i._getSet(a)})).then((function(e){return new o.a(e._candidates.slice(0).concat(e._known.slice(0)),[],!1,i._clonePageDefinition(e.pagesDefinition))}))}},{key:"_refineKnowns",value:function(e,t){for(var r=0,n=null,a=[],i=0;i<e._candidates.length;i++){var s=this._isInFeatureSet(e._candidates[i]);if(s===l.b.InFeatureSet){if(e._known.push(e._candidates[i]),r+=1,null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),e._known.length>=this._topnum)break}else if(s===l.b.NotInFeatureSet)null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),r+=1;else if(s===l.b.Unknown)break;if(r>=t)break}null!==n&&a.push(n);for(var u=a.length-1;u>=0;u--)e._candidates.splice(a[u].start,a[u].end-a[u].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])}},{key:"_stat",value:function(){return Object(u.u)({calculated:!1})}},{key:"_canDoAggregates",value:function(){return Object(u.u)(!1)}}],[{key:"registerAction",value:function(){c.a._featuresetFunctions.top=function(e){return new r({parentfeatureset:this,topnum:e})}}}]),r}(c.a);t.a=d},1036:function(e,t,r){"use strict";var n=r(12),a=r(2),i=r(3),s=r(5),u=r(6),l=r(16),o=r(111),c=r(75),d=r(246),f=r(809),p=r(835),h=r(885),y=r(848),v=r(837),b=r(278),m=r(827),g=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",n._removeGeometry=!1,n._overrideFields=null,n._forceIsTable=!1,e.spatialReference&&(n.spatialReference=e.spatialReference),n._transparent=!0,n._maxProcessing=1e3,n._layer=e.layer,n._wset=null,!0===e.isTable&&(n._forceIsTable=!0),void 0!==e.outFields&&(n._overrideFields=e.outFields),void 0!==e.includeGeometry&&(n._removeGeometry=!1===e.includeGeometry),n}return Object(i.a)(r,[{key:"_maxQueryRate",value:function(){return f.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"load",value:function(){var e=this;return null===this._loadPromise&&(this._loadPromise=Object(l.c)((function(t,r){if(!0===e._layer.loaded)return e._initialiseFeatureSet(),void t(e);e._layer.when().then((function(){try{e._initialiseFeatureSet(),t(e)}catch(t){r(t)}}),r),e._layer.load()}))),this._loadPromise}},{key:"gdbVersion",get:function(){return""}},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{var e,t=[],r=Object(n.a)(this.fields);try{for(r.s();!(e=r.n()).done;){var a=e.value;if("oid"===a.type)t.push(a);else{var i,s=Object(n.a)(this._layer.outFields);try{for(s.s();!(i=s.n()).done;){if(i.value.toLowerCase()===a.name.toLowerCase()){t.push(a);break}}}catch(m){s.e(m)}finally{s.f()}}}}catch(m){r.e(m)}finally{r.f()}this.fields=t}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var u,l=[],o=[],c=Object(n.a)(this.fields);try{for(c.s();!(u=c.n()).done;){var d=u.value;if("oid"===d.type)l.push(d),o.push(d.name);else{var p,h=Object(n.a)(this._overrideFields);try{for(h.s();!(p=h.n()).done;){if(p.value.toLowerCase()===d.name.toLowerCase()){l.push(d),o.push(d.name);break}}}catch(m){h.e(m)}finally{h.f()}}}}catch(m){c.e(m)}finally{c.f()}this.fields=l,this._overrideFields=o}this.objectIdField=this._layer.objectIdField;var y,v=Object(n.a)(this.fields);try{for(v.s();!(y=v.n()).done;){var b=y.value;"global-id"===b.type&&(this.globalIdField=b.name)}}catch(m){v.e(m)}finally{v.f()}this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=f.a.Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}},{key:"isTable",value:function(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}},{key:"_isInFeatureSet",value:function(){return f.b.InFeatureSet}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,null,e)})).then((function(e){return t._wset=e,e})):Object(l.u)(this._wset)}},{key:"_changeFeature",value:function(e){var t,r={},a=Object(n.a)(this.fields);try{for(a.s();!(t=a.n()).done;){var i=t.value;r[i.name]=e.attributes[i.name]}}catch(s){a.e(s)}finally{a.f()}return new c.a({geometry:!0===this._removeGeometry?null:e.geometry,attributes:r})}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this,s="",u=!1;if(null!==n&&(s=n.constructClause(),u=!0),this.isTable()&&t&&null!==e&&""!==e){var o=new p.a([],[],!0,null);return Object(l.u)(o)}var c=new b.a;return c.where=null===r?null===t?"1=1":"":Object(h.i)(r,f.a.Standardised),c.spatialRelationship=this._makeRelationshipEnum(e),c.outSpatialReference=this.spatialReference,c.orderByFields=""!==s?s.split(","):null,c.geometry=null===t?null:t,c.returnGeometry=!0,c.relationParameter=this._makeRelationshipParam(e),this._layer.queryFeatures(c).then((function(e){if(null===e)return new p.a([],[],u,null);i._checkCancelled(a);var t=[];return e.features.forEach((function(e){var r=e.attributes[i._layer.objectIdField];t.push(r),i._featureCache[r]=i._changeFeature(e)})),new p.a([],t,u,null)}))}},{key:"_makeRelationshipEnum",value:function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}},{key:"_makeRelationshipParam",value:function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""}},{key:"_queryAllFeatures",value:function(){var e=this;if(this._wset)return Object(l.u)(this._wset);var t=new b.a;return t.where="1=1",this._ensureLoaded().then((function(){if(e._layer.source&&e._layer.source.items){var r=[];return e._layer.source.items.forEach((function(t){var n=t.attributes[e._layer.objectIdField];r.push(n),e._featureCache[n]=e._changeFeature(t)})),e._wset=new p.a([],r,!1,null),e._wset}return e._layer.queryFeatures(t).then((function(t){var r=[];return t.features.forEach((function(t){var n=t.attributes[e._layer.objectIdField];r.push(n),e._featureCache[n]=e._changeFeature(t)})),e._wset=new p.a([],r,!1,null),e._wset}))}))}},{key:"_getFeatures",value:function(e,t,r){var n=[];-1!==t&&void 0===this._featureCache[t]&&n.push(t);for(var a=e._lastFetchedIndex;a<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[a]]&&(e._known[a]!==t&&n.push(e._known[a]),n.length>r)));a++);return 0===n.length?Object(l.u)("success"):Object(l.t)(new Error("Unaccounted for Features. Not in Feature Collection"))}},{key:"_refineSetBlock",value:function(e){return Object(l.u)(e)}},{key:"_stat",value:function(){return Object(l.u)({calculated:!1})}},{key:"_canDoAggregates",value:function(){return Object(l.u)(!1)}},{key:"relationshipMetaData",value:function(){return[]}},{key:"nativeCapabilities",value:function(){return{title:this._layer.title,canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}},{key:"queryAttachments",value:function(){return Object(l.u)([])}},{key:"getFeatureByObjectId",value:function(e){var t=new b.a;return t.where=this.objectIdField+"="+e.toString(),this._layer.queryFeatures(t).then((function(e){return 1===e.features.length?e.features[0]:null}))}},{key:"getOwningSystemUrl",value:function(){return Object(l.u)("")}},{key:"getIdentityUser",value:function(){return Object(l.u)("")}}],[{key:"_cloneAttr",value:function(e){var t={};for(var r in e)t[r]=e[r];return t}},{key:"create",value:function(e,t){var a=e.layerDefinition.objectIdField,i=e.layerDefinition.typeIdField?e.layerDefinition.typeIdField:"",s=[];if(e.layerDefinition.types){var u,l=Object(n.a)(e.layerDefinition.types);try{for(l.s();!(u=l.n()).done;){var c=u.value;s.push(v.a.fromJSON(c))}}catch(M){l.e(M)}finally{l.f()}}var f=e.layerDefinition.geometryType;void 0===f&&(f=e.featureSet.geometryType||"");var p=e.featureSet.features,h=t.toJSON();if(""===a||void 0===a){var y,b=!1,g=Object(n.a)(e.layerDefinition.fields);try{for(g.s();!(y=g.n()).done;){var _=y.value;if("oid"===_.type||"esriFieldTypeOID"===_.type){a=_.name,b=!0;break}}}catch(M){g.e(M)}finally{g.f()}if(!1===b){for(var O="FID",j=!0,w=0;j;){var S,F=!0,I=Object(n.a)(e.layerDefinition.fields);try{for(I.s();!(S=I.n()).done;){if(S.value.name===O){F=!1;break}}}catch(M){I.e(M)}finally{I.f()}!0===F?j=!1:O="FID"+(++w).toString()}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:O,alias:O});for(var k=[],x=0;x<p.length;x++)k.push({geometry:e.featureSet.features[x].geometry,attributes:e.featureSet.features[x].attributes?this._cloneAttr(e.featureSet.features[x].attributes):{}}),k[x].attributes[O]=x;p=k,a=O}}var T,E=[],C=Object(n.a)(e.layerDefinition.fields);try{for(C.s();!(T=C.n()).done;){var D=T.value;D instanceof d.a?E.push(D):E.push(d.a.fromJSON(D))}}catch(M){C.e(M)}finally{C.f()}var N=f;switch(N){case"esriGeometryPoint":N="point";break;case"esriGeometryPolyline":N="polyline";break;case"esriGeometryPolygon":N="polygon";break;case"esriGeometryExtent":N="extent";break;case"esriGeometryMultipoint":N="multipoint"}var R,A=Object(n.a)(p);try{for(A.s();!(R=A.n()).done;){var P=R.value;P.geometry&&P.geometry instanceof o.a==0&&(P.geometry.type=N,void 0===P.geometry.spatialReference&&(P.geometry.spatialReference=h))}}catch(M){A.e(M)}finally{A.f()}var L={outFields:["*"],source:p,fields:E,types:s,typeIdField:i,objectIdField:a,spatialReference:t};return L.geometryType=N||"point",new r({layer:new m.default(L),spatialReference:t,isTable:null===N||""===N})}}]),r}(y.a);t.a=g},1126:function(e,t,r){"use strict";r.r(t),r.d(t,"constructAssociationMetaDataFeatureSetFromUrl",(function(){return re})),r.d(t,"constructFeatureSet",(function(){return ee})),r.d(t,"constructFeatureSetFromPortalItem",(function(){return ce})),r.d(t,"constructFeatureSetFromRelationship",(function(){return ne})),r.d(t,"constructFeatureSetFromUrl",(function(){return X})),r.d(t,"createFeatureSetCollectionFromMap",(function(){return se})),r.d(t,"createFeatureSetCollectionFromService",(function(){return ue})),r.d(t,"getPortal",(function(){return le})),r.d(t,"initialiseMetaDataCache",(function(){return $})),r.d(t,"lookupUser",(function(){return oe}));var n=r(9),a=r(2),i=r(3),s=r(5),u=r(6),l=r(12),o=r(16),c=r(104),d=r(81),f=r(124),p=r(385),h=r(809),y=r(1033),v=r(960),b=r(710),m=r(974),g=r(975),_=r(44),O=r(75),j=r(823),w=r(246),S=r(835),F=r(885),I=r(939),k=r(791),x=r(848),T=r(1034),E=r(976),C=function(){function e(){Object(a.a)(this,e)}return Object(i.a)(e,[{key:"clone",value:function(){var t=new e;return t.field=this.field,t.tofieldname=this.tofieldname,t.typeofstat=this.typeofstat,t.workingexpr=this.workingexpr,t}},{key:"toStatisticsName",value:function(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg";default:return"count"}}}],[{key:"parseStatField",value:function(t,r,n){var a=new e;a.field=t;var i=b.WhereClause.create(r,n),s=function(e){if("function"===e.parseTree.type){if(0===e.parseTree.args.value.length)return{name:e.parseTree.name,expr:null};if(e.parseTree.args.value.length>1)throw new Error("Statistic does not have 1 or 0 Parameters");var t=b.WhereClause.create(Object(F.j)(e.parseTree.args.value[0],h.a.Standardised,e.parameters),e.fieldsIndex);return{name:e.parseTree.name,expr:t}}return null}(i);if(null===s)throw new Error("Invalid Statistic Function");var u=s.name.toUpperCase().trim();if("MIN"===u){if(a.typeofstat="MIN",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("MAX"===u){if(a.typeofstat="MAX",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("COUNT"===u)a.typeofstat="COUNT",a.workingexpr=s.expr;else if("STDEV"===u){if(a.typeofstat="STDDEV",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("SUM"===u){if(a.typeofstat="SUM",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("MEAN"===u){if(a.typeofstat="AVG",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("AVG"===u){if(a.typeofstat="AVG",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else{if("VAR"!==u)throw new Error("Invalid Statistic Function");if(a.typeofstat="VAR",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}return a}}]),e}(),D=r(924);function N(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}var R=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e))._decodedStatsfield=[],n._decodedGroupbyfield=[],n._candosimplegroupby=!0,n.phsyicalgroupbyfields=[],n.objectIdField="ROW__ID",n._internalObjectIdField="ROW__ID",n._adaptedFields=[],n.declaredClass="esri.arcade.featureset.actions.Aggregate",n._uniqueIds=1,n._maxQuery=10,n._maxProcessing=10,n._parent=e.parentfeatureset,n._config=e,n}return Object(i.a)(r,[{key:"isTable",value:function(){return!0}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._getFilteredSet("",null,null,null,e).then((function(e){return t._wset=e,t._wset})):Object(o.u)(this._wset)}},{key:"_isInFeatureSet",value:function(){return h.b.InFeatureSet}},{key:"nextUniqueName",value:function(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;var t="T"+this._uniqueIds.toString();return e[t]=1,t}},{key:"convertToEsriFieldType",value:function(e){return e}},{key:"_initialiseFeatureSet",value:function(){var e={},t=!1,r=1,n=this._parent?this._parent.getFieldsIndex():new k.a([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){for(var a=!1,i=0;i<this._config.groupbyfields.length;i++)if(this._config.groupbyfields[i].name.toLowerCase()===this.objectIdField.toLowerCase()){a=!0;break}if(!1===a)for(var s=0;s<this._config.statsfields.length;s++)if(this._config.statsfields[s].name.toLowerCase()===this.objectIdField.toLowerCase()){a=!0;break}!1===a?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}var u,o=Object(l.a)(this._config.statsfields);try{for(o.s();!(u=o.n()).done;){var c=u.value,d=new C;d.field=c.name,d.tofieldname=c.name,d.workingexpr=c.expression instanceof b.WhereClause?c.expression:b.WhereClause.create(c.expression,n),d.typeofstat=N(c.statistic),this._decodedStatsfield.push(d)}}catch(U){o.e(U)}finally{o.f()}this._decodedGroupbyfield=[];var f,p=Object(l.a)(this._config.groupbyfields);try{for(p.s();!(f=p.n()).done;){var y=f.value,v={name:y.name,singlefield:null,tofieldname:y.name,expression:y.expression instanceof b.WhereClause?y.expression:b.WhereClause.create(y.expression,n)};this._decodedGroupbyfield.push(v)}}catch(U){p.e(U)}finally{p.f()}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";var m,g=Object(l.a)(this._parent.fields);try{for(g.s();!(m=g.n()).done;){e[m.value.name.toUpperCase()]=1}}catch(U){g.e(U)}finally{g.f()}this.types=null}else this.geometryType=h.m.point,this.typeIdField="",this.types=null,this.spatialReference=new _.a({wkid:4326});this.fields=[];var O=new C;O.field=this.nextUniqueName(e),O.tofieldname=this.objectIdField,O.workingexpr=b.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex()),O.typeofstat="MIN",this._decodedStatsfield.push(O);var j,S=Object(l.a)(this._decodedGroupbyfield);try{for(S.s();!(j=S.n()).done;){var I=j.value,x=new w.a;if(I.name=this.nextUniqueName(e),x.name=I.tofieldname,x.alias=x.name,Object(F.c)(I.expression)){var E=this._parent.getField(Object(F.i)(I.expression,h.a.Standardised));if(!E)throw new Error("Field is not present for Aggregation");I.name=E.name,I.singlefield=E.name,this.phsyicalgroupbyfields.push(E.name),x.type=E.type}else{x.type=this.convertToEsriFieldType(Object(F.f)(I.expression,this._parent.fields));var D=new w.a;D.name=I.name,D.alias=D.name,this.phsyicalgroupbyfields.push(I.name),this._adaptedFields.push(new T.d(D,I.expression)),this._candosimplegroupby=!1}this.fields.push(x)}}catch(U){S.e(U)}finally{S.f()}if(this._adaptedFields.length>0){var R,A=Object(l.a)(this._parent.fields);try{for(A.s();!(R=A.n()).done;){var P=R.value;this._adaptedFields.push(new T.c(P))}}catch(U){A.e(U)}finally{A.f()}}for(var L=0;L<this._decodedStatsfield.length;L++){var M=new w.a,G=null,B=this._decodedStatsfield[L];B.field=this.nextUniqueName(e),B.tofieldname===this.objectIdField&&(this._internalObjectIdField=B.field),M.name=B.tofieldname,M.alias=M.name;var q=null!==B.workingexpr&&Object(F.c)(B.workingexpr)?Object(F.i)(B.workingexpr,h.a.Standardised):"";switch(this._decodedStatsfield[L].typeofstat){case"SUM":if(""!==q){if(!(G=this._parent.getField(q)))throw new Error("Field is not present for Aggregation");M.type=G.type}else M.type="double";break;case"MIN":case"MAX":if(""!==q){if(!(G=this._parent.getField(q)))throw new Error("Field is not present for Aggregation");M.type=G.type}else M.type="double";break;case"COUNT":M.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==q&&!(G=this._parent.getField(q)))throw new Error("Field is not present for Aggregation");M.type="double"}this.fields.push(M)}}},{key:"_canDoAggregates",value:function(){return Object(o.u)(!1)}},{key:"_getFeatures",value:function(e,t,r,n){var a=this;-1!==t&&this._featureCache[t];var i=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(e,i)?this._expandPagedSet(e,i,0,0,n).then((function(){return a._getFeatures(e,t,r,n)})):Object(o.u)("success")}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;if(""!==e)return Object(o.u)(new S.a([],[],!0,null));var s=null,u={ordered:!1,nowhereclause:!1};return this._ensureLoaded().then((function(){if(null!==r)for(var e=0;e<i._decodedStatsfield.length;e++)if(!0===Object(F.h)(r,i._decodedStatsfield[e].tofieldname)){u.nowhereclause=!0,r=null;break}if(null!==n){u.ordered=!0;for(var t=0;t<i._decodedStatsfield.length;t++)if(!0===n.scanForField(i._decodedStatsfield[t].tofieldname)){n=null,u.ordered=!1;break}if(null!==n){var a,s=Object(l.a)(i._decodedGroupbyfield);try{for(s.s();!(a=s.n()).done;){var c=a.value;if(null===c.singlefield&&!0===n.scanForField(c.tofieldname)){n=null,u.ordered=!1;break}}}catch(d){s.e(d)}finally{s.f()}}}return!1===i._candosimplegroupby?Object(o.u)(!1):i._parent._canDoAggregates(i.phsyicalgroupbyfields,i._decodedStatsfield,"",null,null)})).then((function(e){if(e){var t=null;r&&(t=i._reformulateWhereClauseWithoutGroupByFields(r));var l=null;return n&&(l=i._reformulateOrderClauseWithoutGroupByFields(n)),i._parent._getAggregatePagesDataSourceDefinition(i.phsyicalgroupbyfields,i._decodedStatsfield,"",null,t,l,i._internalObjectIdField).then((function(e){return i._checkCancelled(a),s=!0===u.nowhereclause?new S.a(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===u.ordered&&e._ordered,i._clonePageDefinition(e.pagesDefinition)):new S.a(e._candidates.slice(0),e._known.slice(0),!0===u.ordered&&e._ordered,i._clonePageDefinition(e.pagesDefinition))}))}var o=i._parent;if(i._adaptedFields.length>0&&(o=new T.a({parentfeatureset:i._parent,adaptedFields:i._adaptedFields,extraFilter:null})),!0===u.nowhereclause)s=new S.a(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:i._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new g.a({parentfeatureset:o,orderbyclause:new E.a(i.phsyicalgroupbyfields.join(",")+","+i._parent.objectIdField+" ASC")})}});else{var c=o;if(null!==r){var d=null;r&&(d=i._reformulateWhereClauseWithoutGroupByFields(r)),c=new m.a({parentfeatureset:c,whereclause:d})}s=new S.a(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:i._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new g.a({parentfeatureset:c,orderbyclause:new E.a(i.phsyicalgroupbyfields.join(",")+","+i._parent.objectIdField+" ASC")})}})}return s}))}},{key:"_reformulateWhereClauseWithoutStatsFields",value:function(e){var t,r=Object(l.a)(this._decodedStatsfield);try{for(r.s();!(t=r.n()).done;){var n=t.value;e=Object(F.g)(e,n.tofieldname,Object(F.i)(n.workingexpr,h.a.Standardised),this._parent.getFieldsIndex())}}catch(a){r.e(a)}finally{r.f()}return e}},{key:"_reformulateWhereClauseWithoutGroupByFields",value:function(e){var t,r=Object(l.a)(this._decodedGroupbyfield);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.tofieldname!==n.name&&(e=Object(F.g)(e,n.tofieldname,Object(F.i)(n.expression,h.a.Standardised),this._parent.getFieldsIndex()))}}catch(a){r.e(a)}finally{r.f()}return e}},{key:"_reformulateOrderClauseWithoutGroupByFields",value:function(e){var t,r=[],n=Object(l.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.tofieldname!==a.name&&r.push({field:a.tofieldname,newfield:a.name})}}catch(i){n.e(i)}finally{n.f()}return r.length>0?e.replaceFields(r):e}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}},{key:"_refineSetBlock",value:function(e,t,r){var n=this;try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQuery))return this._expandPagedSet(e,this._maxQuery,0,0,r).then((function(){return n._refineSetBlock(e,t,r)}));this._checkCancelled(r);e._candidates.length;return this._refineKnowns(e,t),e._candidates.length,e._candidates.length,Object(o.u)(e)}catch(a){return Object(o.t)(a)}}},{key:"_expandPagedSet",value:function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}},{key:"_getPhysicalPage",value:function(e,t,r){var n=this;return!0===e.pagesDefinition.aggregatefeaturesetpagedefinition?Object(o.c)((function(t,a){n._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r,[]).then((function(e){t(e)}),a)})):this._getAgregagtePhysicalPage(e,t,r).then((function(e){var t,r=Object(l.a)(e);try{for(r.s();!(t=r.n()).done;){var a,i=t.value,s={geometry:i.geometry,attributes:{}},u=Object(l.a)(n._decodedGroupbyfield);try{for(u.s();!(a=u.n()).done;){var o=a.value;s.attributes[o.tofieldname]=i.attributes[o.name]}}catch(p){u.e(p)}finally{u.f()}var c,d=Object(l.a)(n._decodedStatsfield);try{for(d.s();!(c=d.n()).done;){var f=c.value;s.attributes[f.tofieldname]=i.attributes[f.field]}}catch(p){d.e(p)}finally{d.f()}n._featureCache[s.attributes[n.objectIdField]]=new O.a(s)}}catch(p){r.e(p)}finally{r.f()}return e.length}))}},{key:"_sequentialGetPhysicalItem",value:function(e,t,r,n){var a=this;return Object(o.c)((function(i,s){null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?i(n.length):a._nextAggregateItem(e,t,r,n,(function(s){null===s?i(n.length):(t-=1,i(a._sequentialGetPhysicalItem(e,t,r,n)))}),s)}))}},{key:"_nextAggregateItem",value:function(e,t,r,n,a,i){var s=this;try{Object(j.q)(e.pagesDefinition.internal.iterator.next()).then((function(u){if(null===u)if(null!==e.pagesDefinition.internal.workingItem){var l=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(l),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(l.attributes[s.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,a(null)}else e.pagesDefinition.internal.fullyResolved=!0,a(null);else{var o=s._generateAggregateHash(u);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[u],id:o};else{if(o!==e.pagesDefinition.internal.workingItem.id){var c=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return n.push(c),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(c.attributes[s.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[u],id:o},void a(c)}e.pagesDefinition.internal.workingItem.features.push(u)}s._nextAggregateItem(e,t,r,n,a,i)}}),i)}catch(e){i(e)}}},{key:"_calculateFieldStat",value:function(e,t,r){for(var n=[],a=0;a<e.features.length;a++)if(null!==t.workingexpr){var i=t.workingexpr.calculateValue(e.features[a]);null!==i&&n.push(i)}else n.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=Object(I.a)("min",n,-1);break;case"MAX":r.attributes[t.tofieldname]=Object(I.a)("max",n,-1);break;case"SUM":r.attributes[t.tofieldname]=Object(I.a)("sum",n,-1);break;case"COUNT":r.attributes[t.tofieldname]=n.length;break;case"VAR":r.attributes[t.tofieldname]=Object(I.a)("var",n,-1);break;case"STDDEV":r.attributes[t.tofieldname]=Object(I.a)("stddev",n,-1);break;case"AVG":r.attributes[t.tofieldname]=Object(I.a)("avg",n,-1)}return!0}},{key:"_calculateAndAppendAggregateItem",value:function(e){var t,r={attributes:{},geometry:null},n=Object(l.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var a=t.value,i=a.singlefield?e.features[0].attributes[a.singlefield]:a.expression.calculateValue(e.features[0]);r.attributes[a.tofieldname]=i}}catch(f){n.e(f)}finally{n.f()}var s,u=Object(l.a)(this._decodedStatsfield);try{for(u.s();!(s=u.n()).done;){var o=s.value;this._calculateFieldStat(e,o,r)}}catch(f){u.e(f)}finally{u.f()}for(var c=[],d=0;d<this._decodedStatsfield.length;d++)c.push(this._calculateFieldStat(e,this._decodedStatsfield[d],r));return this._featureCache[r.attributes[this.objectIdField]]=new O.a({attributes:r.attributes,geometry:r.geometry}),r}},{key:"_generateAggregateHash",value:function(e){var t,r="",n=Object(l.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var a=t.value,i=a.singlefield?e.attributes[a.singlefield]:a.expression.calculateValue(e);r+=null==i?":":":"+i.toString()}}catch(s){n.e(s)}finally{n.f()}return Object(D.a)(r,D.b.String)}},{key:"_stat",value:function(){return Object(o.u)({calculated:!1})}},{key:"getFeatureByObjectId",value:function(){return Object(o.u)(null)}}],[{key:"registerAction",value:function(){x.a._featuresetFunctions.groupby=function(e,t){return new r({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}]),r}(x.a),A=r(1005),P=r(1035),L=r(827),M=r(59),G=r(967),B=r(360),q=r(363),U=r(323),V=r(278),W=r(419),J=r(251),z=r(403),Q=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",n._removeGeometry=!1,n._overrideFields=null,n.formulaCredential=null,n._pageJustIds=!1,n._requestStandardised=!1,e.spatialReference&&(n.spatialReference=e.spatialReference),n._transparent=!0,n._maxProcessing=1e3,n._layer=e.layer,n._wset=null,void 0!==e.outFields&&(n._overrideFields=e.outFields),void 0!==e.includeGeometry&&(n._removeGeometry=!1===e.includeGeometry),n}return Object(i.a)(r,[{key:"_maxQueryRate",value:function(){return h.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(e){this._pageJustIds=e}},{key:"convertQueryToLruCacheKey",value:function(e){var t=Object(h.q)(e.toJSON());return Object(D.a)(t,D.b.String)}},{key:"load",value:function(){var e=this;return null===this._loadPromise&&(this._loadPromise=Object(o.c)((function(t,r){try{if(!0===e._layer.loaded)return e._initialiseFeatureSet(),void t(e);e._layer.when().then((function(){try{e._initialiseFeatureSet(),t(e)}catch(t){r(t)}}),r),e._layer.load()}catch(t){r(t)}}))),this._loadPromise}},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{var e,t=[],r=Object(l.a)(this.fields);try{for(r.s();!(e=r.n()).done;){var n=e.value;if("oid"===n.type)t.push(n);else{var a,i=Object(l.a)(this._layer.outFields);try{for(i.s();!(a=i.n()).done;){if(a.value.toLowerCase()===n.name.toLowerCase()){t.push(n);break}}}catch(g){i.e(g)}finally{i.f()}}}}catch(g){r.e(g)}finally{r.f()}this.fields=t}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var s,u=[],o=[],c=Object(l.a)(this.fields);try{for(c.s();!(s=c.n()).done;){var d=s.value;if("oid"===d.type)u.push(d),o.push(d.name);else{var f,p=Object(l.a)(this._overrideFields);try{for(p.s();!(f=p.n()).done;){if(f.value.toLowerCase()===d.name.toLowerCase()){u.push(d),o.push(d.name);break}}}catch(g){p.e(g)}finally{p.f()}}}}catch(g){c.e(g)}finally{c.f()}this.fields=u,this._overrideFields=o}if(this._layer.source&&this._layer.source.sourceJSON){var y=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=h.a.StandardisedNoInterval,null!=y&&y>=10.61&&(this._databaseType=h.a.Standardised)):null!=y&&(y>=10.5&&(this._databaseType=h.a.StandardisedNoInterval,this._requestStandardised=!0),y>=10.61&&(this._databaseType=h.a.Standardised))}this.objectIdField=this._layer.objectIdField;var v,b=Object(l.a)(this.fields);try{for(b.s();!(v=b.n()).done;){var m=v.value;"global-id"===m.type&&(this.globalIdField=m.name)}}catch(g){b.e(g)}finally{b.f()}this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}},{key:"_isInFeatureSet",value:function(){return h.b.InFeatureSet}},{key:"_refineSetBlock",value:function(e){return Object(o.u)(e)}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,null,e)})).then((function(e){return t._wset=e,e})):Object(o.u)(this._wset)}},{key:"_runDatabaseProbe",value:function(e){var t=this;return Object(o.c)((function(r,n){try{t._ensureLoaded().then((function(){try{var a=new V.a;a.where=e.replace("OBJECTID",t._layer.objectIdField),t._layer.queryObjectIds(a).then((function(){r(!0)}),(function(){try{r(!1)}catch(r){n(r)}}))}catch(r){n(r)}}))}catch(r){n(r)}}))}},{key:"_canUsePagination",value:function(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}},{key:"_cacheableFeatureSetSourceKey",value:function(){return this._layer.url}},{key:"pbfSupportedForQuery",value:function(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF&&!0===this._layer.capabilities.query.supportsQuantizationEditMode}},{key:"queryPBF",value:function(e){return e.quantizationParameters={mode:"edit"},Object(J.executeQueryPBF)(this._layer.parsedUrl,e,new W.b({})).then((function(e){return q.default.fromJSON(Object(B.j)(e.data)).unquantize()}))}},{key:"gdbVersion",get:function(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion?this._layer.gdbVersion:"SDE.DEFAULT":""}},{key:"nativeCapabilities",value:function(){return{title:this._layer.title,source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}},{key:"executeQuery",value:function(e,t){var r=this,n=new z.a({url:this._layer.parsedUrl.path}),a="execute"===t&&this.pbfSupportedForQuery(e),i=null;if(this.recentlyUsedQueries){var s=this.convertQueryToLruCacheKey(e);null===(i=this.recentlyUsedQueries.getFromCache(s))&&(i=!0!==a?n[t](e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(s,i),i=i.catch((function(e){throw r.recentlyUsedQueries.removeFromCache(s),e})))}return null===i&&(i=!0!==a?n[t](e):this.queryPBF(e)),i}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this.databaseType().then((function(s){if(i.isTable()&&t&&null!==e&&""!==e)return new S.a([],[],!0,null);if(i._canUsePagination())return i._getFilteredSetUsingPaging(e,t,r,n,a);var u="",l=!1;null!==n&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(u=n.constructClause(),l=!0);var o=new V.a;return o.where=null===r?null===t?"1=1":"":Object(F.i)(r,s),i._requestStandardised&&(o.sqlFormat="standard"),o.spatialRelationship=i._makeRelationshipEnum(e),o.outSpatialReference=i.spatialReference,o.orderByFields=""!==u?u.split(","):null,o.geometry=null===t?null:t,o.relationParameter=i._makeRelationshipParam(e),i.executeQuery(o,"executeForIds").then((function(e){return null===e&&(e=[]),i._checkCancelled(a),new S.a([],e,l,null)}))}))}},{key:"_expandPagedSet",value:function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}},{key:"_getFilteredSetUsingPaging",value:function(e,t,r,n,a){var i=this;try{var s="",u=!1;return null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(s=n.constructClause(),u=!0),this.databaseType().then((function(n){var l=null===r?null===t?"1=1":"":Object(F.i)(r,n);i._layer.definitionExpression&&(l=""!==l?"(("+i._layer.definitionExpression+") AND ("+l+"))":i._layer.definitionExpression);var o=i._maxQueryRate(),c=i._layer.capabilities.query.maxRecordCount;void 0!==c&&c<o&&(o=c);var d=null;if(!0===i._pageJustIds)d=new S.a([],["GETPAGES"],u,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:i._layer.objectIdField,resultRecordCount:o,resultOffset:0,geometry:null===t?null:t,where:l,orderByFields:s,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{var f=!0;!0===i._removeGeometry&&(f=!1);var p=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i._layer.outFields?i._layer.outFields:["*"]);d=new S.a([],["GETPAGES"],u,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:p.join(","),resultRecordCount:o,resultOffset:0,geometry:null===t?null:t,where:l,orderByFields:s,returnGeometry:f,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return i._expandPagedSet(d,o,0,1,a).then((function(){return d}))}))}catch(e){return Object(o.t)(e)}}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}},{key:"_getPhysicalPage",value:function(e,t,r){var n=this;try{var a=e.pagesDefinition.internal.lastRetrieved,i=a,s=e.pagesDefinition.internal.lastPage,u=new V.a;return this._requestStandardised&&(u.sqlFormat="standard"),u.spatialRelationship=e.pagesDefinition.spatialRel,u.relationParameter=e.pagesDefinition.relationParam,u.outFields=e.pagesDefinition.outFields.split(","),u.num=e.pagesDefinition.resultRecordCount,u.start=e.pagesDefinition.internal.lastPage,u.geometry=e.pagesDefinition.geometry,u.where=e.pagesDefinition.where,u.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,u.returnGeometry=e.pagesDefinition.returnGeometry,u.outSpatialReference=this.spatialReference,this.executeQuery(u,"execute").then((function(t){if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==s)return"done";for(var u=0;u<t.features.length;u++)e.pagesDefinition.internal.set[i+u]=t.features[u].attributes[n._layer.objectIdField];if(!1===n._pageJustIds)for(var l=0;l<t.features.length;l++)n._featureCache[t.features[l].attributes[n._layer.objectIdField]]=t.features[l];return(void 0===t.exceededTransferLimit&&t.features.length!==e.pagesDefinition.resultRecordCount||!1===t.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+t.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"}))}catch(e){return Object(o.t)(e)}}},{key:"_fieldsIncludingObjectId",value:function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.indexOf("*")>-1)return t;var r,n=!1,a=Object(l.a)(t);try{for(a.s();!(r=a.n()).done;){if(r.value.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}}}catch(i){a.e(i)}finally{a.f()}return!1===n&&t.push(this.objectIdField),t}},{key:"_getFeatures",value:function(e,t,r,n){var a=this,i=[];try{if(-1!==t&&void 0===this._featureCache[t]&&i.push(t),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate()))return this._expandPagedSet(e,this._maxProcessingRate(),0,0,n).then((function(){return a._getFeatures(e,t,r,n)}));for(var s=0,u=e._lastFetchedIndex;u<e._known.length;u++){if(e._lastFetchedIndex+=1,s++,void 0===this._featureCache[e._known[u]]){var l=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){var c=this._layer._mode;if(void 0!==c._featureMap[e._known[u]]){var d=c._featureMap[e._known[u]];null!==d&&(l=!0,this._featureCache[e._known[u]]=d)}}if(!1===l&&(e._known[u]!==t&&i.push(e._known[u]),i.length>=this._maxProcessingRate()-1))break}if(s>=r&&0===i.length)break}if(0===i.length)return Object(o.u)("success");try{var f=new V.a;return this._requestStandardised&&(f.sqlFormat="standard"),f.objectIds=i,f.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),f.returnGeometry=!0,!0===this._removeGeometry&&(f.returnGeometry=!1),f.outSpatialReference=this.spatialReference,this.executeQuery(f,"execute").then((function(e){if(a._checkCancelled(n),void 0!==e.error)return Object(o.t)(new Error(e.error));for(var t=0;t<e.features.length;t++)a._featureCache[e.features[t].attributes[a._layer.objectIdField]]=e.features[t];return"success"}))}catch(e){return Object(o.t)(e)}}catch(e){return Object(o.t)(e)}}},{key:"_getDistinctPages",value:function(e,t,r,n,a,i,s,u,l){var c=this;return this._ensureLoaded().then((function(){return c.databaseType()})).then((function(d){for(var f=r.parseTree.column,p=0;p<c._layer.fields.length;p++)if(c._layer.fields[p].name.toLowerCase()===f.toLowerCase()){f=c._layer.fields[p].name;break}var h=new V.a;c._requestStandardised&&(h.sqlFormat="standard");var y=null===i?null===a?"1=1":"":Object(F.i)(i,d);return c._layer.definitionExpression&&(y=""!==y?"(("+c._layer.definitionExpression+") AND ("+y+"))":c._layer.definitionExpression),h.where=y,h.spatialRelationship=c._makeRelationshipEnum(n),h.relationParameter=c._makeRelationshipParam(n),h.geometry=null===a?null:a,h.returnDistinctValues=!0,h.returnGeometry=!1,h.outFields=[f],c.executeQuery(h,"execute").then((function(d){if(c._checkCancelled(l),!d.hasOwnProperty("features"))return Object(o.t)(new Error("Unnexected Result querying statistics from layer"));for(var p=!1,h=0;h<c._layer.fields.length;h++)if(c._layer.fields[h].name===f){"date"===c._layer.fields[h].type&&(p=!0);break}for(var y=0;y<d.features.length;y++){if(p){var v=d.features[y].attributes[f];null!==v?u.push(new Date(v)):u.push(v)}else u.push(d.features[y].attributes[f]);if(u.length>=s)break}return 0===d.features.length?u:d.features.length===c._layer.capabilities.query.maxRecordCount&&u.length<s?c._getDistinctPages(e+d.features.length,t,r,n,a,i,s,u,l).then((function(e){return{calculated:!0,result:e}})):u}))}))}},{key:"_distinctStat",value:function(e,t,r,n,a,i,s){return this._getDistinctPages(0,e,t,r,n,a,i,[],s).then((function(e){return{calculated:!0,result:e}}))}},{key:"isTable",value:function(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType}},{key:"_countstat",value:function(e,t,r,n){var a=this;return this.databaseType().then((function(e){var i=new V.a;if(a._requestStandardised&&(i.sqlFormat="standard"),a.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};var s=null===n?null===r?"1=1":"":Object(F.i)(n,e);return a._layer.definitionExpression&&(s=""!==s?"(("+a._layer.definitionExpression+") AND ("+s+"))":a._layer.definitionExpression),i.where=s,i.where=s,i.spatialRelationship=a._makeRelationshipEnum(t),i.relationParameter=a._makeRelationshipParam(t),i.geometry=null===r?null:r,i.returnGeometry=!1,a.executeQuery(i,"executeForCount").then((function(e){return{calculated:!0,result:e}}))}))}},{key:"_stats",value:function(e,t,r,n,a,i,s){var u=this;return this._ensureLoaded().then((function(){var l=u._layer.capabilities&&u._layer.capabilities.query&&!0===u._layer.capabilities.query.supportsSqlExpression,c=u._layer.capabilities&&u._layer.capabilities.query&&!0===u._layer.capabilities.query.supportsStatistics,d=u._layer.capabilities&&u._layer.capabilities.query&&!0===u._layer.capabilities.query.supportsDistinct;return"count"===e?d?u._countstat(e,r,n,a):{calculated:!1}:!1===c||!1===Object(F.c)(t)&&!1===l||!1===t.isStandardized?""!==r||null!==a?{calculated:!1}:u._manualStat(e,t,i,s):"distinct"===e?!1===d?""!==r||null!==a?{calculated:!1}:u._manualStat(e,t,i,s):u._distinctStat(e,t,r,n,a,i,s):u.databaseType().then((function(i){if(u.isTable()&&n&&null!==r&&""!==r)return{calculated:!0,result:null};var s=new V.a;u._requestStandardised&&(s.sqlFormat="standard");var l=null===a?null===n?"1=1":"":Object(F.i)(a,i);u._layer.definitionExpression&&(l=""!==l?"(("+u._layer.definitionExpression+") AND ("+l+"))":u._layer.definitionExpression),s.where=l,s.spatialRelationship=u._makeRelationshipEnum(r),s.relationParameter=u._makeRelationshipParam(r),s.geometry=null===n?null:n;var c=new U.a;c.statisticType=Object(I.c)(e),c.onStatisticField=Object(F.i)(t,i),c.outStatisticFieldName="ARCADE_STAT_RESULT",s.returnGeometry=!1;var d="ARCADE_STAT_RESULT";return s.outStatistics=[c],u.executeQuery(s,"execute").then((function(e){if(!e.hasOwnProperty("features")||0===e.features.length)return Object(o.t)(new Error("Unnexected Result querying statistics from layer"));for(var t=!1,r=0;r<e.fields.length;r++)if("ARCADE_STAT_RESULT"===e.fields[r].name.toUpperCase()){d=e.fields[r].name,"date"===e.fields[r].type&&(t=!0);break}if(t){var n=e.features[0].attributes[d];return null!==n&&(n=new Date(e.features[0].attributes[d])),{calculated:!0,result:n}}return{calculated:!0,result:e.features[0].attributes[d]}}))}))}))}},{key:"_stat",value:function(e,t,r,n,a,i,s){return this._stats(e,t,r,n,a,i,s)}},{key:"_canDoAggregates",value:function(e,t){var r=this;return this._ensureLoaded().then((function(){var e=!1,n=r._layer.capabilities&&r._layer.capabilities.query&&!0===r._layer.capabilities.query.supportsSqlExpression;if(void 0!==r._layer.capabilities&&null!==r._layer.capabilities.query&&!0===r._layer.capabilities.query.supportsStatistics&&!0===r._layer.capabilities.query.supportsOrderBy&&(e=!0),e)for(var a=0;a<t.length-1;a++)null!==t[a].workingexpr&&(!1===t[a].workingexpr.isStandardized||!1===Object(F.c)(t[a].workingexpr)&&!1===n)&&(e=!1);return!1!==e}))}},{key:"_makeRelationshipEnum",value:function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}},{key:"_makeRelationshipParam",value:function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,s){var u=this;return this._ensureLoaded().then((function(){return u.databaseType()})).then((function(l){var o="",c=!1,d=!1;null!==i&&u._layer.capabilities&&u._layer.capabilities.query&&!0===u._layer.capabilities.query.supportsOrderBy&&(o=i.constructClause(),d=!0),u._layer.capabilities&&u._layer.capabilities.query&&!1===u._layer.capabilities.query.supportsPagination&&(d=!1,c=!0,o=u._layer.objectIdField);for(var f=[],p=0;p<t.length;p++){var h=new U.a;h.onStatisticField=null!==t[p].workingexpr?Object(F.i)(t[p].workingexpr,l):"",h.outStatisticFieldName=t[p].field,h.statisticType=t[p].toStatisticsName(),f.push(h)}""===o&&(o=e.join(","));var y=u._maxQueryRate(),v=u._layer.capabilities.query.maxRecordCount;void 0!==v&&v<y&&(y=v);var b=null===a?null===n?"1=1":"":Object(F.i)(a,l);return u._layer.definitionExpression&&(b=""!==b?"(("+u._layer.definitionExpression+") AND ("+b+"))":u._layer.definitionExpression),new S.a([],["GETPAGES"],d,{groupbypage:!0,spatialRel:u._makeRelationshipEnum(r),relationParam:u._makeRelationshipParam(r),outFields:["*"],useOIDpagination:c,generatedOid:s,resultRecordCount:y,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:f,geometry:null===n?null:n,where:b,orderByFields:o,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}))}},{key:"_getAgregagtePhysicalPage",value:function(e,t,r){var n=this;try{var a=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(a=""!==a?"("+a+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());var i=e.pagesDefinition.internal.lastRetrieved,s=i,u=e.pagesDefinition.internal.lastPage,l=new V.a;return this._requestStandardised&&(l.sqlFormat="standard"),l.where=a,l.spatialRelationship=e.pagesDefinition.spatialRel,l.relationParameter=e.pagesDefinition.relationParam,l.outFields=e.pagesDefinition.outFields,l.outStatistics=e.pagesDefinition.outStatistics,l.geometry=e.pagesDefinition.geometry,l.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,l.num=e.pagesDefinition.resultRecordCount,l.start=e.pagesDefinition.internal.lastPage,l.returnGeometry=e.pagesDefinition.returnGeometry,l.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,this.isTable()&&l.geometry&&l.spatialRelationship?Object(o.u)([]):this.executeQuery(l,"execute").then((function(t){if(n._checkCancelled(r),!t.hasOwnProperty("features"))return Object(o.t)(new Error("Unnexected Result querying aggregates from layer"));var a=[];if(e.pagesDefinition.internal.lastPage!==u)return[];for(var l=0;l<t.features.length;l++)e.pagesDefinition.internal.set[s+l]=t.features[l].attributes[e.pagesDefinition.generatedOid];for(var c=0;c<t.features.length;c++)a.push(new O.a({attributes:t.features[c].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===t.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=t.features[t.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===t.exceededTransferLimit&&t.features.length!==e.pagesDefinition.resultRecordCount||!1===t.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=i+t.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,a}))}catch(e){return Object(o.t)(e)}}},{key:"relationshipMetaData",value:function(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]}},{key:"serviceUrl",value:function(){return Object(h.i)(this._layer.parsedUrl.path)}},{key:"queryAttachments",value:function(e,t,r,n){var a=this;if(this._layer.capabilities.data.supportsAttachment&&this._layer.capabilities.operations.supportsQueryAttachments){var i={objectIds:[e]};return(t&&t>0||r&&r>0)&&(i.size=[t&&t>0?t:0,r&&r>0?r:t+1]),n&&n.length>0&&(i.attachmentTypes=n),this._layer.queryAttachments(i).then((function(t){var r=[];return t&&t[e]&&t[e].forEach((function(t){var n=a._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+t.id.toString();r.push(new G.a(t.id,t.name,t.contentType,t.size,n))})),r}))}return Object(o.u)([])}},{key:"queryRelatedFeatures",value:function(e){var t={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields.join(","),returnGeometry:e.returnGeometry.toString()};return void 0!==e.resultOffset&&null!==e.resultOffset&&(t.resultOffset=e.resultOffset.toString()),void 0!==e.resultRecordCount&&null!==e.resultRecordCount&&(t.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(t.orderByFields=e.orderByFields.join(",")),e.objectIds.length>0&&(t.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(t.outSR=JSON.stringify(e.outSpatialReference.toJSON())),Object(d.default)(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:t}).then((function(e){if(e.data){var t={},r=e.data;if(r&&r.relatedRecordGroups){var n,a=r.spatialReference,i=Object(l.a)(r.relatedRecordGroups);try{for(i.s();!(n=i.n()).done;){var s,u=n.value,c=u.objectId,d=[],f=Object(l.a)(u.relatedRecords);try{for(f.s();!(s=f.n()).done;){var p=s.value;p.geometry&&(p.geometry.spatialReference=a);var h=new O.a({geometry:p.geometry?Object(M.a)(p.geometry):null,attributes:p.attributes});d.push(h)}}catch(y){f.e(y)}finally{f.f()}t[c]={features:d,exceededTransferLimit:!0===r.exceededTransferLimit}}}catch(y){i.e(y)}finally{i.f()}}return t}return Object(o.t)("Invalid Request")}))}},{key:"getFeatureByObjectId",value:function(e,t){var r=new z.a({url:this._layer.parsedUrl.path}),n=new V.a;return n.outFields=t,n.returnGeometry=!1,n.outSpatialReference=this.spatialReference,n.where=this.objectIdField+"="+e.toString(),r.execute(n).then((function(e){return 1===e.features.length?e.features[0]:null}))}},{key:"getIdentityUser",value:function(){var e=this;return this.load().then((function(){var t,r=null==(t=c.b)?void 0:t.findCredential(e._layer.url);return r?r.userId:null}))}},{key:"getOwningSystemUrl",value:function(){var e=this;return this.load().then((function(){var t,r=null==(t=c.b)?void 0:t.findServerInfo(e._layer.url);if(r)return Object(o.u)(r.owningSystemUrl);var n=e._layer.url,a=n.toLowerCase().indexOf("/rest/services");return(n=a>-1?n.substring(0,a):n)?(n+="/rest/info",Object(o.c)((function(e,t){Object(d.default)(n,{query:{f:"json"}}).then((function(t){var r="";t.data&&t.data.owningSystemUrl&&(r=t.data.owningSystemUrl),e(r)}),(function(t){e("")}))}))):Object(o.u)("")}))}}],[{key:"create",value:function(e,t,n,a){return new r({layer:new L.default({url:e,outFields:null===t?["*"]:t}),spatialReference:n,lrucache:a})}}]),r}(x.a),H=r(1036),Y=r(364),K=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",n._findObjectId=-1,n._requestStandardised=!1,n._removeGeometry=!1,n._overrideFields=null,n.featureObjectId=null,n.relatedLayer=null,n.relationship=null,e.spatialReference&&(n.spatialReference=e.spatialReference),n._transparent=!0,n._maxProcessing=1e3,n._layer=e.layer,n._wset=null,n._findObjectId=e.objectId,n.featureObjectId=e.objectId,n.relationship=e.relationship,n.relatedLayer=e.relatedLayer,void 0!==e.outFields&&(n._overrideFields=e.outFields),void 0!==e.includeGeometry&&(n._removeGeometry=!1===e.includeGeometry),n}return Object(i.a)(r,[{key:"_maxQueryRate",value:function(){return h.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"load",value:function(){var e=this;return null===this._loadPromise&&(this._loadPromise=Object(o.c)((function(t,r){Object(o.b)([e._layer.load(),e.relatedLayer.load()]).then((function(){e._initialiseFeatureSet(),t(e)}),r)}))),this._loadPromise}},{key:"nativeCapabilities",value:function(){return this.relatedLayer.nativeCapabilities()}},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this.relatedLayer.geometryType,this.fields=this.relatedLayer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var e,t=[],r=[],n=Object(l.a)(this.fields);try{for(n.s();!(e=n.n()).done;){var a=e.value;if("oid"===a.type)t.push(a),r.push(a.name);else{var i,s=Object(l.a)(this._overrideFields);try{for(s.s();!(i=s.n()).done;){if(i.value.toLowerCase()===a.name.toLowerCase()){t.push(a),r.push(a.name);break}}}catch(o){s.e(o)}finally{s.f()}}}}catch(o){n.e(o)}finally{n.f()}this.fields=t,this._overrideFields=r}var u=this._layer.nativeCapabilities();u&&(this._databaseType=u.databaseType,this._requestStandardised=u.requestStandardised),this.objectIdField=this.relatedLayer.objectIdField,this.globalIdField=this.relatedLayer.globalIdField,this.hasM=this.relatedLayer.supportsM,this.hasZ=this.relatedLayer.supportsZ,this.typeIdField=this.relatedLayer.typeIdField,this.types=this.relatedLayer.types}},{key:"databaseType",value:function(){var e=this;return this.relatedLayer.databaseType().then((function(){return e._databaseType=e.relatedLayer._databaseType,e._databaseType}))}},{key:"isTable",value:function(){return this.relatedLayer.isTable()}},{key:"_isInFeatureSet",value:function(){return h.b.InFeatureSet}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,null,e)})).then((function(e){return t._wset=e,e})):Object(o.u)(this._wset)}},{key:"_changeFeature",value:function(e){var t,r={},n=Object(l.a)(this.fields);try{for(n.s();!(t=n.n()).done;){var a=t.value;r[a.name]=e.attributes[a.name]}}catch(i){n.e(i)}finally{n.f()}return new O.a({geometry:!0===this._removeGeometry?null:e.geometry,attributes:r})}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this.databaseType().then((function(){if(i.isTable()&&t&&null!==e&&""!==e)return new S.a([],[],!0,null);var s=i._layer.nativeCapabilities();if(!1===s.canQueryRelated)return new S.a([],[],!0,null);if(s.capabilities.queryRelated&&s.capabilities.queryRelated.supportsPagination)return i._getFilteredSetUsingPaging(e,t,r,n,a);var u="",l=!1;null!==n&&s.capabilities&&s.capabilities.queryRelated&&!0===s.capabilities.queryRelated.supportsOrderBy&&(u=n.constructClause(),l=!0);var o=new Y.a;o.objectIds=[i._findObjectId];var c=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i.relatedLayer.fields?i.relatedLayer.fields.map((function(e){return e.name})):["*"]);o.outFields=c,o.relationshipId=i.relationship.id,o.where="1=1";var d=!0;return!0===i._removeGeometry&&(d=!1),o.returnGeometry=d,i._requestStandardised&&(o.sqlFormat="standard"),o.outSpatialReference=i.spatialReference,o.orderByFields=""!==u?u.split(","):null,s.source.queryRelatedFeatures(o).then((function(n){i._checkCancelled(a);for(var s=n[i._findObjectId]?n[i._findObjectId].features:[],u=[],o=0;o<s.length;o++)i._featureCache[s[o].attributes[i._layer.objectIdField]]=s[o],u.push(s[o].attributes[i._layer.objectIdField]);var c=t&&null!==e&&""!==e,d=null!=r;return new S.a(c||d?u:[],c||d?[]:u,l,null)}))}))}},{key:"_fieldsIncludingObjectId",value:function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.indexOf("*")>-1)return t;var r,n=!1,a=Object(l.a)(t);try{for(a.s();!(r=a.n()).done;){if(r.value.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}}}catch(i){a.e(i)}finally{a.f()}return!1===n&&t.push(this.objectIdField),t}},{key:"_getFilteredSetUsingPaging",value:function(e,t,r,n,a){var i=this;try{var s="",u=!1,l=this._layer.nativeCapabilities();return null!==n&&l&&l.capabilities.queryRelated&&!0===l.capabilities.queryRelated.supportsOrderBy&&(s=n.constructClause(),u=!0),this.databaseType().then((function(){var n=i._maxQueryRate(),o=l.capabilities.query.maxRecordCount;void 0!==o&&o<n&&(n=o);var c,d=t&&null!==e&&""!==e,f=null!=r,p=!0;!0===i._removeGeometry&&(p=!1);var h=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i.relatedLayer.fields?i.relatedLayer.fields.map((function(e){return e.name})):["*"]);return c=new S.a(d||f?["GETPAGES"]:[],d||f?[]:["GETPAGES"],u,{outFields:h.join(","),resultRecordCount:n,resultOffset:0,objectIds:[i._findObjectId],where:"1=1",orderByFields:s,returnGeometry:p,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),i._expandPagedSet(c,n,0,0,a).then((function(){return c}))}))}catch(e){return Object(o.t)(e)}}},{key:"_expandPagedSet",value:function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}},{key:"_getPhysicalPage",value:function(e,t,r){var n=this;try{var a=e.pagesDefinition.internal.lastRetrieved,i=a,s=e.pagesDefinition.internal.lastPage,u=this._layer.nativeCapabilities(),l=new Y.a;return!0===this._requestStandardised&&(l.sqlFormat="standard"),l.relationshipId=this.relationship.id,l.objectIds=e.pagesDefinition.objectIds,l.resultOffset=e.pagesDefinition.internal.lastPage,l.resultRecordCount=e.pagesDefinition.resultRecordCount,l.outFields=e.pagesDefinition.outFields.split(","),l.where=e.pagesDefinition.where,l.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,l.returnGeometry=e.pagesDefinition.returnGeometry,l.outSpatialReference=this.spatialReference,u.source.queryRelatedFeatures(l).then((function(t){if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==s)return 0;for(var u=t[n._findObjectId]?t[n._findObjectId].features:[],l=0;l<u.length;l++)e.pagesDefinition.internal.set[i+l]=u[l].attributes[n._layer.objectIdField];for(var o=0;o<u.length;o++)n._featureCache[u[o].attributes[n._layer.objectIdField]]=u[o];var c=!t[n._findObjectId]||!1===t[n._findObjectId].exceededTransferLimit;return u.length!==e.pagesDefinition.resultRecordCount&&c&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+u.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,u.length}))}catch(e){return Object(o.t)(e)}}},{key:"_getFeatures",value:function(e,t,r,n){var a=this,i=[];-1!==t&&void 0===this._featureCache[t]&&i.push(t);var s=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,s))return this._expandPagedSet(e,s,0,0,n).then((function(){return a._getFeatures(e,t,r,n)}));for(var u=0,l=e._lastFetchedIndex;l<e._known.length&&(++u<=r&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[l]&&void 0===this._featureCache[e._known[l]]&&(e._known[l]!==t&&i.push(e._known[l]),i.length>r)))&&!(u>=r&&0===i.length);l++);return 0===i.length?Object(o.u)("success"):Object(o.t)(new Error("Unaccounted for Features. Not in Feature Collection"))}},{key:"_refineSetBlock",value:function(e,t,r){return Object(o.u)(e)}},{key:"_stat",value:function(e,t,r,n,a,i,s){return Object(o.u)({calculated:!1})}},{key:"gdbVersion",get:function(){return this.relatedLayer.gdbVersion}},{key:"_canDoAggregates",value:function(e,t,r,n,a){return Object(o.u)(!1)}},{key:"relationshipMetaData",value:function(){return this.relatedLayer.relationshipMetaData()}},{key:"serviceUrl",value:function(){return this.relatedLayer.serviceUrl()}},{key:"queryAttachments",value:function(e,t,r,n){return this.relatedLayer.queryAttachments(e,t,r,n)}},{key:"getFeatureByObjectId",value:function(e,t){return this.relatedLayer.getFeatureByObjectId(e,t)}},{key:"getOwningSystemUrl",value:function(){return this.relatedLayer.getOwningSystemUrl()}},{key:"getIdentityUser",value:function(){return this.relatedLayer.getIdentityUser()}}]),r}(x.a);function $(){null===v.a.applicationCache&&(v.a.applicationCache=new v.a)}function Z(e,t){if(v.a.applicationCache){var r=v.a.applicationCache.getLayerInfo(e);if(r)return r.then((function(r){return Object(o.u)(new L.default({url:e,outFields:t,sourceJSON:r}))}));var n=new L.default({url:e,outFields:t}),a=Object(o.c)((function(e,t){n.load().then((function(){e(n.sourceJSON)}),(function(e){t(e)}))}));return v.a.applicationCache&&(v.a.applicationCache.setLayerInfo(e,a),a=a.catch((function(t){throw v.a.applicationCache.clearLayerInfo(e),t}))),a.then((function(){return Object(o.u)(n)}))}return Object(o.u)(new L.default({url:e,outFields:t}))}function X(e,t,r,n,a){return Z(e,["*"]).then((function(e){return Object(o.u)(ee(e,t,r,n,a))}))}function ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return!0===e._hasMemorySource()?new H.a({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a}):new Q({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a})}function te(e){if(null!==v.a.applicationCache){var t=v.a.applicationCache.getLayerInfo(e);if(null!==t)return t}var r=Object(d.default)(e,{responseType:"json",query:{f:"json"}}).then((function(e){if(e.data){var t=e.data;return t.layers||(t.layers=[]),t.tables||(t.tables=[]),Object(o.u)(t)}return Object(o.u)({layers:[],tables:[]})}));return null!==v.a.applicationCache&&(v.a.applicationCache.setLayerInfo(e,r),r=r.catch((function(t){throw v.a.applicationCache.clearLayerInfo(e),t}))),r}function re(e,t){var r={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null};return te(e).then((function(n){if(r.metadata=n,n.controllerDatasetLayers&&void 0!==n.controllerDatasetLayers.utilityNetworkLayerId&&null!==n.controllerDatasetLayers.utilityNetworkLayerId){if(n.layers){var a,i=Object(l.a)(n.layers);try{for(i.s();!(a=i.n()).done;){var s=a.value;r.layerNameLkp[s.id]=s.name}}catch(h){i.e(h)}finally{i.f()}}if(n.tables){var u,c=Object(l.a)(n.tables);try{for(c.s();!(u=c.n()).done;){var f=u.value;r.layerNameLkp[f.id]=f.name}}catch(h){c.e(h)}finally{c.f()}}var p=n.controllerDatasetLayers.utilityNetworkLayerId;return r.networkId=p,function(e,t){var r="QUERYDATAELEMTS:"+t.toString()+":"+e;if(null!==v.a.applicationCache){var n=v.a.applicationCache.getLayerInfo(r);if(null!==n)return n}var a=Object(d.default)(e+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([t.toString()]),f:"json"}}).then((function(e){if(e.data){var t=e.data;if(t.layerDataElements&&t.layerDataElements[0])return t.layerDataElements[0]}throw new Error("Not Found")}));return null!==v.a.applicationCache&&(v.a.applicationCache.setLayerInfo(r,a),a=a.catch((function(e){throw v.a.applicationCache.clearLayerInfo(r),e}))),a}(e,p).then((function(n){if(n){r.queryelem=n,r.queryelem&&r.queryelem.dataElement&&void 0!==r.queryelem.dataElement.schemaGeneration&&(r.unVersion=r.queryelem.dataElement.schemaGeneration),r.lkp={},r.queryelem.dataElement.domainNetworks||(r.queryelem.dataElement.domainNetworks=[]);var a,i=Object(l.a)(r.queryelem.dataElement.domainNetworks);try{for(i.s();!(a=i.n()).done;){var s,u=a.value,c=Object(l.a)(u.edgeSources?u.edgeSources:[]);try{for(c.s();!(s=c.n()).done;){var f=s.value,y={layerId:f.layerId,sourceId:f.sourceId,className:r.layerNameLkp[f.layerId]?r.layerNameLkp[f.layerId]:null};y.className&&(r.lkp[y.className]=y)}}catch(h){c.e(h)}finally{c.f()}var m,g=Object(l.a)(u.junctionSources?u.junctionSources:[]);try{for(g.s();!(m=g.n()).done;){var _=m.value,O={layerId:_.layerId,sourceId:_.sourceId,className:r.layerNameLkp[_.layerId]?r.layerNameLkp[_.layerId]:null};O.className&&(r.lkp[O.className]=O)}}catch(h){g.e(h)}finally{g.f()}}}catch(h){i.e(h)}finally{i.f()}if(r.queryelem.dataElement.terminalConfigurations){var j,w=Object(l.a)(r.queryelem.dataElement.terminalConfigurations);try{for(w.s();!(j=w.n()).done;){var S,F=j.value,I=Object(l.a)(F.terminals);try{for(I.s();!(S=I.n()).done;){var k=S.value;r.terminals.push({terminalId:k.terminalId,terminalName:k.terminalName})}}catch(h){I.e(h)}finally{I.f()}}}catch(h){w.e(h)}finally{w.f()}}return function(e){if(null!==v.a.applicationCache){var t=v.a.applicationCache.getLayerInfo(e);if(null!==t)return t}var r=Object(d.default)(e,{responseType:"json",query:{f:"json"}}).then((function(e){if(e.data){var t=e.data;return Object(o.u)(t)}return Object(o.u)(null)}));return null!==v.a.applicationCache&&(v.a.applicationCache.setLayerInfo(e,r),r=r.catch((function(t){throw v.a.applicationCache.clearLayerInfo(e),t}))),r}(e+"/"+p).then((function(n){if(n.systemLayers&&void 0!==n.systemLayers.associationsTableId&&null!==n.systemLayers.associationsTableId){var a=[];return r.unVersion>=4&&(a.push("STATUS"),a.push("PERCENTALONG")),X(e+"/"+n.systemLayers.associationsTableId.toString(),t,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID"].concat(a),!1,null).then((function(e){return e.load()})).then((function(e){return r.unVersion>=4?(e=e.filter(b.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)",e.getFieldsIndex()))).load():e})).then((function(e){return{lkp:r.lkp,associations:e,unVersion:r.unVersion,terminals:r.terminals}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}function ne(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=e.serviceUrl();return u?X(u="/"===u.charAt(u.length-1)?u+t.relatedTableId.toString():u+"/"+t.relatedTableId.toString(),n,a,i,s).then((function(u){return new K({layer:e,relatedLayer:u,relationship:t,objectId:r,spatialReference:n,outFields:a,includeGeometry:i,lrucache:s})})):null}m.a.registerAction(),R.registerAction(),g.a.registerAction(),A.a.registerAction(),P.a.registerAction();var ae=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(a.a)(this,r),(n=t.call(this))._map=e,n._overridespref=i,n.lrucache=s,n._instantLayers=[],n}return Object(i.a)(r,[{key:"makeAndAddFeatureSet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=ee(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}},{key:"featureSetByName",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((function(){try{return t.featureSetByName(e,r,a)}catch(e){return Object(o.t)(e)}}));null===a&&(a=["*"]),a=(a=a.slice(0)).sort();for(var i=JSON.stringify(a),s=0;s<this._instantLayers.length;s++){var u=this._instantLayers[s];if(u.opitem.title===e&&u.includeGeometry===r&&u.outFields===i)return this.resolvePromise(this._instantLayers[s].featureset)}var l=this._map.layers.find((function(t){return t instanceof L.default&&t.title===e}));if(l)return this.resolvePromise(this.makeAndAddFeatureSet(l,r,a));if(this._map.tables){var c=this._map.tables.find((function(t){return!!(t.title&&t.title===e||t.title&&t.title===e)}));if(c){if(c instanceof L.default)return this.resolvePromise(this.makeAndAddFeatureSet(c,r,a));if(c._materializedTable);else{var d=c.outFields?c:Object(n.a)(Object(n.a)({},c),{},{outFields:["*"]});c._materializedTable=new L.default(d)}return c._materializedTable.load().then((function(){return t.resolvePromise(t.makeAndAddFeatureSet(c._materializedTable,r,a))}))}}return this.resolvePromise(null)}},{key:"featureSetById",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["*"];if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((function(){try{return t.featureSetById(e,r,a)}catch(e){return Object(o.t)(e)}}));null===a&&(a=["*"]),a=(a=a.slice(0)).sort();for(var i=JSON.stringify(a),s=0;s<this._instantLayers.length;s++){var u=this._instantLayers[s];if(u.opitem.id===e&&u.includeGeometry===r&&u.outFields===i)return this.resolvePromise(this._instantLayers[s].featureset)}var l=this._map.layers.find((function(t){return t instanceof L.default&&t.id===e}));if(l)return this.resolvePromise(this.makeAndAddFeatureSet(l,r,a));if(this._map.tables){var c=this._map.tables.find((function(t){return t.id===e}));if(c){if(c instanceof L.default)return this.resolvePromise(this.makeAndAddFeatureSet(c,r,a));if(c._materializedTable);else{var d=Object(n.a)(Object(n.a)({},c),{},{outFields:["*"]});c._materializedTable=new L.default(d)}return c._materializedTable.load().then((function(){return t.resolvePromise(t.makeAndAddFeatureSet(c._materializedTable,r,a))}))}}return this.resolvePromise(null)}}]),r}(y.a),ie=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(a.a)(this,r),(n=t.call(this))._url=e,n._overridespref=i,n.lrucache=s,n.metadata=null,n._instantLayers=[],n}return Object(i.a)(r,[{key:"url",get:function(){return this._url}},{key:"makeAndAddFeatureSet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=ee(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}},{key:"_loadMetaData",value:function(){var e=this;return te(this._url).then((function(t){return e.metadata=t,t}))}},{key:"load",value:function(){return this._loadMetaData()}},{key:"clone",value:function(){return new r(this._url,this._overridespref,this.lrucache)}},{key:"featureSetByName",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=["*"]),n=(n=n.slice(0)).sort();for(var a=JSON.stringify(n),i=0;i<this._instantLayers.length;i++){var s=this._instantLayers[i];if(s.opitem.title===e&&s.includeGeometry===r&&s.outFields===a)return this.resolvePromise(this._instantLayers[i].featureset)}return this._loadMetaData().then((function(a){var i,s=null,u=Object(l.a)(a.layers?a.layers:[]);try{for(u.s();!(i=u.n()).done;){var o=i.value;o.name===e&&(s=o)}}catch(p){u.e(p)}finally{u.f()}if(!s){var c,d=Object(l.a)(a.tables?a.tables:[]);try{for(d.s();!(c=d.n()).done;){var f=c.value;f.name===e&&(s=f)}}catch(p){d.e(p)}finally{d.f()}}return s?Z(t._url+"/"+s.id,["*"]).then((function(e){return t.makeAndAddFeatureSet(e,r,n)})):t.resolvePromise(null)}))}},{key:"featureSetById",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["*"];null===n&&(n=["*"]),n=(n=n.slice(0)).sort();var a=JSON.stringify(n);e=null!=e?e.toString():"";for(var i=0;i<this._instantLayers.length;i++){var s=this._instantLayers[i];if(s.opitem.id===e&&s.includeGeometry===r&&s.outFields===a)return this.resolvePromise(this._instantLayers[i].featureset)}return this._loadMetaData().then((function(a){var i,s=null,u=Object(l.a)(a.layers?a.layers:[]);try{for(u.s();!(i=u.n()).done;){var o=i.value;null!==o.id&&void 0!==o.id&&o.id.toString()===e&&(s=o)}}catch(p){u.e(p)}finally{u.f()}if(!s){var c,d=Object(l.a)(a.tables?a.tables:[]);try{for(d.s();!(c=d.n()).done;){var f=c.value;null!==f.id&&void 0!==f.id&&f.id.toString()===e&&(s=f)}}catch(p){d.e(p)}finally{d.f()}}return s?Z(t._url+"/"+s.id,["*"]).then((function(e){return t.makeAndAddFeatureSet(e,r,n)})):t.resolvePromise(null)}))}}]),r}(y.a);function se(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new ae(e,t,r)}function ue(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new ie(e,t,r)}function le(e,t){return null===e?t:new f.a({url:e.field("url")})}function oe(e,t,r){return c.b.findCredential(e.restUrl)?"loaded"===e.loadStatus&&""===t&&e.user&&e.user.sourceJSON&&!1===r?Object(o.u)(e.user.sourceJSON):""===t?Object(d.default)(e.restUrl+"/community/self",{responseType:"json",query:Object(n.a)({f:"json"},!1===r?{}:{returnUserLicenseTypeExtensions:!0})}).then((function(e){if(e.data){var t=e.data;if(t&&t.username)return Object(o.u)(t)}return Object(o.u)(null)})):Object(d.default)(e.restUrl+"/community/users/"+t,{responseType:"json",query:{f:"json"}}).then((function(e){if(e.data){var t=e.data;return t.error?null:Object(o.u)(t)}return Object(o.u)(null)})):Object(o.u)(null)}function ce(e,t,r,n,a,i,s){if(v.a.applicationCache){var u=v.a.applicationCache.getLayerInfo(e+":"+i.url);if(u)return u.then((function(e){try{var i=new L.default({url:Object(h.i)(e.url)+"/"+t,outFields:["*"]});return Object(o.u)(ee(i,r,n,a,s))}catch(u){return Object(o.t)(u)}}),(function(e){return Object(o.t)(e)}))}return Object(o.c)((function(u,l){var o=new p.default({id:e,portal:i}).load();v.a.applicationCache&&v.a.applicationCache.setLayerInfo(e+":"+i.url,o),o.then((function(e){try{var i=new L.default({url:Object(h.i)(e.url)+"/"+t,outFields:["*"]});u(ee(i,r,n,a,s))}catch(u){l(u)}}),(function(t){v.a.applicationCache&&v.a.applicationCache.clearLayerInfo(e+":"+i.url),l(t)}))}))}},1212:function(e,t,r){"use strict";r.r(t),r.d(t,"registerFunctions",(function(){return T}));var n=r(12),a=r(16),i=r(823),s=r(915),u=r(989),l=r(246),o=r(809),c=r(928),d=r(1072),f=r(1033),p=r(710),h=r(885),y=r(974),v=r(1034),b=r(976),m=r(975),g=r(961),_=r(1035),O=r(827),j=r(1036),w=r(1126);function S(e,t,r){var n=e.getVariables();if(n.length>0){for(var i=[],s=0;s<n.length;s++){var u={name:n[s]};i.push(t.evaluateIdentifier(r,u))}return Object(a.b)(i).then((function(t){for(var r={},a=0;a<n.length;a++)r[n[a]]=t[a];return e.parameters=r,e}))}return Object(a.u)(e)}function F(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(var n in e)if(n.toLowerCase()===t.toLowerCase())return e[n];return r}function I(e){if(null===e)return null;var t={type:F(e,"type",""),name:F(e,"name","")};if("range"===t.type)t.range=F(e,"range",[]);else{t.codedValues=[];var r,a=Object(n.a)(F(e,"codedValues",[]));try{for(a.s();!(r=a.n()).done;){var i=r.value;t.codedValues.push({name:F(i,"name",""),code:F(i,"code",null)})}}catch(s){a.e(s)}finally{a.f()}}return t}function k(e){if(null===e)return null;var t={},r=F(e,"wkt",null);null!==r&&(t.wkt=r);var n=F(e,"wkid",null);return null!==n&&(t.wkid=n),t}function x(e){if(null===e)return null;var t={hasZ:F(e,"hasz",!1),hasM:F(e,"hasm",!1)},r=F(e,"spatialreference",null);r&&(t.spatialReference=k(r));var n=F(e,"x",null);if(null!==n)return t.x=n,t.y=F(e,"y",null),t;var a=F(e,"rings",null);if(null!==a)return t.rings=a,t;var i=F(e,"paths",null);if(null!==i)return t.paths=i,t;var s=F(e,"points",null);if(null!==s)return t.points=s,t;for(var u=0,l=["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"];u<l.length;u++){var o=l[u],c=F(e,o,null);null!==c&&(t[o]=c)}return t}function T(e){"async"===e.mode&&(e.functions.getuser=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){Object(i.J)(n,1,2);var a=Object(i.c)(n[1],""),l=!0===a;if(a=!0===a||!1===a?"":Object(i.y)(a),n[0]instanceof u.a){var o=null;return t.services&&t.services.portal&&(o=t.services.portal),o=Object(w.getPortal)(n[0],o),Object(w.lookupUser)(o,a,l).then((function(e){if(e){for(var t=JSON.parse(JSON.stringify(e)),r=0,n=["lastLogin","created","modified"];r<n.length;r++){var a=n[r];void 0!==t[a]&&null!==t[a]&&(t[a]=new Date(t[a]))}return s.a.convertObjectToArcadeDictionary(t)}return null}))}var c=null;if(Object(i.T)(n[0])&&(c=n[0]),c)return l=!1,a?null:c.load().then((function(){return c.getOwningSystemUrl()})).then((function(e){if(!e)return a?null:c.getIdentityUser().then((function(e){return e?s.a.convertObjectToArcadeDictionary({username:e}):null}));var r=null;return t.services&&t.services.portal&&(r=t.services.portal),r=Object(w.getPortal)(new u.a(e),r),Object(w.lookupUser)(r,a,l).then((function(e){if(e){for(var t=JSON.parse(JSON.stringify(e)),r=0,n=["lastLogin","created","modified"];r<n.length;r++){var a=n[r];void 0!==t[a]&&null!==t[a]&&(t[a]=new Date(t[a]))}return s.a.convertObjectToArcadeDictionary(t)}return null}))}));throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getuser",min:"1",max:"2"}),e.functions.featuresetbyid=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(Object(i.J)(r,2,4),r[0]instanceof f.a){var n=Object(i.y)(r[1]),a=Object(i.c)(r[2],null),s=Object(i.x)(Object(i.c)(r[3],!0));if(null===a&&(a=["*"]),!1===Object(i.B)(a))throw new Error("Invalid Parameter");return r[0].featureSetById(n,s,a)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),e.functions.featuresetbyportalitem=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){if(Object(i.J)(n,2,5),null===n[0])throw new Error("Portal is required");if(n[0]instanceof u.a){var a=Object(i.y)(n[1]),s=Object(i.y)(n[2]),l=Object(i.c)(n[3],null),o=Object(i.x)(Object(i.c)(n[4],!0));if(null===l&&(l=["*"]),!1===Object(i.B)(l))throw new Error("Invalid Parameter");var c=null;return t.services&&t.services.portal&&(c=t.services.portal),c=Object(w.getPortal)(n[0],c),Object(w.constructFeatureSetFromPortalItem)(a,s,t.spatialReference,l,o,c,t.lrucache)}if(!1===Object(i.v)(n[0]))throw new Error("Portal is required");var d=Object(i.y)(n[0]),f=Object(i.y)(n[1]),p=Object(i.c)(n[2],null),h=Object(i.x)(Object(i.c)(n[3],!0));if(null===p&&(p=["*"]),!1===Object(i.B)(p))throw new Error("Invalid Parameter");if(t.services&&t.services.portal)return Object(w.constructFeatureSetFromPortalItem)(d,f,t.spatialReference,p,h,t.services.portal,t.lrucache);throw new Error("Portal is required")}))},e.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),e.functions.featuresetbyname=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(Object(i.J)(r,2,4),r[0]instanceof f.a){var n=Object(i.y)(r[1]),a=Object(i.c)(r[2],null),s=Object(i.x)(Object(i.c)(r[3],!0));if(null===a&&(a=["*"]),!1===Object(i.B)(a))throw new Error("Invalid Parameter");return r[0].featureSetByName(n,s,a)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),e.functions.featureset=function(t,r){return e.standardFunction(t,r,(function(e,r,a){Object(i.J)(a,1,1);var u,l=a[0],o={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(Object(i.v)(l))void 0!==(l=JSON.parse(l)).layerDefinition?(o.layerDefinition=l.layerDefinition,o.featureSet=l.featureSet,l.layerDefinition.spatialReference&&(o.layerDefinition.spatialReference=l.layerDefinition.spatialReference)):(o.featureSet.features=l.features,o.featureSet.geometryType=l.geometryType,o.layerDefinition.geometryType=o.featureSet.geometryType,o.layerDefinition.objectIdField=l.objectIdFieldName,o.layerDefinition.typeIdField=l.typeIdFieldName,o.layerDefinition.globalIdField=l.globalIdFieldName,o.layerDefinition.fields=l.fields,l.spatialReference&&(o.layerDefinition.spatialReference=l.spatialReference));else{if(!(a[0]instanceof s.a))throw new Error("Invalid Parameter");var c=F(l=JSON.parse(a[0].castToText()),"layerdefinition");if(null!==c){o.layerDefinition.geometryType=F(c,"geometrytype",""),o.featureSet.geometryType=o.layerDefinition.geometryType,o.layerDefinition.globalIdField=F(c,"globalidfield",""),o.layerDefinition.objectIdField=F(c,"objectidfield",""),o.layerDefinition.typeIdField=F(c,"typeidfield","");var d=F(c,"spatialreference",null);d&&(o.layerDefinition.spatialReference=k(d));var f,p=Object(n.a)(F(c,"fields",[]));try{for(p.s();!(f=p.n()).done;){var h=f.value,y={name:F(h,"name",""),alias:F(h,"alias",""),type:F(h,"type",""),nullable:F(h,"nullable",!0),editable:F(h,"editable",!0),length:F(h,"length",null),domain:I(F(h,"domain"))};o.layerDefinition.fields.push(y)}}catch(Q){p.e(Q)}finally{p.f()}var v=F(l,"featureset",null);if(v){var b,m={},g=Object(n.a)(o.layerDefinition.fields);try{for(g.s();!(b=g.n()).done;){var _=b.value;m[_.name.toLowerCase()]=_.name}}catch(Q){g.e(Q)}finally{g.f()}var O,w=Object(n.a)(F(v,"features",[]));try{for(w.s();!(O=w.n()).done;){var S=O.value,T={},E=F(S,"attributes",{});for(var C in E)T[m[C.toLowerCase()]]=E[C];o.featureSet.features.push({attributes:T,geometry:x(F(S,"geometry",null))})}}catch(Q){w.e(Q)}finally{w.f()}}}else{o.layerDefinition.geometryType=F(l,"geometrytype",""),o.featureSet.geometryType=o.layerDefinition.geometryType,o.layerDefinition.objectIdField=F(l,"objectidfieldname",""),o.layerDefinition.typeIdField=F(l,"typeidfieldname","");var D=F(l,"spatialreference",null);D&&(o.layerDefinition.spatialReference=k(D));var N,R=Object(n.a)(F(l,"fields",[]));try{for(R.s();!(N=R.n()).done;){var A=N.value,P={name:F(A,"name",""),alias:F(A,"alias",""),type:F(A,"type",""),nullable:F(A,"nullable",!0),editable:F(A,"editable",!0),length:F(A,"length",null),domain:I(F(A,"domain"))};o.layerDefinition.fields.push(P)}}catch(Q){R.e(Q)}finally{R.f()}var L,M={},G=Object(n.a)(o.layerDefinition.fields);try{for(G.s();!(L=G.n()).done;){var B=L.value;M[B.name.toLowerCase()]=B.name}}catch(Q){G.e(Q)}finally{G.f()}var q,U=Object(n.a)(F(l,"features",[]));try{for(U.s();!(q=U.n()).done;){var V=q.value,W={},J=F(V,"attributes",{});for(var z in J)W[M[z.toLowerCase()]]=J[z];o.featureSet.features.push({attributes:W,geometry:x(F(V,"geometry",null))})}}catch(Q){U.e(Q)}finally{U.f()}}}if(0==(!!(u=o).layerDefinition&&!!u.featureSet&&!1!==function(e,t){var r,a=Object(n.a)(["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"]);try{for(a.s();!(r=a.n()).done;){if(r.value===e)return!0}}catch(Q){a.e(Q)}finally{a.f()}return!1}(u.layerDefinition.geometryType)&&null!==u.layerDefinition.objectIdField&&""!==u.layerDefinition.objectIdField&&!1!==Object(i.B)(u.layerDefinition.fields)&&!1!==Object(i.B)(u.featureSet.features)))throw new Error("Invalid Parameter");return j.a.create(o,t.spatialReference)}))},e.signatures.push({name:"featureset",min:"1",max:"1"}),e.functions.filter=function(t,r){return e.standardFunctionAsync(t,r,(function(r,n,s){return Object(i.J)(s,2,2),Object(i.T)(s[0])?s[0].load().then((function(r){var n=p.WhereClause.create(s[1],r.getFieldsIndex()),i=n.getVariables();if(i.length>0){for(var u=[],l=0;l<i.length;l++){var o={name:i[l]};u.push(e.evaluateIdentifier(t,o))}return Object(a.b)(u).then((function(e){for(var t={},r=0;r<i.length;r++)t[i[r]]=e[r];return n.parameters=t,new y.a({parentfeatureset:s[0],whereclause:n})}))}return Object(a.u)(new y.a({parentfeatureset:s[0],whereclause:n}))})):e.failDefferred("Filter cannot accept this parameter type")}))},e.signatures.push({name:"filter",min:"2",max:"2"}),e.functions.orderby=function(t,r){return e.standardFunctionAsync(t,r,(function(t,r,n){if(Object(i.J)(n,2,2),Object(i.T)(n[0])){var s=new b.a(n[1]);return Object(a.u)(new m.a({parentfeatureset:n[0],orderbyclause:s}))}return e.failDefferred("Order cannot accept this parameter type")}))},e.signatures.push({name:"orderby",min:"2",max:"2"}),e.functions.top=function(t,r){return e.standardFunctionAsync(t,r,(function(t,r,n){return Object(i.J)(n,2,2),Object(i.T)(n[0])?Object(a.u)(new _.a({parentfeatureset:n[0],topnum:n[1]})):Object(i.B)(n[0])?Object(i.w)(n[1])>=n[0].length?n[0].slice(0):n[0].slice(0,Object(i.w)(n[1])):Object(i.I)(n[0])?Object(i.w)(n[1])>=n[0].length()?n[0].slice(0):n[0].slice(0,Object(i.w)(n[1])):e.failDefferred("Top cannot accept this parameter type")}))},e.signatures.push({name:"top",min:"2",max:"2"}),e.functions.first=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){return Object(i.J)(r,1,1),Object(i.T)(r[0])?r[0].first(e.abortSignal).then((function(e){if(null!==e){var t=c.a.createFromGraphicLikeObject(e.geometry,e.attributes,r[0]);t._underlyingGraphic=e,e=t}return e})):Object(i.B)(r[0])?0===r[0].length?Object(a.u)(null):Object(a.u)(r[0][0]):Object(i.I)(r[0])?0===r[0].length()?Object(a.u)(null):Object(a.u)(r[0].get(0)):null}))},e.signatures.push({name:"first",min:"1",max:"1"}),e.functions.attachments=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){Object(i.J)(n,1,2);var a={minsize:-1,maxsize:-1,types:null};if(n.length>1)if(n[1]instanceof s.a){if(n[1].hasField("minsize")&&(a.minsize=Object(i.w)(n[1].field("minsize"))),n[1].hasField("maxsize")&&(a.maxsize=Object(i.w)(n[1].field("maxsize"))),n[1].hasField("types")){var u=Object(i.t)(n[1].field("types"),!1);u.length>0&&(a.types=u)}}else if(null!==n[1])throw new Error("Invalid Parameter");if(n[0]instanceof c.a){var l=n[0]._layer;return l instanceof O.default&&(l=Object(w.constructFeatureSet)(l,t.spatialReference,["*"],!0,t.lrucache)),null===l||!1===Object(i.T)(l)?[]:l.load().then((function(){return l.queryAttachments(n[0].field(l.objectIdField),a.minsize,a.maxsize,a.types)}))}if(null===n[0])return[];throw new Error("Invalid Parameter")}))},e.signatures.push({name:"attachments",min:"1",max:"2"}),e.functions.featuresetbyrelationshipname=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){Object(i.J)(n,2,4);var a=n[0],s=Object(i.y)(n[1]),u=Object(i.c)(n[2],null),l=Object(i.x)(Object(i.c)(n[3],!0));if(null===u&&(u=["*"]),!1===Object(i.B)(u))throw new Error("Invalid Parameter");if(null===n[0])return null;if(!(n[0]instanceof c.a))throw new Error("Invalid Parameter");var o=a._layer;return o instanceof O.default&&(o=Object(w.constructFeatureSet)(o,t.spatialReference,["*"],!0,t.lrucache)),null===o||!1===Object(i.T)(o)?null:o.load().then((function(e){var r=e.relationshipMetaData().filter((function(e){return e.name===s}));if(0===r.length)return null;if(void 0!==r[0].relationshipTableId&&null!==r[0].relationshipTableId&&r[0].relationshipTableId>-1)return Object(w.constructFeatureSetFromRelationship)(e,r[0],a.field(e.objectIdField),e.spatialReference,u,l,t.lrucache);var n=e.serviceUrl();return n?(n="/"===n.charAt(n.length-1)?n+r[0].relatedTableId.toString():n+"/"+r[0].relatedTableId.toString(),Object(w.constructFeatureSetFromUrl)(n,e.spatialReference,u,l,t.lrucache).then((function(t){return t.load().then((function(){return t.relationshipMetaData()})).then((function(n){if(n=n.filter((function(e){return e.id===r[0].id})),!1===a.hasField(r[0].keyField)||null===a.field(r[0].keyField))return e.getFeatureByObjectId(a.field(e.objectIdField),[r[0].keyField]).then((function(e){if(e){var a=p.WhereClause.create(n[0].keyField+"= @id",t.getFieldsIndex());return a.parameters={id:e.attributes[r[0].keyField]},t.filter(a)}return new g.a({parentfeatureset:t})}));var i=p.WhereClause.create(n[0].keyField+"= @id",t.getFieldsIndex());return i.parameters={id:a.field(r[0].keyField)},t.filter(i)}))}))):null}))}))},e.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),e.functions.featuresetbyassociation=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,a){Object(i.J)(a,2,3);var s=a[0],u=Object(i.y)(Object(i.c)(a[1],"")).toLowerCase(),d=Object(i.v)(a[2])?Object(i.y)(a[2]):null;if(null===a[0])return null;if(!(a[0]instanceof c.a))throw new Error("Invalid Parameter");var f=s._layer;return f instanceof O.default&&(f=Object(w.constructFeatureSet)(f,t.spatialReference,["*"],!0,t.lrucache)),null===f||!1===Object(i.T)(f)?null:f.load().then((function(){var e=f.serviceUrl();return Object(w.constructAssociationMetaDataFeatureSetFromUrl)(e,t.spatialReference)})).then((function(e){var t=null,r=null,a=!1;if(null!==d&&""!==d&&void 0!==d){var c,h=Object(n.a)(e.terminals);try{for(h.s();!(c=h.n()).done;){var y=c.value;y.terminalName===d&&(r=y.terminalId)}}catch(W){h.e(W)}finally{h.f()}null===r&&(a=!0)}var b,m=e.associations.getFieldsIndex(),g=m.get("TOGLOBALID").name,_=m.get("FROMGLOBALID").name,O=m.get("TOTERMINALID").name,j=m.get("FROMTERMINALID").name,w=m.get("FROMNETWORKSOURCEID").name,S=m.get("TONETWORKSOURCEID").name,F=m.get("ASSOCIATIONTYPE").name,I=m.get("ISCONTENTVISIBLE").name,k=m.get("OBJECTID").name,x=Object(n.a)(f.fields);try{for(x.s();!(b=x.n()).done;){var T=b.value;if("global-id"===T.type){t=s.field(T.name);break}}}catch(W){x.e(W)}finally{x.f()}var E=null,C=new v.d(new l.a({name:"percentalong",alias:"percentalong",type:"double"}),p.WhereClause.create("0",e.associations.getFieldsIndex())),D=new v.d(new l.a({name:"side",alias:"side",type:"string"}),p.WhereClause.create("''",e.associations.getFieldsIndex())),N="globalid",R="globalId",A={};for(var P in e.lkp)A[P]=e.lkp[P].sourceId;var L=new v.e(new l.a({name:"classname",alias:"classname",type:"string"}),null,A),M="";switch(u){case"midspan":M="((".concat(g,"='").concat(t,"') OR ( ").concat(_,"='").concat(t,"')) AND (").concat(F," IN (5))"),L.codefield=p.WhereClause.create("CASE WHEN (".concat(g,"='").concat(t,"') THEN ").concat(w," ELSE ").concat(S," END"),e.associations.getFieldsIndex());var G=Object(o.c)(v.a.findField(e.associations.fields,_));G.name=N,G.alias=N,E=new v.d(G,p.WhereClause.create("CASE WHEN (".concat(_,"='").concat(t,"') THEN ").concat(g," ELSE ").concat(_," END"),e.associations.getFieldsIndex())),C=e.unVersion>=4?new v.c(v.a.findField(e.associations.fields,m.get("PERCENTALONG").name)):new v.d(new l.a({name:"percentalong",alias:"percentalong",type:"double"}),p.WhereClause.create("0",e.associations.getFieldsIndex()));break;case"junctionedge":M="((".concat(g,"='").concat(t,"') OR ( ").concat(_,"='").concat(t,"')) AND (").concat(F," IN (4,6))"),L.codefield=p.WhereClause.create("CASE WHEN (".concat(g,"='").concat(t,"') THEN ").concat(w," ELSE ").concat(S," END"),e.associations.getFieldsIndex());var B=Object(o.c)(v.a.findField(e.associations.fields,_));B.name=N,B.alias=N,E=new v.d(B,p.WhereClause.create("CASE WHEN (".concat(_,"='").concat(t,"') THEN ").concat(g," ELSE ").concat(_," END"),e.associations.getFieldsIndex())),D=new v.d(new l.a({name:"side",alias:"side",type:"string"}),p.WhereClause.create("CASE WHEN (".concat(F,"=4) THEN 'from' ELSE 'to' END"),e.associations.getFieldsIndex()));break;case"connected":var q="".concat(g,"='@T'"),U="".concat(_,"='@T'");null!==r&&(q+=" AND ".concat(O,"=@A"),U+=" AND ".concat(j,"=@A")),M="(("+q+") OR ("+U+"))",M=Object(i.g)(M,"@T",t),q=Object(i.g)(q,"@T",t),null!==r&&(q=Object(i.g)(q,"@A",r.toString()),M=Object(i.g)(M,"@A",r.toString())),L.codefield=p.WhereClause.create("CASE WHEN "+q+" THEN ".concat(w," ELSE ").concat(S," END"),e.associations.getFieldsIndex());var V=Object(o.c)(v.a.findField(e.associations.fields,_));V.name=N,V.alias=N,E=new v.d(V,p.WhereClause.create("CASE WHEN "+q+" THEN ".concat(_," ELSE ").concat(g," END"),e.associations.getFieldsIndex()));break;case"container":M="".concat(g,"='").concat(t,"' AND ").concat(F," = 2"),null!==r&&(M+=" AND ".concat(O," = ")+r.toString()),L.codefield=w,M="( "+M+" )",E=new v.b(v.a.findField(e.associations.fields,_),N,N);case"content":M="(".concat(_,"='").concat(t,"' AND ").concat(F," = 2)"),null!==r&&(M+=" AND ".concat(j," = ")+r.toString()),L.codefield=S,M="( "+M+" )",E=new v.b(v.a.findField(e.associations.fields,g),N,N);break;case"structure":M="(".concat(g,"='").concat(t,"' AND ").concat(F," = 3)"),null!==r&&(M+=" AND ".concat(O," = ")+r.toString()),L.codefield=w,M="( "+M+" )",E=new v.b(v.a.findField(e.associations.fields,_),N,R);break;case"attached":M="(".concat(_,"='").concat(t,"' AND ").concat(F," = 3)"),null!==r&&(M+=" AND ".concat(j," = ")+r.toString()),L.codefield=S,M="( "+M+" )",E=new v.b(v.a.findField(e.associations.fields,g),N,R);break;default:throw new Error("Invalid Parameter")}return a&&(M="1 <> 1"),new v.a({parentfeatureset:e.associations,adaptedFields:[new v.c(v.a.findField(e.associations.fields,k)),new v.c(v.a.findField(e.associations.fields,I)),E,D,L,C],extraFilter:M?p.WhereClause.create(M,e.associations.getFieldsIndex()):null})}))}))},e.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),e.functions.groupby=function(t,r){return e.standardFunctionAsync(t,r,(function(r,u,l){return Object(i.J)(l,3,3),Object(i.T)(l[0])?l[0].load().then((function(r){var u=[],o=[],c=!1,d=[];if(Object(i.v)(l[1]))d.push(l[1]);else if(l[1]instanceof s.a)d.push(l[1]);else if(Object(i.B)(l[1]))d=l[1];else{if(!Object(i.I)(l[1]))return e.failDefferred("Illegal Value: GroupBy");d=l[1].toArray()}var f,y=Object(n.a)(d);try{for(y.s();!(f=y.n()).done;){var v=f.value;if(Object(i.v)(v)){var b=p.WhereClause.create(Object(i.y)(v),r.getFieldsIndex()),m=!0===Object(h.c)(b)?Object(i.y)(v):"%%%%FIELDNAME";u.push({name:m,expression:b}),"%%%%FIELDNAME"===m&&(c=!0)}else{if(!(v instanceof s.a))return e.failDefferred("Illegal Value: GroupBy");var g=v.hasField("name")?v.field("name"):"%%%%FIELDNAME",_=v.hasField("expression")?v.field("expression"):"";if("%%%%FIELDNAME"===g&&(c=!0),!g)return e.failDefferred("Illegal Value: GroupBy");u.push({name:g,expression:p.WhereClause.create(_||g,r.getFieldsIndex())})}}}catch(H){y.e(H)}finally{y.f()}if(d=[],Object(i.v)(l[2]))d.push(l[2]);else if(Object(i.B)(l[2]))d=l[2];else if(Object(i.I)(l[2]))d=l[2].toArray();else{if(!(l[2]instanceof s.a))return e.failDefferred("Illegal Value: GroupBy");d.push(l[2])}var O,j=Object(n.a)(d);try{for(j.s();!(O=j.n()).done;){var w=O.value;if(!(w instanceof s.a))return e.failDefferred("Illegal Value: GroupBy");var F=w.hasField("name")?w.field("name"):"",I=w.hasField("statistic")?w.field("statistic"):"",k=w.hasField("expression")?w.field("expression"):"";if(!F||!I||!k)return e.failDefferred("Illegal Value: GroupBy");o.push({name:F,statistic:I.toLowerCase(),expression:p.WhereClause.create(k,r.getFieldsIndex())})}}catch(H){j.e(H)}finally{j.f()}if(c){var x,T={},E=Object(n.a)(r.fields);try{for(E.s();!(x=E.n()).done;){T[x.value.name.toLowerCase()]=1}}catch(H){E.e(H)}finally{E.f()}var C,D=Object(n.a)(u);try{for(D.s();!(C=D.n()).done;){var N=C.value;"%%%%FIELDNAME"!==N.name&&(T[N.name.toLowerCase()]=1)}}catch(H){D.e(H)}finally{D.f()}var R,A=Object(n.a)(o);try{for(A.s();!(R=A.n()).done;){var P=R.value;"%%%%FIELDNAME"!==P.name&&(T[P.name.toLowerCase()]=1)}}catch(H){A.e(H)}finally{A.f()}var L,M=0,G=Object(n.a)(u);try{for(G.s();!(L=G.n()).done;){var B=L.value;if("%%%%FIELDNAME"===B.name){for(;1===T["field_"+M.toString()];)M++;T["field_"+M.toString()]=1,B.name="FIELD_"+M.toString()}}}catch(H){G.e(H)}finally{G.f()}}for(var q=[],U=0,V=u;U<V.length;U++){var W=V[U];q.push(S(W.expression,e,t))}for(var J=0,z=o;J<z.length;J++){var Q=z[J];q.push(S(Q.expression,e,t))}return q.length>0?Object(a.b)(q).then((function(){return Object(a.u)(l[0].groupby(u,o))})):Object(a.u)(l[0].groupby(u,o))})):e.failDefferred("Illegal Value: GroupBy")}))},e.signatures.push({name:"groupby",min:"3",max:"3"}),e.functions.distinct=function(t,r){return e.standardFunctionAsync(t,r,(function(r,u,l){return Object(i.T)(l[0])?(Object(i.J)(l,2,2),l[0].load().then((function(r){var u=[],o=[];if(Object(i.v)(l[1]))o.push(l[1]);else if(l[1]instanceof s.a)o.push(l[1]);else if(Object(i.B)(l[1]))o=l[1];else{if(!Object(i.I)(l[1]))return e.failDefferred("Illegal Value: GroupBy");o=l[1].toArray()}var c,d=!1,f=Object(n.a)(o);try{for(f.s();!(c=f.n()).done;){var y=c.value;if(Object(i.v)(y)){var v=p.WhereClause.create(Object(i.y)(y),r.getFieldsIndex()),b=!0===Object(h.c)(v)?Object(i.y)(y):"%%%%FIELDNAME";u.push({name:b,expression:v}),"%%%%FIELDNAME"===b&&(d=!0)}else{if(!(y instanceof s.a))return e.failDefferred("Illegal Value: GroupBy");var m=y.hasField("name")?y.field("name"):"%%%%FIELDNAME",g=y.hasField("expression")?y.field("expression"):"";if("%%%%FIELDNAME"===m&&(d=!0),!m)return e.failDefferred("Illegal Value: GroupBy");u.push({name:m,expression:p.WhereClause.create(g||m,r.getFieldsIndex())})}}}catch(A){f.e(A)}finally{f.f()}if(d){var _,O={},j=Object(n.a)(r.fields);try{for(j.s();!(_=j.n()).done;){O[_.value.name.toLowerCase()]=1}}catch(A){j.e(A)}finally{j.f()}var w,F=Object(n.a)(u);try{for(F.s();!(w=F.n()).done;){var I=w.value;"%%%%FIELDNAME"!==I.name&&(O[I.name.toLowerCase()]=1)}}catch(A){F.e(A)}finally{F.f()}var k,x=0,T=Object(n.a)(u);try{for(T.s();!(k=T.n()).done;){var E=k.value;if("%%%%FIELDNAME"===E.name){for(;1===O["field_"+x.toString()];)x++;O["field_"+x.toString()]=1,E.name="FIELD_"+x.toString()}}}catch(A){T.e(A)}finally{T.f()}}for(var C=[],D=0,N=u;D<N.length;D++){var R=N[D];C.push(S(R.expression,e,t))}return C.length>0?Object(a.b)(C).then((function(){return Object(a.u)(l[0].groupby(u,[]))})):Object(a.u)(l[0].groupby(u,[]))}))):function(e,t,r,n){if(1===n.length){if(Object(i.B)(n[0]))return Object(d.a)(e,n[0],-1);if(Object(i.I)(n[0]))return Object(d.a)(e,n[0].toArray(),-1)}return Object(d.a)(e,n,-1)}("distinct",0,0,l)}))})}},710:function(e,t,r){"use strict";r.r(t),r.d(t,"WhereClause",(function(){return k})),r.d(t,"defaultAttributeAdapter",(function(){return U}));var n=r(32),a=r(37),i=r(12),s=r(2),u=r(3),l=r(13);var o={min:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.min.apply(Math,e[0])}},max:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.max.apply(Math,e[0])}},avg:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:c(e[0])}},sum:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}(e[0])}},stddev:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sqrt(d(e[0]))}},count:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].length}},var:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:d(e[0])}}};function c(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function d(e){var t,r=c(e),n=e.length,a=0,s=Object(i.a)(e);try{for(s.s();!(t=s.n()).done;){var u=t.value;a+=Math.pow(u-r,2)}}catch(l){s.e(l)}finally{s.f()}return n>1?a/(n-1):0}var f=r(108),p=function(){function e(){Object(s.a)(this,e),this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0}return Object(u.a)(e,[{key:"valueInMilliseconds",value:function(){return("-"===this.op?-1:1)*(1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}],[{key:"fixDefaults",value:function(e){if(null!==e.precision||null!==e.secondary)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}},{key:"createFromMilliseconds",value:function(t){var r=new e;return r.second=t/1e3,r}},{key:"createFromValueAndQualifer",value:function(t,r,n){var a=new e;if(a.op="-"===n?"-":"+","interval-period"===r.type){e.fixDefaults(r);var i=new RegExp("^[0-9]{1,}$");if("year"===r.period||"month"===r.period)throw new Error("Year-Month Intervals not supported");if(!i.test(t))throw new Error("Illegal Interval");a[r.period]=parseFloat(t)}else{if(e.fixDefaults(r.start),e.fixDefaults(r.end),"year"===r.start.period||"month"===r.start.period)throw new Error("Year-Month Intervals not supported");if("year"===r.end.period||"month"===r.end.period)throw new Error("Year-Month Intervals not supported");switch(r.start.period){case"day":switch(r.end.period){case"hour":if(!new RegExp("^[0-9]{1,} [0-9]{1,}$").test(t))throw new Error("Illegal Interval");a[r.start.period]=parseFloat(t.split(" ")[0]),a[r.end.period]=parseFloat(t.split(" ")[1]);break;case"minute":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$").test(t))throw new Error("Illegal Interval");a[r.start.period]=parseFloat(t.split(" ")[0]);var s=t.split(" ")[1].split(":");a.hour=parseFloat(s[0]),a.minute=parseFloat(s[1]);break;case"second":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");a[r.start.period]=parseFloat(t.split(" ")[0]);var u=t.split(" ")[1].split(":");a.hour=parseFloat(u[0]),a.minute=parseFloat(u[1]),a.second=parseFloat(u[2]);break;default:throw"Invalid Interval."}break;case"hour":switch(r.end.period){case"minute":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}$").test(t))throw new Error("Illegal Interval");a.hour=parseFloat(t.split(":")[0]),a.minute=parseFloat(t.split(":")[1]);break;case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");var l=t.split(":");a.hour=parseFloat(l[0]),a.minute=parseFloat(l[1]),a.second=parseFloat(l[2]);break;default:throw"Invalid Interval."}break;case"minute":switch(r.end.period){case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");var o=t.split(":");a.minute=parseFloat(o[0]),a.second=parseFloat(o[1]);break;default:throw"Invalid Interval."}break;default:throw"Invalid Interval."}}return a}}]),e}();function h(e,t){var r=y[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to ".concat(e.toUpperCase()));return r.evaluate(t)}var y={extract:{minParams:2,maxParams:2,evaluate:function(e){var t=Object(n.a)(e,2),r=t[0],a=t[1];if(null==a)return null;if(a instanceof Date)switch(r.toUpperCase()){case"SECOND":return a.getSeconds();case"MINUTE":return a.getMinutes();case"HOUR":return a.getHours();case"DAY":return a.getDate();case"MONTH":return a.getMonth()+1;case"YEAR":return a.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:function(e){if(2===e.length){var t=Object(n.a)(e,2),r=t[0],a=t[1];return null==r||null==a?null:r.toString().substring(a-1)}if(3===e.length){var i=Object(n.a)(e,3),s=i[0],u=i[1],l=i[2];return null==s||null==u||null==l?null:l<=0?"":s.toString().substring(u-1,u+l-1)}}},position:{minParams:2,maxParams:2,evaluate:function(e){var t=Object(n.a)(e,2),r=t[0],a=t[1];return null==r||null==a?null:a.indexOf(r)+1}},trim:{minParams:2,maxParams:3,evaluate:function(e){var t=3===e.length,r=t?e[1]:" ",n=t?e[2]:e[1];if(null==r||null==n)return null;var a="(".concat(Object(f.a)(r),")");switch(e[0]){case"BOTH":return n.replace(new RegExp("^".concat(a,"*|").concat(a,"*$"),"g"),"");case"LEADING":return n.replace(new RegExp("^".concat(a,"*"),"g"),"");case"TRAILING":return n.replace(new RegExp("".concat(a,"*$"),"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.abs(e[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.ceil(e[0])}},floor:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.floor(e[0])}},log:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])}},log10:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sin(e[0])}},cos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.cos(e[0])}},tan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.tan(e[0])}},asin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.asin(e[0])}},acos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.acos(e[0])}},atan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.atan(e[0])}},sign:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0]>0?1:e[1]<0?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])}},mod:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:e[0]%e[1]}},round:{minParams:1,maxParams:2,evaluate:function(e){var t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:function(e){return null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(e){return"string"==typeof e[0]||e[0]instanceof String?e[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(e){for(var t="",r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toUpperCase()}}},v=r(242),b=Object(v.b)((function(e){e.exports&&(e.exports=function(){function e(t,r,n,a){this.message=t,this.expected=r,this.found=n,this.location=a,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){var r={literal:function(e){return'"'+a(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?i(e.parts[t][0])+"-"+i(e.parts[t][1]):i(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function a(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function s(e){return r[e.type](e)}return"Expected "+function(e){var t,r,n=new Array(e.length);for(t=0;t<e.length;t++)n[t]=s(e[t]);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+a(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var n,a={},i={start:ze},s=ze,u=function(e,t){var r={type:"expr_list"},n=function(e,t,r){return function(e,t){for(var r=[e],n=0;n<t.length;n++)r.push(t[n][3]);return r}(e,t)}(e,t);return r.value=n,r},l=function(e,t){return yr(e,t)},o=qe("!",!1),c=qe("=",!1),d=qe(">=",!1),f=qe(">",!1),p=qe("<=",!1),h=qe("<>",!1),y=qe("<",!1),v=qe("!=",!1),b=function(e){return e[0]+" "+e[2]},m=qe("+",!1),g=qe("-",!1),_=qe("*",!1),O=qe("/",!1),j=function(e,t){return e+t.join("")},w=/^[A-Za-z_\x80-\uFFFF]/,S=Ue([["A","Z"],["a","z"],"_",["\x80","\uffff"]],!1,!1),F=/^[A-Za-z0-9_]/,I=Ue([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),k=/^[A-Za-z0-9_.\x80-\uFFFF]/,x=Ue([["A","Z"],["a","z"],["0","9"],"_",".",["\x80","\uffff"]],!1,!1),T=qe("@",!1),E=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},C=function(e,t){return{type:"interval-period",period:"second",precision:e,secondary:t}},D=function(e){return parseFloat(e)},N=qe("'",!1),R=qe("N'",!1),A="''",P=qe("''",!1),L=/^[^']/,M=Ue(["'"],!0,!1),G=function(e,t){return{type:"when_clause",operand:e,value:t}},B=qe(".",!1),q=/^[0-9]/,U=Ue([["0","9"]],!1,!1),V=/^[eE]/,W=Ue(["e","E"],!1,!1),J=/^[+\-]/,z=Ue(["+","-"],!1,!1),Q=qe("NULL",!0),H=qe("TRUE",!0),Y=qe("FALSE",!0),K=qe("IN",!0),$=qe("IS",!0),Z=qe("LIKE",!0),X=qe("ESCAPE",!0),ee=qe("NOT",!0),te=qe("AND",!0),re=qe("OR",!0),ne=qe("BETWEEN",!0),ae=qe("FROM",!0),ie=qe("FOR",!0),se=qe("SUBSTRING",!0),ue=qe("EXTRACT",!0),le=qe("TRIM",!0),oe=qe("POSITION",!0),ce=qe("TIMESTAMP",!0),de=qe("DATE",!0),fe=qe("LEADING",!0),pe=qe("TRAILING",!0),he=qe("BOTH",!0),ye=qe("TO",!0),ve=qe("INTERVAL",!0),be=qe("YEAR",!0),me=qe("MONTH",!0),ge=qe("DAY",!0),_e=qe("HOUR",!0),Oe=qe("MINUTE",!0),je=qe("SECOND",!0),we=qe("CASE",!0),Se=qe("END",!0),Fe=qe("WHEN",!0),Ie=qe("THEN",!0),ke=qe("ELSE",!0),xe=qe(",",!1),Te=qe("(",!1),Ee=qe(")",!1),Ce=/^[ \t\n\r]/,De=Ue([" ","\t","\n","\r"],!1,!1),Ne=qe("`",!1),Re=/^[^`]/,Ae=Ue(["`"],!0,!1),Pe=0,Le=[{line:1,column:1}],Me=0,Ge=[],Be=0;if("startRule"in r){if(!(r.startRule in i))throw new Error("Can't start parsing from rule \""+r.startRule+'".');s=i[r.startRule]}function qe(e,t){return{type:"literal",text:e,ignoreCase:t}}function Ue(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Ve(e){var r,n=Le[e];if(n)return n;for(r=e-1;!Le[r];)r--;for(n={line:(n=Le[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Le[e]=n,n}function We(e,t){var r=Ve(e),n=Ve(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function Je(e){Pe<Me||(Pe>Me&&(Me=Pe,Ge=[]),Ge.push(e))}function ze(){var e,t;return e=Pe,dr()!==a&&(t=He())!==a&&dr()!==a?e=t:(Pe=e,e=a),e}function Qe(){var e,t,r,n,i,s,l,o;if(e=Pe,(t=He())!==a){for(r=[],n=Pe,(i=dr())!==a&&(s=lr())!==a&&(l=dr())!==a&&(o=He())!==a?n=i=[i,s,l,o]:(Pe=n,n=a);n!==a;)r.push(n),n=Pe,(i=dr())!==a&&(s=lr())!==a&&(l=dr())!==a&&(o=He())!==a?n=i=[i,s,l,o]:(Pe=n,n=a);r!==a?e=t=u(t,r):(Pe=e,e=a)}else Pe=e,e=a;return e}function He(){var e,t,r,n,i,s,u,o;if(e=Pe,(t=Ye())!==a){for(r=[],n=Pe,(i=dr())!==a&&(s=Pt())!==a&&(u=dr())!==a&&(o=Ye())!==a?n=i=[i,s,u,o]:(Pe=n,n=a);n!==a;)r.push(n),n=Pe,(i=dr())!==a&&(s=Pt())!==a&&(u=dr())!==a&&(o=Ye())!==a?n=i=[i,s,u,o]:(Pe=n,n=a);r!==a?e=t=l(t,r):(Pe=e,e=a)}else Pe=e,e=a;return e}function Ye(){var e,t,r,n,i,s,u,o;if(e=Pe,(t=Ke())!==a){for(r=[],n=Pe,(i=dr())!==a&&(s=At())!==a&&(u=dr())!==a&&(o=Ke())!==a?n=i=[i,s,u,o]:(Pe=n,n=a);n!==a;)r.push(n),n=Pe,(i=dr())!==a&&(s=At())!==a&&(u=dr())!==a&&(o=Ke())!==a?n=i=[i,s,u,o]:(Pe=n,n=a);r!==a?e=t=l(t,r):(Pe=e,e=a)}else Pe=e,e=a;return e}function Ke(){var e,r,n,i,s;return e=Pe,(r=Rt())===a&&(r=Pe,33===t.charCodeAt(Pe)?(n="!",Pe++):(n=a,0===Be&&Je(o)),n!==a?(i=Pe,Be++,61===t.charCodeAt(Pe)?(s="=",Pe++):(s=a,0===Be&&Je(c)),Be--,s===a?i=void 0:(Pe=i,i=a),i!==a?r=n=[n,i]:(Pe=r,r=a)):(Pe=r,r=a)),r!==a&&(n=dr())!==a&&(i=Ke())!==a?e=r=function(e){return function(e,t){return{type:"unary_expr",operator:"NOT",expr:t}}(0,e)}(i):(Pe=e,e=a),e===a&&(e=function(){var e,t,r;return e=Pe,(t=et())!==a&&dr()!==a?((r=function(){var e;return(e=function(){var e,t,r,n,i,s;if(e=[],t=Pe,(r=dr())!==a&&(n=$e())!==a&&(i=dr())!==a&&(s=et())!==a?t=r=[r,n,i,s]:(Pe=t,t=a),t!==a)for(;t!==a;)e.push(t),t=Pe,(r=dr())!==a&&(n=$e())!==a&&(i=dr())!==a&&(s=et())!==a?t=r=[r,n,i,s]:(Pe=t,t=a);else e=a;return e!==a&&(e=function(e){return{type:"arithmetic",tail:e}}(e)),e}())===a&&(e=function(){var e,t,r,n;return e=Pe,(t=Xe())!==a&&dr()!==a&&(r=or())!==a&&dr()!==a&&(n=Qe())!==a&&dr()!==a&&cr()!==a?e=t=function(e,t){return{op:e,right:t}}(t,n):(Pe=e,e=a),e===a&&(e=Pe,(t=Xe())!==a&&dr()!==a&&(r=or())!==a&&dr()!==a&&(n=cr())!==a?e=t=function(e){return{op:e,right:{type:"expr_list",value:[]}}}(t):(Pe=e,e=a),e===a&&(e=Pe,(t=Xe())!==a&&dr()!==a&&(r=ot())!==a?e=t=function(e,t){return{op:e,right:t}}(t,r):(Pe=e,e=a))),e}())===a&&(e=function(){var e,t,r,n,i,s;return e=Pe,(t=Rt())!==a&&dr()!==a&&(r=Lt())!==a&&dr()!==a&&(n=et())!==a&&dr()!==a&&(i=At())!==a&&dr()!==a&&(s=et())!==a?e=t=function(e,t,r){return{op:"NOT"+e,right:{type:"expr_list",value:[t,r]}}}(r,n,s):(Pe=e,e=a),e===a&&(e=Pe,(t=Lt())!==a&&dr()!==a&&(r=et())!==a&&dr()!==a&&(n=At())!==a&&dr()!==a&&(i=et())!==a?e=t=function(e,t,r){return{op:e,right:{type:"expr_list",value:[t,r]}}}(t,r,i):(Pe=e,e=a)),e}())===a&&(e=function(){var e,t,r,n;return e=Pe,(t=Ct())!==a&&dr()!==a&&(r=Rt())!==a&&dr()!==a&&(n=et())!==a?e=t=function(e,t){return{op:e+"NOT",right:t}}(t,n):(Pe=e,e=a),e===a&&(e=Pe,(t=Ct())!==a&&dr()!==a&&(r=et())!==a?e=t=function(e,t){return{op:e,right:t}}(t,r):(Pe=e,e=a)),e}())===a&&(e=function(){var e,t,r,n;return e=Pe,(t=Ze())!==a&&dr()!==a&&(r=vt())!==a&&dr()!==a&&Nt()!==a&&dr()!==a&&(n=bt())!==a?e=t=function(e,t,r){return{op:e,right:t,escape:r.value}}(t,r,n):(Pe=e,e=a),e===a&&(e=Pe,(t=Ze())!==a&&dr()!==a&&(r=vt())!==a?e=t=function(e,t){return{op:e,right:t,escape:""}}(t,r):(Pe=e,e=a)),e}()),e}())===a&&(r=null),r!==a?e=t=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?yr(e,t.tail):hr(t.op,e,t.right,t.escape)}(t,r):(Pe=e,e=a)):(Pe=e,e=a),e}()),e}function $e(){var e;return">="===t.substr(Pe,2)?(e=">=",Pe+=2):(e=a,0===Be&&Je(d)),e===a&&(62===t.charCodeAt(Pe)?(e=">",Pe++):(e=a,0===Be&&Je(f)),e===a&&("<="===t.substr(Pe,2)?(e="<=",Pe+=2):(e=a,0===Be&&Je(p)),e===a&&("<>"===t.substr(Pe,2)?(e="<>",Pe+=2):(e=a,0===Be&&Je(h)),e===a&&(60===t.charCodeAt(Pe)?(e="<",Pe++):(e=a,0===Be&&Je(y)),e===a&&(61===t.charCodeAt(Pe)?(e="=",Pe++):(e=a,0===Be&&Je(c)),e===a&&("!="===t.substr(Pe,2)?(e="!=",Pe+=2):(e=a,0===Be&&Je(v)))))))),e}function Ze(){var e,t,r,n,i;return e=Pe,t=Pe,(r=Rt())!==a&&(n=dr())!==a&&(i=Dt())!==a?t=r=[r,n,i]:(Pe=t,t=a),t!==a&&(t=b(t)),(e=t)===a&&(e=Dt()),e}function Xe(){var e,t,r,n,i;return e=Pe,t=Pe,(r=Rt())!==a&&(n=dr())!==a&&(i=Et())!==a?t=r=[r,n,i]:(Pe=t,t=a),t!==a&&(t=b(t)),(e=t)===a&&(e=Et()),e}function et(){var e,t,r,n,i,s,u,o;if(e=Pe,(t=rt())!==a){for(r=[],n=Pe,(i=dr())!==a&&(s=tt())!==a&&(u=dr())!==a&&(o=rt())!==a?n=i=[i,s,u,o]:(Pe=n,n=a);n!==a;)r.push(n),n=Pe,(i=dr())!==a&&(s=tt())!==a&&(u=dr())!==a&&(o=rt())!==a?n=i=[i,s,u,o]:(Pe=n,n=a);r!==a?e=t=l(t,r):(Pe=e,e=a)}else Pe=e,e=a;return e}function tt(){var e;return 43===t.charCodeAt(Pe)?(e="+",Pe++):(e=a,0===Be&&Je(m)),e===a&&(45===t.charCodeAt(Pe)?(e="-",Pe++):(e=a,0===Be&&Je(g))),e}function rt(){var e,t,r,n,i,s,u,l;if(e=Pe,(t=at())!==a){for(r=[],n=Pe,(i=dr())!==a&&(s=nt())!==a&&(u=dr())!==a&&(l=at())!==a?n=i=[i,s,u,l]:(Pe=n,n=a);n!==a;)r.push(n),n=Pe,(i=dr())!==a&&(s=nt())!==a&&(u=dr())!==a&&(l=at())!==a?n=i=[i,s,u,l]:(Pe=n,n=a);r!==a?e=t=function(e,t){return yr(e,t)}(t,r):(Pe=e,e=a)}else Pe=e,e=a;return e}function nt(){var e;return 42===t.charCodeAt(Pe)?(e="*",Pe++):(e=a,0===Be&&Je(_)),e===a&&(47===t.charCodeAt(Pe)?(e="/",Pe++):(e=a,0===Be&&Je(O))),e}function at(){var e,t;return(e=function(){var e;return(e=bt())===a&&(e=function(){var e,t,r,n;return e=Pe,(t=function(){var e,t,r,n;return e=Pe,(t=Ot())!==a&&(r=jt())!==a&&(n=wt())!==a?e=t=function(e,t,r){return parseFloat(e+t+r)}(t,r,n):(Pe=e,e=a),e===a&&(e=Pe,(t=Ot())!==a&&(r=jt())!==a?e=t=function(e,t){return parseFloat(e+t)}(t,r):(Pe=e,e=a),e===a&&(e=Pe,(t=Ot())!==a&&(r=wt())!==a?e=t=function(e,t){return parseFloat(e+t)}(t,r):(Pe=e,e=a),e===a&&(e=Pe,(t=Ot())!==a&&(t=function(e){return parseFloat(e)}(t)),e=t))),e}())!==a?(r=Pe,Be++,n=st(),Be--,n===a?r=void 0:(Pe=r,r=a),r!==a?e=t=function(e){return{type:"number",value:e}}(t):(Pe=e,e=a)):(Pe=e,e=a),e}())===a&&(e=function(){var e,t;return e=Pe,(t=xt())!==a&&(t={type:"bool",value:!0}),(e=t)===a&&(e=Pe,(t=Tt())!==a&&(t={type:"bool",value:!1}),e=t),e}())===a&&(e=function(){var e;return(e=kt())!==a&&(e={type:"null",value:null}),e}())===a&&(e=function(){var e,t;return e=Pe,Jt()!==a&&dr()!==a&&(t=vt())!==a?e=function(e){return{type:"date",value:e.value}}(t):(Pe=e,e=a),e}())===a&&(e=function(){var e,t;return e=Pe,Wt()!==a&&dr()!==a&&(t=vt())!==a?e=function(e){return{type:"timestamp",value:e.value}}(t):(Pe=e,e=a),e}())===a&&(e=dt()),e}())===a&&(e=function(){var e,t,r;return e=Pe,qt()!==a&&dr()!==a&&or()!==a&&dr()!==a&&(t=function(){var e;return(e=$t())===a&&(e=Zt())===a&&(e=Xt())===a&&(e=er())===a&&(e=tr())===a&&(e=rr()),e}())!==a&&dr()!==a&&Mt()!==a&&dr()!==a&&(r=He())!==a&&dr()!==a&&cr()!==a?e=function(e,t){return{type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:e},t]}}}(t,r):(Pe=e,e=a),e}())===a&&(e=function(){var e,t,r,n,i,s,u,l;return e=Pe,Bt()!==a&&dr()!==a&&or()!==a&&dr()!==a&&(t=He())!==a&&dr()!==a&&Mt()!==a&&dr()!==a&&(r=He())!==a&&dr()!==a?(n=Pe,(i=Gt())!==a&&(s=dr())!==a&&(u=He())!==a&&(l=dr())!==a?n=i=[i,s,u,l]:(Pe=n,n=a),n===a&&(n=null),n!==a&&(i=cr())!==a?e=function(e,t,r){return{type:"function",name:"substring",args:{type:"expr_list",value:r?[e,t,r[2]]:[e,t]}}}(t,r,n):(Pe=e,e=a)):(Pe=e,e=a),e}())===a&&(e=function(){var e,t,r,n;return e=Pe,Ut()!==a&&dr()!==a&&or()!==a&&dr()!==a?((t=ct())===a&&(t=null),t!==a&&dr()!==a&&(r=He())!==a&&dr()!==a&&Mt()!==a&&dr()!==a&&(n=He())!==a&&dr()!==a&&cr()!==a?e=function(e,t,r){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t,r]}}}(t,r,n):(Pe=e,e=a)):(Pe=e,e=a),e===a&&(e=Pe,Ut()!==a&&dr()!==a&&or()!==a&&dr()!==a?((t=ct())===a&&(t=null),t!==a&&dr()!==a&&(r=He())!==a&&dr()!==a&&cr()!==a?e=function(e,t){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t]}}}(t,r):(Pe=e,e=a)):(Pe=e,e=a)),e}())===a&&(e=function(){var e,t,r;return e=Pe,Vt()!==a&&dr()!==a&&or()!==a&&dr()!==a&&(t=He())!==a&&dr()!==a&&Et()!==a&&dr()!==a&&(r=He())!==a&&dr()!==a&&cr()!==a?e=function(e,t){return{type:"function",name:"position",args:{type:"expr_list",value:[e,t]}}}(t,r):(Pe=e,e=a),e}())===a&&(e=function(){var e,t,r;return e=Pe,(t=pr())!==a&&dr()!==a&&or()!==a&&dr()!==a?((r=Qe())===a&&(r=null),r!==a&&dr()!==a&&cr()!==a?e=t=function(e,t){return{type:"function",name:e,args:t||{type:"expr_list",value:[]}}}(t,r):(Pe=e,e=a)):(Pe=e,e=a),e}())===a&&(e=function(){var e;return(e=function(){var e,t,r,n,i;if(e=Pe,nr()!==a)if(dr()!==a)if((t=He())!==a)if(dr()!==a){for(r=[],n=gt();n!==a;)r.push(n),n=gt();r!==a&&(n=dr())!==a&&(i=ar())!==a?e=function(e,t){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:null}}(t,r):(Pe=e,e=a)}else Pe=e,e=a;else Pe=e,e=a;else Pe=e,e=a;else Pe=e,e=a;if(e===a)if(e=Pe,nr()!==a)if(dr()!==a)if((t=He())!==a)if(dr()!==a){for(r=[],n=gt();n!==a;)r.push(n),n=gt();r!==a&&(n=dr())!==a&&(i=_t())!==a&&dr()!==a&&ar()!==a?e=function(e,t,r){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:r.value}}(t,r,i):(Pe=e,e=a)}else Pe=e,e=a;else Pe=e,e=a;else Pe=e,e=a;else Pe=e,e=a;return e}())===a&&(e=function(){var e,t,r,n;if(e=Pe,nr()!==a)if(dr()!==a){for(t=[],r=mt();r!==a;)t.push(r),r=mt();t!==a&&(r=dr())!==a&&(n=ar())!==a?e=function(e){return{type:"case_expression",format:"searched",clauses:e,else:null}}(t):(Pe=e,e=a)}else Pe=e,e=a;else Pe=e,e=a;if(e===a)if(e=Pe,nr()!==a)if(dr()!==a){for(t=[],r=mt();r!==a;)t.push(r),r=mt();t!==a&&(r=dr())!==a&&(n=_t())!==a&&dr()!==a&&ar()!==a?e=function(e,t){return{type:"case_expression",format:"searched",clauses:e,else:t.value}}(t,n):(Pe=e,e=a)}else Pe=e,e=a;else Pe=e,e=a;return e}()),e}())===a&&(e=function(){var e;return(e=function(){var e;return(e=function(){var e,t,r,n;if(e=Pe,(t=st())!==a){for(r=[],n=lt();n!==a;)r.push(n),n=lt();r!==a?e=t=j(t,r):(Pe=e,e=a)}else Pe=e,e=a;return e}())!==a&&(e=e),e}())!==a&&(e=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:e}}(e)),e}())===a&&(e=ot())===a&&(e=Pe,or()!==a&&dr()!==a&&(t=He())!==a&&dr()!==a&&cr()!==a?e=function(e){return e.paren=!0,e}(t):(Pe=e,e=a)),e}function it(){var e,t,r,n;if(e=Pe,(t=st())!==a){for(r=[],n=ut();n!==a;)r.push(n),n=ut();r!==a?e=t=j(t,r):(Pe=e,e=a)}else Pe=e,e=a;return e}function st(){var e;return w.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===Be&&Je(S)),e}function ut(){var e;return F.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===Be&&Je(I)),e}function lt(){var e;return k.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===Be&&Je(x)),e}function ot(){var e,r,n;return e=Pe,64===t.charCodeAt(Pe)?(r="@",Pe++):(r=a,0===Be&&Je(T)),r!==a&&(n=it())!==a?e=r=[r,n]:(Pe=e,e=a),e!==a&&(e=function(e){return{type:"param",value:e[1]}}(e)),e}function ct(){var e;return(e=zt())===a&&(e=Qt())===a&&(e=Ht()),e}function dt(){var e,r,n,i;return e=Pe,Kt()!==a&&dr()!==a?(45===t.charCodeAt(Pe)?(r="-",Pe++):(r=a,0===Be&&Je(g)),r===a&&(43===t.charCodeAt(Pe)?(r="+",Pe++):(r=a,0===Be&&Je(m))),r!==a&&dr()!==a&&(n=vt())!==a&&dr()!==a&&(i=ft())!==a?e=function(e,t,r){return{type:"interval",value:t,qualifier:r,op:e}}(r,n,i):(Pe=e,e=a)):(Pe=e,e=a),e===a&&(e=Pe,Kt()!==a&&dr()!==a&&(r=vt())!==a&&dr()!==a&&(n=ft())!==a?e=function(e,t){return{type:"interval",value:e,qualifier:t,op:""}}(r,n):(Pe=e,e=a)),e}function ft(){var e,t,r;return e=Pe,(t=function(){var e,t,r;return e=Pe,(t=pt())!==a&&dr()!==a&&or()!==a&&dr()!==a&&(r=yt())!==a&&dr()!==a&&cr()!==a?e=t=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}}(t,r):(Pe=e,e=a),e===a&&(e=Pe,(t=pt())!==a&&(t=E(t)),e=t),e}())!==a&&dr()!==a&&Yt()!==a&&dr()!==a&&(r=function(){var e,t,r,n;return e=Pe,(t=pt())!==a&&(t=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}}(t)),(e=t)===a&&(e=Pe,(t=rr())!==a&&dr()!==a&&or()!==a&&dr()!==a&&(r=yt())!==a&&dr()!==a&&lr()!==a&&dr()!==a&&(n=ht())!==a&&dr()!==a&&cr()!==a?e=t=C(r,n):(Pe=e,e=a),e===a&&(e=Pe,(t=rr())!==a&&dr()!==a&&or()!==a&&dr()!==a&&(r=yt())!==a&&dr()!==a&&cr()!==a?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(r):(Pe=e,e=a),e===a&&(e=Pe,(t=rr())!==a&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t))),e}())!==a?e=t=function(e,t){return{type:"interval-qualifier",start:e,end:t}}(t,r):(Pe=e,e=a),e===a&&(e=function(){var e,t,r,n;return e=Pe,(t=pt())!==a&&dr()!==a&&or()!==a&&dr()!==a&&(r=ht())!==a&&dr()!==a&&cr()!==a?e=t=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}}(t,r):(Pe=e,e=a),e===a&&(e=Pe,(t=pt())!==a&&(t=E(t)),(e=t)===a&&(e=Pe,(t=rr())!==a&&dr()!==a&&or()!==a&&dr()!==a&&(r=yt())!==a&&dr()!==a&&lr()!==a&&dr()!==a&&(n=ht())!==a&&dr()!==a&&cr()!==a?e=t=C(r,n):(Pe=e,e=a),e===a&&(e=Pe,(t=rr())!==a&&dr()!==a&&or()!==a&&dr()!==a&&(r=ht())!==a&&dr()!==a&&cr()!==a?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(r):(Pe=e,e=a),e===a&&(e=Pe,(t=rr())!==a&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t)))),e}()),e}function pt(){var e,t;return e=Pe,(t=Xt())!==a&&(t={type:"string",value:"day"}),(e=t)===a&&(e=Pe,(t=er())!==a&&(t={type:"string",value:"hour"}),(e=t)===a&&(e=Pe,(t=tr())!==a&&(t={type:"string",value:"minute"}),(e=t)===a&&(e=Pe,(t=Zt())!==a&&(t={type:"string",value:"month"}),(e=t)===a&&(e=Pe,(t=$t())!==a&&(t={type:"string",value:"year"}),e=t)))),e}function ht(){var e;return(e=St())!==a&&(e=D(e)),e}function yt(){var e;return(e=St())!==a&&(e=D(e)),e}function vt(){var e;return(e=bt())===a&&(e=ot()),e}function bt(){var e,r,n,i,s;if(e=Pe,39===t.charCodeAt(Pe)?(r="'",Pe++):(r=a,0===Be&&Je(N)),r===a&&("N'"===t.substr(Pe,2)?(r="N'",Pe+=2):(r=a,0===Be&&Je(R))),r!==a){for(n=[],i=Pe,t.substr(Pe,2)===A?(s=A,Pe+=2):(s=a,0===Be&&Je(P)),s!==a&&(s="'"),(i=s)===a&&(L.test(t.charAt(Pe))?(i=t.charAt(Pe),Pe++):(i=a,0===Be&&Je(M)));i!==a;)n.push(i),i=Pe,t.substr(Pe,2)===A?(s=A,Pe+=2):(s=a,0===Be&&Je(P)),s!==a&&(s="'"),(i=s)===a&&(L.test(t.charAt(Pe))?(i=t.charAt(Pe),Pe++):(i=a,0===Be&&Je(M)));n!==a?(39===t.charCodeAt(Pe)?(i="'",Pe++):(i=a,0===Be&&Je(N)),i!==a?e=r=function(e){return{type:"string",value:e.join("")}}(n):(Pe=e,e=a)):(Pe=e,e=a)}else Pe=e,e=a;return e}function mt(){var e,t,r;return e=Pe,ir()!==a&&dr()!==a&&(t=He())!==a&&dr()!==a&&sr()!==a&&dr()!==a&&(r=He())!==a?e=G(t,r):(Pe=e,e=a),e}function gt(){var e,t,r;return e=Pe,ir()!==a&&dr()!==a&&(t=He())!==a&&dr()!==a&&sr()!==a&&dr()!==a&&(r=He())!==a?e=G(t,r):(Pe=e,e=a),e}function _t(){var e,t;return e=Pe,ur()!==a&&dr()!==a&&(t=He())!==a?e=function(e){return{type:"else_clause",value:e}}(t):(Pe=e,e=a),e}function Ot(){var e,r,n;return(e=St())===a&&(e=Pe,45===t.charCodeAt(Pe)?(r="-",Pe++):(r=a,0===Be&&Je(g)),r===a&&(43===t.charCodeAt(Pe)?(r="+",Pe++):(r=a,0===Be&&Je(m))),r!==a&&(n=St())!==a?e=r=function(e,t){return e[0]+t}(r,n):(Pe=e,e=a)),e}function jt(){var e,r,n;return e=Pe,46===t.charCodeAt(Pe)?(r=".",Pe++):(r=a,0===Be&&Je(B)),r!==a?((n=St())===a&&(n=null),n!==a?e=r=function(e){return"."+(null!=e?e:"")}(n):(Pe=e,e=a)):(Pe=e,e=a),e}function wt(){var e,t,r;return e=Pe,(t=It())!==a&&(r=St())!==a?e=t=function(e,t){return e+t}(t,r):(Pe=e,e=a),e}function St(){var e,t;if(e=[],(t=Ft())!==a)for(;t!==a;)e.push(t),t=Ft();else e=a;return e!==a&&(e=function(e){return e.join("")}(e)),e}function Ft(){var e;return q.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===Be&&Je(U)),e}function It(){var e,r,n;return e=Pe,V.test(t.charAt(Pe))?(r=t.charAt(Pe),Pe++):(r=a,0===Be&&Je(W)),r!==a?(J.test(t.charAt(Pe))?(n=t.charAt(Pe),Pe++):(n=a,0===Be&&Je(z)),n===a&&(n=null),n!==a?e=r=function(e,t){return"e"+(null===t?"":t)}(0,n):(Pe=e,e=a)):(Pe=e,e=a),e}function kt(){var e,r,n,i;return e=Pe,"null"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===Be&&Je(Q)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r=[r,n]:(Pe=e,e=a)):(Pe=e,e=a),e}function xt(){var e,r,n,i;return e=Pe,"true"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===Be&&Je(H)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r=[r,n]:(Pe=e,e=a)):(Pe=e,e=a),e}function Tt(){var e,r,n,i;return e=Pe,"false"===t.substr(Pe,5).toLowerCase()?(r=t.substr(Pe,5),Pe+=5):(r=a,0===Be&&Je(Y)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r=[r,n]:(Pe=e,e=a)):(Pe=e,e=a),e}function Et(){var e,r,n,i;return e=Pe,"in"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=a,0===Be&&Je(K)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="IN":(Pe=e,e=a)):(Pe=e,e=a),e}function Ct(){var e,r,n,i;return e=Pe,"is"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=a,0===Be&&Je($)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="IS":(Pe=e,e=a)):(Pe=e,e=a),e}function Dt(){var e,r,n,i;return e=Pe,"like"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===Be&&Je(Z)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="LIKE":(Pe=e,e=a)):(Pe=e,e=a),e}function Nt(){var e,r,n,i;return e=Pe,"escape"===t.substr(Pe,6).toLowerCase()?(r=t.substr(Pe,6),Pe+=6):(r=a,0===Be&&Je(X)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="ESCAPE":(Pe=e,e=a)):(Pe=e,e=a),e}function Rt(){var e,r,n,i;return e=Pe,"not"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=a,0===Be&&Je(ee)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="NOT":(Pe=e,e=a)):(Pe=e,e=a),e}function At(){var e,r,n,i;return e=Pe,"and"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=a,0===Be&&Je(te)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="AND":(Pe=e,e=a)):(Pe=e,e=a),e}function Pt(){var e,r,n,i;return e=Pe,"or"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=a,0===Be&&Je(re)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="OR":(Pe=e,e=a)):(Pe=e,e=a),e}function Lt(){var e,r,n,i;return e=Pe,"between"===t.substr(Pe,7).toLowerCase()?(r=t.substr(Pe,7),Pe+=7):(r=a,0===Be&&Je(ne)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="BETWEEN":(Pe=e,e=a)):(Pe=e,e=a),e}function Mt(){var e,r,n,i;return e=Pe,"from"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===Be&&Je(ae)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="FROM":(Pe=e,e=a)):(Pe=e,e=a),e}function Gt(){var e,r,n,i;return e=Pe,"for"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=a,0===Be&&Je(ie)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="FOR":(Pe=e,e=a)):(Pe=e,e=a),e}function Bt(){var e,r,n,i;return e=Pe,"substring"===t.substr(Pe,9).toLowerCase()?(r=t.substr(Pe,9),Pe+=9):(r=a,0===Be&&Je(se)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="SUBSTRING":(Pe=e,e=a)):(Pe=e,e=a),e}function qt(){var e,r,n,i;return e=Pe,"extract"===t.substr(Pe,7).toLowerCase()?(r=t.substr(Pe,7),Pe+=7):(r=a,0===Be&&Je(ue)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="EXTRACT":(Pe=e,e=a)):(Pe=e,e=a),e}function Ut(){var e,r,n,i;return e=Pe,"trim"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===Be&&Je(le)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="TRIM":(Pe=e,e=a)):(Pe=e,e=a),e}function Vt(){var e,r,n,i;return e=Pe,"position"===t.substr(Pe,8).toLowerCase()?(r=t.substr(Pe,8),Pe+=8):(r=a,0===Be&&Je(oe)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="POSITION":(Pe=e,e=a)):(Pe=e,e=a),e}function Wt(){var e,r,n,i;return e=Pe,"timestamp"===t.substr(Pe,9).toLowerCase()?(r=t.substr(Pe,9),Pe+=9):(r=a,0===Be&&Je(ce)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="TIMESTAMP":(Pe=e,e=a)):(Pe=e,e=a),e}function Jt(){var e,r,n,i;return e=Pe,"date"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===Be&&Je(de)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="DATE":(Pe=e,e=a)):(Pe=e,e=a),e}function zt(){var e,r,n,i;return e=Pe,"leading"===t.substr(Pe,7).toLowerCase()?(r=t.substr(Pe,7),Pe+=7):(r=a,0===Be&&Je(fe)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="LEADING":(Pe=e,e=a)):(Pe=e,e=a),e}function Qt(){var e,r,n,i;return e=Pe,"trailing"===t.substr(Pe,8).toLowerCase()?(r=t.substr(Pe,8),Pe+=8):(r=a,0===Be&&Je(pe)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="TRAILING":(Pe=e,e=a)):(Pe=e,e=a),e}function Ht(){var e,r,n,i;return e=Pe,"both"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===Be&&Je(he)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="BOTH":(Pe=e,e=a)):(Pe=e,e=a),e}function Yt(){var e,r,n,i;return e=Pe,"to"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=a,0===Be&&Je(ye)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="TO":(Pe=e,e=a)):(Pe=e,e=a),e}function Kt(){var e,r,n,i;return e=Pe,"interval"===t.substr(Pe,8).toLowerCase()?(r=t.substr(Pe,8),Pe+=8):(r=a,0===Be&&Je(ve)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="INTERVAL":(Pe=e,e=a)):(Pe=e,e=a),e}function $t(){var e,r,n,i;return e=Pe,"year"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===Be&&Je(be)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="YEAR":(Pe=e,e=a)):(Pe=e,e=a),e}function Zt(){var e,r,n,i;return e=Pe,"month"===t.substr(Pe,5).toLowerCase()?(r=t.substr(Pe,5),Pe+=5):(r=a,0===Be&&Je(me)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="MONTH":(Pe=e,e=a)):(Pe=e,e=a),e}function Xt(){var e,r,n,i;return e=Pe,"day"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=a,0===Be&&Je(ge)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="DAY":(Pe=e,e=a)):(Pe=e,e=a),e}function er(){var e,r,n,i;return e=Pe,"hour"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===Be&&Je(_e)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="HOUR":(Pe=e,e=a)):(Pe=e,e=a),e}function tr(){var e,r,n,i;return e=Pe,"minute"===t.substr(Pe,6).toLowerCase()?(r=t.substr(Pe,6),Pe+=6):(r=a,0===Be&&Je(Oe)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="MINUTE":(Pe=e,e=a)):(Pe=e,e=a),e}function rr(){var e,r,n,i;return e=Pe,"second"===t.substr(Pe,6).toLowerCase()?(r=t.substr(Pe,6),Pe+=6):(r=a,0===Be&&Je(je)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="SECOND":(Pe=e,e=a)):(Pe=e,e=a),e}function nr(){var e,r,n,i;return e=Pe,"case"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===Be&&Je(we)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="CASE":(Pe=e,e=a)):(Pe=e,e=a),e}function ar(){var e,r,n,i;return e=Pe,"end"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=a,0===Be&&Je(Se)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="END":(Pe=e,e=a)):(Pe=e,e=a),e}function ir(){var e,r,n,i;return e=Pe,"when"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===Be&&Je(Fe)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="WHEN":(Pe=e,e=a)):(Pe=e,e=a),e}function sr(){var e,r,n,i;return e=Pe,"then"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===Be&&Je(Ie)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="THEN":(Pe=e,e=a)):(Pe=e,e=a),e}function ur(){var e,r,n,i;return e=Pe,"else"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=a,0===Be&&Je(ke)),r!==a?(n=Pe,Be++,i=ut(),Be--,i===a?n=void 0:(Pe=n,n=a),n!==a?e=r="ELSE":(Pe=e,e=a)):(Pe=e,e=a),e}function lr(){var e;return 44===t.charCodeAt(Pe)?(e=",",Pe++):(e=a,0===Be&&Je(xe)),e}function or(){var e;return 40===t.charCodeAt(Pe)?(e="(",Pe++):(e=a,0===Be&&Je(Te)),e}function cr(){var e;return 41===t.charCodeAt(Pe)?(e=")",Pe++):(e=a,0===Be&&Je(Ee)),e}function dr(){var e,t;for(e=[],t=fr();t!==a;)e.push(t),t=fr();return e}function fr(){var e;return Ce.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===Be&&Je(De)),e}function pr(){var e,r,n,i;if(e=Pe,(r=it())!==a&&(r=r),(e=r)===a)if(e=Pe,96===t.charCodeAt(Pe)?(r="`",Pe++):(r=a,0===Be&&Je(Ne)),r!==a){if(n=[],Re.test(t.charAt(Pe))?(i=t.charAt(Pe),Pe++):(i=a,0===Be&&Je(Ae)),i!==a)for(;i!==a;)n.push(i),Re.test(t.charAt(Pe))?(i=t.charAt(Pe),Pe++):(i=a,0===Be&&Je(Ae));else n=a;n!==a?(96===t.charCodeAt(Pe)?(i="`",Pe++):(i=a,0===Be&&Je(Ne)),i!==a?e=r=function(e){return e.join("")}(n):(Pe=e,e=a)):(Pe=e,e=a)}else Pe=e,e=a;return e}function hr(e,t,r,n){var a={type:"binary_expr",operator:e,left:t,right:r};return void 0!==n&&(a.escape=n),a}function yr(e,t){for(var r=e,n=0;n<t.length;n++)r=hr(t[n][1],r,t[n][3]);return r}if((n=s())!==a&&Pe===t.length)return n;throw n!==a&&Pe<t.length&&Je({type:"end"}),function(t,r,n){return new e(e.buildMessage(t,r),t,r,n)}(Ge,Me<t.length?t.charAt(Me):null,Me<t.length?We(Me,Me+1):We(Me,Me))}}}())})),m=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,null,[{key:"parse",value:function(e){return b.parse(e)}}]),e}(),g=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,_=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,O=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,j=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,w=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function S(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}function F(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"0",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"0",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"0",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"0",l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"0";if("+"===s||"-"===s){var o="".concat(S(parseInt(e,10),4),"-").concat(S(parseInt(t,10),2),"-").concat(S(parseInt(r,10),2)),c="";parseFloat(i)<10&&(c="0");var d="".concat(S(parseInt(n,10),2),":").concat(S(parseInt(a,10),2),":").concat(c+parseFloat(i).toString()),f="".concat(s).concat(S(parseInt(u,10),2),":").concat(S(parseInt(l,10),2));return new Date(o+"T"+d+f)}return new Date(parseInt(e,10),parseInt(t,10)-1,parseInt(r,10),parseInt(n,10),parseInt(a,10),parseFloat(i))}var I=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,null,[{key:"makeBool",value:function(e){return E(e)}},{key:"featureValue",value:function(e,t,r,n){return q(e,t,r,n)}},{key:"equalsNull",value:function(e){return null===e}},{key:"applyLike",value:function(e,t,r){return P(e,t,r)}},{key:"ensureArray",value:function(e){return C(e)}},{key:"applyIn",value:function(e,t){return A(e,t)}},{key:"currentDate",value:function(){var e=new Date;return e.setHours(0,0,0,0),e}},{key:"makeSqlInterval",value:function(e,t,r){return p.createFromValueAndQualifer(e,t,r)}},{key:"convertInterval",value:function(e){return e instanceof p?e.valueInMilliseconds():e}},{key:"currentTimestamp",value:function(){return new Date}},{key:"compare",value:function(e,t,r){return M(e,t,r)}},{key:"calculate",value:function(e,t,r){return B(e,t,r)}},{key:"makeComparable",value:function(e){return L(e)}},{key:"evaluateFunction",value:function(e,t){return h(e,t)}},{key:"lookup",value:function(e,t){var r=t[e];return void 0===r?null:r}},{key:"between",value:function(e,t){return null==e||null==t[0]||null==t[1]?null:e>=t[0]&&e<=t[1]}},{key:"notbetween",value:function(e,t){return null==e||null==t[0]||null==t[1]?null:e<t[0]||e>t[1]}},{key:"ternaryNot",value:function(e){return D(e)}},{key:"ternaryAnd",value:function(e,t){return N(e,t)}},{key:"ternaryOr",value:function(e,t){return R(e,t)}}]),e}(),k=function(){function e(t,r){Object(s.a)(this,e),this.fieldsIndex=r,this.datefields={},this.parameters={},this.parseTree=m.parse(t);var n=this.extractExpressionInfo(r),a=n.isStandardized,i=n.isAggregate,u=n.referencedFieldNames;this.referencedFieldNames=u,this.isStandardized=a,this.isAggregate=i}return Object(u.a)(e,[{key:"fieldNames",get:function(){return this.referencedFieldNames}},{key:"testSet",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U,n={},a=Object(i.a)(this.fieldNames);try{var s=function(){var a=t.value;n[a]=e.map((function(e){return r.getAttribute(e,a)}))};for(a.s();!(t=a.n()).done;)s()}catch(u){a.e(u)}finally{a.f()}return!!this.evaluateNode(this.parseTree,{attributes:n},U)}},{key:"calculateValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U,r=this.evaluateNode(this.parseTree,e,t);return r instanceof p?r.valueInMilliseconds()/864e5:r}},{key:"calculateValueCompiled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;return null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):Object(l.a)("csp-restrictions")?this.calculateValue(e,t):(this.compileMe(),this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}},{key:"testFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;return!!this.evaluateNode(this.parseTree,e,t)}},{key:"testFeatureCompiled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;return null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):Object(l.a)("csp-restrictions")?this.testFeature(e,t):(this.compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}},{key:"getFunctions",value:function(){var e=[];return this.visitAll(this.parseTree,(function(t){"function"===t.type&&e.push(t.name.toLowerCase())})),G(e)}},{key:"getExpressions",value:function(){var e=new Map;return this.visitAll(this.parseTree,(function(t){if("function"===t.type){var r=t.name.toLowerCase(),n=t.args.value[0];if("column_ref"===n.type){var a=n.column,i="".concat(r,"-").concat(a);e.has(i)||e.set(i,{aggregateType:r,field:a})}}})),Object(a.a)(e.values())}},{key:"getVariables",value:function(){var e=[];return this.visitAll(this.parseTree,(function(t){"param"===t.type&&e.push(t.value.toLowerCase())})),G(e)}},{key:"compileMe",value:function(){var e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",e).bind(I)}},{key:"extractExpressionInfo",value:function(e){var t=this,r=[],n=!0,a=!0;return this.visitAll(this.parseTree,(function(i){switch(i.type){case"column_ref":var s=e.get(i.column),u=s&&s.name;!s||"date"!==s.type&&"esriFieldTypeDate"!==s.type||(t.datefields[s.name]=1),void 0!==u?(r.push(u),i.column=u):r.push(i.column);break;case"function":var l=i.name,c=i.args.value.length;n&&(n=function(e,t){var r=y[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(l,c)),a&&(a=function(e,t){var r=o[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(l,c))}})),{referencedFieldNames:G(r),isStandardized:n,isAggregate:a}}},{key:"visitAll",value:function(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":var r,n=Object(i.a)(e.clauses);try{for(n.s();!(r=n.n()).done;){var a=r.value;this.visitAll(a,t)}}catch(o){n.e(o)}finally{n.f()}"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":var s,u=Object(i.a)(e.value);try{for(u.s();!(s=u.n()).done;){var l=s.value;this.visitAll(l,t)}}catch(o){u.e(o)}finally{u.f()}break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}}},{key:"evaluateNodeToJavaScript",value:function(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case_expression":var t="";if("simple"===e.format){var r="this.makeComparable("+this.evaluateNodeToJavaScript(e.operand)+")";t="( ";for(var n=0;n<e.clauses.length;n++)t+=" ("+r+" === this.makeComparable("+this.evaluateNodeToJavaScript(e.clauses[n].operand)+")) ? ("+this.evaluateNodeToJavaScript(e.clauses[n].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{t="( ";for(var a=0;a<e.clauses.length;a++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[a].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[a].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t;case"param":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expr_list":var s,u="[",l=Object(i.a)(e.value);try{for(l.s();!(s=l.n()).done;){var o=s.value;"["!==u&&(u+=","),u+=this.evaluateNodeToJavaScript(o)}}catch(c){l.e(c)}finally{l.f()}return u+="]";case"unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary_expr":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"*":case"-":case"+":case"/":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")"}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return JSON.stringify(e.value);case"date":return"(new Date("+T(e.value).getTime().toString()+"))";case"timestamp":return"(new Date("+x(e.value).getTime().toString()+"))";case"current_time":return"date"===e.mode?"this.currentDate()":"this.currentTimestamp()";case"column_ref":return"this.featureValue(feature,"+JSON.stringify(e.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+")"}throw new Error("Unsupported sql syntax "+e.type)}},{key:"evaluateNode",value:function(e,t,r){switch(e.type){case"interval":var n=this.evaluateNode(e.value,t,r);return p.createFromValueAndQualifer(n,e.qualifier,e.op);case"case_expression":if("simple"===e.format){for(var a=L(this.evaluateNode(e.operand,t,r)),s=0;s<e.clauses.length;s++)if(a===L(this.evaluateNode(e.clauses[s].operand,t,r)))return this.evaluateNode(e.clauses[s].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}else{for(var u=0;u<e.clauses.length;u++)if(E(this.evaluateNode(e.clauses[u].operand,t,r)))return this.evaluateNode(e.clauses[u].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":var l,c=[],d=Object(i.a)(e.value);try{for(d.s();!(l=d.n()).done;){var f=l.value;c.push(this.evaluateNode(f,t,r))}}catch(w){d.e(w)}finally{d.f()}return c;case"unary_expr":return D(this.evaluateNode(e.expr,t,r));case"binary_expr":switch(e.operator){case"AND":return N(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"OR":return R(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t,r);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t,r);case"IN":var y=C(this.evaluateNode(e.right,t,r));return A(this.evaluateNode(e.left,t,r),y);case"NOT IN":var v=C(this.evaluateNode(e.right,t,r));return D(A(this.evaluateNode(e.left,t,r),v));case"BETWEEN":var b=this.evaluateNode(e.left,t,r),m=this.evaluateNode(e.right,t,r);return null==b||null==m[0]||null==m[1]?null:b>=L(m[0])&&b<=L(m[1]);case"NOTBETWEEN":var g=this.evaluateNode(e.left,t,r),_=this.evaluateNode(e.right,t,r);return null==g||null==_[0]||null==_[1]?null:g<L(_[0])||g>L(_[1]);case"LIKE":return P(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape);case"NOT LIKE":return D(P(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return M(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"-":case"+":case"*":case"/":return B(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r))}case"null":case"bool":case"string":case"number":return e.value;case"date":return T(e.value);case"timestamp":return x(e.value);case"current_time":var O=new Date;return"date"===e.mode&&O.setHours(0,0,0,0),O;case"column_ref":return q(t,e.column,this.datefields,r);case"function":var j=this.evaluateNode(e.args,t,r);return this.isAggregate?function(e,t){var r=o[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to ".concat(e.toUpperCase()));return r.evaluate(t)}(e.name,j):h(e.name,j)}throw new Error("Unsupported sql syntax "+e.type)}}],[{key:"create",value:function(t,r){return new e(t,r)}}]),e}();function x(e){var t=_.exec(e);if(null!==t){var r=t,a=Object(n.a)(r,7);return F(a[1],a[2],a[3],a[4],a[5],a[6])}if(null!==(t=O.exec(e))){var i=t,s=Object(n.a)(i,10);return F(s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],s[9])}if(null!==(t=j.exec(e))){var u=t,l=Object(n.a)(u,9);return F(l[1],l[2],l[3],l[4],l[5],"0",l[6],l[7],l[8])}if(null!==(t=w.exec(e))){var o=t,c=Object(n.a)(o,6);return F(c[1],c[2],c[3],c[4],c[5])}if(null!==(t=g.exec(e))){var d=t,f=Object(n.a)(d,4);return F(f[1],f[2],f[3])}throw new Error("SQL Invalid Timestamp")}function T(e){var t=g.exec(e);if(null===t)throw new Error("SQL Invalid Date");var r=Object(n.a)(t,4),a=r[1],i=r[2],s=r[3];return new Date(parseInt(a,10),parseInt(i,10)-1,parseInt(s,10))}function E(e){return!0===e}function C(e){return Array.isArray(e)?e:[e]}function D(e){return null!==e?!0!==e:null}function N(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function R(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function A(e,t){if(null==e)return null;var r,n=!1,a=Object(i.a)(t);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(null==s)n=null;else if(e===s){n=!0;break}}}catch(u){a.e(u)}finally{a.f()}return n}function P(e,t,r){if(null==e)return null;for(var n=t,a=r,i="",s="-[]/{}()*+?.\\^$|",u=0,l=0;l<n.length;l++){var o=n.charAt(l);switch(u){case 0:o===a?u=1:s.indexOf(o)>=0?i+="\\"+o:i+="%"===o?".*":"_"===o?".":o;break;case 1:s.indexOf(o)>=0?i+="\\"+o:i+=o,u=0}}return new RegExp("^"+i+"$").test(e)}function L(e){return e instanceof Date?e.valueOf():e}function M(e,t,r){if(null==t||null==r)return null;var n=L(t),a=L(r);switch(e){case"<>":return n!==a;case"=":return n===a;case">":return n>a;case"<":return n<a;case">=":return n>=a;case"<=":return n<=a}}function G(e){var t,r=[],n={},a=Object(i.a)(e);try{for(a.s();!(t=a.n()).done;){var s=t.value,u=s.toLowerCase();void 0===n[u]&&(r.push(s),n[u]=1)}}catch(l){a.e(l)}finally{a.f()}return r}function B(e,t,r){if(t instanceof p)if(r instanceof Date)switch(e){case"+":return new Date(t.valueInMilliseconds()+r.getTime());case"-":return t.valueInMilliseconds()-r.getTime();case"*":return t.valueInMilliseconds()*r.getTime();case"/":return t.valueInMilliseconds()/r.getTime()}else if(r instanceof p)switch(e){case"+":return p.createFromMilliseconds(t.valueInMilliseconds()+r.valueInMilliseconds());case"-":return p.createFromMilliseconds(t.valueInMilliseconds()-r.valueInMilliseconds());case"*":return t.valueInMilliseconds()*r.valueInMilliseconds();case"/":return t.valueInMilliseconds()/r.valueInMilliseconds()}else t=t.valueInMilliseconds();else if(r instanceof p)if(t instanceof Date)switch(e){case"+":return new Date(r.valueInMilliseconds()+t.getTime());case"-":return new Date(t.getTime()-r.valueInMilliseconds());case"*":return t.getTime()*r.valueInMilliseconds();case"/":return t.getTime()/r.valueInMilliseconds()}else r=r.valueInMilliseconds();else if(t instanceof Date&&"number"==typeof r)switch(r=24*r*60*60*1e3,t=t.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}else if(r instanceof Date&&"number"==typeof t)switch(t=24*t*60*60*1e3,r=r.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r}}function q(e,t,r,n){var a=n.getAttribute(e,t);return null!=a&&1===r[t]?new Date(a):a}var U={getAttribute:function(e,t){var r;return((r=e)&&"object"==typeof r.attributes?e.attributes:e)[t]}}},791:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var n=r(12),a=r(2),i=r(3);function s(e){return"date"===e.type||"esriFieldTypeDate"===e.type}function u(e){return e.toLowerCase().trim()}var l=function(){function e(t){if(Object(a.a)(this,e),this.fields=t,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this.dateFields=[],t){var r,i=[],l=Object(n.a)(t);try{for(l.s();!(r=l.n()).done;){var o=r.value,c=o&&o.name;if(c){var d=u(c);this._fieldsMap.set(c,o),this._fieldsMap.set(d,o),i.push(d),s(o)&&(this.dateFields.push(o),this._dateFieldsSet.add(o))}}}catch(f){l.e(f)}finally{l.f()}i.sort(),this.uid=i.join(",")}}return Object(i.a)(e,[{key:"destroy",value:function(){this._fieldsMap.clear()}},{key:"has",value:function(e){return null!=this.get(e)}},{key:"get",value:function(e){return null!=e?this._fieldsMap.get(e)||this._fieldsMap.get(u(e)):void 0}},{key:"isDateField",value:function(e){return this._dateFieldsSet.has(this.get(e))}},{key:"normalizeFieldName",value:function(e){var t=this.get(e);if(t)return t.name}}]),e}()},793:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return v})),r.d(t,"d",(function(){return y})),r.d(t,"e",(function(){return p}));r(13);var n=r(4),a=r(110),i=r(150),s=r(118),u=r(233),l=r(799),o=s.a.fromJSON(l.a),c=a.a.fromJSON(l.c),d=i.a.fromJSON(l.b),f=u.a.fromJSON(l.d);function p(e){if(Object(n.h)(e))return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return o;case"polyline":return c;case"polygon":case"extent":return d}return null}var h=s.a.fromJSON(l.e),y=a.a.fromJSON(l.g),v=i.a.fromJSON(l.f)},794:function(e,t,r){"use strict";var n,a=r(2),i=r(3),s=r(5),u=r(6),l=r(0),o=(r(13),r(24)),c=(r(14),r(15),r(1)),d=r(50),f=r(63),p=r(8),h=r(47),y=(r(11),r(19),r(20),r(28)),v=r(149),b=r(806),m=n=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).expression=null,e.title=null,e.value=null,e}return Object(i.a)(r,[{key:"readExpression",value:function(e,t){return t.value?Object(b.a)(t.value):e}},{key:"writeExpression",value:function(e,t,r){null!=this.value&&(e=Object(b.a)(this.value)),t[r]=e}},{key:"clone",value:function(){return new n({expression:this.expression,title:this.title,value:this.value})}}]),r}(y.a);Object(l.a)([Object(c.b)({type:String,json:{write:{allowNull:!0}}})],m.prototype,"expression",void 0),Object(l.a)([Object(c.b)({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],m.prototype,"title",void 0),Object(l.a)([Object(c.b)({json:{read:!1,write:!1}})],m.prototype,"value",void 0),Object(l.a)([Object(f.a)("expression",["expression","value"])],m.prototype,"readExpression",null),Object(l.a)([Object(h.a)("expression")],m.prototype,"writeExpression",null);var g,_=m=n=Object(l.a)([Object(p.a)("esri.layers.support.LabelExpressionInfo")],m),O=r(793),j=new d.a({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function w(e){return!e||"service"!==e.origin&&!(e.layer&&"map-image"===e.layer.type)}var S=g=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).type="label",n.name=null,n.deconflictionStrategy="static",n.labelExpression=null,n.labelExpressionInfo=null,n.labelPlacement=null,n.maxScale=0,n.minScale=0,n.symbol=O.a,n.useCodedValues=void 0,n.where=null,n}return Object(i.a)(r,[{key:"readLabelExpression",value:function(e,t){var r=t.labelExpressionInfo;if(!r||!r.value&&!r.expression)return e}},{key:"writeLabelExpression",value:function(e,t,r,n){if(this.labelExpressionInfo&&(w(n)||n&&"service"===n.origin))if(null!=this.labelExpressionInfo.value)e=Object(b.f)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){var a=Object(b.e)(this.labelExpressionInfo.expression);a&&(e="["+a+"]")}null!=e&&(t[r]=e)}},{key:"writeLabelExpressionInfo",value:function(e,t,r,n){if(null==e&&null!=this.labelExpression&&w(n))e=new _({expression:this.getLabelExpressionArcade()});else if(!e)return;var a=e.toJSON(n);a.expression&&(t[r]=a)}},{key:"writeMaxScale",value:function(e,t){(e||this.minScale)&&(t.maxScale=e)}},{key:"writeMinScale",value:function(e,t){(e||this.maxScale)&&(t.minScale=e)}},{key:"getLabelExpression",value:function(){return Object(b.b)(this)}},{key:"getLabelExpressionArcade",value:function(){return Object(b.c)(this)}},{key:"getLabelExpressionSingleField",value:function(){return Object(b.d)(this)}},{key:"hash",value:function(){return JSON.stringify(this)}},{key:"clone",value:function(){return new g({deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:Object(o.a)(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:Object(o.a)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}}],[{key:"evaluateWhere",value:function(e,t){var r=function(e,t,r){switch(t){case"=":return e==r;case"<>":return e!=r;case">":return e>r;case">=":return e>=r;case"<":return e<r;case"<=":return e<=r}return!1};try{if(null==e)return!0;var n=e.split(" ");if(3===n.length)return r(t[n[0]],n[1],n[2]);if(7===n.length){var a=r(t[n[0]],n[1],n[2]),i=n[3],s=r(t[n[4]],n[5],n[6]);switch(i){case"AND":return a&&s;case"OR":return a||s}}return!1}catch(t){console.log("Error.: can't parse = "+e)}}}]),r}(y.a);Object(l.a)([Object(c.b)({type:String,json:{write:!0}})],S.prototype,"name",void 0),Object(l.a)([Object(c.b)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],S.prototype,"deconflictionStrategy",void 0),Object(l.a)([Object(c.b)({type:String,json:{write:{allowNull:!0}}})],S.prototype,"labelExpression",void 0),Object(l.a)([Object(f.a)("labelExpression")],S.prototype,"readLabelExpression",null),Object(l.a)([Object(h.a)("labelExpression")],S.prototype,"writeLabelExpression",null),Object(l.a)([Object(c.b)({type:_,json:{write:{overridePolicy:function(e,t,r){return w(r)?{allowNull:!0}:{enabled:!1}}}}})],S.prototype,"labelExpressionInfo",void 0),Object(l.a)([Object(h.a)("labelExpressionInfo")],S.prototype,"writeLabelExpressionInfo",null),Object(l.a)([Object(c.b)({type:j.apiValues,json:{type:j.jsonValues,read:j.read,write:j.write}})],S.prototype,"labelPlacement",void 0),Object(l.a)([Object(c.b)({type:Number})],S.prototype,"maxScale",void 0),Object(l.a)([Object(h.a)("maxScale")],S.prototype,"writeMaxScale",null),Object(l.a)([Object(c.b)({type:Number})],S.prototype,"minScale",void 0),Object(l.a)([Object(h.a)("minScale")],S.prototype,"writeMinScale",null),Object(l.a)([Object(c.b)({types:v.d,json:{origins:{"web-scene":{types:v.g,write:v.j,default:null}},write:v.j,default:null}})],S.prototype,"symbol",void 0),Object(l.a)([Object(c.b)({type:Boolean,json:{write:!0}})],S.prototype,"useCodedValues",void 0),Object(l.a)([Object(c.b)({type:String,json:{write:!0}})],S.prototype,"where",void 0);var F=S=g=Object(l.a)([Object(p.a)("esri.layers.support.LabelClass")],S);t.a=F},798:function(e,t,r){"use strict";var n,a=r(2),i=r(3),s=r(5),u=r(6),l=r(0),o=(r(13),r(14),r(15),r(1)),c=r(8),d=(r(11),r(19),r(20),r(28)),f=r(174),p=n=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).value=0,n.unit="milliseconds",n}return Object(i.a)(r,[{key:"toMilliseconds",value:function(){return this.value*f.b[this.unit]}},{key:"clone",value:function(){return new n({value:this.value,unit:this.unit})}}]),r}(d.a);Object(l.a)([Object(o.b)({type:Number,json:{write:!0},nonNullable:!0})],p.prototype,"value",void 0),Object(l.a)([Object(o.b)({type:f.d.apiValues,json:{type:f.d.jsonValues,read:f.d.read,write:f.d.write},nonNullable:!0})],p.prototype,"unit",void 0);var h=p=n=Object(l.a)([Object(c.a)("esri.TimeInterval")],p);t.a=h},799:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return c})),r.d(t,"g",(function(){return o}));var n=[252,146,31,255],a={type:"esriSMS",style:"esriSMSCircle",size:6,color:n,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},i={type:"esriSLS",style:"esriSLSSolid",width:.75,color:n},s={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},u={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},l={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},o={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},c={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},801:function(e,t,r){"use strict";var n=r(2),a=r(5),i=r(6),s=r(0),u=(r(13),r(14),r(15),r(1)),l=r(8),o=(r(11),r(19),r(20),function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(){var e;return Object(n.a)(this,r),(e=t.apply(this,arguments)).type=null,e}return r}(r(28).a));Object(s.a)([Object(u.b)({type:["selection","cluster"],readOnly:!0,json:{read:!1,write:!0}})],o.prototype,"type",void 0);var c=o=Object(s.a)([Object(l.a)("esri.layers.support.FeatureReduction")],o);t.a=c},802:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(2),a=r(3),i=r(5),s=r(6),u=r(0),l=(r(13),r(14),r(15),r(1)),o=r(8),c=(r(11),r(19),r(20),function(e){var t=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(){var e;return Object(n.a)(this,r),(e=t.apply(this,arguments)).refreshInterval=0,e}return Object(a.a)(r,[{key:"refresh",value:function(){this.emit("refresh")}}]),r}(e);return Object(u.a)([Object(l.b)({type:Number,cast:function(e){return e>=.1?e:e<=0?0:.1},json:{write:!0,origins:{"web-document":{write:!0}}}})],t.prototype,"refreshInterval",void 0),t=Object(u.a)([Object(o.a)("esri.layers.mixins.RefreshableLayer")],t)})},805:function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return v}));var n=r(26),a=r(12),i=r(4),s=r(98),u=r(33),l=r(41),o=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function c(e){return e instanceof u.a}function d(e){return e instanceof l.a?Object.keys(e.items):c(e)?Object(s.a)(e).keys():e?Object.keys(e):[]}function f(e,t){return e instanceof l.a?e.items[t]:e[t]}function p(e){return e?e.declaredClass:null}function h(e,t){var r=e.diff;if(r&&"function"==typeof r)return r(e,t);var s=d(e),u=d(t);if(0!==s.length||0!==u.length){if(!s.length||!u.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};var l,y=u.filter((function(e){return-1===s.indexOf(e)})),v=s.filter((function(e){return-1===u.indexOf(e)})),b=s.filter((function(r){return u.indexOf(r)>-1&&f(e,r)!==f(t,r)})).concat(y,v).sort(),m=p(e);if(m&&o.indexOf(m)>-1&&b.length)return{type:"complete",oldValue:e,newValue:t};var g,_=c(e)&&c(t),O=Object(a.a)(b);try{for(O.s();!(g=O.n()).done;){var j=g.value,w=f(e,j),S=f(t,j),F=void 0;(_||"function"!=typeof w&&"function"!=typeof S)&&w!==S&&(null==w&&null==S||(F=r&&r[j]&&"function"==typeof r[j]?r[j](w,S):"object"==typeof w&&"object"==typeof S&&p(w)===p(S)?h(w,S):{type:"complete",oldValue:w,newValue:S},Object(i.i)(F)&&(Object(i.i)(l)?l.diff[j]=F:l={type:"partial",diff:Object(n.a)({},j,F)})))}}catch(I){O.e(I)}finally{O.f()}return l}}function y(e,t){if(Object(i.h)(e))return!1;var r,n=t.split("."),s=e,u=Object(a.a)(n);try{for(u.s();!(r=u.n()).done;){var l=r.value;if("complete"===s.type)return!0;if("partial"!==s.type)return!1;var o=s.diff[l];if(!o)return!1;s=o}}catch(c){u.e(c)}finally{u.f()}return!0}function v(e,t){var r,n=Object(a.a)(t);try{for(n.s();!(r=n.n()).done;){if(y(e,r.value))return!0}}catch(i){n.e(i)}finally{n.f()}return!1}function b(e,t){if("function"!=typeof e&&"function"!=typeof t&&(e||t))return!e||!t||"object"==typeof e&&"object"==typeof t&&p(e)!==p(t)?{type:"complete",oldValue:e,newValue:t}:h(e,t)}},806:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return d})),r.d(t,"e",(function(){return b})),r.d(t,"f",(function(){return l}));var n=r(108),a=new RegExp("__begin__","ig"),i=new RegExp("__end__","ig"),s=new RegExp("^__begin__","i"),u=new RegExp("__end__$","i");function l(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function o(e){var t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):null!=e.labelExpression&&(t.expression=function(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}(e.labelExpression),t.type="conventional"),t}function c(e){var t=o(e);if(!t)return null;switch(t.type){case"conventional":return f(t.expression);case"arcade":return t.expression}return null}function d(e){var t=o(e);if(!t)return null;switch(t.type){case"conventional":return function(e){var t=e.match(p);return t&&t[1].trim()||null}(t.expression);case"arcade":return b(t.expression)}return null}function f(e){var t;return e?(t=Object(n.c)(e,(function(e){return'__begin__$feature["'+e+'"]__end__'})),t=s.test(t)?t.replace(s,""):'"'+t,t=(t=u.test(t)?t.replace(u,""):t+'"').replace(a,'" + ').replace(i,' + "')):t='""',t}var p=/^\s*\{([^}]+)\}\s*$/i;var h=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,y=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,v=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function b(e){if(!e)return null;var t=h.exec(e)||y.exec(e);return t?t[1]||t[3]:(t=v.exec(e))?t[2]:null}},807:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return c}));var n=r(32),a=r(12),i=r(2),s=r(3),u=r(129),l=-3,o=function(){function e(t,r,n){Object(i.a)(this,e),this._namespace=t,this._storage=r,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",n&&(this._storage.registerRemoveFunc(this._namespace,n),this._removeFunc=!0)}return Object(s.a)(e,[{key:"namespace",get:function(){return this._namespace.slice(0,-1)}},{key:"hitRate",get:function(){return this._hit/(this._hit+this._miss)}},{key:"size",get:function(){return this._storage.size}},{key:"maxSize",get:function(){return this._storage.maxSize}},{key:"resetHitRate",value:function(){this._hit=this._miss=0}},{key:"destroy",value:function(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this)}},{key:"put",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._storage.put(this._namespace+e,t,r,n)}},{key:"get",value:function(e){var t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}},{key:"pop",value:function(e){var t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}},{key:"updateSize",value:function(e,t,r){this._storage.updateSize(this._namespace+e,t,r)}},{key:"clear",value:function(){this._storage.clear(this._namespace)}},{key:"clearAll",value:function(){this._storage.clearAll()}},{key:"getStats",value:function(){return this._storage.getStats()}},{key:"resetStats",value:function(){this._storage.resetStats()}}]),e}(),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10485760;Object(i.a)(this,e),this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=[],this._users=new u.a}return Object(s.a)(e,[{key:"register",value:function(e){this._users.push(e)}},{key:"deregister",value:function(e){this._users.removeUnordered(e)}},{key:"registerRemoveFunc",value:function(e,t){this._removeFuncs.push([e,t])}},{key:"deregisterRemoveFunc",value:function(e){this._removeFuncs=this._removeFuncs.filter((function(t){return t[0]!==e}))}},{key:"size",get:function(){return this._size}},{key:"maxSize",get:function(){return this._maxSize},set:function(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}},{key:"put",value:function(e,t,r,n){var a=this._db.get(e);if(a&&(this._size-=a.size,this._db.delete(e),a.entry!==t&&this._notifyRemoved(e,a.entry)),r>this._maxSize)this._notifyRemoved(e,t);else if(void 0!==t)if(!r||r<0)console.warn("Refusing to cache entry with invalid size "+r);else{var i=1+Math.max(n,-3)- -3;this._db.set(e,{entry:t,size:r,lifetime:i,lives:i}),this._size+=r,this._checkSizeLimit()}else console.warn("Refusing to cache undefined entry ")}},{key:"updateSize",value:function(e,t,r){var n=this._db.get(e);n&&n.entry===t&&(this._size-=n.size,r>this._maxSize?this._notifyRemoved(e,t):(n.size=r,this._size+=r,this._checkSizeLimit()))}},{key:"pop",value:function(e){var t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss}},{key:"get",value:function(e){var t=this._db.get(e);if(void 0!==t)return this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry;++this._miss}},{key:"getStats",value:function(){var e=this,t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},n=new Array;this._db.forEach((function(t,a){var i=t.lifetime;n[i]=(n[i]||0)+t.size,e._users.forAll((function(e){var n=e.namespace;if(a.startsWith(n)){var i=r[n]||0;r[n]=i+t.size}}))}));var a={};this._users.forAll((function(e){var t=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){var n=r[t]||0;r[t]=n,a[t]=Math.round(100*e.hitRate)+"%"}else a[t]="0%"}));var i=Object.keys(r);i.forEach((function(t){return r[t]=r[t]/e._size*100})),i.sort((function(e,t){return r[t]-r[e]})),i.forEach((function(e){return t[e]=Math.round(r[e])+"% / "+a[e]}));for(var s=n.length-1;s>=0;--s){var u=n[s];u&&(t["Priority "+(s+-3-1)]=Math.round(u/this.size*100)+"%")}return t}},{key:"resetStats",value:function(){this._hit=this._miss=0,this._users.forAll((function(e){return e.resetHitRate()}))}},{key:"clear",value:function(e){var t=this;this._db.forEach((function(r,n){n.startsWith(e)&&(t._size-=r.size,t._db.delete(n),t._notifyRemoved(n,r.entry))}))}},{key:"clearAll",value:function(){var e=this;this._db.forEach((function(t,r){return e._notifyRemoved(r,t.entry)})),this._size=0,this._db.clear()}},{key:"_getHitRate",value:function(){return this._hit/(this._hit+this._miss)}},{key:"_notifyRemoved",value:function(e,t){this._removeFuncs.forEach((function(r){e.startsWith(r[0])&&r[1](t)}))}},{key:"_checkSizeLimit",value:function(){if(!(this._size<=this._maxSize)){var e,t=Object(a.a)(this._db);try{for(t.s();!(e=t.n()).done;){var r=Object(n.a)(e.value,2),i=r[0],s=r[1];if(this._db.delete(i),s.lives<=1?(this._size-=s.size,this._notifyRemoved(i,s.entry)):(--s.lives,this._db.set(i,s)),this._size<=.9*this.maxSize)return}}catch(u){t.e(u)}finally{t.f()}}}}]),e}()},808:function(e,t,r){"use strict";var n,a=r(2),i=r(3),s=r(5),u=r(6),l=r(0),o=(r(13),r(24)),c=(r(14),r(15),r(1)),d=r(63),f=r(8),p=r(47),h=(r(11),r(19),r(20),r(28)),y=r(174),v=r(305),b=r(798),m=n=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).respectsDaylightSaving=!1,n.timezone=null,n}return Object(i.a)(r,[{key:"readRespectsDaylightSaving",value:function(e,t){return void 0!==t.respectsDaylightSaving?t.respectsDaylightSaving:void 0!==t.respectDaylightSaving&&t.respectDaylightSaving}},{key:"clone",value:function(){var e=this.respectsDaylightSaving,t=this.timezone;return new n({respectsDaylightSaving:e,timezone:t})}}]),r}(h.a);Object(l.a)([Object(c.b)({type:Boolean,json:{write:!0}})],m.prototype,"respectsDaylightSaving",void 0),Object(l.a)([Object(d.a)("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],m.prototype,"readRespectsDaylightSaving",null),Object(l.a)([Object(c.b)({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],m.prototype,"timezone",void 0);var g,_=m=n=Object(l.a)([Object(f.a)("esri.layers.support.TimeReference")],m),O=g=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).cumulative=!1,n.endField=null,n.fullTimeExtent=null,n.hasLiveData=!1,n.interval=null,n.startField=null,n.timeReference=null,n.trackIdField=null,n.useTime=!0,n}return Object(i.a)(r,[{key:"readFullTimeExtent",value:function(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||2!==t.timeExtent.length)return null;var r=new Date(t.timeExtent[0]),n=new Date(t.timeExtent[1]);return new v.a({start:r,end:n})}},{key:"writeFullTimeExtent",value:function(e,t){e&&e.start&&e.end?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}},{key:"readInterval",value:function(e,t){return t.timeInterval&&t.timeIntervalUnits?new b.a({value:t.timeInterval,unit:y.d.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new b.a({value:t.defaultTimeInterval,unit:y.d.fromJSON(t.defaultTimeIntervalUnits)}):null}},{key:"writeInterval",value:function(e,t){if(e){var r=e.toJSON();t.timeInterval=r.value,t.timeIntervalUnits=r.unit}else t.timeInterval=null,t.timeIntervalUnits=null}},{key:"clone",value:function(){var e=this.cumulative,t=this.endField,r=this.hasLiveData,n=this.interval,a=this.startField,i=this.timeReference,s=this.fullTimeExtent,u=this.trackIdField,l=this.useTime;return new g({cumulative:e,endField:t,hasLiveData:r,interval:n,startField:a,timeReference:Object(o.a)(i),fullTimeExtent:Object(o.a)(s),trackIdField:u,useTime:l})}}]),r}(h.a);Object(l.a)([Object(c.b)({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],O.prototype,"cumulative",void 0),Object(l.a)([Object(c.b)({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],O.prototype,"endField",void 0),Object(l.a)([Object(c.b)({type:v.a,json:{write:{enabled:!0,allowNull:!0}}})],O.prototype,"fullTimeExtent",void 0),Object(l.a)([Object(d.a)("fullTimeExtent",["timeExtent"])],O.prototype,"readFullTimeExtent",null),Object(l.a)([Object(p.a)("fullTimeExtent")],O.prototype,"writeFullTimeExtent",null),Object(l.a)([Object(c.b)({type:Boolean,json:{write:!0}})],O.prototype,"hasLiveData",void 0),Object(l.a)([Object(c.b)({type:b.a,json:{write:{enabled:!0,allowNull:!0}}})],O.prototype,"interval",void 0),Object(l.a)([Object(d.a)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],O.prototype,"readInterval",null),Object(l.a)([Object(p.a)("interval")],O.prototype,"writeInterval",null),Object(l.a)([Object(c.b)({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],O.prototype,"startField",void 0),Object(l.a)([Object(c.b)({type:_,json:{write:{enabled:!0,allowNull:!0}}})],O.prototype,"timeReference",void 0),Object(l.a)([Object(c.b)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],O.prototype,"trackIdField",void 0),Object(l.a)([Object(c.b)({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],O.prototype,"useTime",void 0);var j=O=g=Object(l.a)([Object(f.a)("esri.layers.support.TimeInfo")],O);t.a=j},813:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n=r(157),a=(r(130),r(215)),i=(r(309),r(310)),s=r(216),u=r(217),l=(r(218),r(179),r(277)),o=["oid","global-id"],c=["oid","global-id","guid"];function d(e,t){var r=e.displayField,i=e.editFieldsInfo,s=e.fields,o=e.objectIdField,c=e.title;if(!s)return null;var d=b({editFieldsInfo:i,fields:s,objectIdField:o},t);if(!d.length)return null;var f=function(e){var t=Object(n.l)(e),r=e.titleBase;return t?"".concat(r,": {").concat(t.trim(),"}"):r}({titleBase:c,fields:s,displayField:r}),p=[new u.a,new a.a];return new l.a({title:f,content:p,fieldInfos:d})}var f=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],p=function(e,t){var r=t.editFieldsInfo,n=t.objectIdField,a=t.visibleFieldNames;return a?a.has(e.name):!y(e.name,r)&&(!n||e.name!==n)&&!(o.indexOf(e.type)>-1)&&!f.some((function(t){return t.test(e.name)}))};function h(e,t){return"oid"===e.type?-1:"oid"===t.type?1:g(e)?-1:g(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function y(e,t){if(!e||!t)return!1;var r=t.creationDateField,n=t.creatorField,a=t.editDateField,i=t.editorField;return-1!==[r&&r.toLowerCase(),n&&n.toLowerCase(),a&&a.toLowerCase(),i&&i.toLowerCase()].indexOf(e.toLowerCase())}function v(e,t){return e.editable&&-1===c.indexOf(e.type)&&!y(e.name,t)}function b(e,t){var r=e.editFieldsInfo,n=e.fields,a=e.objectIdField;return function(e,t){var r=e;return t&&(e=e.filter((function(e){return-1===t.indexOf(e.type)}))),e===r&&(e=e.slice()),e.sort(h),e}(n,(null==t?void 0:t.ignoreFieldTypes)||_).map((function(e){return new s.a({fieldName:e.name,isEditable:v(e,r),label:e.alias,format:m(e),visible:p(e,{editFieldsInfo:r,objectIdField:a,visibleFieldNames:null==t?void 0:t.visibleFieldNames})})}))}function m(e){switch(e.type){case"small-integer":case"integer":case"single":return new i.a({digitSeparator:!0,places:0});case"double":return new i.a({digitSeparator:!0,places:2});case"date":return new i.a({dateFormat:"long-month-day-year"});default:return null}}function g(e){return"name"===(e.name&&e.name.toLowerCase())||("name"===(e.alias&&e.alias.toLowerCase())||void 0)}var _=["geometry","blob","raster","guid","xml"]},817:function(e,t,r){"use strict";var n=r(2),a=r(3),i=r(5),s=r(6),u=r(0),l=(r(13),r(24)),o=(r(14),r(15),r(1)),c=r(50),d=r(8),f=r(47),p=(r(11),r(19),r(20),r(28)),h=new c.a({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"}),y=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).name=null,a.description=null,a.drawingTool=null,a.prototype=null,a.thumbnail=null,a}return Object(a.a)(r,[{key:"writeDrawingTool",value:function(e,t){t.drawingTool=h.toJSON(e)}},{key:"writePrototype",value:function(e,t){t.prototype=Object(l.c)(Object(l.a)(e),!0)}},{key:"writeThumbnail",value:function(e,t){t.thumbnail=Object(l.c)(Object(l.a)(e))}}]),r}(p.a);Object(u.a)([Object(o.b)({json:{write:!0}})],y.prototype,"name",void 0),Object(u.a)([Object(o.b)({json:{write:!0}})],y.prototype,"description",void 0),Object(u.a)([Object(o.b)({json:{read:h.read,write:h.write}})],y.prototype,"drawingTool",void 0),Object(u.a)([Object(f.a)("drawingTool")],y.prototype,"writeDrawingTool",null),Object(u.a)([Object(o.b)({json:{write:!0}})],y.prototype,"prototype",void 0),Object(u.a)([Object(f.a)("prototype")],y.prototype,"writePrototype",null),Object(u.a)([Object(o.b)({json:{write:!0}})],y.prototype,"thumbnail",void 0),Object(u.a)([Object(f.a)("thumbnail")],y.prototype,"writeThumbnail",null);var v=y=Object(u.a)([Object(d.a)("esri.layers.support.FeatureTemplate")],y);t.a=v},818:function(e,t,r){"use strict";var n,a=r(2),i=r(3),s=r(5),u=r(6),l=r(0),o=(r(13),r(14),r(15),r(1)),c=r(8),d=(r(11),r(19),r(20),r(801)),f=n=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).type="selection",n}return Object(i.a)(r,[{key:"clone",value:function(){return new n}}]),r}(d.a);Object(l.a)([Object(o.b)({type:["selection"]})],f.prototype,"type",void 0);var p=f=n=Object(l.a)([Object(c.a)("esri.layers.support.FeatureReductionSelection")],f);t.a=p},819:function(e,t,r){"use strict";var n,a=r(2),i=r(3),s=r(5),u=r(6),l=r(0),o=(r(13),r(24)),c=(r(14),r(15),r(1)),d=r(8),f=(r(11),r(19),r(20),r(28)),p=r(277),h=r(36),y=r(788),v=n=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).statisticType=null,e.onStatisticField=null,e.onStatisticValueExpression=null,e}return Object(i.a)(r,[{key:"clone",value:function(){return new n({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}}]),r}(f.a);Object(l.a)([Object(c.b)({type:String,json:{write:!0}})],v.prototype,"statisticType",void 0),Object(l.a)([Object(c.b)({type:String,json:{write:!0}})],v.prototype,"onStatisticField",void 0),Object(l.a)([Object(c.b)({type:String,json:{write:!0}})],v.prototype,"onStatisticValueExpression",void 0);var b,m=v=n=Object(l.a)([Object(d.a)("esri.layers.support.OutStatistic")],v),g=b=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).name=null,e}return Object(i.a)(r,[{key:"clone",value:function(){return new b({name:this.name,outStatistic:this.outStatistic.clone()})}}]),r}(f.a);Object(l.a)([Object(c.b)({type:String,json:{write:!0}})],g.prototype,"name",void 0),Object(l.a)([Object(c.b)({type:m,json:{write:!0}})],g.prototype,"outStatistic",void 0);var _,O=g=b=Object(l.a)([Object(d.a)("esri.layers.support.AggregateField")],g),j=r(794),w=_=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).type="cluster",n.clusterRadius=Object(h.j)("80px"),n.clusterMinSize=Object(h.j)("12px"),n.clusterMaxSize=Object(h.j)("50px"),n.popupEnabled=!0,n.popupTemplate=null,n.labelingInfo=null,n.labelsVisible=!0,n.fields=null,n}return Object(i.a)(r,[{key:"clone",value:function(){return new _({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:Object(o.a)(this.labelingInfo),labelsVisible:this.labelsVisible,fields:Object(o.a)(this.fields),popupEnabled:this.popupEnabled,popupTemplate:Object(o.a)(this.popupTemplate)})}}]),r}(f.a);Object(l.a)([Object(c.b)({type:["cluster"],readOnly:!0,json:{write:!0}})],w.prototype,"type",void 0),Object(l.a)([Object(c.b)({type:Number,cast:function(e){return"auto"===e?e:Object(h.j)(e)},json:{write:!0}})],w.prototype,"clusterRadius",void 0),Object(l.a)([Object(c.b)({type:Number,cast:h.j,json:{write:!0}})],w.prototype,"clusterMinSize",void 0),Object(l.a)([Object(c.b)({type:Number,cast:h.j,json:{write:!0}})],w.prototype,"clusterMaxSize",void 0),Object(l.a)([Object(c.b)(y.g)],w.prototype,"popupEnabled",void 0),Object(l.a)([Object(c.b)({type:p.a,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],w.prototype,"popupTemplate",void 0),Object(l.a)([Object(c.b)({type:[j.a],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],w.prototype,"labelingInfo",void 0),Object(l.a)([Object(c.b)(y.c)],w.prototype,"labelsVisible",void 0),Object(l.a)([Object(c.b)({type:[O],json:{write:!0}})],w.prototype,"fields",void 0);var S=w=_=Object(l.a)([Object(d.a)("esri.layers.support.FeatureReductionCluster")],w);t.a=S},821:function(e,t,r){"use strict";r.d(t,"a",(function(){return S})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return m})),r.d(t,"e",(function(){return g})),r.d(t,"f",(function(){return j})),r.d(t,"g",(function(){return y}));var n=r(12),a=r(32),i=r(175),s=r(4),u=r(14),l=r(52),o=r(75),c=r(306),d=r(795),f=u.a.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),p=new o.a,h=Math.PI,y=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function v(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"color"===e.type}))[0]:e;if(n)if("esri.renderers.visualVariables.ColorVariable"===n.declaredClass){var a="number"==typeof t,i=a?null:t,u=i&&i.attributes,o=a?t:null,c=n.field,d=n.cache,p=d.ipData,h=d.hasExpression,y=n.cache.compiledFunc;if(!c&&!h){var v=n.stops;return v&&v[0]&&v[0].color}if("number"!=typeof o)if(h){if(!Object(s.i)(r)||!Object(s.i)(r.arcade))return void f.error("Use of arcade expressions requires an arcade context");var b={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},m=r.arcade.arcadeUtils,g=m.getViewInfo(b),_=m.createExecContext(i,g);if(!y){var O=m.createSyntaxTree(n.valueExpression);y=m.createFunction(O),n.cache.compiledFunc=y}o=m.executeFunction(y,_)}else u&&(o=u[c]);var j=n.normalizationField,S=u?parseFloat(u[j]):void 0;if(null!=o&&(!j||a||!isNaN(S)&&0!==S)){isNaN(S)||a||(o/=S);var F=w(o,p);if(F){var I=F[0],k=F[1],x=I===k?n.stops[I].color:l.a.blendColors(n.stops[I].color,n.stops[k].color,F[2],Object(s.i)(r)?r.color:void 0);return new l.a(x)}}}else f.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable")}function b(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"opacity"===e.type}))[0]:e;if(n)if("esri.renderers.visualVariables.OpacityVariable"===n.declaredClass){var a="number"==typeof t,i=a?null:t,u=i&&i.attributes,l=a?t:null,o=n.field,c=n.cache,d=c.ipData,p=c.hasExpression,h=n.cache.compiledFunc;if(!o&&!p){var y=n.stops;return y&&y[0]&&y[0].opacity}if("number"!=typeof l)if(p){if(Object(s.h)(r)||Object(s.h)(r.arcade))return void f.error("Use of arcade expressions requires an arcade context");var v={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},b=r.arcade.arcadeUtils,m=b.getViewInfo(v),g=b.createExecContext(i,m);if(!h){var _=b.createSyntaxTree(n.valueExpression);h=b.createFunction(_),n.cache.compiledFunc=h}l=b.executeFunction(h,g)}else u&&(l=u[o]);var O=n.normalizationField,j=u?parseFloat(u[O]):void 0;if(null!=l&&(!O||a||!isNaN(j)&&0!==j)){isNaN(j)||a||(l/=j);var S=w(l,d);if(S){var F=S[0],I=S[1];if(F===I)return n.stops[F].opacity;var k=n.stops[F].opacity;return k+(n.stops[I].opacity-k)*S[2]}}}else f.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable")}function m(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"rotation"===e.type}))[0]:e;if(n){if("esri.renderers.visualVariables.RotationVariable"===n.declaredClass){var a=n.axis||"heading",i="heading"===a&&"arithmetic"===n.rotationType?90:0,u="heading"===a&&"arithmetic"===n.rotationType?-1:1,l="number"==typeof t?null:t,o=l&&l.attributes,c=n.field,d=n.cache.hasExpression,p=n.cache.compiledFunc,h=0;if(!c&&!d)return h;if(d){if(Object(s.h)(r)||Object(s.h)(r.arcade))return void f.error("Use of arcade expressions requires an arcade context");var y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},v=r.arcade.arcadeUtils,b=v.getViewInfo(y),m=v.createExecContext(l,b);if(!p){var g=v.createSyntaxTree(n.valueExpression);p=v.createFunction(g),n.cache.compiledFunc=p}h=v.executeFunction(p,m)}else o&&(h=o[c]||0);return h="number"!=typeof h||isNaN(h)?null:i+u*h}f.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable")}}function g(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"size"===e.type}))[0]:e;if(n){if("esri.renderers.visualVariables.SizeVariable"===n.declaredClass){var i=function(e,t,r,n,i){switch(t.transformationType){case"additive":return function(e,t,r,n){return e+(_(t.minSize,r,n)||t.minDataValue)}(e,t,r,n);case"constant":return function(e,t,r){var n=e.stops,a=n&&n.length&&n[0].size;return null==a&&(a=e.minSize),_(a,t,r)}(t,r,n);case"clamped-linear":return function(e,t,r,n){var a=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),i=_(t.minSize,r,n),u=_(t.maxSize,r,n),l=Object(s.i)(n)?n.shape:void 0;if(e<=t.minDataValue)return i;if(e>=t.maxDataValue)return u;if("area"===t.scaleBy&&l){var o="circle"===l,c=o?h*Math.pow(i/2,2):i*i,d=c+a*((o?h*Math.pow(u/2,2):u*u)-c);return o?2*Math.sqrt(d/h):Math.sqrt(d)}return i+a*(u-i)}(e,t,r,n);case"proportional":return function(e,t,r,n){var a=Object(s.i)(n)?n.shape:void 0,i=e/t.minDataValue,u=_(t.minSize,r,n),l=_(t.maxSize,r,n);return O("circle"===a?2*Math.sqrt(i*Math.pow(u/2,2)):"square"===a||"diamond"===a||"image"===a?Math.sqrt(i*Math.pow(u,2)):i*u,u,l)}(e,t,r,n);case"stops":return function(e,t,r,n,i){var s=w(e,i),u=Object(a.a)(s,3),l=u[0],o=u[1],c=u[2];if(l===o)return _(t.stops[l].size,r,n);var d=_(t.stops[l].size,r,n);return d+(_(t.stops[o].size,r,n)-d)*c}(e,t,r,n,i);case"real-world-size":return function(e,t,r,n){var a=(Object(s.i)(n)&&n.resolution?n.resolution:1)*c.a[t.valueUnit],i=_(t.minSize,r,n),u=_(t.maxSize,r,n),l=t.valueRepresentation;return O("area"===l?2*Math.sqrt(e/h)/a:"radius"===l||"distance"===l?2*e/a:e/a,i,u)}(e,t,r,n);case"identity":return e;case"unknown":return null}}(function(e,t,r){var n="number"==typeof t,a=n?null:t,i=a&&a.attributes,u=n?t:null,l=e.cache.isScaleDriven,o=e.cache.compiledFunc;if(l){var c=Object(s.i)(r)?r.scale:void 0,p=Object(s.i)(r)?r.view:void 0;u=null==c||"3d"===p?function(e){var t=null,r=null,n=e.stops;return n?(t=n[0].value,r=n[n.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):c}else if(!n)switch(e.inputValueType){case"expression":if(Object(s.h)(r)||Object(s.h)(r.arcade))return void f.error("Use of arcade expressions requires an arcade context");var h={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,v=y.getViewInfo(h),b=y.createExecContext(a,v);if(!o){var m=y.createSyntaxTree(e.valueExpression);o=y.createFunction(m),e.cache.compiledFunc=o}u=y.executeFunction(o,b);break;case"field":i&&(u=i[e.field]);break;case"unknown":u=null}if(!Object(d.d)(u))return null;if(n||!e.normalizationField)return u;var g=i?parseFloat(i[e.normalizationField]):null;return Object(d.d)(g)&&0!==g?u/g:null}(n,t,r),n,t,r,n.cache.ipData);return null==i||isNaN(i)?0:i}f.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable")}}function _(e,t,r){return null==e?null:Object(d.c)(e)?g(e,t,r):Object(d.d)(e)?e:null}function O(e,t,r){return Object(d.d)(r)&&e>r?r:Object(d.d)(t)&&e<t?t:e}function j(e,t,r){if(!(e.cache.isScaleDriven&&"3d"===r||t))return null;var n={scale:t,view:r},a=_(e.minSize,p,n),i=_(e.maxSize,p,n);if(null!=a||null!=i){if(a>i){var s=i;i=a,a=s}return{minSize:a,maxSize:i}}}function w(e,t){if(t){var r=0,n=t.length-1;return t.some((function(t,a){return e<t?(n=a,!0):(r=a,!1)})),[r,n,(e-t[r])/(t[n]-t[r])]}}function S(e,t,r){var a,s=["proportional","proportional","proportional"],u=Object(n.a)(e);try{for(u.s();!(a=u.n()).done;){var l=a.value,o=l.useSymbolValue?"symbol-value":g(l,t,r);switch(l.axis){case"width":s[0]=o;break;case"depth":s[1]=o;break;case"height":s[2]=o;break;case"width-and-depth":s[0]=o,s[1]=o;break;case"all":case void 0:case null:s[0]=o,s[1]=o,s[2]=o;break;default:Object(i.a)(l.axis)}}}catch(c){u.e(c)}finally{u.f()}return s}},826:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var n=r(2),a=r(3),i=r(5),s=r(6),u=r(0),l=(r(13),r(14),r(15),r(1)),o=r(63),c=r(8),d=(r(11),r(19),r(20),r(157)),f=r(174),p=r(305),h=r(798),y=r(808);var v=function(e){var t=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(){var e;return Object(n.a)(this,r),(e=t.apply(this,arguments)).timeExtent=null,e.timeOffset=null,e.useViewTime=!0,e}return Object(a.a)(r,[{key:"readOffset",value:function(e,t){var r=t.timeInfo.exportOptions;if(!r)return null;var n=r.timeOffset,a=f.d.fromJSON(r.timeOffsetUnits);return n&&a?new h.a({value:n,unit:a}):null}},{key:"timeInfo",set:function(e){Object(d.k)(e,this.fields),this._set("timeInfo",e)}}]),r}(e);return Object(u.a)([Object(l.b)({type:p.a,json:{write:!1}})],t.prototype,"timeExtent",void 0),Object(u.a)([Object(l.b)({type:h.a})],t.prototype,"timeOffset",void 0),Object(u.a)([Object(o.a)("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),Object(u.a)([Object(l.b)({value:null,type:y.a,json:{write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),Object(u.a)([Object(l.b)({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=Object(u.a)([Object(c.a)("esri.layers.mixins.TemporalLayer")],t),t}},827:function(e,t,r){"use strict";r.r(t);var n,a=r(12),i=r(10),s=r.n(i),u=r(21),l=r(9),o=r(2),c=r(3),d=r(61),f=r(55),p=r(5),h=r(6),y=r(0),v=r(13),b=r(99),m=r(4),g=r(14),_=r(1),O=r(73),j=r(50),w=r(63),S=r(234),F=r(8),I=r(47),k=r(23),x=r(11),T=(r(19),r(20),r(16)),E=r(44),C=r(62),D=r(41),N=r(157),R=r(277),A=r(81),P=r(149),L=r(56),M=r(244),G=r(796),B=r(386),q=r(235),U=r(788),V=r(810),W=(r(814),r(824),r(833)),J=(r(863),r(874),r(875),r(862)),z=r(871),Q=r(870),H=r(791),Y=r(24),K=r(28),$=r(15),Z=n=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).expression=null,n.name=null,n.returnType="boolean",n.title=null,n}return Object(c.a)(r,[{key:"clone",value:function(){return new n({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}}]),r}(K.a);Object(y.a)([Object(_.b)({type:String,json:{write:!0}})],Z.prototype,"expression",void 0),Object(y.a)([Object(_.b)({type:String,json:{write:!0}})],Z.prototype,"name",void 0),Object(y.a)([Object(_.b)({type:["boolean"],json:{write:!0}})],Z.prototype,"returnType",void 0),Object(y.a)([Object(_.b)({type:String,json:{write:!0}})],Z.prototype,"title",void 0);var X,ee=Z=n=Object(y.a)([Object(F.a)("esri.form.ExpressionInfo")],Z),te=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).type=null,n}return r}(function(e){var t=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).description=null,e.label=null,e.visibilityExpression=null,e}return r}(e);return Object(y.a)([Object(_.b)({type:String,json:{write:!0}})],t.prototype,"description",void 0),Object(y.a)([Object(_.b)({type:String,json:{write:!0}})],t.prototype,"label",void 0),Object(y.a)([Object(_.b)({type:String,json:{write:!0}})],t.prototype,"visibilityExpression",void 0),t=Object(y.a)([Object(F.a)("esri.form.elements.ElementMixin")],t),t}(K.a));Object(y.a)([Object(_.b)()],te.prototype,"type",void 0),te=Object(y.a)([Object(F.a)("esri.form.elements.Element")],te);var re=X=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).type=null,n}return Object(c.a)(r,[{key:"clone",value:function(){return new X({type:this.type})}}]),r}(K.a);Object(y.a)([Object(_.b)({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],re.prototype,"type",void 0);var ne,ae=re=X=Object(y.a)([Object(F.a)("esri.form.elements.inputs.AttachmentInput")],re),ie=ne=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).attachmentKeyword=null,n.editable=!0,n.input=null,n.type="attachment",n}return Object(c.a)(r,[{key:"clone",value:function(){return new ne({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}}]),r}(te);Object(y.a)([Object(_.b)({type:String,json:{write:!0}})],ie.prototype,"attachmentKeyword",void 0),Object(y.a)([Object(_.b)({type:Boolean,json:{default:!0,write:!0}})],ie.prototype,"editable",void 0),Object(y.a)([Object(_.b)({type:ae,json:{read:{source:"inputType"},write:{target:"inputType"}}})],ie.prototype,"input",void 0),Object(y.a)([Object(_.b)({type:["attachment"],json:{read:!1,write:!0}})],ie.prototype,"type",void 0);var se=ie=ne=Object(y.a)([Object(F.a)("esri.form.elements.AttachmentElement")],ie),ue=r(214),le=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).type=null,n}return r}(K.a);Object(y.a)([Object(_.b)()],le.prototype,"type",void 0);var oe,ce=le=Object(y.a)([Object(F.a)("esri.form.elements.inputs.Input")],le),de=oe=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).type="barcode-scanner",n}return Object(c.a)(r,[{key:"clone",value:function(){return new oe}}]),r}(ce);Object(y.a)([Object(_.b)({type:["barcode-scanner"],json:{read:!1,write:!0}})],de.prototype,"type",void 0);var fe,pe=de=oe=Object(y.a)([Object(F.a)("esri.form.elements.inputs.BarcodeScannerInput")],de),he=fe=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).type="combo-box",n}return Object(c.a)(r,[{key:"clone",value:function(){return new fe}}]),r}(ce);Object(y.a)([Object(_.b)({type:["combo-box"],json:{read:!1,write:!0}})],he.prototype,"type",void 0);var ye,ve=he=fe=Object(y.a)([Object(F.a)("esri.form.elements.inputs.ComboBoxInput")],he);function be(e){return null!=e?new Date(e):null}function me(e){return e?e.getTime():null}var ge=ye=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).includeTime=!1,n.max=null,n.min=null,n.type="datetime-picker",n}return Object(c.a)(r,[{key:"readMax",value:function(e,t){return be(t.max)}},{key:"writeMax",value:function(e,t){t.max=me(e)}},{key:"readMin",value:function(e,t){return be(t.min)}},{key:"writeMin",value:function(e,t){t.min=me(e)}},{key:"clone",value:function(){return new ye({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}}]),r}(ce);Object(y.a)([Object(_.b)({type:Boolean,json:{write:!0,default:!1}})],ge.prototype,"includeTime",void 0),Object(y.a)([Object(_.b)({type:Date,json:{type:Number,write:!0}})],ge.prototype,"max",void 0),Object(y.a)([Object(w.a)("max")],ge.prototype,"readMax",null),Object(y.a)([Object(I.a)("max")],ge.prototype,"writeMax",null),Object(y.a)([Object(_.b)({type:Date,json:{type:Number,write:!0}})],ge.prototype,"min",void 0),Object(y.a)([Object(w.a)("min")],ge.prototype,"readMin",null),Object(y.a)([Object(I.a)("min")],ge.prototype,"writeMin",null),Object(y.a)([Object(_.b)({type:["datetime-picker"],json:{read:!1,write:!0}})],ge.prototype,"type",void 0);var _e,Oe=ge=ye=Object(y.a)([Object(F.a)("esri.form.elements.inputs.DateTimePickerInput")],ge),je=_e=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).type="radio-buttons",n}return Object(c.a)(r,[{key:"clone",value:function(){return new _e}}]),r}(ce);Object(y.a)([Object(_.b)({type:["radio-buttons"],json:{read:!1,write:!0}})],je.prototype,"type",void 0);var we,Se=je=_e=Object(y.a)([Object(F.a)("esri.form.elements.inputs.RadioButtonsInput")],je),Fe=we=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).maxLength=null,n.minLength=0,n.type=null,n}return Object(c.a)(r,[{key:"clone",value:function(){return new we({maxLength:this.maxLength,minLength:this.minLength,type:this.type})}}]),r}(ce);Object(y.a)([Object(_.b)({type:Number,json:{write:!0}})],Fe.prototype,"maxLength",void 0),Object(y.a)([Object(_.b)({type:Number,json:{default:0,write:!0}})],Fe.prototype,"minLength",void 0),Object(y.a)([Object(_.b)()],Fe.prototype,"type",void 0);var Ie=Fe=we=Object(y.a)([Object(F.a)("esri.form.elements.inputs.support.TextInput")],Fe),ke=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).type="text-area",n}return r}(Ie);Object(y.a)([Object(_.b)({type:["text-area"],json:{read:!1,write:!0}})],ke.prototype,"type",void 0);var xe=ke=Object(y.a)([Object(F.a)("esri.form.elements.inputs.TextAreaInput")],ke),Te=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).type="text-box",n}return r}(Ie);Object(y.a)([Object(_.b)({type:["text-box"],json:{read:!1,write:!0}})],Te.prototype,"type",void 0);var Ee,Ce={base:ce,key:"type",typeMap:{"barcode-scanner":pe,"combo-box":ve,"datetime-picker":Oe,"radio-buttons":Se,"text-area":xe,"text-box":Te=Object(y.a)([Object(F.a)("esri.form.elements.inputs.TextBoxInput")],Te)}},De=Ee=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).domain=null,n.editable=!0,n.fieldName=null,n.hint=null,n.input=null,n.requiredExpression=null,n.type="field",n}return Object(c.a)(r,[{key:"clone",value:function(){return new Ee({description:this.description,domain:this.domain,editable:this.editable,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,visibilityExpression:this.visibilityExpression})}}]),r}(te);Object(y.a)([Object(_.b)({types:ue.d,json:{read:{reader:ue.b},write:!0}})],De.prototype,"domain",void 0),Object(y.a)([Object(_.b)({type:Boolean,json:{default:!0,write:!0}})],De.prototype,"editable",void 0),Object(y.a)([Object(_.b)({type:String,json:{write:!0}})],De.prototype,"fieldName",void 0),Object(y.a)([Object(_.b)({type:String,json:{write:!0}})],De.prototype,"hint",void 0),Object(y.a)([Object(_.b)({types:Ce,json:{read:{source:"inputType"},write:{target:"inputType"}}})],De.prototype,"input",void 0),Object(y.a)([Object(_.b)({type:String,json:{write:!0}})],De.prototype,"requiredExpression",void 0),Object(y.a)([Object(_.b)({type:String,json:{read:!1,write:!0}})],De.prototype,"type",void 0);var Ne,Re=De=Ee=Object(y.a)([Object(F.a)("esri.form.elements.FieldElement")],De),Ae=r(390),Pe=Ne=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).displayCount=null,n.displayType="list",n.editable=!0,n.orderByFields=null,n.relationshipId=null,n.type="relationship",n}return Object(c.a)(r,[{key:"clone",value:function(){return new Ne({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:Object(Y.a)(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}}]),r}(te);Object(y.a)([Object(_.b)({type:Number,json:{write:!0}})],Pe.prototype,"displayCount",void 0),Object(y.a)([Object(_.b)({type:["list"],json:{write:!0}})],Pe.prototype,"displayType",void 0),Object(y.a)([Object(_.b)({type:Boolean,json:{default:!0,write:!0}})],Pe.prototype,"editable",void 0),Object(y.a)([Object(_.b)({type:[Ae.a],json:{write:!0}})],Pe.prototype,"orderByFields",void 0),Object(y.a)([Object(_.b)({type:Number,json:{write:!0}})],Pe.prototype,"relationshipId",void 0),Object(y.a)([Object(_.b)({type:["relationship"],json:{read:!1,write:!0}})],Pe.prototype,"type",void 0);var Le,Me=Pe=Ne=Object(y.a)([Object(F.a)("esri.form.elements.RelationshipElement")],Pe);function Ge(e){return{typesWithGroup:{base:te,key:"type",typeMap:{attachment:se,field:Re,group:e,relationship:Me}},typesWithoutGroup:{base:te,key:"type",typeMap:{attachment:se,field:Re,relationship:Me}}}}function Be(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e)return null;var n=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((function(e){return n[e.type]})).map((function(e){return n[e.type].fromJSON(e)}))}function qe(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e)return null;var n=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((function(e){return n[e.type]})).map((function(e){return e.toJSON()}))}function Ue(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e?e.map((function(e){return Object($.k)(r?t.typesWithGroup:t.typesWithoutGroup,e)})):null}var Ve=Le=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).elements=null,n.initialState="expanded",n.type="group",n}return Object(c.a)(r,[{key:"castElements",value:function(e){return Ue(e,Je,!1)}},{key:"readElements",value:function(e,t){return Be(t.formElements,Je,!1)}},{key:"writeElements",value:function(e,t){t.formElements=qe(e,Je,!1)}},{key:"clone",value:function(){return new Le({description:this.description,elements:Object(Y.a)(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}}]),r}(te);Object(y.a)([Object(_.b)({json:{write:!0}})],Ve.prototype,"elements",void 0),Object(y.a)([Object(O.a)("elements")],Ve.prototype,"castElements",null),Object(y.a)([Object(w.a)("elements",["formElements"])],Ve.prototype,"readElements",null),Object(y.a)([Object(I.a)("elements")],Ve.prototype,"writeElements",null),Object(y.a)([Object(_.b)({type:["collapsed","expanded"],json:{default:"expanded",write:!0}})],Ve.prototype,"initialState",void 0),Object(y.a)([Object(_.b)({type:String,json:{read:!1,write:!0}})],Ve.prototype,"type",void 0);var We,Je=Ge(Ve=Le=Object(y.a)([Object(F.a)("esri.form.elements.GroupElement")],Ve)),ze=Ge(Ve),Qe=We=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).description=null,n.elements=null,n.expressionInfos=null,n.title=null,n}return Object(c.a)(r,[{key:"castElements",value:function(e){return Ue(e,ze)}},{key:"readElements",value:function(e,t){return Be(t.formElements,ze)}},{key:"writeElements",value:function(e,t){t.formElements=qe(e,ze)}},{key:"clone",value:function(){return new We({description:this.description,expressionInfos:Object(Y.a)(this.expressionInfos),elements:Object(Y.a)(this.elements),title:this.title})}}]),r}(K.a);Object(y.a)([Object(_.b)({type:String,json:{write:!0}})],Qe.prototype,"description",void 0),Object(y.a)([Object(_.b)({json:{write:!0}})],Qe.prototype,"elements",void 0),Object(y.a)([Object(O.a)("elements")],Qe.prototype,"castElements",null),Object(y.a)([Object(w.a)("elements",["formElements"])],Qe.prototype,"readElements",null),Object(y.a)([Object(I.a)("elements")],Qe.prototype,"writeElements",null),Object(y.a)([Object(_.b)({type:[ee],json:{write:!0}})],Qe.prototype,"expressionInfos",void 0),Object(y.a)([Object(_.b)({type:String,json:{write:!0}})],Qe.prototype,"title",void 0);var He=Qe=We=Object(y.a)([Object(F.a)("esri.form.FormTemplate")],Qe),Ye=r(363);var Ke,$e=r(82),Ze=r(198),Xe=(r(77),r(213)),et=r(136),tt=r(75),rt=r(384),nt=r(312),at=r(391),it=0,st=g.a.getLogger("esri.layers.graphics.sources.MemorySource"),ut=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e))._idToClientGraphic=null,n.type="memory",n}return Object(c.a)(r,[{key:"load",value:function(e){var t=Object(m.i)(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Object(T.u)(this)}},{key:"destroy",value:function(){var e;null==(e=this._connection)||e.close(),this._connection=null}},{key:"workerGeometryType",get:function(){var e=this.layer&&this.layer.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}},{key:"applyEdits",value:function(e){var t=this;return this.load().then((function(){return t._applyEdits(e)}))}},{key:"openPorts",value:function(){var e=this;return this.load().then((function(){return e._connection.openPorts()}))}},{key:"queryFeatures",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var r,n,i,u,l,o,c,d,f,p=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.length>1&&void 0!==p[1]?p[1]:{},e.next=3,this.load(r);case 3:return e.next=5,this._connection.invoke("queryFeatures",t?t.toJSON():null,r);case 5:if(n=e.sent,Object(at.a)(t,this.layer.spatialReference,n),i=Ye.default.fromJSON(n),this._requiresClientGraphicMapping()){e.next=10;break}return e.abrupt("return",i);case 10:u=this.layer.objectIdField,l=Object(a.a)(i.features);try{for(l.s();!(o=l.n()).done;)c=o.value,d=c.attributes[u],(f=this._idToClientGraphic.get(d))&&(c.geometry=f.geometry)}catch(s){l.e(s)}finally{l.f()}return e.abrupt("return",(i.geometryType=this.layer.geometryType,i));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryFeaturesJSON",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var r,n,a=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>1&&void 0!==a[1]?a[1]:{},!this._requiresClientGraphicMapping()){e.next=3;break}return e.abrupt("return",Object(T.t)(new k.a("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)")));case 3:return e.next=5,this.load(r);case 5:return e.next=7,this._connection.invoke("queryFeatures",t?t.toJSON():null,r);case 7:return n=e.sent,e.abrupt("return",(Object(at.a)(t,this.layer.spatialReference,n),n));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.load(r).then((function(){return t._connection.invoke("queryFeatureCount",e?e.toJSON():null,r)}))}},{key:"queryObjectIds",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.load(r).then((function(){return t._connection.invoke("queryObjectIds",e?e.toJSON():null,r)}))}},{key:"queryExtent",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.load(r).then((function(){return t._connection.invoke("queryExtent",e?e.toJSON():null,r)})).then((function(e){return{count:e.count,extent:C.a.fromJSON(e.extent)}}))}},{key:"_applyEdits",value:function(e){var t=this;if(!this._connection)throw new k.a("feature-layer-source:edit-failure","Memory source not loaded");var r=this.layer.objectIdField,n=null,i=[],s=[],u=function(e){return"objectId"in e&&null!=e.objectId?e.objectId:"attributes"in e&&null!=e.attributes[r]?e.attributes[r]:null};if(e.addFeatures&&(n=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures){var l,o=Object(a.a)(e.deleteFeatures);try{for(o.s();!(l=o.n()).done;){var c=u(l.value);null!=c&&i.push(c)}}catch(v){o.e(v)}finally{o.f()}}var d=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){var f,p=Object(a.a)(e.updateFeatures);try{for(p.s();!(f=p.n()).done;){var h=f.value;if(s.push(this._serializeFeature(h)),d){var y=u(h);null!=y&&d.set(y,h)}}}catch(v){p.e(v)}finally{p.f()}}return Object(nt.b)(n?n.features:null,s,this.layer.spatialReference),this._connection.invoke("applyEdits",{adds:n?n.features:[],updates:s,deletes:i}).then((function(e){var r=e.fullExtent,i=e.featureEditResults;if(t.fullExtent=r,n&&n.finish(i.uidToObjectId),t._idToClientGraphic){if(d){var s,u=Object(a.a)(i.updateResults);try{for(u.s();!(s=u.n()).done;){var l=s.value;if(l.success){var o=d.get(l.objectId);null!=o&&t._addIdToClientGraphic(o)}}}catch(v){u.e(v)}finally{u.f()}}var c,f=Object(a.a)(i.deleteResults);try{for(f.s();!(c=f.n()).done;){var p=c.value;p.success&&t._idToClientGraphic.delete(p.objectId)}}catch(v){f.e(v)}finally{f.f()}}return t._createEditsResult(i)}))}},{key:"_createEditsResult",value:function(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}},{key:"_createFeatureEditResult",value:function(e){var t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new k.a("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}},{key:"_prepareAddFeatures",value:function(e){for(var t=new Map,r=new Array(e.length),n=null,a=0;a<e.length;a++){var i=e[a],s=this._serializeFeature(i);!n&&Object(m.i)(i.geometry)&&(n=i.geometry.type),r[a]=s,t.set("".concat(s.uid),i)}var u=this;return{features:r,inferredGeometryType:n,finish:function(e){var r=u.sourceJSON.objectIdField;for(var n in e){var a=e[n],i=t.get(n);i&&(i.attributes||(i.attributes={}),-1===a?delete i.attributes[r]:i.attributes[r]=a,u._addIdToClientGraphic(i))}}}}},{key:"_addIdToClientGraphic",value:function(e){if(this._idToClientGraphic){var t=this.sourceJSON.objectIdField,r=e.attributes&&e.attributes[t];null!=r&&this._idToClientGraphic.set(r,e)}}},{key:"_requiresClientGraphicMapping",value:function(){var e=this.layer.geometryType||this.sourceJSON.geometryType;return this._geometryTypeRequiresClientGraphicMapping(e)}},{key:"_geometryRequiresClientGraphicMapping",value:function(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}},{key:"_geometryTypeRequiresClientGraphicMapping",value:function(e){return"mesh"===e||"multipatch"===e||"extent"===e}},{key:"_serializeFeature",value:function(e){var t=e.attributes,r=this._geometryForSerialization(e),n=(it++).toString();return r?{uid:n,geometry:r.toJSON(),attributes:t}:{uid:n,attributes:t}}},{key:"_geometryForSerialization",value:function(e){var t=e.geometry;return Object(m.h)(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?$e.a.fromExtent(t.extent):null:t}},{key:"_startWorker",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var r,n,i,u,l,o,c,d,f,p,h,y,b,m,g;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(rt.b)("MemorySourceWorker",{strategy:Object(v.a)("feature-layers-workers")?"dedicated":"local",signal:t});case 2:return this._connection=e.sent,r=this.layer,n=r.fields,i=r.spatialReference,u=r.objectIdField,l=r.hasM,o=r.hasZ,c=r.timeInfo,d="defaults"===this.layer.originOf("spatialReference"),f=this._prepareAddFeatures(this.items),this.on("before-changes",(function(e){st.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),e.preventDefault()})),p={features:f.features,fields:n&&n.map((function(e){return e.toJSON()})),geometryType:Ze.c.toJSON(this.workerGeometryType),hasM:l,hasZ:o,objectIdField:u,spatialReference:d?null:i&&i.toJSON(),timeInfo:c?c.toJSON():null},e.next=8,this._connection.invoke("load",p,{signal:t});case 8:h=e.sent,y=Object(a.a)(h.warnings);try{for(y.s();!(b=y.n()).done;)m=b.value,st.warn(m.message,{layer:this.layer,warning:m})}catch(s){y.e(s)}finally{y.f()}h.featureErrors.length&&st.warn("Encountered ".concat(h.featureErrors.length," validation errors while loading features"),h.featureErrors),g=h.layerDefinition,this._geometryTypeRequiresClientGraphicMapping(f.inferredGeometryType)&&(g.geometryType=Ze.c.toJSON(f.inferredGeometryType)),"mesh"!==g.geometryType&&"mesh"!==this.layer.geometryType||(g.hasZ=!0),this.sourceJSON=g,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),f.finish(h.assignedObjectIds);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(et.a.LoadableMixin(Object(Xe.b)(D.a)));Object(y.a)([(Ke={Type:tt.a,ensureType:Object($.m)(tt.a)},function(e,t){e[t]=Ke})],ut.prototype,"itemType",void 0),Object(y.a)([Object(_.b)()],ut.prototype,"type",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],ut.prototype,"layer",void 0),Object(y.a)([Object(_.b)({readOnly:!0,dependsOn:["layer.geometryType"]})],ut.prototype,"workerGeometryType",null),Object(y.a)([Object(_.b)()],ut.prototype,"sourceJSON",void 0);var lt,ot=ut=Object(y.a)([Object(F.a)("esri.layers.graphics.sources.MemorySource")],ut),ct=r(867),dt=r(381),ft=r(846),pt=r(803),ht=r(802),yt=r(380),vt=r(808),bt=r(826),mt=lt=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){return Object(o.a)(this,r),t.call(this,e)}return Object(c.a)(r,[{key:"clone",value:function(){var e=this.name,t=this.fields,r=this.isAscending,n=this.isUnique,a=this.description;return new lt({name:e,fields:t,isAscending:r,isUnique:n,description:a})}}]),r}(K.a);Object(y.a)([Object(_.b)({constructOnly:!0})],mt.prototype,"name",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],mt.prototype,"fields",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],mt.prototype,"isAscending",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],mt.prototype,"isUnique",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],mt.prototype,"description",void 0);mt=lt=Object(y.a)([Object(F.a)("esri.layers.support.FeatureIndex")],mt);var gt=r(801),_t=r(794),Ot=r(819),jt=r(818),wt=r(872),St=r(817),Ft=r(837),It=r(859),kt=r(864),xt=new j.a({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Tt=new j.a({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"}),Et=function(e){Object(p.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).cardinality=null,n.composite=null,n.id=null,n.keyField=null,n.keyFieldInRelationshipTable=null,n.name=null,n.relatedTableId=null,n.relationshipTableId=null,n.role=null,n}return r}(K.a);Object(y.a)([Object(_.b)({json:{read:xt.read,write:xt.write}})],Et.prototype,"cardinality",void 0),Object(y.a)([Object(_.b)({json:{read:!0,write:!0}})],Et.prototype,"composite",void 0),Object(y.a)([Object(_.b)({json:{read:!0,write:!0}})],Et.prototype,"id",void 0),Object(y.a)([Object(_.b)({json:{read:!0,write:!0}})],Et.prototype,"keyField",void 0),Object(y.a)([Object(_.b)({json:{read:!0,write:!0}})],Et.prototype,"keyFieldInRelationshipTable",void 0),Object(y.a)([Object(_.b)({json:{read:!0,write:!0}})],Et.prototype,"name",void 0),Object(y.a)([Object(_.b)({json:{read:!0,write:!0}})],Et.prototype,"relatedTableId",void 0),Object(y.a)([Object(_.b)({json:{read:!0,write:!0}})],Et.prototype,"relationshipTableId",void 0),Object(y.a)([Object(_.b)({json:{read:Tt.read,write:Tt.write}})],Et.prototype,"role",void 0);var Ct=Et=Object(y.a)([Object(F.a)("esri.layers.support.Relationship")],Et),Dt=r(236),Nt=r(836),Rt=r(813),At=r(285),Pt=r(278),Lt=r(364),Mt=new j.a({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Gt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},Bt="FeatureLayer",qt=g.a.getLogger("esri.layers.FeatureLayer");function Ut(e){return e&&e instanceof D.a}function Vt(e,t,r){return!!(e&&e.hasOwnProperty(t)?e[t]:r)}function Wt(e,t,r){return e&&e.hasOwnProperty(t)?e[t]:r}var Jt=Object(It.a)();function zt(e,t,r){var n=!(null==r||!r.writeLayerSchema);return{enabled:n,ignoreOrigin:n}}var Qt=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a)))._handles=new L.a,e.capabilities=null,e.charts=null,e.copyright=null,e.displayField=null,e.definitionExpression=null,e.dynamicDataSource=null,e.editFieldsInfo=null,e.editingEnabled=!0,e.editingInfo=null,e.elevationInfo=null,e.featureReduction=null,e.fields=null,e.formTemplate=null,e.fullExtent=null,e.gdbVersion=null,e.geometryProperties=null,e.geometryType=null,e.hasM=void 0,e.hasZ=void 0,e.heightModelInfo=null,e.historicMoment=null,e.isTable=!1,e.labelsVisible=!0,e.labelingInfo=null,e.layerId=void 0,e.legendEnabled=!0,e.minScale=0,e.maxScale=0,e.globalIdField=null,e.objectIdField=null,e.outFields=null,e.path=null,e.popupEnabled=!0,e.popupTemplate=null,e.relationships=null,e.sourceJSON=null,e.returnM=void 0,e.returnZ=void 0,e.screenSizePerspectiveEnabled=!0,e.serviceDefinitionExpression=null,e.spatialReference=E.a.WGS84,e.templates=null,e.timeInfo=null,e.title=null,e.sublayerTitleMode="item-title",e.trackIdField=null,e.type="feature",e.typeIdField=null,e.types=null,e.indexes=new(D.a.ofType(mt)),e.userIsAdmin=!1,e.version=void 0,e.visible=!0,e}return Object(c.a)(n,[{key:"destroy",value:function(){var e;null==(e=this.source)||e.destroy(),this._handles&&(this._handles.destroy(),this._handles=null)}},{key:"normalizeCtorArgs",value:function(e,t){return"string"==typeof e?Object(l.a)({url:e},t):e}},{key:"load",value:function(e){var t=this,r=Object(m.i)(e)?e.signal:null;if(!(this.portalItem&&this.portalItem.loaded&&this.source)){var n=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch((function(e){return e})).then(Object(u.a)(s.a.mark((function e(){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.url||null!=t.layerId||!/FeatureServer|MapServer\/*$/i.test(t.url)){e.next=5;break}return e.next=3,t._fetchFirstLayerId(r);case 3:null!=(n=e.sent)&&(t.layerId=n);case 5:if(t.url||t._hasMemorySource()){e.next=7;break}throw new k.a("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");case 7:return e.t0=t,e.next=10,t.createGraphicsSource(r);case 10:return e.t1=e.sent,e.abrupt("return",e.t0._initLayerProperties.call(e.t0,e.t1));case 12:case"end":return e.stop()}}),e)}))));return this.addResolvingPromise(n),Object(T.u)(this)}this.addResolvingPromise(this.createGraphicsSource(r).then((function(e){return t._initLayerProperties(e)})))}},{key:"readCapabilities",value:function(e,t){return t=t.layerDefinition||t,{attachment:this._readAttachmentCapabilities(t.attachmentProperties),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),editing:this._readEditingCapabilities(t)}}},{key:"createQueryVersion",get:function(){return this.definitionExpression,this.dynamicDataSource,this.timeExtent,this.timeOffset,this.geometryType,this.gdbVersion,this.historicMoment,this.returnZ,this.capabilities,this.returnM,(this._get("createQueryVersion")||0)+1}},{key:"readEditingEnabled",value:function(e,t){return this._readEditingEnabled(t,!1)}},{key:"readEditingEnabledFromWebMap",value:function(e,t,r){return this._readEditingEnabled(t,!0,r)}},{key:"writeEditingEnabled",value:function(e,t){this._writeEditingEnabled(e,t,!1)}},{key:"writeEditingEnabledToWebMap",value:function(e,t,r,n){this._writeEditingEnabled(e,t,!0,n)}},{key:"readEditingInfo",value:function(e,t){var r=t.editingInfo;return r?{lastEditDate:null!=r.lastEditDate?new Date(r.lastEditDate):null}:null}},{key:"readFeatureReduction",value:function(e,t){return Object(wt.a)(e,t)}},{key:"writeWebSceneFeatureReduction",value:function(e,t,r,n){Object(wt.c)(e,t,"layerDefinition.featureReduction",n)}},{key:"fieldsIndex",get:function(){return new H.a(this.fields||[])}},{key:"readIsTable",value:function(e,t){return"Table"===(t=t&&t.layerDefinition||t).type||!t.geometryType}},{key:"writeIsTable",value:function(e,t,r,n){null!=n&&n.writeLayerSchema&&Object(b.c)(r,e?"Table":"Feature Layer",t)}},{key:"readMinScale",value:function(e,t){return t.effectiveMinScale||e||0}},{key:"readMaxScale",value:function(e,t){return t.effectiveMaxScale||e||0}},{key:"readGlobalIdFieldFromService",value:function(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){var r,n=Object(a.a)(t.fields);try{for(n.s();!(r=n.n()).done;){var i=r.value;if("esriFieldTypeGlobalID"===i.type)return i.name}}catch(s){n.e(s)}finally{n.f()}}}},{key:"readObjectIdFieldFromService",value:function(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields){var r,n=Object(a.a)(t.fields);try{for(n.s();!(r=n.n()).done;){var i=r.value;if("esriFieldTypeOID"===i.type)return i.name}}catch(s){n.e(s)}finally{n.f()}}}},{key:"parsedUrl",get:function(){var e=this.url?Object(x.I)(this.url):null;return null!=e&&(null!=this.dynamicDataSource?e.path=Object(x.x)(e.path,"dynamicLayer"):null!=this.layerId&&(e.path=Object(x.x)(e.path,this.layerId.toString()))),e}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(e){Object(N.j)(e,this.fields),this._set("renderer",e)}},{key:"readRenderer",value:function(e,t,r){var n=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(n){var a=Object(Q.b)(n,t,r)||void 0;return a||qt.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:r}),a}if(t.defaultSymbol)return t.types&&t.types.length?new W.a({defaultSymbol:Ht(t.defaultSymbol,t,r),field:t.typeIdField,uniqueValueInfos:t.types.map((function(e){return{id:e.id,symbol:Ht(e.symbol,e,r)}}))}):new J.a({symbol:Ht(t.defaultSymbol,t,r)})}},{key:"source",set:function(e){var t=this._get("source");t!==e&&(Ut(t)&&this._resetMemorySource(t),Ut(e)&&this._initMemorySource(e),this._set("source",e))}},{key:"castSource",value:function(e){return e?Array.isArray(e)||e instanceof D.a?new ot({layer:this,items:e}):e:null}},{key:"readSource",value:function(e,t){var r=Ye.default.fromJSON(t.featureSet);return new ot({layer:this,items:r&&r.features||[]})}},{key:"readServiceDefinitionExpression",value:function(e,t){return t.definitionQuery||t.definitionExpression}},{key:"readTemplates",value:function(e,t){var r=t.editFieldsInfo,n=r&&r.creatorField,a=r&&r.editorField;return e=e&&e.map((function(e){return St.a.fromJSON(e)})),this._fixTemplates(e,n),this._fixTemplates(e,a),e}},{key:"readTitle",value:function(e,t){var r=t.layerDefinition&&t.layerDefinition.name||t.name,n=t.title||t.layerDefinition&&t.layerDefinition.title;if(r){var a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return this.url?Object(B.h)(this.url,r):r;var i=r;if(!i&&this.url){var s=Object(B.e)(this.url);Object(m.i)(s)&&(i=s.title)}if(!i)return;return"item-title-and-service-name"===this.sublayerTitleMode&&a&&a!==i&&(i=a+" - "+i),Object(B.a)(i)}if("item-title"===this.sublayerTitleMode&&n)return n}},{key:"readTitleFromWebMap",value:function(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}},{key:"readTypeIdField",value:function(e,t){var r=(t=t.layerDefinition||t).typeIdField;if(r){var n=Object(N.n)(t.fields,r);n&&(r=n.name)}return r}},{key:"readTypes",value:function(e,t){var r=this;e=(t=t.layerDefinition||t).types;var n=t.editFieldsInfo,a=n&&n.creatorField,i=n&&n.editorField;return e&&e.map((function(e){return e=Ft.a.fromJSON(e),r._fixTemplates(e.templates,a),r._fixTemplates(e.templates,i),e}))}},{key:"url",set:function(e){var t=Object(B.g)(this,e,qt);this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)}},{key:"writeUrl",value:function(e,t,r,n){Object(B.i)(this,e,null,t,n)}},{key:"readVersion",value:function(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}},{key:"readVisible",value:function(e,t){return t.layerDefinition&&null!=t.layerDefinition.defaultVisibility?!!t.layerDefinition.defaultVisibility:null!=t.visibility?!!t.visibility:void 0}},{key:"addAttachment",value:function(e,t){var r=this;return this.load().then((function(){return r._checkAttachmentSupport(e)})).then((function(){if(!("addAttachment"in r.source))throw new k.a(Bt,"Layer source does not support addAttachment capability");return r.source.addAttachment(e,t)}))}},{key:"updateAttachment",value:function(e,t,r){var n=this;return this.load().then((function(){return n._checkAttachmentSupport(e)})).then((function(){if(!("updateAttachment"in n.source))throw new k.a(Bt,"Layer source does not support updateAttachment capability");return n.source.updateAttachment(e,t,r)}))}},{key:"applyEdits",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(37).then(r.bind(null,1285));case 2:return a=e.sent,e.next=5,this.load();case 5:return e.abrupt("return",a.applyEdits(this,this.source,t,n));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"on",value:function(e,t){return Object(d.a)(Object(f.a)(n.prototype),"on",this).call(this,e,t)}},{key:"createPopupTemplate",value:function(e){return Object(Rt.a)(this,e)}},{key:"createGraphicsSource",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._hasMemorySource()){e.next=2;break}return e.abrupt("return",(this.emit("graphics-source-create",{graphicsSource:this.source}),this.source.load({signal:t})));case 2:return e.next=4,r.e(139).then(r.bind(null,1286));case 4:return n=e.sent,Object(T.w)(t),e.next=8,new n.default({layer:this}).load({signal:t});case 8:return a=e.sent,e.abrupt("return",(this.emit("graphics-source-create",{graphicsSource:a}),a));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createQuery",value:function(){var e=new Pt.a,t=this.get("capabilities.data");e.dynamicDataSource=this.dynamicDataSource,e.gdbVersion=this.gdbVersion,e.historicMoment=this.historicMoment,e.returnGeometry=!0,t&&(t.supportsZ&&null!=this.returnZ&&(e.returnZ=this.returnZ),t.supportsM&&null!=this.returnM&&(e.returnM=this.returnM)),e.outFields=["*"],e.where=this.definitionExpression||"1=1";var r=this.timeOffset,n=this.timeExtent;return e.timeExtent=null!=r&&null!=n?n.offset(-r.value,r.unit):n||null,e.multipatchOption="multipatch"===this.geometryType?"xyFootprint":null,e}},{key:"deleteAttachments",value:function(e,t){var r=this;return this.load().then((function(){return r._checkAttachmentSupport(e)})).then((function(){if(!("deleteAttachments"in r.source))throw new k.a(Bt,"Layer source does not support deleteAttachments capability");return r.source.deleteAttachments(e,t)}))}},{key:"fetchRecomputedExtents",value:function(e){var t=this;return this.load({signal:null==e?void 0:e.signal}).then((function(){if(t.source.fetchRecomputedExtents)return t.source.fetchRecomputedExtents(e);throw new k.a(Bt,"Layer source does not support fetchUpdates capability")}))}},{key:"getFeatureType",value:function(e){var t=this.typeIdField,r=this.types;if(!t||!e)return null;var n=e.attributes?e.attributes[t]:void 0;if(null==n)return null;var a=null;return r.some((function(e){var t=e.id;return null!=t&&(t.toString()===n.toString()&&(a=e),!!a)})),a}},{key:"getFieldDomain",value:function(e,t){var r=t&&t.feature,n=this.getFeatureType(r);if(n){var a=n.domains&&n.domains[e];if(a&&"inherited"!==a.type)return a}return this._getLayerDomain(e)}},{key:"getField",value:function(e){return this.fieldsIndex.get(e)}},{key:"queryAttachments",value:function(e,t){var r=this;return e=At.a.from(e),this.load().then((function(){if(!r.get("capabilities.data.supportsAttachment"))throw new k.a(Bt,"this layer doesn't support attachments");var t=e,n=t.attachmentTypes,a=t.objectIds,i=t.globalIds,s=t.num,u=t.size,l=t.start,o=t.where;if(!r.get("capabilities.operations.supportsQueryAttachments")){var c=a&&a.length>1,d=n&&n.length,f=i&&i.length,p=u&&u.length;if(c||d||f||p||s||l||o)throw new k.a(Bt,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(a&&a.length||o))throw new k.a(Bt,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in r.source))throw new k.a(Bt,"Layer source does not support queryAttachments capability",e);return r.source.queryAttachments(e)}))}},{key:"queryFeatures",value:function(e,t){var r=this;return this.load().then((function(){return r.source.queryFeatures(Pt.a.from(e)||r.createQuery(),t)})).then((function(e){if(e&&e.features){var t,n=Object(a.a)(e.features);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.layer=i.sourceLayer=r}}catch(s){n.e(s)}finally{n.f()}}return e}))}},{key:"queryObjectIds",value:function(e,t){var r=this;return this.load().then((function(){if(r.source.queryObjectIds)return r.source.queryObjectIds(Pt.a.from(e)||r.createQuery(),t);throw new k.a(Bt,"Layer source does not support queryObjectIds capability")}))}},{key:"queryFeatureCount",value:function(e,t){var r=this;return this.load().then((function(){if(r.source.queryFeatureCount)return r.source.queryFeatureCount(Pt.a.from(e)||r.createQuery(),t);throw new k.a(Bt,"Layer source does not support queryFeatureCount capability")}))}},{key:"queryExtent",value:function(e,t){var r=this;return this.load().then((function(){if(r.source.queryExtent)return r.source.queryExtent(Pt.a.from(e)||r.createQuery(),t);throw new k.a(Bt,"Layer source does not support queryExtent capability")}))}},{key:"queryRelatedFeatures",value:function(e,t){var r=this;return this.load().then((function(){if("queryRelatedFeatures"in r.source)return r.source.queryRelatedFeatures(Lt.a.from(e),t);throw new k.a(Bt,"Layer source does not support queryRelatedFeatures capability")}))}},{key:"queryRelatedFeaturesCount",value:function(e,t){var r=this;return this.load().then((function(){if("queryRelatedFeaturesCount"in r.source)return r.source.queryRelatedFeaturesCount(Lt.a.from(e),t);throw new k.a(Bt,"Layer source does not support queryRelatedFeaturesCount capability")}))}},{key:"read",value:function(e,t){var r=e.featureCollection;if(r){var a=r.layers;a&&1===a.length&&(Object(d.a)(Object(f.a)(n.prototype),"read",this).call(this,a[0],t),null!=r.showLegend&&Object(d.a)(Object(f.a)(n.prototype),"read",this).call(this,{showLegend:r.showLegend},t))}Object(d.a)(Object(f.a)(n.prototype),"read",this).call(this,e,t),t&&"service"===t.origin&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}},{key:"write",value:function(e,t){var r,a,i=(t=Object(l.a)(Object(l.a)({},t),{},{writeLayerSchema:null!=(r=null==(a=t)?void 0:a.writeLayerSchema)?r:this._hasMemorySource()})).origin,s=t.layerContainerType,u=t.messages;if(this.isTable){if("web-scene"===i||"web-map"===i&&"tables"!==s)return u&&u.push(new k.a("layer:unsupported","Layer (".concat(this.title,", ").concat(this.id,") of type '").concat(this.declaredClass,"' using a Table source cannot be written to web scenes and web maps"),{layer:this})),null;if(this._hasMemorySource())return u&&u.push(new k.a("layer:unsupported","Layer (".concat(this.title,", ").concat(this.id,") of type '").concat(this.declaredClass,"' using an in-memory Table source cannot be written to web scenes and web maps"),{layer:this})),null}else if(this.loaded&&"web-map"===i&&"tables"===s)return u&&u.push(new k.a("layer:unsupported","Layer (".concat(this.title,", ").concat(this.id,") of type '").concat(this.declaredClass,"' using a non-table source cannot be written to tables in web maps"),{layer:this})),null;return Object(d.a)(Object(f.a)(n.prototype),"write",this).call(this,e,t)}},{key:"_readEditingEnabled",value:function(e,t,r){var n,a=null==(n=e.layerDefinition)?void 0:n.capabilities;return a?this._hasEditingCapability(a):(a=e.capabilities,!(t&&"web-map"===(null==r?void 0:r.origin)&&!this._hasMemorySource()&&a)||this._hasEditingCapability(a))}},{key:"_hasEditingCapability",value:function(e){return e.toLowerCase().split(",").map((function(e){return e.trim()})).includes("editing")}},{key:"_writeEditingEnabled",value:function(e,t,r,n){e||(Object(b.c)("layerDefinition.capabilities","Query",t),!r||null!=n&&n.writeLayerSchema||(t.capabilities="Query"))}},{key:"_checkAttachmentSupport",value:function(e){var t=e.attributes,r=this.objectIdField;return this.get("capabilities.data.supportsAttachment")?e?t?t[r]?void 0:Object(T.t)(new k.a(Bt,"feature is missing the identifying attribute ".concat(r))):Object(T.t)(new k.a(Bt,"'attributes' are required on a feature to query attachments")):Object(T.t)(new k.a(Bt,"A feature is required to add/delete/update attachments")):Object(T.t)(new k.a(Bt,"this layer doesn't support attachments"))}},{key:"_getLayerDomain",value:function(e){var t=this.fieldsIndex.get(e);return t?t.domain:null}},{key:"_fetchFirstLayerId",value:function(e){return Object(A.default)(this.url,{query:Object(l.a)({f:"json"},this.customParameters),responseType:"json",signal:e}).then((function(e){var t=e.data;if(t)return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}))}},{key:"_initLayerProperties",value:function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this._set("source",t),t.sourceJSON&&(this.sourceJSON=t.sourceJSON,this.read(t.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Object(N.j)(this.renderer,this.fields),Object(N.k)(this.timeInfo,this.fields),Object(Nt.a)(this,{origin:"service"})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_verifyFields",value:function(){var e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||-1!==e.search(/\/FeatureServer\//i)||this.fields&&this.fields.some((function(e){return"geometry"===e.type}))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}},{key:"_fixTemplates",value:function(e,t){e&&e.forEach((function(e){var r=e.prototype&&e.prototype.attributes;r&&t&&delete r[t]}))}},{key:"_verifySource",value:function(){if(this._hasMemorySource()){if(this.url)throw new k.a("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new k.a("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}},{key:"_initMemorySource",value:function(e){var t=this;e.forEach((function(e){e.layer=t,e.sourceLayer=t})),this._handles.add([e.on("after-add",(function(e){e.item.layer=t,e.item.sourceLayer=t})),e.on("after-remove",(function(e){e.item.layer=null,e.item.sourceLayer=null}))],"fl-source")}},{key:"_resetMemorySource",value:function(e){e.forEach((function(e){e.layer=null,e.sourceLayer=null})),this._handles.remove("fl-source")}},{key:"_hasMemorySource",value:function(){return!(this.url||!this.source)}},{key:"_readAttachmentCapabilities",value:function(e){var t={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1};return e&&Array.isArray(e)&&e.forEach((function(e){var r=Gt[e.name];r&&(t[r]=!!e.isEnabled)})),t}},{key:"_readDataCapabilities",value:function(e){return{isVersioned:Vt(e,"isDataVersioned",!1),supportsAttachment:Vt(e,"hasAttachments",!1),supportsM:Vt(e,"hasM",!1),supportsZ:Vt(e,"hasZ",!1)}}},{key:"_readMetadataCapabilities",value:function(e){return{supportsAdvancedFieldProperties:Vt(e,"supportsFieldDescriptionProperty",!1)}}},{key:"_readOperationsCapabilities",value:function(e,t){var r=e?e.toLowerCase().split(",").map((function(e){return e.trim()})):[],n=-1!==r.indexOf("editing"),a=n&&-1!==r.indexOf("create"),i=n&&-1!==r.indexOf("delete"),s=n&&-1!==r.indexOf("update"),u=-1!==r.indexOf("changetracking");return n&&!(a||i||s)&&(a=i=s=!0),{supportsCalculate:Vt(t,"supportsCalculate",!1),supportsTruncate:Vt(t,"supportsTruncate",!1),supportsValidateSql:Vt(t,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:i,supportsEditing:n,supportsChangeTracking:u,supportsQuery:-1!==r.indexOf("query"),supportsQueryAttachments:Vt(t.advancedQueryCapabilities,"supportsQueryAttachments",!1),supportsResizeAttachments:Vt(t,"supportsAttachmentsResizing",!1),supportsSync:-1!==r.indexOf("sync"),supportsUpdate:s,supportsExceedsLimitStatistics:Vt(t,"supportsExceedsLimitStatistics",!1)}}},{key:"_readQueryCapabilities",value:function(e){var t=e.advancedQueryCapabilities,r=e.ownershipBasedAccessControlForFeatures,n=e.archivingInfo,a=(e.supportedQueryFormats||"").split(",").reduce((function(e,t){var r=t.toLowerCase().trim();return r&&e.add(r),e}),new Set);return{supportsStatistics:Vt(t,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:Vt(t,"supportsPercentileStatistics",!1),supportsCentroid:Vt(t,"supportsReturningGeometryCentroid",!1),supportsDistance:Vt(t,"supportsQueryWithDistance",!1),supportsDistinct:Vt(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:Vt(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Vt(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:Vt(t,"supportsHavingClause",!1),supportsOrderBy:Vt(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:Vt(t,"supportsPagination",!1),supportsQuantization:Vt(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Vt(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Vt(e,"supportsReturningQueryGeometry",!1),supportsResultType:Vt(t,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Vt(t,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Vt(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Vt(e,"useStandardizedQueries",!1),supportsQueryByOthers:Vt(r,"allowOthersToQuery",!0),supportsHistoricMoment:Vt(n,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a.has("pbf"),supportsDisjointSpatialRelationship:Vt(t,"supportsDisjointSpatialRel",!1),supportsCacheHint:Vt(t,"supportsQueryWithCacheHint",!1),maxRecordCountFactor:Wt(e,"maxRecordCountFactor",void 0),maxRecordCount:Wt(e,"maxRecordCount",void 0),standardMaxRecordCount:Wt(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:Wt(e,"tileMaxRecordCount",void 0)}}},{key:"_readQueryRelatedCapabilities",value:function(e){var t=e.advancedQueryCapabilities,r=Vt(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Vt(t,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r}}},{key:"_readEditingCapabilities",value:function(e){var t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Vt(e,"allowGeometryUpdates",!0),supportsGlobalId:Vt(e,"supportsApplyEditsWithGlobalIds",!1),supportsRollbackOnFailure:Vt(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Vt(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Vt(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Vt(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Vt(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Vt(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Vt(t,"allowOthersToUpdate",!0)}}}]),n}(Object(dt.a)(Object(bt.a)(Object(yt.a)(Object(ht.a)(Object(ct.a)(Object(V.a)(Object(pt.a)(Object(G.a)(Object(ft.a)(M.a))))))))));Object(y.a)([Object(_.b)({readOnly:!0,json:{read:!1}})],Qt.prototype,"capabilities",void 0),Object(y.a)([Object(w.a)("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],Qt.prototype,"readCapabilities",null),Object(y.a)([Object(_.b)({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Qt.prototype,"charts",void 0),Object(y.a)([Object(_.b)({readOnly:!0,dependsOn:["definitionExpression","dynamicDataSource","timeExtent","timeOffset","geometryType","gdbVersion","historicMoment","returnZ","capabilities","returnM"]})],Qt.prototype,"createQueryVersion",null),Object(y.a)([Object(_.b)({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],Qt.prototype,"copyright",void 0),Object(y.a)([Object(_.b)({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],Qt.prototype,"displayField",void 0),Object(y.a)([Object(_.b)({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],Qt.prototype,"definitionExpression",void 0),Object(y.a)([Object(_.b)({types:P.i,readOnly:!0})],Qt.prototype,"defaultSymbol",void 0),Object(y.a)([Object(_.b)({type:Dt.a})],Qt.prototype,"dynamicDataSource",void 0),Object(y.a)([Object(_.b)({readOnly:!0})],Qt.prototype,"editFieldsInfo",void 0),Object(y.a)([Object(_.b)({type:Boolean})],Qt.prototype,"editingEnabled",void 0),Object(y.a)([Object(w.a)(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Qt.prototype,"readEditingEnabled",null),Object(y.a)([Object(w.a)("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Qt.prototype,"readEditingEnabledFromWebMap",null),Object(y.a)([Object(I.a)(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Qt.prototype,"writeEditingEnabled",null),Object(y.a)([Object(I.a)("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Qt.prototype,"writeEditingEnabledToWebMap",null),Object(y.a)([Object(_.b)({readOnly:!0})],Qt.prototype,"editingInfo",void 0),Object(y.a)([Object(w.a)("editingInfo")],Qt.prototype,"readEditingInfo",null),Object(y.a)([Object(_.b)(U.b)],Qt.prototype,"elevationInfo",void 0),Object(y.a)([Object(_.b)({types:{key:"type",base:gt.a,typeMap:{selection:jt.a,cluster:Ot.a}},json:{write:{target:"layerDefinition.featureReduction"}}})],Qt.prototype,"featureReduction",void 0),Object(y.a)([Object(w.a)("featureReduction",["layerDefinition.featureReduction"])],Qt.prototype,"readFeatureReduction",null),Object(y.a)([Object(I.a)("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:wt.b}})],Qt.prototype,"writeWebSceneFeatureReduction",null),Object(y.a)([Object(_.b)(Object(l.a)(Object(l.a)({},Jt.fields),{},{json:{read:{source:"layerDefinition.fields"},origins:{service:{read:!0},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:zt}}}}}))],Qt.prototype,"fields",void 0),Object(y.a)([Object(_.b)({readOnly:!0,dependsOn:["fields"]})],Qt.prototype,"fieldsIndex",null),Object(y.a)([Object(_.b)({type:He,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Qt.prototype,"formTemplate",void 0),Object(y.a)([Object(_.b)({type:C.a,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],Qt.prototype,"fullExtent",void 0),Object(y.a)([Object(_.b)()],Qt.prototype,"gdbVersion",void 0),Object(y.a)([Object(_.b)({readOnly:!0})],Qt.prototype,"geometryProperties",void 0),Object(y.a)([Object(_.b)({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:Mt.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:zt,writer:function(e,t,r){var n=e?Mt.toJSON(e):null;n&&Object(b.c)(r,n,t)}}}},read:{source:"layerDefinition.geometryType",reader:Mt.read}}})],Qt.prototype,"geometryType",void 0),Object(y.a)([Object(_.b)({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],Qt.prototype,"hasM",void 0),Object(y.a)([Object(_.b)({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],Qt.prototype,"hasZ",void 0),Object(y.a)([Object(_.b)({readOnly:!0,type:q.a})],Qt.prototype,"heightModelInfo",void 0),Object(y.a)([Object(_.b)({type:Date})],Qt.prototype,"historicMoment",void 0),Object(y.a)([Object(_.b)({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],Qt.prototype,"id",void 0),Object(y.a)([Object(_.b)({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Qt.prototype,"isTable",void 0),Object(y.a)([Object(w.a)("service","isTable",["type","geometryType"]),Object(w.a)("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Qt.prototype,"readIsTable",null),Object(y.a)([Object(I.a)("web-map","isTable")],Qt.prototype,"writeIsTable",null),Object(y.a)([Object(_.b)(U.c)],Qt.prototype,"labelsVisible",void 0),Object(y.a)([Object(_.b)({type:[_t.a],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:kt.a},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:kt.a},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Qt.prototype,"labelingInfo",void 0),Object(y.a)([Object(_.b)(U.f)],Qt.prototype,"opacity",void 0),Object(y.a)([Object(_.b)({type:Number,json:{origins:{service:{read:{source:"id"}}},read:!1}})],Qt.prototype,"layerId",void 0),Object(y.a)([Object(_.b)(U.d)],Qt.prototype,"legendEnabled",void 0),Object(y.a)([Object(_.b)({type:["show","hide"]})],Qt.prototype,"listMode",void 0),Object(y.a)([Object(_.b)({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}})],Qt.prototype,"minScale",void 0),Object(y.a)([Object(w.a)("service","minScale",["minScale","effectiveMinScale"])],Qt.prototype,"readMinScale",null),Object(y.a)([Object(_.b)({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}})],Qt.prototype,"maxScale",void 0),Object(y.a)([Object(w.a)("service","maxScale",["maxScale","effectiveMaxScale"])],Qt.prototype,"readMaxScale",null),Object(y.a)([Object(_.b)({type:String})],Qt.prototype,"globalIdField",void 0),Object(y.a)([Object(w.a)("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),Object(w.a)("service","globalIdField",["globalIdField","fields"])],Qt.prototype,"readGlobalIdFieldFromService",null),Object(y.a)([Object(_.b)({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:zt}}}}})],Qt.prototype,"objectIdField",void 0),Object(y.a)([Object(w.a)("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),Object(w.a)("service","objectIdField",["objectIdField","fields"])],Qt.prototype,"readObjectIdFieldFromService",null),Object(y.a)([Object(_.b)({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Qt.prototype,"operationalLayerType",void 0),Object(y.a)([Object(_.b)(Jt.outFields)],Qt.prototype,"outFields",void 0),Object(y.a)([Object(_.b)({readOnly:!0,dependsOn:["layerId","dynamicDataSource"]})],Qt.prototype,"parsedUrl",null),Object(y.a)([Object(_.b)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Qt.prototype,"path",void 0),Object(y.a)([Object(_.b)(U.g)],Qt.prototype,"popupEnabled",void 0),Object(y.a)([Object(_.b)({type:R.a,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Qt.prototype,"popupTemplate",void 0),Object(y.a)([Object(_.b)({readOnly:!0,dependsOn:["fields","title"]})],Qt.prototype,"defaultPopupTemplate",null),Object(y.a)([Object(_.b)({type:[Ct],readOnly:!0})],Qt.prototype,"relationships",void 0),Object(y.a)([Object(_.b)({types:z.a,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:z.b,write:{target:"layerDefinition.drawingInfo.renderer",writer:Q.c}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:function(e,t,r){return{ignoreOrigin:null==r?void 0:r.writeLayerSchema}},writer:Q.c}}})],Qt.prototype,"renderer",null),Object(y.a)([Object(w.a)("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Object(w.a)("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Qt.prototype,"readRenderer",null),Object(y.a)([Object(_.b)()],Qt.prototype,"sourceJSON",void 0),Object(y.a)([Object(_.b)({type:Boolean})],Qt.prototype,"returnM",void 0),Object(y.a)([Object(_.b)({type:Boolean})],Qt.prototype,"returnZ",void 0),Object(y.a)([Object(_.b)(U.i)],Qt.prototype,"screenSizePerspectiveEnabled",void 0),Object(y.a)([Object(_.b)()],Qt.prototype,"source",null),Object(y.a)([Object(O.a)("source")],Qt.prototype,"castSource",null),Object(y.a)([Object(w.a)("portal-item","source",["featureSet"]),Object(w.a)("web-map","source",["featureSet"])],Qt.prototype,"readSource",null),Object(y.a)([Object(_.b)({readOnly:!0})],Qt.prototype,"serviceDefinitionExpression",void 0),Object(y.a)([Object(w.a)("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],Qt.prototype,"readServiceDefinitionExpression",null),Object(y.a)([Object(_.b)({type:E.a,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],Qt.prototype,"spatialReference",void 0),Object(y.a)([Object(_.b)({type:[St.a]})],Qt.prototype,"templates",void 0),Object(y.a)([Object(w.a)("templates",["editFieldsInfo","creatorField","editorField","templates"])],Qt.prototype,"readTemplates",null),Object(y.a)([Object(_.b)({type:vt.a})],Qt.prototype,"timeInfo",void 0),Object(y.a)([Object(_.b)()],Qt.prototype,"title",void 0),Object(y.a)([Object(w.a)("service","title",["name"]),Object(w.a)("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Qt.prototype,"readTitle",null),Object(y.a)([Object(w.a)("web-map","title",["layerDefinition.name","title"])],Qt.prototype,"readTitleFromWebMap",null),Object(y.a)([Object(_.b)({type:String})],Qt.prototype,"sublayerTitleMode",void 0),Object(y.a)([Object(_.b)({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],Qt.prototype,"trackIdField",void 0),Object(y.a)([Object(_.b)({json:{read:!1}})],Qt.prototype,"type",void 0),Object(y.a)([Object(_.b)({type:String})],Qt.prototype,"typeIdField",void 0),Object(y.a)([Object(w.a)("service","typeIdField"),Object(w.a)("typeIdField",["layerDefinition.typeIdField"])],Qt.prototype,"readTypeIdField",null),Object(y.a)([Object(_.b)({type:[Ft.a]})],Qt.prototype,"types",void 0),Object(y.a)([Object(w.a)("service","types",["types"]),Object(w.a)("types",["layerDefinition.types"])],Qt.prototype,"readTypes",null),Object(y.a)([Object(_.b)({readOnly:!0,json:{write:!1}})],Qt.prototype,"serverGens",void 0),Object(y.a)([Object(_.b)({type:D.a.ofType(mt),readOnly:!0})],Qt.prototype,"indexes",void 0),Object(y.a)([Object(_.b)(U.j)],Qt.prototype,"url",null),Object(y.a)([Object(I.a)("url")],Qt.prototype,"writeUrl",null),Object(y.a)([Object(_.b)({readOnly:!0})],Qt.prototype,"userIsAdmin",void 0),Object(y.a)([Object(_.b)({json:{origins:{service:{read:!0}},read:!1}})],Qt.prototype,"version",void 0),Object(y.a)([Object(w.a)("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],Qt.prototype,"readVersion",null),Object(y.a)([Object(_.b)({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Qt.prototype,"visible",void 0),Object(y.a)([Object(w.a)("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Qt.prototype,"readVisible",null),Qt=Object(y.a)([Object(F.a)("esri.layers.FeatureLayer")],Qt);var Ht=Object(S.b)({types:P.a}),Yt=Qt;t.default=Yt},835:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(2),a=function e(t,r,a,i){Object(n.a)(this,e),this._candidates=null,this._known=null,this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=t,this._known=r,this._ordered=a,this.pagesDefinition=i}},836:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(10),a=r.n(n),i=r(21),s=r(176),u=r(16),l=r(279);function o(e,t,r){return c.apply(this,arguments)}function c(){return(c=Object(i.a)(a.a.mark((function e(t,r,n){var i,o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=t&&t.getAtOrigin&&t.getAtOrigin("renderer",r.origin))||"unique-value"!==i.type||!i.styleOrigin){e.next=6;break}return e.next=4,Object(l.c)(i.populateFromStyle());case 4:o=e.sent,Object(u.w)(n),!1===o.ok&&(c=o.error,r&&r.messages&&r.messages.push(new s.a("renderer:style-reference","Failed to create unique value renderer from style reference: ".concat(c.message),{error:c,context:r})),t.clear("renderer",r.origin));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},837:function(e,t,r){"use strict";var n=r(2),a=r(3),i=r(5),s=r(6),u=r(0),l=(r(13),r(24)),o=(r(14),r(15),r(1)),c=r(63),d=r(8),f=r(47),p=(r(11),r(19),r(20),r(28)),h=r(283),y=r(281),v=r(282),b=(r(214),r(817)),m=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).id=null,a.name=null,a.domains=null,a.templates=null,a}return Object(a.a)(r,[{key:"readDomains",value:function(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];switch(n.type){case"range":t[r]=v.a.fromJSON(n);break;case"codedValue":t[r]=h.a.fromJSON(n);break;case"inherited":t[r]=y.a.fromJSON(n)}}return t}},{key:"writeDomains",value:function(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]&&e[n].toJSON());Object(l.c)(r),t.domains=r}},{key:"readTemplates",value:function(e){return e&&e.map((function(e){return new b.a(e)}))}},{key:"writeTemplates",value:function(e,t){t.templates=e&&e.map((function(e){return e.toJSON()}))}}]),r}(p.a);Object(u.a)([Object(o.b)({json:{write:!0}})],m.prototype,"id",void 0),Object(u.a)([Object(o.b)({json:{write:!0}})],m.prototype,"name",void 0),Object(u.a)([Object(o.b)({json:{write:!0}})],m.prototype,"domains",void 0),Object(u.a)([Object(c.a)("domains")],m.prototype,"readDomains",null),Object(u.a)([Object(f.a)("domains")],m.prototype,"writeDomains",null),Object(u.a)([Object(o.b)({json:{write:!0}})],m.prototype,"templates",void 0),Object(u.a)([Object(c.a)("templates")],m.prototype,"readTemplates",null),Object(u.a)([Object(f.a)("templates")],m.prototype,"writeTemplates",null);var g=m=Object(u.a)([Object(d.a)("esri.layers.support.FeatureType")],m);t.a=g},846:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(2),a=r(5),i=r(6),s=r(0),u=(r(13),r(14),r(15),r(1)),l=r(8),o=(r(11),r(19),r(20),function(e){var t=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(){var e;return Object(n.a)(this,r),(e=t.apply(this,arguments)).customParameters=null,e}return r}(e);return Object(s.a)([Object(u.b)({json:{write:!0,origins:{"web-scene":{write:!1}}}})],t.prototype,"customParameters",void 0),t=Object(s.a)([Object(l.a)("esri.layers.mixins.CustomParametersMixin")],t)})},848:function(e,t,r){"use strict";var n=r(12),a=r(2),i=r(3),s=r(16),u=r(44),l=r(809),o=r(927),c=function(){function e(t,r){Object(a.a)(this,e),this._lastId=-1,this._progress=r,this._parent=t}return Object(i.a)(e,[{key:"reset",value:function(){this._lastId=-1}},{key:"nextBatch",value:function(e){var t=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((function(r){return t.nextBatch(e)}),(function(r){return t.nextBatch(e)}));var r={returnpromise:null,hasset:!1},n=[];return r.returnpromise=Object(s.c)((function(a,i){t._parent._getSet(t._progress).then((function(s){var u=s._known.length-1;if("GETPAGES"===s._known[s._known.length-1]&&(u-=1),t._lastId+e>u&&s._known.length>0&&"GETPAGES"===s._known[s._known.length-1])t._parent._expandPagedSet(s,t._parent._maxQueryRate(),0,0,t._progress).then((function(n){r.hasset=!0,t._parent._mainSetInUse=null,t.nextBatch(e).then(a,i)}),(function(e){r.hasset=!0,t._parent._mainSetInUse=null,i(e)}));else{if(u>=t._lastId+e||0===s._candidates.length){for(var l=0;l<e;l++){var o=l+t._lastId+1;if(o>=s._known.length)break;n[l]=s._known[o]}return t._lastId+=n.length,0===n.length&&(r.hasset=!0,t._parent._mainSetInUse=null,a([])),void t._parent._getFeatureBatch(n,t._progress).then((function(e){r.hasset=!0,t._parent._mainSetInUse=null,a(e)}),(function(e){r.hasset=!0,t._parent._mainSetInUse=null,i(e)}))}t._parent._refineSetBlock(s,t._parent._maxProcessingRate(),t._progress).then((function(){r.hasset=!0,t._parent._mainSetInUse=null,t.nextBatch(e).then(a,i)}),(function(e){r.hasset=!0,t._parent._mainSetInUse=null,i(e)}))}}),(function(e){r.hasset=!0,t._parent._mainSetInUse=null,i(e)}))})),!1===r.hasset&&(this._parent._mainSetInUse=r.returnpromise,r.hasset=!0),r.returnpromise}},{key:"next",value:function(){var e=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((function(t){return e.next()}),(function(t){return e.next()}));var t={returnpromise:null,hasset:!1};return t.returnpromise=Object(s.c)((function(r,n){e._parent._getSet(e._progress).then((function(a){e._lastId<a._known.length-1?"GETPAGES"===a._known[e._lastId+1]?e._parent._expandPagedSet(a,e._parent._maxQueryRate(),0,0,e._progress).then((function(r){return t.hasset=!0,e._parent._mainSetInUse=null,e.next()})).then(r,n):(e._lastId+=1,e._parent._getFeature(a,a._known[e._lastId],e._progress).then((function(n){t.hasset=!0,e._parent._mainSetInUse=null,r(n)}),(function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)}))):a._candidates.length>0?e._parent._refineSetBlock(a,e._parent._maxProcessingRate(),e._progress).then((function(){t.hasset=!0,e._parent._mainSetInUse=null,e.next().then(r,n)}),(function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)})):(t.hasset=!0,e._parent._mainSetInUse=null,r(null))}),(function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)}))})),!1===t.hasset&&(this._parent._mainSetInUse=t.returnpromise,t.hasset=!0),t.returnpromise}},{key:"count",value:function(){var e=this;return-1!==this._parent._totalCount?Object(s.u)(this._parent._totalCount):this._parent._getSet(this._progress).then((function(t){return e._refineAllSets(t)})).then((function(t){return e._parent._totalCount=t._known.length,Object(s.u)(e._parent._totalCount)}))}},{key:"_refineAllSets",value:function(e){var t=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,1,this._progress).then((function(r){return t._refineAllSets(e)})).then((function(e){return Object(s.u)(e)})):e._candidates.length>0?"GETPAGES"===e._known[e._candidates.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,2,this._progress).then((function(r){return t._refineAllSets(e)})).then((function(e){return Object(s.u)(e)})):this._parent._refineSetBlock(e,this._parent._maxProcessingRate(),this._progress).then((function(e){return e._candidates.length>0?t._refineAllSets(e):Object(s.u)(e)})):Object(s.u)(e)}}]),e}(),d=r(835),f=r(960),p=r(710),h=r(939),y=r(791),v=function(){function e(t){Object(a.a)(this,e),this.recentlyUsedQueries=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=l.a.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=[],this.types=null,this.fields=null,this.geometryType="",this.objectIdField="",this.globalIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,t&&t.lrucache&&(this.recentlyUsedQueries=t.lrucache)}return Object(i.a)(e,[{key:"optimisePagingFeatureQueries",value:function(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)}},{key:"_hasMemorySource",value:function(){return!0}},{key:"prop",value:function(e,t){return void 0===t?this[e]:(void 0!==this[e]&&(this[e]=t),this)}},{key:"end",value:function(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent}},{key:"_ensureLoaded",value:function(){return this.load()}},{key:"load",value:function(){var e=this;return null===this._loadPromise&&(this._loadPromise=Object(s.c)((function(t,r){if(!0===e._parent.loaded)return e._initialiseFeatureSet(),void t(e);e._parent.load().then((function(){try{e._initialiseFeatureSet(),t(e)}catch(t){r(t)}}),r)}))),this._loadPromise}},{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new u.a({wkid:4326}),this.geometryType=l.m.point)}},{key:"getField",value:function(e,t){var r;return(t=t||this.fields)&&(e=e.toLowerCase(),t.some((function(t){return t&&t.name.toLowerCase()===e&&(r=t),!!r}))),r}},{key:"getFieldsIndex",value:function(){return null===this._fieldsIndex&&(this._fieldsIndex=new y.a(this.fields)),this._fieldsIndex}},{key:"_maxProcessingRate",value:function(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())}},{key:"_maxQueryRate",value:function(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery}},{key:"_checkCancelled",value:function(e){if(null!==e&&e.aborted)throw new Error("Operation has been cancelled.")}},{key:"nativeCapabilities",value:function(){return this._parent.nativeCapabilities()}},{key:"_canDoAggregates",value:function(e,t,r,n,a){return null===this._parent?Object(s.u)(!1):this._parent._canDoAggregates(e,t,r,n,a)}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,u){return null===this._parent?Object(s.t)(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,a,i,u)}},{key:"_getAgregagtePhysicalPage",value:function(e,t,r){return null===this._parent?Object(s.t)(new Error("Should never be called")):this._parent._getAgregagtePhysicalPage(e,t,r)}},{key:"databaseType",value:function(){var e=this;if(this._databaseType===l.a.NotEvaluated){if(null!==f.a.applicationCache){var t=f.a.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(null!==t)return t}if(null!==this._databaseTypeProbed)return this._databaseTypeProbed;var r=[{thetype:l.a.SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:l.a.Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:l.a.StandardisedNoInterval,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}],n=Object(s.c)((function(t,n){e._getDatabaseTypeImpl(r,0).then((function(r){e._databaseType=r,t(e._databaseType)}),(function(e){n(e)}))}));return null!==f.a.applicationCache&&(f.a.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),n),n=n.catch((function(t){throw f.a.applicationCache.clearDatabaseType(e._cacheableFeatureSetSourceKey()),t}))),this._databaseTypeProbed=n,this._databaseTypeProbed}return Object(s.u)(this._databaseType)}},{key:"_cacheableFeatureSetSourceKey",value:function(){return"MUSTBESET"}},{key:"_getDatabaseTypeImpl",value:function(e,t){var r=this;return t>=e.length?Object(s.u)(l.a.StandardisedNoInterval):this._runDatabaseProbe(e[t].testwhere).then((function(n){return!0===n?e[t].thetype:r._getDatabaseTypeImpl(e,t+1)}))}},{key:"_runDatabaseProbe",value:function(e){return null!==this._parent?this._parent._runDatabaseProbe(e):Object(s.t)(new Error("Not Implemented"))}},{key:"isTable",value:function(){return this._parent.isTable()}},{key:"_featureFromCache",value:function(e){if(void 0!==this._featureCache[e])return this._featureCache[e]}},{key:"_isInFeatureSet",value:function(e){return l.b.Unknown}},{key:"_getSet",value:function(e){throw new Error("Not implemented in abstract class")}},{key:"_getFeature",value:function(e,t,r){var n=this;try{return this._checkCancelled(r),void 0!==this._featureFromCache(t)?Object(s.u)(this._featureFromCache(t)):this._getFeatures(e,t,this._maxProcessingRate(),r).then((function(){return n._checkCancelled(r),void 0!==n._featureFromCache(t)?n._featureFromCache(t):Object(s.t)(new Error("Feature Not Found"))}))}catch(e){return Object(s.t)(e)}}},{key:"_getFeatureBatch",value:function(e,t){var r=this;try{this._checkCancelled(t);var a=new d.a([],e,!1,null),i=[];return this._getFeatures(a,-1,e.length,t).then((function(){r._checkCancelled(t);var a,s=Object(n.a)(e);try{for(s.s();!(a=s.n()).done;){var u=a.value;void 0!==r._featureFromCache(u)&&i.push(r._featureFromCache(u))}}catch(l){s.e(l)}finally{s.f()}return i}))}catch(e){return Object(s.t)(e)}}},{key:"_getFeatures",value:function(e,t,r,n){return Object(s.u)("success")}},{key:"_getFilteredSet",value:function(e,t,r,n,a){throw new Error("Not implemented in abstract class")}},{key:"_refineSetBlock",value:function(e,t,r){var n=this;try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQueryRate()))return this._expandPagedSet(e,this._maxQueryRate(),0,0,r).then((function(){return n._refineSetBlock(e,t,r)}));this._checkCancelled(r);var a=e._candidates.length;this._refineKnowns(e,t);var i=a-e._candidates.length;return 0===e._candidates.length||i>=t?Object(s.u)(e):this._refineIfParentKnown(e,t-i,r).then((function(){if(n._checkCancelled(r),n._refineKnowns(e,t-i),(i=a-e._candidates.length)<t&&e._candidates.length>0){var s=t-i,u=n._prepareFetchAndRefineSet(e._candidates);return n._fetchAndRefineFeatures(u,u.length>s?s:e._candidates.length,r).then((function(){return n._checkCancelled(r),n._refineKnowns(e,t-i),e}))}return e}))}catch(e){return Object(s.t)(e)}}},{key:"_fetchAndRefineFeatures",value:function(e,t,r){return null}},{key:"_prepareFetchAndRefineSet",value:function(e){for(var t=[],r=0;r<e.length;r++)this._isPhysicalFeature(e[r])&&t.push(e[r]);return t}},{key:"_isPhysicalFeature",value:function(e){return null===this._parent||this._parent._isPhysicalFeature(e)}},{key:"_refineKnowns",value:function(e,t){var r=0,n=null,a=[];t=this._maxQueryRate();for(var i=0;i<e._candidates.length&&"GETPAGES"!==e._candidates[i];i++){var s=!1,u=this._candidateIdTransform(e._candidates[i]);u!==e._candidates[i]&&(s=!0);var o=this._isInFeatureSet(u);if(o===l.b.InFeatureSet)!0===s?e._known.indexOf(u)<0&&(e._known.push(u),r+=1):(e._known.push(e._candidates[i]),r+=1),null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i});else if(o===l.b.NotInFeatureSet)null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),r+=1;else if(o===l.b.Unknown&&(r+=1,!0===e._ordered))break;if(r>=t)break}null!==n&&a.push(n);for(var c=a.length-1;c>=0;c--)e._candidates.splice(a[c].start,a[c].end-a[c].start+1)}},{key:"_refineIfParentKnown",value:function(e,t,r){var n=new d.a([],[],e._ordered,null);return n._candidates=e._candidates.slice(0),this._parent._refineSetBlock(n,t,r)}},{key:"_candidateIdTransform",value:function(e){return this._parent._candidateIdTransform(e)}},{key:"_checkIfNeedToExpandKnownPage",value:function(e,t){if(null===e.pagesDefinition)return!1;for(var r=0,n=e._lastFetchedIndex;n<e._known.length;n++){if("GETPAGES"===e._known[n])return!0;if(void 0===this._featureCache[e._known[n]]&&(r+=1)>=t)break}return!1}},{key:"_checkIfNeedToExpandCandidatePage",value:function(e,t){if(null===e.pagesDefinition)return!1;for(var r=0,n=0;n<e._candidates.length;n++){if("GETPAGES"===e._candidates[n])return!0;if((r+=1)>=t)break}return!1}},{key:"_expandPagedSet",value:function(e,t,r,n,a){return null===this._parent?Object(s.t)(new Error("Parent Paging not implemented")):this._parent._expandPagedSet(e,t,r,n,a)}},{key:"_expandPagedSetFeatureSet",value:function(e,t,r,n,a){var i=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]&&(n=1),0===n&&e._candidates.length>0&&"GETPAGES"===e._candidates[e._candidates.length-1]&&(n=2),0===n?Object(s.u)("finished"):this._getPage(e,n,a).then((function(n){return r+n<t?i._expandPagedSet(e,t,r+n,0,a):"success"}))}},{key:"_getPage",value:function(e,t,r){var n=this,a=1===t?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||!0===e.pagesDefinition.internal.fullyResolved){a.length=a.length-1;for(var i=0,u=0;u<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+u>=e.pagesDefinition.internal.set.length);u++)a[a.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+u],i++;e.pagesDefinition.resultOffset+=i;var l=!1;return!0===e.pagesDefinition.internal.fullyResolved&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(l=!0),!1===l&&a.push("GETPAGES"),Object(s.u)(i)}return this._getPhysicalPage(e,t,r).then((function(){return n._getPage(e,t,r)}))}},{key:"_getPhysicalPage",value:function(e,t,r){return null}},{key:"_clonePageDefinition",value:function(e){return null===this._parent?null:this._parent._clonePageDefinition(e)}},{key:"_first",value:function(e){return this.iterator(e).next()}},{key:"first",value:function(e){return this._first(e)}},{key:"calculateStatistic",value:function(e,t,r,n){var a=this;return this._ensureLoaded().then((function(){return a._stat(e,t,"",null,null,r,n).then((function(i){return!1===i.calculated?a._manualStat(e,t,r,n).then((function(e){return e.result})):i.result}))}))}},{key:"_manualStat",value:function(e,t,r,n){switch(e.toLowerCase()){case"count":return Object(h.b)(this,n).then((function(e){return{calculated:!0,result:e}}));case"distinct":return Object(h.d)(this,t,r).then((function(e){return{calculated:!0,result:e}}));case"avg":case"mean":return Object(h.f)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"stdev":return Object(h.h)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"variance":return Object(h.j)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"sum":return Object(h.i)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"min":return Object(h.g)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"max":return Object(h.e)(this,t,n).then((function(e){return{calculated:!0,result:e}}));default:return Object(s.u)({calculated:!0,result:0})}}},{key:"_stat",value:function(e,t,r,n,a,i,s){var u=this;return this._parent._stat(e,t,r,n,a,i,s).then((function(l){return!1===l.calculated?null===a&&""===r&&null===n?u._manualStat(e,t,i,s):{calculated:!1}:l}))}},{key:"_unionAllGeomSelf",value:function(e){var t=this,r=this.iterator(this._defaultTracker(e)),n=[];return Object(s.c)((function(e,a){t._unionShapeInBatches(n,r,e,a)}))}},{key:"_unionAllGeom",value:function(e){var t=this;return Object(s.c)((function(r,n){var a=t.iterator(t._defaultTracker(e));t._unionShapeInBatches([],a,r,n)}))}},{key:"_unionShapeInBatches",value:function(e,t,r,n){var a=this;t.next().then((function(i){try{null!==i&&null!==i.geometry&&e.push(i.geometry),e.length>30||null===i&&e.length>1?Object(o.B)(e).then((function(s){try{null===i?r(s):(e=[s],a._unionShapeInBatches(e,t,r,n))}catch(e){n(e)}}),n):null===i?1===e.length?r(e[0]):r(null):a._unionShapeInBatches(e,t,r,n)}catch(e){n(e)}}),n)}},{key:"iterator",value:function(e){return new c(this,e)}},{key:"intersection",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e._featuresetFunctions.intersection.bind(this)(t,r)}},{key:"difference",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._featuresetFunctions.difference.bind(this)(t,r,n)}},{key:"symmetricDifference",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._featuresetFunctions.symmetricDifference.bind(this)(t,r,n)}},{key:"morphShape",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return e._featuresetFunctions.morphShape.bind(this)(t,r,n,a)}},{key:"morphShapeAndAttributes",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown";return e._featuresetFunctions.morphShapeAndAttributes.bind(this)(t,r,n)}},{key:"union",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e._featuresetFunctions.union.bind(this)(t,r)}},{key:"intersects",value:function(t){return e._featuresetFunctions.intersects.bind(this)(t)}},{key:"envelopeIntersects",value:function(t){return e._featuresetFunctions.envelopeIntersects.bind(this)(t)}},{key:"contains",value:function(t){return e._featuresetFunctions.contains.bind(this)(t)}},{key:"overlaps",value:function(t){return e._featuresetFunctions.overlaps.bind(this)(t)}},{key:"relate",value:function(t,r){return e._featuresetFunctions.relate.bind(this)(t,r)}},{key:"within",value:function(t){return e._featuresetFunctions.within.bind(this)(t)}},{key:"touches",value:function(t){return e._featuresetFunctions.touches.bind(this)(t)}},{key:"top",value:function(t){return e._featuresetFunctions.top.bind(this)(t)}},{key:"crosses",value:function(t){return e._featuresetFunctions.crosses.bind(this)(t)}},{key:"buffer",value:function(t,r,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return e._featuresetFunctions.buffer.bind(this)(t,r,n,a)}},{key:"filter",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e._featuresetFunctions.filter.bind(this)(t,r)}},{key:"orderBy",value:function(t){return e._featuresetFunctions.orderBy.bind(this)(t)}},{key:"dissolve",value:function(t,r){return e._featuresetFunctions.dissolve.bind(this)(t,r)}},{key:"groupby",value:function(t,r){return e._featuresetFunctions.groupby.bind(this)(t,r)}},{key:"reduce",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return Object(s.c)((function(a,i){t._reduceImpl(t.iterator(t._defaultTracker(n)),e,r,0,a,i,0)}))}},{key:"_reduceImpl",value:function(e,t,r,n,a,i,u){var l=this;try{if(++u>1e3)return void setTimeout((function(){u=0,l._reduceImpl(e,t,r,n,a,i,u)}));e.next().then((function(o){try{if(null===o)a(r);else{var c=t(r,o,n,l);Object(s.p)(c)?c.then((function(r){l._reduceImpl(e,t,r,n+1,a,i,u)}),i):l._reduceImpl(e,t,c,n+1,a,i,u)}}catch(e){i(e)}}),i)}catch(e){i(e)}}},{key:"removeField",value:function(t){return e._featuresetFunctions.removeField.bind(this)(t)}},{key:"addField",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e._featuresetFunctions.addField.bind(this)(t,r,n)}},{key:"sumArea",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,n=Object(l.e)(e);return this.reduce((function(e,r){return null===r.geometry?0:t?Object(o.l)(r.geometry,n).then((function(t){return e+t})):Object(o.u)(r.geometry,n).then((function(t){return e+t}))}),0,r)}},{key:"sumLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,n=Object(l.d)(e);return this.reduce((function(e,r){return null===r.geometry?0:t?Object(o.o)(r.geometry,n).then((function(t){return e+t})):Object(o.v)(r.geometry,n).then((function(t){return e+t}))}),0,r)}},{key:"_substituteVars",value:function(e,t){if(null!==t){var r={};for(var n in t)r[n.toLowerCase()]=t[n];e.parameters=r}}},{key:"distinct",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0;return this.load().then((function(){var i=p.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(i,n),t.calculateStatistic("distinct",i,r,t._defaultTracker(a))}))}},{key:"min",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=p.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("min",a,-1,t._defaultTracker(n))}))}},{key:"max",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=p.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("max",a,-1,t._defaultTracker(n))}))}},{key:"avg",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=p.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("avg",a,-1,t._defaultTracker(n))}))}},{key:"sum",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=p.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("sum",a,-1,t._defaultTracker(n))}))}},{key:"stdev",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=p.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("stdev",a,-1,t._defaultTracker(n))}))}},{key:"variance",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=p.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("variance",a,-1,t._defaultTracker(n))}))}},{key:"count",value:function(e){var t=this;return this.load().then((function(){return t.calculateStatistic("count",p.WhereClause.create("1",t.getFieldsIndex()),-1,t._defaultTracker(e))}))}},{key:"_defaultTracker",value:function(e){return e||{aborted:!1}}},{key:"forEach",value:function(e,t){var r=this;return Object(s.c)((function(n,a){r._forEachImpl(r.iterator(r._defaultTracker(t)),e,r,n,a,0)}))}},{key:"_forEachImpl",value:function(e,t,r,n,a,i){var u=this;try{if(++i>1e3)return void setTimeout((function(){i=0,u._forEachImpl(e,t,r,n,a,i)}),0);e.next().then((function(l){try{if(null===l)n(r);else{var o=t(l);null==o?u._forEachImpl(e,t,r,n,a,i):Object(s.p)(o)?o.then((function(){try{u._forEachImpl(e,t,r,n,a,i)}catch(e){a(e)}}),a):u._forEachImpl(e,t,r,n,a,i)}}catch(e){a(e)}}),a)}catch(e){a(e)}}},{key:"convertToJSON",value:function(e){for(var t={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}},r=0;r<this.fields.length;r++)t.layerDefinition.fields.push(Object(l.h)(this.fields[r]));return this.reduce((function(e,r){var n={geometry:r.geometry&&r.geometry.toJSON(),attributes:{}};for(var a in r.attributes)n.attributes[a]=r.attributes[a];return t.featureSet.features.push(n),1}),0,e).then((function(){return t}))}},{key:"castToText",value:function(){return"object, FeatureSet"}},{key:"queryAttachments",value:function(e,t,r,n){return this._parent.queryAttachments(e,t,r,n)}},{key:"serviceUrl",value:function(){return this._parent.serviceUrl()}},{key:"subtypes",value:function(){return this.typeIdField?{subtypeField:this.typeIdField,subtypes:this.types?this.types.map((function(e){return{name:e.name,code:e.id}})):[]}:null}},{key:"relationshipMetaData",value:function(){return this._parent.relationshipMetaData()}},{key:"gdbVersion",get:function(){return this._parent?this._parent.gdbVersion:""}},{key:"schema",value:function(){var e,t=[],r=Object(n.a)(this.fields);try{for(r.s();!(e=r.n()).done;){var a=e.value;t.push(Object(l.h)(a))}}catch(i){r.e(i)}finally{r.f()}return{objectIdField:this.objectIdField,globalIdField:this.globalIdField,geometryType:void 0===l.n[this.geometryType]?"":l.n[this.geometryType],fields:t}}},{key:"convertToText",value:function(e,t){var r=this;return"schema"===e?this._ensureLoaded().then((function(){return JSON.stringify(r.schema())})):"featureset"===e?this._ensureLoaded().then((function(){var e=[];return r.reduce((function(t,r){var n={geometry:r.geometry?r.geometry.toJSON():null,attributes:r.attributes};return null!==n.geometry&&n.geometry.spatialReference&&delete n.geometry.spatialReference,e.push(n),1}),0,t).then((function(){var t=r.schema();return t.features=e,t.spatialReference=r.spatialReference.toJSON(),JSON.stringify(t)}))})):Object(s.u)(this.castToText())}},{key:"getFeatureByObjectId",value:function(e,t){return this._parent.getFeatureByObjectId(e,t)}},{key:"getOwningSystemUrl",value:function(){return this._parent.getOwningSystemUrl()}},{key:"getIdentityUser",value:function(){return this._parent.getIdentityUser()}}]),e}();v._featuresetFunctions={};t.a=v},859:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var n=r(12),a=r(14),i=r(157),s=r(246),u=a.a.getLogger("esri.layers.support.fieldProperties");function l(){return{fields:{type:[s.a],value:null},outFields:{type:[String],dependsOn:["fields"],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){var e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;var t,r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;Object(i.p)(this.fields,a)||u.error("field-attributes-layer:invalid-field","Invalid field ".concat(a," found in outFields"),{layer:this,outFields:e})}}catch(s){r.e(s)}finally{r.f()}return Object(i.i)(this.fields,e)}}}}},864:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(794),a=/\[([^\[\]]+)\]/gi;function i(e,t,r){var i=this;return e?e.map((function(e){var s=new n.a;if(s.read(e,r),s.labelExpression){var u=t.fields||t.layerDefinition&&t.layerDefinition.fields||i.fields;s.labelExpression=s.labelExpression.replace(a,(function(e,t){return"[".concat(function(e,t){if(!t)return e;for(var r=e.toLowerCase(),n=0;n<t.length;n++){var a=t[n].name;if(a.toLowerCase()===r)return a}return e}(t,u),"]")}))}return s})):null}},872:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return c}));var n=r(99),a=r(23),i=r(801),s=r(819),u=r(818),l={key:"type",base:i.a,typeMap:{selection:u.a}};function o(e,t){var r=(t=t.layerDefinition||t).featureReduction;if(r)switch(r.type){case"selection":return u.a.fromJSON(r);case"cluster":return s.a.fromJSON(r)}return null}function c(e,t,r,i){var s=function(e,t,r){return e?"selection"!==e.type?(r.messages&&r.messages.push(new a.a("featureReduction:unsupported","FeatureReduction of type '".concat(e.declaredClass,"' are not supported in scenes."),{featureReduction:e,context:r})),null):e.write(t,r):null}(e,{},i);s&&Object(n.c)(r,s,t)}},885:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return w})),r.d(t,"c",(function(){return _})),r.d(t,"d",(function(){return p})),r.d(t,"e",(function(){return h})),r.d(t,"f",(function(){return y})),r.d(t,"g",(function(){return o})),r.d(t,"h",(function(){return g})),r.d(t,"i",(function(){return u})),r.d(t,"j",(function(){return l})),r.d(t,"k",(function(){return f}));var n=r(12),a=r(823),i=r(809),s=r(710);function u(e,t){return d(e.parseTree,t,e.parameters)}function l(e,t,r){return d(e,t,r)}function o(e,t,r,n){return s.WhereClause.create(d(e.parseTree,i.a.Standardised,e.parameters,t,r),n)}function c(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"AND";return s.WhereClause.create("(("+u(e,i.a.Standardised)+")"+r+"("+u(t,i.a.Standardised)+"))",e.fieldsIndex)}function d(e,t,r){var a,i,s,u,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;switch(e.type){case"interval":return w(d(e.value,t,r,l,o),e.qualifier,e.op);case"case_expression":var c=" CASE ";"simple"===e.format&&(c+=d(e.operand,t,r,l,o));for(var y=0;y<e.clauses.length;y++)c+=" WHEN "+d(e.clauses[y].operand,t,r,l,o)+" THEN "+d(e.clauses[y].value,t,r,l,o);return null!==e.else&&(c+=" ELSE "+d(e.else,t,r,l,o)),c+=" END ";case"param":var v=r[e.value.toLowerCase()];if("string"==typeof v)return"'"+r[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(v instanceof Date)return p(v,t);if(v instanceof Array){for(var b=[],m=0;m<v.length;m++)"string"==typeof v[m]?b.push("'"+v[m].toString().replace(/'/g,"''")+"'"):v[m]instanceof Date?b.push(p(v[m],t)):b.push(v[m].toString());return b}return v.toString();case"expr_list":i=[];var g,_=Object(n.a)(e.value);try{for(_.s();!(g=_.n()).done;){var O=g.value;i.push(d(O,t,r,l,o))}}catch(S){_.e(S)}finally{_.f()}return i;case"unary_expr":return" ( NOT "+d(e.expr,t,r,l,o)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+d(e.left,t,r,l,o)+" AND "+d(e.right,t,r,l,o)+") ";case"OR":return" ("+d(e.left,t,r,l,o)+" OR "+d(e.right,t,r,l,o)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+d(e.left,t,r,l,o)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+d(e.left,t,r,l,o)+" IS NOT NULL )";case"IN":return a=[],"expr_list"===e.right.type?(a=d(e.right,t,r,l,o)," ("+d(e.left,t,r,l,o)+" IN ("+a.join(",")+")) "):(u=d(e.right,t,r,l,o))instanceof Array?" ("+d(e.left,t,r,l,o)+" IN ("+u.join(",")+")) ":" ("+d(e.left,t,r,l,o)+" IN ("+u+")) ";case"NOT IN":return a=[],"expr_list"===e.right.type?(a=d(e.right,t,r,l,o)," ("+d(e.left,t,r,l,o)+" NOT IN ("+a.join(",")+")) "):(u=d(e.right,t,r,l,o))instanceof Array?" ("+d(e.left,t,r,l,o)+" NOT IN ("+u.join(",")+")) ":" ("+d(e.left,t,r,l,o)+" NOT IN ("+u+")) ";case"BETWEEN":return s=d(e.right,t,r,l,o)," ("+d(e.left,t,r,l,o)+" BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"NOTBETWEEN":return s=d(e.right,t,r,l,o)," ("+d(e.left,t,r,l,o)+" NOT BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"LIKE":return""!==e.escape?" ("+d(e.left,t,r,l,o)+" LIKE "+d(e.right,t,r,l,o)+" ESCAPE '"+e.escape+"') ":" ("+d(e.left,t,r,l,o)+" LIKE "+d(e.right,t,r,l,o)+") ";case"NOT LIKE":return""!==e.escape?" ("+d(e.left,t,r,l,o)+" NOT LIKE "+d(e.right,t,r,l,o)+" ESCAPE '"+e.escape+"') ":" ("+d(e.left,t,r,l,o)+" NOT LIKE "+d(e.right,t,r,l,o)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+d(e.left,t,r,l,o)+" "+e.operator+" "+d(e.right,t,r,l,o)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return p(e.value,t);case"number":return e.value.toString();case"current_time":return h("date"===e.mode,t);case"column_ref":return l&&l.toLowerCase()===e.column.toLowerCase()?"("+o+")":e.column;case"function":var j=d(e.args,t,r,l,o);return f(e.name,j,t)}throw new Error("Unsupported sql syntax "+e.type)}function f(e,t,r){switch(e.toLowerCase().trim()){case"abs":if(1!==t.length)throw new Error("Invalid Parameter for call to ABS");return"abs("+t[0]+")";case"ceiling":case"ceil":if(1!==t.length)throw new Error("Invalid Parameter for call to CEILING");switch(r){case i.a.Standardised:case i.a.StandardisedNoInterval:default:return"CEILING("+t[0]+")"}case"floor":if(1!==t.length)throw new Error("Invalid Parameter for call to Floor");return"FLOOR("+t[0]+")";case"log":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG");return"LOG("+t[0]+")";case"log10":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG10");return"LOG10("+t[0]+")";case"power":if(2!==t.length)throw new Error("Invalid Parameter for call to POWER");return"POWER("+t[0]+","+t[1]+")";case"round":if(2===t.length)return"ROUND("+t[0]+","+t[1]+")";if(1===t.length)return"ROUND("+t[0]+")";throw new Error("Invalid Parameter for call to ROUND");case"truncate":if(t.length<1||t.length>2)throw new Error("Invalid Parameter for TRUNCATE function");switch(r){case i.a.SqlServer:return"ROUND("+t[0]+(1===t.length?"0":","+t[1])+",1)";default:return"TRUNCATE("+t[0]+(1===t.length?")":","+t[1]+")")}case"char_length":case"len":if(1!==t.length)throw new Error("Invalid Parameter for CHAR_LENGTH function");switch(r){case i.a.SqlServer:return"LEN("+t[0]+")";case i.a.Oracle:return"LENGTH("+t[0]+")";default:return"CHAR_LENGTH("+t[0]+")"}case"concat":if(t.length<1)throw new Error("Invalid Parameter for CONCAT function");for(var n="CONCAT(",a=0;a<t.length;a++)0!==a&&(n+=","),n+=t[a];return n+=")";case"lower":case"lcase":if(1!==t.length)throw new Error("Invalid Parameter for Lower function");return"LOWER("+t[0]+")";case"upper":case"ucase":if(1!==t.length)throw new Error("Invalid Parameter for Upper function");return"UPPER("+t[0]+")";case"substring":var s="";switch(r){case i.a.Oracle:return s="SUBSTR("+t[0]+","+t[1],3===t.length&&(s+=","+t[2]),s+=")";case i.a.SqlServer:return s=3===t.length?"SUBSTRING("+t[0]+","+t[1]+","+t[2]+")":"SUBSTRING("+t[0]+",  "+t[1]+", LEN("+t[0]+") - "+t[1]+")";default:return s="SUBSTRING("+t[0]+" FROM "+t[1],3===t.length&&(s+=" FOR "+t[2]),s+=")"}case"extract":return"EXTRACT("+t[0].replace(/\'/g,"")+" FROM "+t[1]+")"}throw new Error("Function Not Recognised")}function p(e,t){var r=a.m.Moment(e),n=0===r.minute()&&0===r.hour()&&0===r.second()&&0===r.millisecond();switch(t){case i.a.FILEGDB:case i.a.Standardised:case i.a.StandardisedNoInterval:return n?"date '"+r.format("YYYY-MM-DD")+"'":"date '"+r.format("YYYY-MM-DD HH:mm:ss")+"'";case i.a.Oracle:return n?"TO_DATE('"+r.format("YYYY-MM-DD")+"','YYYY-MM-DD')":"TO_DATE('"+r.format("YYYY-MM-DD HH:mm:ss")+"','YYYY-MM-DD HH24:MI:SS')";case i.a.SqlServer:return"'"+r.format(n?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";case i.a.PGDB:return"#"+r.format(n?"MM-DD-YYYY":"MM-DD-YYYY HH:mm:ss")+"#";case i.a.Postgres:return"TIMESTAMP '"+r.format(n?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";default:return"date '"+r.format("YYYY-MM-DD HH:mm:ss")+"'"}}function h(e,t){switch(t){case i.a.FILEGDB:case i.a.Standardised:case i.a.StandardisedNoInterval:case i.a.Oracle:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP";case i.a.SqlServer:return e?"CAST(GETDATE() AS DATE)":"GETDATE()";case i.a.PGDB:case i.a.Postgres:default:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP"}}function y(e,t){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i={},s={},u={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",oid:"integer",long:"integer","small-integer":"integer",integer:"integer",single:"double",double:"double",date:"date",string:"string"},l=Object(n.a)(t);try{for(l.s();!(r=l.n()).done;){var o=r.value,c=u[o.type];i[o.name.toLowerCase()]=void 0===c?"":c}}catch(p){l.e(p)}finally{l.f()}for(var d in a){var f=u[a[d]];s[d.toLowerCase()]=void 0===f?"":f}switch(v(i,e.parseTree,e.parameters,s)){case"double":return"double";case"integer":return"integer";case"double":return"double";case"date":return"date";case"string":return"string"}return""}function v(e,t,r,a){var i;switch(t.type){case"interval":return"integer";case"case_expression":var s=[];if("simple"===t.format){for(var u=0;u<t.clauses.length;u++)s.push(v(e,t.clauses[u].value,r,a));null!==t.else&&s.push(v(e,t.else,r,a))}else{for(var l=0;l<t.clauses.length;l++)s.push(v(e,t.else,r,a));null!==t.else&&s.push(v(e,t.else,r,a))}return m(s);case"param":var o=a[t.value.toLowerCase()];if(void 0===o&&r){var c=r[t.value.toLowerCase()];if(void 0===c)return"";if(null===c)return"";if("string"==typeof c||c instanceof String)return"string";if("boolean"==typeof c)return"boolean";if(c instanceof Date)return"date";if("number"==typeof c)return c%1==0?"integer":"double"}return void 0===o?"":o;case"expr_list":var d,f=[],p=Object(n.a)(t.value);try{for(p.s();!(d=p.n()).done;){var h=d.value;f.push(v(e,h,r,a))}}catch(g){p.e(g)}finally{p.f()}return f;case"unary_expr":return"boolean";case"binary_expr":switch(t.operator){case"AND":case"OR":return"boolean";case"IS":case"ISNOT":if("null"!==t.right.type)throw new Error("Unsupported RHS for IS");return"boolean";case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":return"boolean";case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"*":case"-":case"+":case"/":return m([v(e,t.left,r,a),v(e,t.right,r,a)]);default:throw new Error("Not Supported Operator "+t.operator)}case"null":return"";case"bool":return"boolean";case"string":return"string";case"number":return null===t.value?"":t.value%1==0?"integer":"double";case"date":case"timestamp":case"current_time":return"date";case"column_ref":var y=e[t.column.toLowerCase()];return void 0===y?"":y;case"function":switch(t.name.toLowerCase()){case"position":case"extract":case"char_length":return"integer";case"round":return(i=v(e,t.args,r,a))instanceof Array?i.length>0?i[0]:"":i;case"sign":return(i=v(e,t.args,r,a))instanceof Array&&(i=m(i)),"integer"===i||"double"===i?i:"double";case"ceiling":case"floor":case"abs":var b=v(e,t.args,r,a);return b instanceof Array?m(b):b;case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"power":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string";case"truncate":return"double";case"round":return(i=v(e,t.args,r,a))instanceof Array?i.length>0?i[0]:"":i}return""}throw new Error("Unsupported sql syntax "+t.type)}var b={boolean:1,string:2,integer:3,double:4,date:5};function m(e){if(e){var t,r="",a=Object(n.a)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;""!==i&&(r=""===r||b[r]<b[i]?i:r)}}catch(s){a.e(s)}finally{a.f()}return r}return""}function g(e,t){return O(e.parseTree,t)}function _(e){return"column_ref"===e.parseTree.type}function O(e,t){if(null==e)return!1;switch(e.type){case"when_clause":return O(e.operand,t)||O(e.value,t);case"case_expression":var r,a=Object(n.a)(e.clauses);try{for(a.s();!(r=a.n()).done;){if(O(r.value,t))return!0}}catch(u){a.e(u)}finally{a.f()}return!("simple"!==e.format||!O(e.operand,t))||!(null===e.else||!O(e.else,t));case"param":return!1;case"expr_list":var i,s=Object(n.a)(e.value);try{for(s.s();!(i=s.n()).done;){if(O(i.value,t))return!0}}catch(u){s.e(u)}finally{s.f()}return!1;case"unary_expr":return O(e.expr,t);case"binary_expr":return O(e.left,t)||O(e.right,t);case"null":case"bool":case"date":case"timestamp":case"string":case"number":return!1;case"column_ref":return t.toLowerCase()===e.column.toLowerCase();case"function":return O(e.args,t)}return!1}function j(e){var t="";return t+=e.period.toUpperCase()}function w(e,t,r){return"INTERVAL "+r+" "+e+" "+("interval-period"===t.type?j(t):j(t.start)+" TO "+j(t.end))}},924:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return n}));var n={Base64:0,Hex:1,String:2,Raw:3};function a(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function i(e,t,r,n,i,s){return a((u=a(a(t,e),a(n,s)))<<(l=i)|u>>>32-l,r);var u,l}function s(e,t,r,n,a,s,u){return i(t&r|~t&n,e,t,a,s,u)}function u(e,t,r,n,a,s,u){return i(t&n|r&~n,e,t,a,s,u)}function l(e,t,r,n,a,s,u){return i(t^r^n,e,t,a,s,u)}function o(e,t,r,n,a,s,u){return i(r^(t|~n),e,t,a,s,u)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.Hex,r=t||n.Base64,i=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,n=-271733879,i=-1732584194,c=271733878,d=0;d<e.length;d+=16){var f=r,p=n,h=i,y=c;r=s(r,n,i,c,e[d+0],7,-680876936),c=s(c,r,n,i,e[d+1],12,-389564586),i=s(i,c,r,n,e[d+2],17,606105819),n=s(n,i,c,r,e[d+3],22,-1044525330),r=s(r,n,i,c,e[d+4],7,-176418897),c=s(c,r,n,i,e[d+5],12,1200080426),i=s(i,c,r,n,e[d+6],17,-1473231341),n=s(n,i,c,r,e[d+7],22,-45705983),r=s(r,n,i,c,e[d+8],7,1770035416),c=s(c,r,n,i,e[d+9],12,-1958414417),i=s(i,c,r,n,e[d+10],17,-42063),n=s(n,i,c,r,e[d+11],22,-1990404162),r=s(r,n,i,c,e[d+12],7,1804603682),c=s(c,r,n,i,e[d+13],12,-40341101),i=s(i,c,r,n,e[d+14],17,-1502002290),r=u(r,n=s(n,i,c,r,e[d+15],22,1236535329),i,c,e[d+1],5,-165796510),c=u(c,r,n,i,e[d+6],9,-1069501632),i=u(i,c,r,n,e[d+11],14,643717713),n=u(n,i,c,r,e[d+0],20,-373897302),r=u(r,n,i,c,e[d+5],5,-701558691),c=u(c,r,n,i,e[d+10],9,38016083),i=u(i,c,r,n,e[d+15],14,-660478335),n=u(n,i,c,r,e[d+4],20,-405537848),r=u(r,n,i,c,e[d+9],5,568446438),c=u(c,r,n,i,e[d+14],9,-1019803690),i=u(i,c,r,n,e[d+3],14,-187363961),n=u(n,i,c,r,e[d+8],20,1163531501),r=u(r,n,i,c,e[d+13],5,-1444681467),c=u(c,r,n,i,e[d+2],9,-51403784),i=u(i,c,r,n,e[d+7],14,1735328473),r=l(r,n=u(n,i,c,r,e[d+12],20,-1926607734),i,c,e[d+5],4,-378558),c=l(c,r,n,i,e[d+8],11,-2022574463),i=l(i,c,r,n,e[d+11],16,1839030562),n=l(n,i,c,r,e[d+14],23,-35309556),r=l(r,n,i,c,e[d+1],4,-1530992060),c=l(c,r,n,i,e[d+4],11,1272893353),i=l(i,c,r,n,e[d+7],16,-155497632),n=l(n,i,c,r,e[d+10],23,-1094730640),r=l(r,n,i,c,e[d+13],4,681279174),c=l(c,r,n,i,e[d+0],11,-358537222),i=l(i,c,r,n,e[d+3],16,-722521979),n=l(n,i,c,r,e[d+6],23,76029189),r=l(r,n,i,c,e[d+9],4,-640364487),c=l(c,r,n,i,e[d+12],11,-421815835),i=l(i,c,r,n,e[d+15],16,530742520),r=o(r,n=l(n,i,c,r,e[d+2],23,-995338651),i,c,e[d+0],6,-198630844),c=o(c,r,n,i,e[d+7],10,1126891415),i=o(i,c,r,n,e[d+14],15,-1416354905),n=o(n,i,c,r,e[d+5],21,-57434055),r=o(r,n,i,c,e[d+12],6,1700485571),c=o(c,r,n,i,e[d+3],10,-1894986606),i=o(i,c,r,n,e[d+10],15,-1051523),n=o(n,i,c,r,e[d+1],21,-2054922799),r=o(r,n,i,c,e[d+8],6,1873313359),c=o(c,r,n,i,e[d+15],10,-30611744),i=o(i,c,r,n,e[d+6],15,-1560198380),n=o(n,i,c,r,e[d+13],21,1309151649),r=o(r,n,i,c,e[d+4],6,-145523070),c=o(c,r,n,i,e[d+11],10,-1120210379),i=o(i,c,r,n,e[d+2],15,718787259),n=o(n,i,c,r,e[d+9],21,-343485551),r=a(r,f),n=a(n,p),i=a(i,h),c=a(c,y)}return[r,n,i,c]}(function(e){for(var t=[],r=0,n=8*e.length;r<n;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}(e),8*e.length);switch(r){case n.Raw:return i;case n.Hex:return function(e){for(var t="0123456789abcdef",r=[],n=0,a=4*e.length;n<a;n++)r.push(t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15));return r.join("")}(i);case n.String:return function(e){for(var t=[],r=0,n=32*e.length;r<n;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}(i);case n.Base64:return function(e){for(var t=[],r=0,n=4*e.length;r<n;r+=3)for(var a=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255,i=0;i<4;i++)8*r+6*i>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>6*(3-i)&63));return t.join("")}(i)}}},927:function(e,t,r){"use strict";r.d(t,"a",(function(){return q})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return m})),r.d(t,"d",(function(){return g})),r.d(t,"e",(function(){return v})),r.d(t,"f",(function(){return K})),r.d(t,"g",(function(){return C})),r.d(t,"h",(function(){return F})),r.d(t,"i",(function(){return _})),r.d(t,"j",(function(){return O})),r.d(t,"k",(function(){return H})),r.d(t,"l",(function(){return re})),r.d(t,"m",(function(){return V})),r.d(t,"n",(function(){return Z})),r.d(t,"o",(function(){return ne})),r.d(t,"p",(function(){return A})),r.d(t,"q",(function(){return j})),r.d(t,"r",(function(){return x})),r.d(t,"s",(function(){return G})),r.d(t,"t",(function(){return I})),r.d(t,"u",(function(){return ee})),r.d(t,"v",(function(){return te})),r.d(t,"w",(function(){return k})),r.d(t,"x",(function(){return z})),r.d(t,"y",(function(){return T})),r.d(t,"z",(function(){return N})),r.d(t,"A",(function(){return w})),r.d(t,"B",(function(){return L})),r.d(t,"C",(function(){return S}));r(9);var n,a=r(10),i=r.n(a),s=r(21),u=(r(38),r(59)),l=(r(77),r(384));function o(e){var t;return Array.isArray(e)?null==(t=e[0])?void 0:t.spatialReference:null==e?void 0:e.spatialReference}function c(e){return e?Array.isArray(e)?e.map(c):e.toJSON?e.toJSON():e:e}function d(e){return Array.isArray(e)?e.map((function(e){return Object(u.a)(e)})):Object(u.a)(e)}function f(e,t){return p.apply(this,arguments)}function p(){return(p=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n||(n=Object(l.b)("geometryEngineWorker",{strategy:"distributed"})),n));case 1:case"end":return e.stop()}}),e)})))();case 2:return e.abrupt("return",e.sent.invoke("executeGEOperation",{operation:t,parameters:c(r)}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e,t){return y.apply(this,arguments)}function y(){return(y=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,f("clip",[o(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t){return b.apply(this,arguments)}function b(){return(b=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,f("cut",[o(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){return f("contains",[o(e),e,t])}function g(e,t){return f("crosses",[o(e),e,t])}function _(e,t,r){return f("distance",[o(e),e,t,r])}function O(e,t){return f("equals",[o(e),e,t])}function j(e,t){return f("intersects",[o(e),e,t])}function w(e,t){return f("touches",[o(e),e,t])}function S(e,t){return f("within",[o(e),e,t])}function F(e,t){return f("disjoint",[o(e),e,t])}function I(e,t){return f("overlaps",[o(e),e,t])}function k(e,t,r){return f("relate",[o(e),e,t,r])}function x(e){return f("isSimple",[o(e),e])}function T(e){return E.apply(this,arguments)}function E(){return(E=Object(s.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,f("simplify",[o(t),t]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e,t){return D.apply(this,arguments)}function D(){return(D=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,f("difference",[o(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t){return R.apply(this,arguments)}function R(){return(R=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,f("symmetricDifference",[o(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t){return P.apply(this,arguments)}function P(){return(P=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,f("intersect",[o(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){return M.apply(this,arguments)}function M(){return(M=Object(s.a)(i.a.mark((function e(t){var r,n,a=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:null,n=function(e,t){var r;return Array.isArray(e)?r=e:((r=[]).push(e),null!=t&&r.push(t)),r}(t,r),e.t0=d,e.next=5,f("union",[o(n),n]);case 5:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e,t,r,n,a,i){return B.apply(this,arguments)}function B(){return(B=Object(s.a)(i.a.mark((function e(t,r,n,a,s,u){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,f("offset",[o(t),t,r,n,a,s,u]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e,t,r){return U.apply(this,arguments)}function U(){return(U=Object(s.a)(i.a.mark((function e(t,r,n){var a,s,u=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]&&u[3],s=[o(t),t,r,n,a],e.t0=d,e.next=5,f("buffer",s);case 5:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t,r,n,a,i){return W.apply(this,arguments)}function W(){return(W=Object(s.a)(i.a.mark((function e(t,r,n,a,s,u){var l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=[o(t),t,r,n,a,s,u],e.t0=d,e.next=4,f("geodesicBuffer",l);case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){return"xmin"in e?e.center:"x"in e?e:e.extent.center}function z(e,t,r){return Q.apply(this,arguments)}function Q(){return(Q=Object(s.a)(i.a.mark((function e(t,r,n){var a,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}throw new Error("Illegal Argument Exception");case 2:return s=t.spatialReference,n=null!=(a=n)?a:J(t),e.t0=t.constructor,e.next=7,f("rotate",[s,t,r,n]);case 7:return e.t1=e.sent,u=e.t0.fromJSON.call(e.t0,e.t1),e.abrupt("return",(u.spatialReference=s,u));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t,r,n){return Y.apply(this,arguments)}function Y(){return(Y=Object(s.a)(i.a.mark((function e(t,r,n,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,f("generalize",[o(t),t,r,n,a]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e,t,r){return $.apply(this,arguments)}function $(){return($=Object(s.a)(i.a.mark((function e(t,r,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,f("densify",[o(t),t,r,n]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e,t,r){return X.apply(this,arguments)}function X(){return(X=Object(s.a)(i.a.mark((function e(t,r,n){var a,s=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>3&&void 0!==s[3]?s[3]:0,e.t0=d,e.next=4,f("geodesicDensify",[o(t),t,r,n,a]);case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e,t){return f("planarArea",[o(e),e,t])}function te(e,t){return f("planarLength",[o(e),e,t])}function re(e,t,r){return f("geodesicArea",[o(e),e,t,r])}function ne(e,t,r){return f("geodesicLength",[o(e),e,t,r])}},939:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return g})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return j})),r.d(t,"e",(function(){return h})),r.d(t,"f",(function(){return y})),r.d(t,"g",(function(){return p})),r.d(t,"h",(function(){return b})),r.d(t,"i",(function(){return m})),r.d(t,"j",(function(){return v}));var n=r(16),a=r(823),i=r(809),s=r(885);function u(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function l(e){for(var t=u(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/e.length}function o(e){for(var t=u(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/(e.length-1)}function c(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}function d(e){switch(e.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""}function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;switch(e.toLowerCase()){case"distinct":return function(e,t){for(var r=[],n={},a=[],s=0;s<e.length;s++){if(void 0!==e[s]&&null!==e[s]){var u=e[s];if(Object(i.j)(u)||Object(i.k)(u))void 0===n[u]&&(r.push(u),n[u]=1);else{for(var l=!1,o=0;o<a.length;o++)!0===Object(i.g)(a[o],u)&&(l=!0);!1===l&&(a.push(u),r.push(u))}}if(r.length>=t&&-1!==t)return r}return r}(t,r);case"avg":case"mean":return u(t);case"min":return Math.min.apply(Math,t);case"sum":return c(t);case"max":return Math.max.apply(Math,t);case"stdev":case"stddev":return Math.sqrt(l(t));case"var":case"variance":return l(t);case"count":return t.length}return 0}function p(e,t,r){return _(e,t,r,!0).then((function(e){return 0===e.length?null:Math.min.apply(Math,e)}))}function h(e,t,r){return _(e,t,r,!0).then((function(e){return 0===e.length?null:Math.max.apply(Math,e)}))}function y(e,t,r){var n="";return!1===Object(s.c)(t)&&(n=Object(s.f)(t,e.fields,null)),_(e,t,r,!0).then((function(e){if(0===e.length)return null;var t,r=u(e);return null===r?r:"integer"===n?(t=+(t=r),isFinite(t)?t-t%1||(t<0?-0:0===t?t:0):t):r}))}function v(e,t,r){return _(e,t,r,!0).then((function(e){return 0===e.length?null:o(e)}))}function b(e,t,r){return _(e,t,r,!0).then((function(e){return 0===e.length?null:Math.sqrt(o(e))}))}function m(e,t,r){return _(e,t,r,!0).then((function(e){return 0===e.length?null:c(e)}))}function g(e,t){try{return e.iterator(t).count()}catch(e){return Object(n.t)(e)}}function _(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{var i=e.iterator(r);return Object(n.c)((function(e,r){O(i,[],t,a,e,r)}))}catch(s){return Object(n.t)(s)}}function O(e,t,r,n,i,s){Object(a.q)(e.next().then((function(a){try{if(null!==a){var u=r.calculateValue(a);return null===u?!1===n&&(t[t.length]=u):t[t.length]=u,O(e,t,r,n,i,s)}i(t)}catch(e){s(e)}}),s))}function j(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return function(e,t,r,a){try{return w(e.iterator(a),{},[],t,r)}catch(e){return Object(n.t)(e)}}(e,t,r,a)}function w(e,t,r,n,a){return e.next().then((function(i){if(null!==i){var s=n.calculateValue(i);return null!=s&&void 0===t[s]&&(r.push(s),t[s]=1),r.length>=a&&-1!==a?r:w(e,t,r,n,a)}return r}))}},960:function(e,t,r){"use strict";var n=r(2),a=r(3),i=function(){function e(){Object(n.a)(this,e),this._databaseTypeMetaData={},this._layerInfo={}}return Object(a.a)(e,[{key:"clearDatabaseType",value:function(e){void 0===this._databaseTypeMetaData[e]&&delete this._databaseTypeMetaData[e]}},{key:"getDatabaseType",value:function(e){return"MUSTBESET"===e||void 0===this._databaseTypeMetaData[e]?null:this._databaseTypeMetaData[e]}},{key:"setDatabaseType",value:function(e,t){this._databaseTypeMetaData[e]=t}},{key:"getLayerInfo",value:function(e){return void 0===this._layerInfo[e]?null:this._layerInfo[e]}},{key:"setLayerInfo",value:function(e,t){this._layerInfo[e]=t}},{key:"clearLayerInfo",value:function(e){void 0!==this._layerInfo[e]&&delete this._layerInfo[e]}}]),e}();i.applicationCache=null,t.a=i},961:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(2),a=r(3),i=r(5),s=r(6),u=r(16),l=r(809),o=r(835),c=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).declaredClass="esri.layers.featureset.sources.Empty",a._maxProcessing=1e3,a._wset=new o.a([],[],!1,null),a._parent=e.parentfeatureset,a._databaseType=l.a.Standardised,a}return Object(a.a)(r,[{key:"_getSet",value:function(){return Object(u.u)(this._wset)}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"_isInFeatureSet",value:function(){return l.b.NotInFeatureSet}},{key:"_getFeature",value:function(){return Object(u.t)(new Error("No Feature Found in EmptySet"))}},{key:"queryAttachments",value:function(){return Object(u.u)([])}},{key:"_getFeatures",value:function(){return Object(u.u)("success")}},{key:"_featureFromCache",value:function(){return null}},{key:"_fetchAndRefineFeatures",value:function(){return Object(u.t)(new Error("Fetch and Refine should not be called in this featureset"))}},{key:"_getFilteredSet",value:function(){return Object(u.u)(new o.a([],[],!1,null))}},{key:"_stat",value:function(e,t,r,n,a,i,s){return this._manualStat(e,t,i,s)}},{key:"_canDoAggregates",value:function(){return Object(u.u)(!1)}}]),r}(r(848).a)},974:function(e,t,r){"use strict";var n=r(2),a=r(3),i=r(5),s=r(6),u=r(16),l=r(44),o=r(809),c=r(835),d=r(710),f=r(885),p=r(848),h=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).declaredClass="esri.arcade.featureset.actions.AttributeFilter",a._maxProcessing=1e3,a._parent=e.parentfeatureset,e.whereclause instanceof d.WhereClause?(a._whereclause=e.whereclause,a._whereClauseFunction=null):(a._whereClauseFunction=e.whereclause,a._whereclause=null),a}return Object(a.a)(r,[{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new l.a({wkid:4326}),this.geometryType=o.m.point)}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._parent._getFilteredSet("",null,t._whereclause,null,e)})).then((function(r){return t._checkCancelled(e),null!==t._whereClauseFunction?t._wset=new c.a(r._candidates.slice(0).concat(r._known.slice(0)),[],r._ordered,t._clonePageDefinition(r.pagesDefinition)):t._wset=new c.a(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset})):Object(u.u)(this._wset)}},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);return t===o.b.NotInFeatureSet?t:void 0===(t=this._idstates[e])?o.b.Unknown:t}},{key:"_getFeature",value:function(e,t,r){return this._parent._getFeature(e,t,r)}},{key:"_getFeatures",value:function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}},{key:"_featureFromCache",value:function(e){return this._parent._featureFromCache(e)}},{key:"executeWhereClause",value:function(e){return this._whereclause.testFeature(e)}},{key:"executeWhereClauseDeferred",value:function(e){if(null!==this._whereClauseFunction)try{var t=this._whereClauseFunction(e);return Object(u.p)(t)?t:Object(u.u)(t)}catch(r){return Object(u.t)(r)}return Object(u.u)(this.executeWhereClause(e))}},{key:"_fetchAndRefineFeatures",value:function(e,t,r){var n=this,a=new c.a([],e,!1,null),i=Math.min(t,e.length);return this._parent._getFeatures(a,-1,i,r).then((function(){if(n._checkCancelled(r),null==n._whereClauseFunction){for(var a=0;a<i;a++){var s=n._parent._featureFromCache(e[a]);!0===n.executeWhereClause(s)?n._idstates[e[a]]=o.b.InFeatureSet:n._idstates[e[a]]=o.b.NotInFeatureSet}return"success"}for(var l=[],c=0;c<i;c++){var d=n._parent._featureFromCache(e[c]);l.push(n.executeWhereClauseDeferred(d))}return Object(u.b)(l).then((function(r){for(var a=0;a<t;a++)!0===r[a]?n._idstates[e[a]]=o.b.InFeatureSet:n._idstates[e[a]]=o.b.NotInFeatureSet;return"success"}))}))}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return null!==this._whereClauseFunction||(null!==r?null!==this._whereclause&&(r=Object(f.a)(this._whereclause,r)):r=this._whereclause),this._ensureLoaded().then((function(){return i._parent._getFilteredSet(e,t,r,n,a)})).then((function(e){return i._checkCancelled(a),null!==i._whereClauseFunction?new c.a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,i._clonePageDefinition(e.pagesDefinition)):new c.a(e._candidates.slice(0),e._known.slice(0),e._ordered,i._clonePageDefinition(e.pagesDefinition))}))}},{key:"_stat",value:function(e,t,r,n,a,i,s){var l=this;if(null!==this._whereClauseFunction)return null===a&&""===r&&null===n?this._manualStat(e,t,i,s):Object(u.u)({calculated:!1});var o=this._whereclause;return null!==a&&null!==this._whereclause&&(o=Object(f.a)(this._whereclause,a)),this._parent._stat(e,t,r,n,o,i,s).then((function(u){return!1===u.calculated?null===a&&""===r&&null===n?l._manualStat(e,t,i,s):{calculated:!1}:u}))}},{key:"_canDoAggregates",value:function(e,t,r,n,a){return null!==this._whereClauseFunction?Object(u.u)(!1):(null!==a?null!==this._whereclause&&(a=Object(f.a)(this._whereclause,a)):a=this._whereclause,null===this._parent?Object(u.u)(!1):this._parent._canDoAggregates(e,t,r,n,a))}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,s){return null===this._parent?Object(u.t)(new Error("Should never be called")):(null!==a?null!==this._whereclause&&(a=Object(f.a)(this._whereclause,a)):a=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,a,i,s))}}],[{key:"registerAction",value:function(){p.a._featuresetFunctions.filter=function(e){if("function"==typeof e)return new r({parentfeatureset:this,whereclause:e});var t=null;return e instanceof d.WhereClause&&(t=e),new r({parentfeatureset:this,whereclause:t})}}}]),r}(p.a);t.a=h},975:function(e,t,r){"use strict";var n=r(12),a=r(2),i=r(3),s=r(5),u=r(6),l=r(16),o=r(823),c=r(835),d=r(848),f=r(976),p=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e))._orderbyclause=null,n.declaredClass="esri.arcade.featureset.actions.OrderBy",n._maxProcessing=100,n._orderbyclause=e.orderbyclause,n._parent=e.parentfeatureset,n}return Object(i.a)(r,[{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,t._orderbyclause,e)})).then((function(r){return t._checkCancelled(e),t._wset=r,t._wset})):Object(l.u)(this._wset)}},{key:"manualOrderSet",value:function(e,t){var r=this;return this.getIdColumnDictionary(e,[],-1,t).then((function(e){r._orderbyclause.order(e);for(var t=new c.a([],[],!0,null),n=0;n<e.length;n++)t._known.push(e[n].id);return t}))}},{key:"getIdColumnDictionary",value:function(e,t,r,a){var i=this;if(r<e._known.length-1){var s=this._maxQueryRate();if("GETPAGES"===e._known[r+1])return Object(o.q)(this._parent._expandPagedSet(e,s,0,0,a)).then((function(){return i.getIdColumnDictionary(e,t,r,a)}));for(var u=r+1,c=[];u<e._known.length&&"GETPAGES"!==e._known[u];)c.push(e._known[u]),u++;return r+=c.length,Object(o.q)(this._parent._getFeatureBatch(c,a)).then((function(s){i._checkCancelled(a);var u,l=Object(n.a)(s);try{for(l.s();!(u=l.n()).done;){var o=u.value;t.push({id:o.attributes[i.objectIdField],feature:o})}}catch(c){l.e(c)}finally{l.f()}return i.getIdColumnDictionary(e,t,r,a)}))}return e._candidates.length>0?Object(o.q)(this._refineSetBlock(e,this._maxProcessingRate(),a)).then((function(){return i._checkCancelled(a),i.getIdColumnDictionary(e,t,r,a)})):Object(l.u)(t)}},{key:"_isInFeatureSet",value:function(e){return this._parent._isInFeatureSet(e)}},{key:"_getFeatures",value:function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}},{key:"_featureFromCache",value:function(e){if(void 0===this._featureCache[e]){var t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]}},{key:"_fetchAndRefineFeatures",value:function(){return Object(l.t)(new Error("Fetch and Refine should not be called in this featureset"))}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this._ensureLoaded().then((function(){return i._parent._getFilteredSet(e,t,r,null===n?i._orderbyclause:n,a)})).then((function(e){var n;i._checkCancelled(a),n=new c.a(e._candidates.slice(0),e._known.slice(0),e._ordered,i._clonePageDefinition(e.pagesDefinition));var s=!0;return e._candidates.length>0&&(s=!1),!1===n._ordered?i.manualOrderSet(n,a).then((function(e){return!1===s&&(null===t&&null===r||(e=new c.a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,i._clonePageDefinition(e.pagesDefinition)))),e})):n}))}}],[{key:"registerAction",value:function(){d.a._featuresetFunctions.orderBy=function(e){return""===e?this:new r({parentfeatureset:this,orderbyclause:new f.a(e)})}}}]),r}(d.a);t.a=p},976:function(e,t,r){"use strict";var n=r(12),a=r(2),i=r(3);function s(e,t){return e===t?0:null===e?-1:null===t?1:e<t?-1:1}var u=function(){function e(t){Object(a.a)(this,e);var r=t.split(",");this._fields=[],this._directions=[];for(var n=0;n<r.length;n++){var i=r[n].match(/\S+/g);this._fields.push(i[0]),2===i.length?"asc"===i[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}return Object(i.a)(e,[{key:"constructClause",value:function(){for(var e="",t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e}},{key:"order",value:function(e){var t=this;e.sort((function(e,r){for(var n=0;n<t._fields.length;n++){var a,i=t.featureValue(e.feature,t._fields[n],n),u=t.featureValue(r.feature,t._fields[n],n);if(0!==(a=1===t._directions[n]?s(i,u):-1*s(i,u)))return a}return 0}))}},{key:"scanForField",value:function(e){for(var t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1}},{key:"replaceFields",value:function(t){for(var r="",a=0;a<this._fields.length;a++){0!==a&&(r+=",");var i,s=this._fields[a],u=Object(n.a)(t);try{for(u.s();!(i=u.n()).done;){var l=i.value;if(s.toLowerCase()===l.field.toLowerCase()){s=l.newfield;break}}}catch(o){u.e(o)}finally{u.f()}r+=s,1===this._directions[a]?r+=" ASC":r+=" DESC"}return new e(r)}},{key:"featureValue",value:function(e,t,r){var n=e.attributes[t];if(void 0!==n)return n;for(var a in e.attributes)if(t.toLowerCase()===a.toLowerCase())return this._fields[r]=a,e.attributes[a];return null}}]),e}();t.a=u}}]);
//# sourceMappingURL=49.d6f2da0f.chunk.js.map