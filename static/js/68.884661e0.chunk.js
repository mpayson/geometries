(this.webpackJsonpgeometries=this.webpackJsonpgeometries||[]).push([[68],{1082:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i(2),a=i(3),n=i(16),s=i(921),l=i(230),o=function(){function e(t){if(Object(r.a)(this,e),t instanceof s.a)this._tilemapCache=t;else{if(!t||!("index"in t))throw new Error("Invalid tilemap!");this._tilemap=t.index}}return Object(a.a)(e,[{key:"dataKey",value:function(e,t){if(this._tilemapCache){var i=e.level,r=e.row,a=e.col,s=new l.a(e);return this._tilemapCache.fetchAvailabilityUpsample(i,r,a,s,t).then((function(){return s.world=e.world,s})).catch((function(e){if(Object(n.n)(e))throw e;return null}))}return this._getIndexedDataKey(e)}},{key:"forEach",value:function(e,t,i,r,a){this._callback=a,this._maxLevel=t+e,this._forEach(this._tilemap,t,i,r)}},{key:"_forEach",value:function(e,t,i,r){0!==e&&(this._callback(t,i,r),t!==this._maxLevel&&"object"==typeof e&&(this._forEach(e[0],t+1,2*i,2*r),this._forEach(e[1],t+1,2*i,2*r+1),this._forEach(e[2],t+1,2*i+1,2*r),this._forEach(e[3],t+1,2*i+1,2*r+1)))}},{key:"_getIndexedDataKey",value:function(e){var t=[e];if(e.level<0||e.row<0||e.col<0||e.row>>e.level>0||e.col>>e.level>0)return Object(n.u)(null);for(var i=e;0!==i.level;)i=new l.a(i.level-1,i.row>>1,i.col>>1,i.world),t.push(i);var r,a,s=this._tilemap,o=t.pop();if(1===s)return Object(n.u)(o);for(;t.length;)if(a=(1&(r=t.pop()).col)+((1&r.row)<<1),s){if(0===s[a]){o=null;break}if(1===s[a]){o=r;break}o=r,s=s[a]}return Object(n.u)(o)}}]),e}()},1293:function(e,t,i){"use strict";i.r(t);var r=i(12),a=i(10),n=i.n(a),s=i(21),l=i(2),o=i(3),c=i(61),u=i(55),h=i(5),f=i(6),d=i(0),y=i(13),v=i(4),p=i(14),b=(i(15),i(1)),_=i(8),g=i(23),m=(i(11),i(19),i(20),i(16)),O=i(75),j=i(56),w=i(107),k=i(805),x=i(1078),S=i(465),T=i(32),I=i(177),R=i(308),C=i(952),D=(i(39),i(243),i(307)),z=i(311),A=(i(362),i(464),function e(t){Object(l.a)(this,e),this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}),P=function e(){Object(l.a)(this,e),this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1};function M(e,t,i,r,a,n){var s=i-a;if(s>=0)return(t>>s)+(r-(n<<s))*(e>>s);var l=-s;return t-(n-(r<<l))*(e>>l)<<l}var L=function(){function e(t,i,r){Object(l.a)(this,e),this._rows=Math.ceil(i/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(var a=0;a<this._rows;a++){this.cells[a]=new Array(this._columns);for(var n=0;n<this._columns;n++)this.cells[a][n]=[]}}return Object(o.a)(e,[{key:"getCell",value:function(e,t){var i=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),r=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][r]||null}},{key:"getCellSpan",value:function(e,t,i,r){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1)]}},{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]),e}();function V(e,t,i,a,n){var s=e.layerData.get(n);if(3===s.type){var l,o=Object(r.a)(a);try{for(o.s();!(l=o.n()).done;){var c=l.value,u=c.unique,h=void 0;if(c.selectedForRendering){var f=u.parts[0],d=f.startOpacity,y=f.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===y;var v=i?Math.floor(127*d)|y<<7:y?255:0;h=v<<24|v<<16|v<<8|v}else h=0;var p,b=Object(r.a)(c.iconVertexRanges);try{for(b.s();!(p=b.n()).done;)for(var _=Object(T.a)(p.value,2),g=_[0],m=_[1],O=g;O<g+m;O+=4)s.iconOpacity[O/4]=h}catch(A){b.e(A)}finally{b.f()}if(c.selectedForRendering){var j=u.parts[1],w=j.startOpacity,k=j.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===k;var x=i?Math.floor(127*w)|k<<7:k?255:0;h=x<<24|x<<16|x<<8|x}else h=0;var S,I=Object(r.a)(c.textVertexRanges);try{for(I.s();!(S=I.n()).done;)for(var R=Object(T.a)(S.value,2),C=R[0],D=R[1],z=C;z<C+D;z+=4)s.textOpacity[z/4]=h}catch(A){I.e(A)}finally{I.f()}}}catch(A){o.e(A)}finally{o.f()}s.lastOpacityUpdate=t,s.opacityChanged=!0}}var U=function(){function e(t){Object(l.a)(this,e),this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;var i=1,r=new Uint32Array(t);this.layerUIDs=[];for(var a=r[i++],n=0;n<a;n++)this.layerUIDs[n]=r[i++];this.bufferDataOffset=i}return Object(o.a)(e,[{key:"isPreparedForRendering",get:function(){return Object(v.h)(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}},{key:"destroy",value:function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}},{key:"prepareForRendering",value:function(e,t){Object(v.h)(this.data)||(this.doPrepareForRendering(e,t,this.data,this.bufferDataOffset),this.data=null)}}]),e}(),B=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e){var r;Object(l.a)(this,i),(r=t.call(this,e)).type=2,r.lineIndexStart=0,r.lineIndexCount=0;var a=r.bufferDataOffset,n=new Uint32Array(e);return r.lineIndexStart=n[a++],r.lineIndexCount=n[a++],r.isLineDataDriven=!!n[a++],r.bufferDataOffset=a,r}return Object(o.a)(i,[{key:"hasData",value:function(){return this.lineIndexCount>0}},{key:"triangleCount",value:function(){return this.lineIndexCount/3}},{key:"doDestroy",value:function(){Object(v.i)(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),Object(v.i)(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),Object(v.i)(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,r,a){var n=new Uint32Array(r),s=new Int32Array(n.buffer),l=n[a++];this.lineVertexBuffer=D.a.createVertex(e,35044,new Int32Array(s.buffer,4*a,l)),a+=l;var o=n[a++];this.lineIndexBuffer=D.a.createIndex(e,35044,new Uint32Array(n.buffer,4*a,o)),a+=o,this.lineVertexArrayObject=new z.a(e,t.getProgramAttributes(3),this.isLineDataDriven?i.lineVertexAttributesDD:i.lineVertexAttributes,{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}]),i}(U);B.lineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}]},B.lineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]};var q=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e){var r;Object(l.a)(this,i),(r=t.call(this,e)).type=1,r.fillIndexStart=0,r.fillIndexCount=0,r.outlineIndexStart=0,r.outlineIndexCount=0;var a=r.bufferDataOffset,n=new Uint32Array(e);return r.fillIndexStart=n[a++],r.fillIndexCount=n[a++],r.outlineIndexStart=n[a++],r.outlineIndexCount=n[a++],r.isFillDataDriven=!!n[a++],r.isOutlineDataDriven=!!n[a++],r.bufferDataOffset=a,r}return Object(o.a)(i,[{key:"hasData",value:function(){return this.fillIndexCount>0||this.outlineIndexCount>0}},{key:"triangleCount",value:function(){return(this.fillIndexCount+this.outlineIndexCount)/3}},{key:"doDestroy",value:function(){Object(v.i)(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),Object(v.i)(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),Object(v.i)(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,Object(v.i)(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),Object(v.i)(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),Object(v.i)(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,r,a){var n=new Uint32Array(r),s=new Int32Array(n.buffer),l=n[a++];this.fillVertexBuffer=D.a.createVertex(e,35044,new Int32Array(s.buffer,4*a,l)),a+=l;var o=n[a++];this.fillIndexBuffer=D.a.createIndex(e,35044,new Uint32Array(n.buffer,4*a,o)),a+=o;var c=n[a++];this.outlineVertexBuffer=D.a.createVertex(e,35044,new Int32Array(s.buffer,4*a,c)),a+=c;var u=n[a++];this.outlineIndexBuffer=D.a.createIndex(e,35044,new Uint32Array(n.buffer,4*a,u)),a+=u,this.fillVertexArrayObject=new z.a(e,t.getProgramAttributes(1),this.isFillDataDriven?i.fillVertexAttributesDD:i.fillVertexAttributes,{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new z.a(e,t.getProgramAttributes(2),this.isOutlineDataDriven?i.outlineVertexAttributesDD:i.outlineVertexAttributes,{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}]),i}(U);q.fillVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]},q.fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]},q.outlineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}]},q.outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:12,normalized:!0,divisor:0}]};var F=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e,r){var a;Object(l.a)(this,i),(a=t.call(this,e)).type=3,a.iconPerPageElementsMap=new Map,a.glyphPerPageElementsMap=new Map,a.symbolInstances=[],a.isIconSDF=!1,a.opacityChanged=!1,a.lastOpacityUpdate=0,a.symbols=[];var n=a.bufferDataOffset,s=new Uint32Array(e),o=new Int32Array(e),c=new Float32Array(e);a.isIconSDF=!!s[n++],a.isIconDataDriven=!!s[n++],a.isTextDataDriven=!!s[n++];for(var u=s[n++],h=0;h<u;h++){var f=s[n++],d=s[n++],y=s[n++];a.iconPerPageElementsMap.set(f,[d,y])}for(var v=s[n++],p=0;p<v;p++){var b=s[n++],_=s[n++],g=s[n++];a.glyphPerPageElementsMap.set(b,[_,g])}var m=s[n++],O=s[n++];return a.iconOpacity=new Int32Array(m),a.textOpacity=new Int32Array(O),n=function(e,t,i,r,a,n){for(var s=t[r++],l=0;l<s;l++){var o=new A(n);o.xTile=t[r++],o.yTile=t[r++],o.hash=t[r++],o.priority=t[r++];for(var c=t[r++],u=0;u<c;u++){var h=t[r++],f=t[r++],d=t[r++],y=t[r++],v=!!t[r++],p=t[r++],b=i[r++],_=i[r++],g=t[r++],m=t[r++];o.colliders.push({xTile:h,yTile:f,dxPixels:d,dyPixels:y,hard:v,partIndex:p,width:g,height:m,minLod:b,maxLod:_})}for(var O=e[r++],j=0;j<O;j++)o.textVertexRanges.push([e[r++],e[r++]]);for(var w=e[r++],k=0;k<w;k++)o.iconVertexRanges.push([e[r++],e[r++]]);a.push(o)}return r}(s,o,c,n,a.symbols,r),a.bufferDataOffset=n,a}return Object(o.a)(i,[{key:"hasData",value:function(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}},{key:"triangleCount",value:function(){var e=0;return this.iconPerPageElementsMap.forEach((function(t){e+=t[1]})),this.glyphPerPageElementsMap.forEach((function(t){e+=t[1]})),e/3}},{key:"doDestroy",value:function(){Object(v.i)(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),Object(v.i)(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),Object(v.i)(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),Object(v.i)(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,Object(v.i)(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),Object(v.i)(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),Object(v.i)(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),Object(v.i)(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}},{key:"updateOpacityInfo",value:function(){if(this.opacityChanged){this.opacityChanged=!1;var e=Object(v.o)(this.iconOpacity),t=Object(v.o)(this.iconOpacityBuffer);e.length>0&&e.byteLength===t.size&&t.setSubData(e);var i=Object(v.o)(this.textOpacity),r=Object(v.o)(this.textOpacityBuffer);i.length>0&&i.byteLength===r.size&&r.setSubData(i)}}},{key:"doPrepareForRendering",value:function(e,t,r,a){var n=new Uint32Array(r),s=new Int32Array(n.buffer),l=n[a++];this.iconVertexBuffer=D.a.createVertex(e,35044,new Int32Array(s.buffer,4*a,l)),a+=l;var o=n[a++];this.iconIndexBuffer=D.a.createIndex(e,35044,new Uint32Array(n.buffer,4*a,o)),a+=o;var c=n[a++];this.textVertexBuffer=D.a.createVertex(e,35044,new Int32Array(s.buffer,4*a,c)),a+=c;var u=n[a++];this.textIndexBuffer=D.a.createIndex(e,35044,new Uint32Array(n.buffer,4*a,u)),a+=u,this.iconOpacityBuffer=D.a.createVertex(e,35044,Object(v.o)(this.iconOpacity).buffer),this.textOpacityBuffer=D.a.createVertex(e,35044,Object(v.o)(this.textOpacity).buffer),this.iconVertexArrayObject=new z.a(e,t.getProgramAttributes(4),this.isIconDataDriven?i.vertexAttributesDD:i.vertexAttributes,{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new z.a(e,t.getProgramAttributes(6),this.isTextDataDriven?i.vertexAttributesDD:i.vertexAttributes,{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}]),i}(U);F.vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}],opacity:[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}]},F.vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}],opacity:[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}]};var H=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e){var r;Object(l.a)(this,i),(r=t.call(this,e)).type=4,r.circleIndexStart=0,r.circleIndexCount=0;var a=r.bufferDataOffset,n=new Uint32Array(e);return r.circleIndexStart=n[a++],r.circleIndexCount=n[a++],r.bufferDataOffset=a,r}return Object(o.a)(i,[{key:"hasData",value:function(){return this.circleIndexCount>0}},{key:"triangleCount",value:function(){return this.circleIndexCount/3}},{key:"doDestroy",value:function(){Object(v.i)(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),Object(v.i)(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),Object(v.i)(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,r,a){var n=new Uint32Array(r),s=new Int32Array(n.buffer),l=n[a++];this.circleVertexBuffer=D.a.createVertex(e,35044,new Int32Array(s.buffer,4*a,l)),a+=l;var o=n[a++];this.circleIndexBuffer=D.a.createIndex(e,35044,new Uint32Array(n.buffer,4*a,o)),a+=o,this.circleVertexArrayObject=new z.a(e,t.getProgramAttributes(5),i.circleVertexAttributes,{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}]),i}(U);H.circleVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:16,normalized:!0,divisor:0},{name:"a_stroke_color",count:4,type:5121,offset:8,stride:16,normalized:!0,divisor:0},{name:"a_data",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};var E=i(842),N=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e,r,a,n){var s;return Object(l.a)(this,i),(s=t.call(this,e,a,n,[4096,4096]))._referenced=0,s._hasSymbolBuckets=!1,s._memoryUsedByLayerData=0,s.layerData=new Map,s.layerCount=0,s.status="loading",s.allSymbolsFadingOut=!1,s.lastOpacityUpdate=0,s.symbols=new Map,s.isCoverage=!1,s.neededForCoverage=!1,s.decluttered=!1,s.invalidating=!1,s.parentTile=null,s.childrenTiles=new Set,s._processed=!1,s._referenced=1,s.styleRepository=r,s.id=e.id,s.transforms.tileUnitsToPixels=Object(R.b)(),s}return Object(o.a)(i,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<C.d}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<C.d)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"setData",value:function(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}},{key:"deleteLayerData",value:function(e){var t,i=!1,a=Object(r.a)(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;if(this.layerData.has(n)){var s=this.layerData.get(n);this._memoryUsedByLayerData-=s.memoryUsed,3===s.type&&this.symbols.has(n)&&(this.symbols.delete(n),i=!0),s.destroy(),this.layerData.delete(n),this.layerCount--}}}catch(l){a.e(l)}finally{a.f()}i&&this.emit("symbols-changed"),this.requestRender()}},{key:"processed",value:function(){return this._processed}},{key:"hasData",value:function(){return this.layerCount>0}},{key:"dispose",value:function(){i._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy()}},{key:"release",value:function(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}},{key:"reference",value:function(){++this._referenced}},{key:"referenced",get:function(){return this._referenced}},{key:"getMemoryUsage",value:function(){return this._memoryUsedByLayerData/(this._referenced||1)}},{key:"changeDataImpl",value:function(e){var t=!1;if(e){var i,a=this._createRenderBuckets(e),n=Object(r.a)(a);try{for(n.s();!(i=n.n()).done;){var s=Object(T.a)(i.value,2),l=s[0],o=s[1];if(this.layerData.has(l)){var c=this.layerData.get(l);this._memoryUsedByLayerData-=o.memoryUsed,c.destroy(),this.layerData.delete(l),this.layerCount--}3===o.type&&(this.symbols.set(l,o.symbols),t=!0),this._memoryUsedByLayerData+=o.memoryUsed,this.layerData.set(l,o),this.layerCount++}}catch(d){n.e(d)}finally{n.f()}}this._hasSymbolBuckets=!1;var u,h=Object(r.a)(this.layerData);try{for(h.s();!(u=h.n()).done;){var f=Object(T.a)(u.value,2);f[0];3===f[1].type&&(this._hasSymbolBuckets=!0)}}catch(d){h.e(d)}finally{h.f()}t&&this.emit("symbols-changed")}},{key:"attachWithContext",value:function(e){this.stage={context:e,trashDisplayObject:function(e){e.processDetach()},untrashDisplayObject:function(){return!1}}}},{key:"setTransform",value:function(e,t){Object(c.a)(Object(u.a)(i.prototype),"setTransform",this).call(this,e,t);var r=t/(e.resolution*e.pixelRatio),a=this.size[0]/this.coordRange[0]*r,n=this.size[1]/this.coordRange[1]*r,s=[0,0];e.toScreen(s,this.coords);var l=this.transforms.tileUnitsToPixels;Object(I.e)(l),Object(I.a)(l,l,s),Object(I.i)(l,l,Math.PI*e.rotation/180),Object(I.c)(l,l,[a,n,1])}},{key:"_createRenderBuckets",value:function(e){var t,i=new Map,a=new Map,n=Object(r.a)(e);try{for(n.s();!(t=n.n()).done;){var s,l=t.value,o=this._deserializeBucket(l,a),c=Object(r.a)(o.layerUIDs);try{for(c.s();!(s=c.n()).done;){var u=s.value;i.set(u,o)}}catch(h){c.e(h)}finally{c.f()}}}catch(h){n.e(h)}finally{n.f()}return i}},{key:"_deserializeBucket",value:function(e,t){var i=t.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case 1:i=new q(e);break;case 2:i=new B(e);break;case 3:i=new F(e,this);break;case 4:i=new H(e)}return t.set(e,i),i}}],[{key:"_destroyRenderBuckets",value:function(e){var t=new Set;e.forEach((function(e){t.has(e)||(e.destroy(),t.add(e))})),e.clear()}}]),i}(E.a),Q=i(830),J=i(831),W=i(9),G=i(81),K=i(807),X=i(946),Z=i(384),Y=i(230),$=i(1082),ee=i(96),te=i(906),ie=function(){function e(t,i){Object(l.a)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new te.a(0,0,t,i))}return Object(o.a)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new te.a;for(var i=null,r=-1,a=0;a<this._free.length;++a){var n=this._free[a];e<=n.width&&t<=n.height&&(null===i||n.y<=i.y&&n.x<=i.x)&&(i=n,r=a)}return null===i?new te.a:(this._free.splice(r,1),i.width<i.height?(i.width>e&&this._free.push(new te.a(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new te.a(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new te.a(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new te.a(i.x,i.y+t,e,i.height-t))),new te.a(i.x,i.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}(),re=function(){function e(t,i,r){Object(l.a)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=i,this._glyphSource=r,this._binPack=new ie(t-4,i-4),this._glyphData.push(new Uint8Array(t*i)),this._dirties.push(!0),this._textures.push(void 0)}return Object(o.a)(e,[{key:"getGlyphItems",value:function(e,t){var i,a=this,n=[],s=this._glyphSource,l=new Set,o=Object(r.a)(t);try{for(o.s();!(i=o.n()).done;){var c=i.value,u=Math.floor(.00390625*c);l.add(u)}}catch(f){o.e(f)}finally{o.f()}var h=[];return l.forEach((function(t){if(t<=256){var i=e+t;if(a._rangePromises.has(i))h.push(a._rangePromises.get(i));else{var r=s.getRange(e,t).then((function(){a._rangePromises.delete(i)}),(function(){a._rangePromises.delete(i)}));a._rangePromises.set(i,r),h.push(r)}}})),Object(m.b)(h).then((function(){var i,l=a._glyphIndex[e];l||(l={},a._glyphIndex[e]=l),i=t;var o,c=Object(r.a)(i);try{for(c.s();!(o=c.n()).done;){var u=o.value,h=l[u];if(h)n[u]={sdf:!0,rect:h.rect,metrics:h.metrics,page:h.page,code:u};else{var d=s.getGlyph(e,u);if(d&&d.metrics){var y=d.metrics,v=void 0;if(0===y.width)v=new te.a(0,0,0,0);else{var p=y.width+6,b=y.height+6,_=p%4?4-p%4:4,g=b%4?4-b%4:4;1===_&&(_=5),1===g&&(g=5),(v=a._binPack.allocate(p+_,b+g)).isEmpty&&(a._dirties[a._currentPage]||(a._glyphData[a._currentPage]=null),a._currentPage=a._glyphData.length,a._glyphData.push(new Uint8Array(a.width*a.height)),a._dirties.push(!0),a._textures.push(void 0),a._binPack=new ie(a.width-4,a.height-4),v=a._binPack.allocate(p+_,b+g));var m=a._glyphData[a._currentPage],O=d.bitmap,j=void 0,w=void 0;if(O)for(var k=0;k<b;k++){j=p*k,w=a.width*(v.y+k+1)+v.x;for(var x=0;x<p;x++)m[w+x+1]=O[j+x]}}l[u]={rect:v,metrics:y,tileIDs:null,page:a._currentPage},n[u]={sdf:!0,rect:v,metrics:y,page:a._currentPage,code:u},a._dirties[a._currentPage]=!0}}}}catch(f){c.e(f)}finally{c.f()}return n}))}},{key:"removeGlyphs",value:function(e){for(var t in this._glyphIndex){var i=this._glyphIndex[t];if(i){var r=void 0;for(var a in i)if((r=i[a]).tileIDs.delete(e),0===r.tileIDs.size){for(var n=this._glyphData[r.page],s=r.rect,l=void 0,o=void 0,c=0;c<s.height;c++)for(l=this.width*(s.y+c)+s.x,o=0;o<s.width;o++)n[l+o]=0;delete i[a],this._dirties[r.page]=!0}}}}},{key:"bind",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[i]||(this._textures[i]=new ee.a(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var a=this._textures[i];a.setSamplingMode(t),this._dirties[i]&&a.setData(this._glyphData[i]),e.bindTexture(a,r),this._dirties[i]=!1}},{key:"dispose",value:function(){this._binPack=null;var e,t=Object(r.a)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(a){t.e(a)}finally{t.f()}this._textures.length=0}}]),e}(),ae=i(399),ne=function(){function e(t){if(Object(l.a)(this,e),this._metrics=[],this._bitmaps=[],t)for(;t.next();)switch(t.tag()){case 1:for(var i=t.getMessage();i.next();)switch(i.tag()){case 3:for(var r=i.getMessage(),a=void 0,n=void 0,s=void 0,o=void 0,c=void 0,u=void 0,h=void 0;r.next();)switch(r.tag()){case 1:a=r.getUInt32();break;case 2:n=r.getBytes();break;case 3:s=r.getUInt32();break;case 4:o=r.getUInt32();break;case 5:c=r.getSInt32();break;case 6:u=r.getSInt32();break;case 7:h=r.getUInt32();break;default:r.skip()}r.release(),a&&(this._metrics[a]={width:s,height:o,left:c,top:u,advance:h},this._bitmaps[a]=n);break;default:i.skip()}i.release();break;default:t.skip()}}return Object(o.a)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),se=function(){function e(){Object(l.a)(this,e),this._ranges=[]}return Object(o.a)(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),le=function(){function e(t){Object(l.a)(this,e),this._glyphInfo={},this._baseURL=t}return Object(o.a)(e,[{key:"getRange",value:function(e,t){var i=this._getFontStack(e);if(i.getRange(t))return Object(m.u)();var r=256*t,a=r+255,n=this._baseURL.replace("{fontstack}",e).replace("{range}",r+"-"+a);return Object(G.default)(n,{responseType:"array-buffer"}).then((function(e){i.addRange(t,new ne(new ae.a(new Uint8Array(e.data),new DataView(e.data))))})).catch((function(){i.addRange(t,new ne)}))}},{key:"getGlyph",value:function(e,t){var i=this._getFontStack(e);if(i){var r=Math.floor(t/256);if(!(r>256)){var a=i.getRange(r);return a?{metrics:a.getMetrics(t),bitmap:a.getBitmap(t)}:void 0}}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new se),t}}]),e}(),oe=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(l.a)(this,e),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(t<=0||i<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=i,r>0&&(this._maxItemSize=r),this._binPack=new ie(t-4,i-4)}return Object(o.a)(e,[{key:"getWidth",value:function(e){return e>=this._size.length?-1:this._size[e][0]}},{key:"getHeight",value:function(e){return e>=this._size.length?-1:this._size[e][1]}},{key:"setSpriteSource",value:function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new ie(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),r=new Uint32Array(t*i);this._mosaicsData[0]=r,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}},{key:"getSpriteItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._mosaicRects[e];if(i)return i;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;var r=this._sprites.getSpriteInfo(e);if(!r||!r.width||!r.height||r.width<0||r.height<0)return null;var a=r.width,n=r.height,s=this._allocateImage(a,n),l=Object(T.a)(s,3),o=l[0],c=l[1],u=l[2];return o.width<=0?null:(this._copy(o,r,c,u,t),i={rect:o,width:a,height:n,sdf:r.sdf,simplePattern:!1,pixelRatio:r.pixelRatio,page:c},this._mosaicRects[e]=i,i)}},{key:"preloadSpriteItems",value:function(){var e,t=Object(r.a)(this._sprites.spriteNames);try{for(t.s();!(e=t.n()).done;){var i=e.value;this.getSpriteItem(i,!0)}}catch(a){t.e(a)}finally{t.f()}}},{key:"getSpriteItems",value:function(e){var t,i={},a=Object(r.a)(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;i[n]=this.getSpriteItem(n)}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"getMosaicItemPosition",value:function(e,t){var i=this.getSpriteItem(e,t),r=i&&i.rect;if(!r)return null;r.width=i.width,r.height=i.height;var a=i.width,n=i.height,s=this._size[i.page];return{size:[i.width,i.height],tl:[(r.x+2)/s[0],(r.y+2)/s[1]],br:[(r.x+2+a)/s[0],(r.y+2+n)/s[1]],page:i.page}}},{key:"bind",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[i]||(this._textures[i]=new ee.a(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[i][0],height:this._size[i][1]},new Uint8Array(this._mosaicsData[i].buffer)));var a=this._textures[i];a.setSamplingMode(t),this._dirties[i]&&a.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(a,r),this._dirties[i]=!1}},{key:"_copy",value:function(t,i,r,a,n,s){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(r>=this._mosaicsData.length)){var l=new Uint32Array(s?s.buffer:this._sprites.image.buffer),o=this._mosaicsData[r];o&&l||console.error("Source or target images are uninitialized!");var c=s?i.width:this._sprites.width;e._copyBits(l,c,i.x,i.y,o,a[0],t.x+2,t.y+2,i.width,i.height,n),this._dirties[r]=!0}}},{key:"_allocateImage",value:function(e,t){e+=2,t+=2;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var r=new te.a(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[r,this._mosaicsData.length-1,[e,t]]}var a=e%4?4-e%4:4,n=t%4?4-t%4:4;1===a&&(a=5),1===n&&(n=5);var s=this._binPack.allocate(e+a,t+n);return s.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new ie(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[s,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"dispose",value:function(){this._binPack=null,this._mosaicRects={};var e,t=Object(r.a)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(a){t.e(a)}finally{t.f()}this._textures.length=0}}],[{key:"_copyBits",value:function(e,t,i,r,a,n,s,l,o,c,u){var h=r*t+i,f=l*n+s;if(u){f-=n;for(var d=-1;d<=c;h=((++d+c)%c+r)*t+i,f+=n)for(var y=-1;y<=o;y++)a[f+y]=e[h+(y+o)%o]}else for(var v=0;v<c;v++){for(var p=0;p<o;p++)a[f+p]=e[h+p];h+=t,f+=n}}}]),e}();function ce(e,t,i,r,a,n){e.fillStyle=t,e.fillRect(i,r,a,n)}function ue(e,t,i,r,a,n){e.strokeStyle=t,e.strokeRect(i,r,a,n)}function he(e,t){e.strokeStyle="black";for(var i=t.cellSize,r=t.rows,a=t.columns,n=0;n<r;n++)for(var s=t.cells[n],l=n*i,o=(n+1)*i,c=0;c<a;c++){var u=s[c],h=c*i,f=(c+1)*i;e.strokeRect(h,l,f-h,o-l),e.fillText("cells:".concat(u.length),h+4,l+12)}}function fe(e,t){for(var i=window.COLLISION_XRAY,a=0;a<t.length;++a){var n=!t[a].unique.show;if(i||!n){var s,l=Object(r.a)(t[a].colliders);try{for(l.s();!(s=l.n()).done;){var o=s.value;if(o.enabled){var c=!t[a].unique.parts[o.partIndex].show;if(i||!c){var u=o.xScreen,h=o.yScreen,f=o.dxScreen,d=o.dyScreen;e.globalAlpha=n||c?.2:1,ce(e,"green",u-1,h-1,3,3),ue(e,"red",u+f,h+d,o.width,o.height),ce(e,"blue",u+f-1,h+d-1,3,3),e.globalAlpha=1}}}}catch(y){l.e(y)}finally{l.f()}}}}var de=new X.a(10),ye=new Map,ve=function(){function e(t,i,r,a){Object(l.a)(this,e),this._vectorTileLayer=t,this._styleRepository=i,this.devicePixelRatio=r,this._memCache=a,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map}return Object(o.a)(e,[{key:"destroy",value:function(){this._ongoingTileRequests&&this.abortAll(),this._connection&&(this._connection.close(),this._connection=null),this._styleRepository=null,this._vectorTileLayer=null,this._spriteMosaic&&(this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic=null)}},{key:"spriteMosaic",get:function(){var e=this;return this._spriteSourcePromise.then((function(){return e._spriteMosaic}))}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}},{key:"start",value:function(){var e=Object(s.a)(n.a.mark((function e(t){var i,r,a,s,l,o,c=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s in i=this._vectorTileLayer,r=i.sourceNameToSource,a=[],r)a.push(this._fetchTileMap(r[s],t));return this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,t),this._spriteSourcePromise.then((function(e){c._spriteMosaic=new oe(1024,1024,250),c._spriteMosaic.setSpriteSource(e)})),l=this._styleRepository,o=new le(l.glyphs),e.abrupt("return",(this._glyphMosaic=new re(1024,1024,o),this._broadcastPromise=Object(Z.b)("WorkerTileHandler",{client:this,scheduler:t.scheduler,signal:t.signal}).then((function(e){return c._connection=e,Object(m.b)(c._connection.broadcast("setStyle",{style:i.currentStyleInfo.style,vectorTileLayerMaxBuffers:Object(y.a)("vectortilelayer-max-buffers")},t))})),Object(m.b)(a)));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateStyle",value:function(){var e=Object(s.a)(n.a.mark((function e(t){var i=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._broadcastPromise=Object(m.c)((function(e,r){Object(m.b)(i._connection.broadcast("updateStyle",t)).then(e,r)})),e.abrupt("return",this._broadcastPromise);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setStyle",value:function(){var e=Object(s.a)(n.a.mark((function e(t,i){var r,a,s,l,o=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:for(s in this._styleRepository=t,r=this._vectorTileLayer.sourceNameToSource,a=[],r)a.push(this._fetchTileMap(r[s],null));return this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,null),this._spriteSourcePromise.then((function(e){o._spriteMosaic=new oe(1024,1024,250),o._spriteMosaic.setSpriteSource(e)})),l=new le(t.glyphs),e.abrupt("return",(this._glyphMosaic=new re(1024,1024,l),this._broadcastPromise=Object(m.c)((function(e,t){Object(m.b)(o._connection.broadcast("setStyle",{style:i,vectorTileLayerMaxBuffers:Object(y.a)("vectortilelayer-max-buffers")})).then(e,t)})),a.push(this._broadcastPromise),Object(m.b)(a)));case 8:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"getVectorTile",value:function(e,t,i,r){var a=this,n=new Y.a(e,t,i,0);if(Object(v.i)(this._memCache)){var s=this._memCache.get(n.id);if(Object(v.i)(s))return s.reference(),Object(m.u)(s)}return this._getVectorTileData(n).then((function(e){if(Object(m.w)(r),Object(v.i)(a._memCache)){var t=a._memCache.get(n.id);if(Object(v.i)(t))return t.reference(),t}if(!a._vectorTileLayer)return null;var i=a._vectorTileLayer.tileInfo.getTileBounds(Object(w.g)(),n),s=new N(n,a._styleRepository,i,[512,512]);if(e&&e.tileData){if(s.setData(e.tileData),Object(v.i)(a._memCache)){s.reference();var l=s.getMemoryUsage();l>0&&a._memCache.put(s.key.id,s,l*s.referenced,K.a)}}else s.setData(null);return s}))}},{key:"releaseVectorTile",value:function(e){Object(v.h)(this._memCache)||e.release()||this._memCache.updateSize(e.key.id,e,e.getMemoryUsage()*e.referenced)}},{key:"fetchTileData",value:function(e,t){var i=this;return this._getRefKeys(e,t).then((function(e){var r=i._vectorTileLayer.sourceNameToSource,a=[];for(var n in r)a.push(n);return i._getSourcesData(a,e,t)}))}},{key:"parseTileData",value:function(e,t){var i=this,r=e&&e.data;if(!r)return Object(m.u)(null);var a=r.sourceName2DataAndRefKey,n=r.transferList;return 0===Object.keys(a).length?Object(m.u)(null):this._broadcastPromise.then((function(){return i._connection.getAvailableClient().then((function(i){return i.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:a,styleLayerUIDs:e.styleLayerUIDs},Object(W.a)(Object(W.a)({},t),{},{transferList:n})).then((function(e){if(Object(y.a)("esri-vector-tiles-debug")){var t={};for(var i in a)t[i]=a[i].refKey;return{tileData:e,refKeys:t}}return{tileData:e}}))}))}))}},{key:"updating",get:function(){return this._ongoingTileRequests.size>0}},{key:"abortAll",value:function(){this._ongoingRequestToController.forEach((function(e){return e.abort()})),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()}},{key:"getSprites",value:function(){var e=Object(s.a)(n.a.mark((function e(t){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._spriteSourcePromise;case 2:return e.abrupt("return",this._spriteMosaic.getSpriteItems(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGlyphs",value:function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}},{key:"perfReport",value:function(e){!function(e,t,i){if(window.PERFORMANCE_RECORDING_STORAGE){var r=window.PERFORMANCE_RECORDING_STORAGE;r.perf=r.perf||{};var a=r.perf;a[e]=a[e]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:i},a[e].time+=t,a[e].samples.push(t),(null==a[e].min||t<a[e].min)&&(a[e].min=t),(null==a[e].max||t>a[e].max)&&(a[e].max=t)}}(e.key,e.milliseconds,"ms")}},{key:"_getTilePayload",value:function(){var e=Object(s.a)(n.a.mark((function e(t,i,r){var a,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Y.a.pool.acquire(t.id),s=this._vectorTileLayer.sourceNameToSource[i].getSourceTileUrl(a.level,a.row,a.col),Y.a.pool.release(a),e.prev=2,e.next=5,Object(G.default)(s,Object(W.a)({responseType:"array-buffer"},r));case 5:return e.t0=e.sent.data,e.t1=i,e.abrupt("return",{protobuff:e.t0,sourceName:e.t1});case 10:if(e.prev=10,e.t2=e.catch(2),!Object(m.n)(e.t2)){e.next=14;break}throw e.t2;case 14:return e.abrupt("return",{protobuff:null,sourceName:i});case 15:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t,i,r){return e.apply(this,arguments)}}()},{key:"_fetchTileMap",value:function(){var e=Object(s.a)(n.a.mark((function e(t,i){var r,a,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.capabilities.operations.supportsTileMap||!t.tileIndex){e.next=2;break}return e.abrupt("return",Object(m.u)());case 2:if(t.tileMapURL){e.next=4;break}return e.abrupt("return");case 4:if(!(r=de.get(t.tileMapURL))){e.next=7;break}return e.abrupt("return",void(t.tileIndex=r));case 7:if(!ye.has(t.tileMapURL)){e.next=20;break}return e.prev=8,e.next=11,ye.get(t.tileMapURL);case 11:a=e.sent,t.tileIndex=new $.a(a.data),e.next=19;break;case 15:if(e.prev=15,e.t0=e.catch(8),!Object(m.n)(e.t0)){e.next=19;break}throw e.t0;case 19:return e.abrupt("return");case 20:return s=Object(G.default)(t.tileMapURL,i),ye.set(t.tileMapURL,s),e.prev=22,e.next=25,s;case 25:a=e.sent,ye.delete(t.tileMapURL),de.put(t.tileMapURL,t.tileIndex),t.tileIndex=new $.a(a.data),e.next=35;break;case 31:if(e.prev=31,e.t1=e.catch(22),ye.delete(t.tileMapURL),!Object(m.n)(e.t1)){e.next=35;break}throw e.t1;case 35:case"end":return e.stop()}}),e,null,[[8,15],[22,31]])})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_getRefKeys",value:function(e,t){var i=this._vectorTileLayer.sourceNameToSource,r=new Array;for(var a in i){var n=i[a].getRefKey(e,t);r.push(n)}return Object(m.j)(r)}},{key:"_getSourcesData",value:function(e,t,i){for(var r=[],a=0;a<t.length;a++)if(null==t[a].value||null==e[a])r.push(null);else{var n=this._getTilePayload(t[a].value,e[a],i);r.push(n)}return Object(m.j)(r).then((function(e){for(var i={},r=[],a=0;a<e.length;a++)if(e[a].value&&e[a].value&&e[a].value.protobuff&&e[a].value.protobuff.byteLength>0){var n=t[a].value.id;i[e[a].value.sourceName]={refKey:n,protobuff:e[a].value.protobuff},r.push(e[a].value.protobuff)}return{sourceName2DataAndRefKey:i,transferList:r}}))}},{key:"_getVectorTileData",value:function(e){var t=this,i=e.id;if(this._ongoingTileRequests.has(i))return this._ongoingTileRequests.get(i);var r=new AbortController,a={signal:r.signal},n=this._getParsedVectorTileData(e,a).then((function(e){return t._ongoingTileRequests.delete(i),t._ongoingRequestToController.delete(i),e})).catch((function(){return t._ongoingTileRequests.delete(i),t._ongoingRequestToController.delete(i),null}));return this._ongoingTileRequests.set(i,n),this._ongoingRequestToController.set(i,r),n}},{key:"_getParsedVectorTileData",value:function(e,t){var i=this;return this.fetchTileData(e,t).then((function(r){return i.parseTileData({key:e,data:r},t)}))}}]),e}(),pe=i(820),be=i(284),_e=function(e,t){return e+1/(1<<2*t)},ge=function(){function e(t,i){Object(l.a)(this,e),this._tiles=new Map,this._tileCache=new pe.a(40,(function(e){return e.dispose()})),this._viewSize=[0,0],this._visibleTiles=new Map,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this._container=i}return Object(o.a)(e,[{key:"destroy",value:function(){this._tiles.clear(),this._tiles=null,this._tileCache.clear(),this._tileCache=null}},{key:"update",value:function(e){this._updateCacheSize(e);var t,i=this.tileInfoView,a=i.getTileCoverage(e.state,0,"smallest"),n=a.spans,s=a.lodInfo,l=s.level,o=new Set,c=new Set,u=Object(r.a)(n);try{for(u.s();!(t=u.n()).done;)for(var h=t.value,f=h.row,d=h.colFrom,y=h.colTo,v=d;v<=y;v++){var p=Y.a.getId(l,f,s.normalizeCol(v),s.getWorldForColumn(v)),b=this._getOrAcquireTile(p);o.add(p),b.processed()?this._addToContainer(b):c.add(new Y.a(p))}}catch(L){u.e(L)}finally{u.f()}var _,g=Object(r.a)(this._tiles);try{for(g.s();!(_=g.n()).done;){var m=Object(T.a)(_.value,2),O=m[0];m[1].isCoverage=o.has(O)}}catch(L){g.e(L)}finally{g.f()}var j,w=Object(r.a)(c);try{for(w.s();!(j=w.n()).done;){var k=j.value;this._findPlaceholdersForMissingTiles(k,o)}}catch(L){w.e(L)}finally{w.f()}var x,S=!1,I=Object(r.a)(this._tiles);try{for(I.s();!(x=I.n()).done;){var R=Object(T.a)(x.value,2),C=R[0],D=R[1];D.neededForCoverage=o.has(C),D.neededForCoverage||D.isHoldingForFade&&i.intersects(a,D.key)&&o.add(C),D.isFading&&(S=!0)}}catch(L){I.e(L)}finally{I.f()}var z,A=Object(r.a)(this._tiles);try{for(A.s();!(z=A.n()).done;){var P=Object(T.a)(z.value,2),M=P[0];P[1];o.has(M)||this._releaseTile(M)}}catch(L){A.e(L)}finally{A.f()}return be.a.pool.release(a),!S}},{key:"clear",value:function(){this._tiles.clear(),this._tileCache.clear(),this._visibleTiles.clear()}},{key:"clearCache",value:function(){this._tileCache.clear()}},{key:"_findPlaceholdersForMissingTiles",value:function(e,t){var i,a=[],n=Object(r.a)(this._tiles);try{for(n.s();!(i=n.n()).done;){var s=Object(T.a)(i.value,2),l=(s[0],s[1]);this._addPlaceholderChild(a,l,e,t)}}catch(c){n.e(c)}finally{n.f()}var o=a.reduce(_e,0);Math.abs(1-o)<1e-6||this._addPlaceholderParent(e.id,t)}},{key:"_addPlaceholderChild",value:function(e,t,i,r){t.key.level<=i.level||!t.hasData()||function(e,t){var i=t.level-e.level;return e.row===t.row>>i&&e.col===t.col>>i&&e.world===t.world}(i,t.key)&&(this._addToContainer(t),r.add(t.id),e.push(t.key.level-i.level))}},{key:"_addPlaceholderParent",value:function(e,t){for(var i=e;;){if(!(i=me(i))||t.has(i))return;var r=this._getTile(i);if(r&&r.hasData())return this._addToContainer(r),void t.add(r.id)}}},{key:"_getOrAcquireTile",value:function(e){var t=this._tiles.get(e);return t||((t=this._tileCache.pop(e))||(t=this.acquireTile(new Y.a(e))),this._tiles.set(e,t),t)}},{key:"_getTile",value:function(e){var t=this._tiles.get(e);return t||((t=this._tileCache.pop(e))&&this._tiles.set(e,t),t)}},{key:"_releaseTile",value:function(e){var t=this._tiles.get(e);this.releaseTile(t),this._removeFromContainer(t),this._tiles.delete(e),t.hasData()?this._tileCache.put(e,t,1):t.dispose()}},{key:"_addToContainer",value:function(e){var t,i=[],a=this._container;if(!a.contains(e)){var n,s=this._visibleTiles,l=Object(r.a)(s);try{for(l.s();!(n=l.n()).done;){var o=Object(T.a)(n.value,2),c=(o[0],o[1]);this._canConnectDirectly(e,c)&&i.push(c),Object(v.h)(t)&&this._canConnectDirectly(c,e)&&(t=c)}}catch(b){l.e(b)}finally{l.f()}if(Object(v.i)(t)){var u,h=Object(r.a)(i);try{for(h.s();!(u=h.n()).done;){var f=u.value;t.childrenTiles.delete(f),e.childrenTiles.add(f),f.parentTile=e}}catch(b){h.e(b)}finally{h.f()}t.childrenTiles.add(e),e.parentTile=t}else{var d,y=Object(r.a)(i);try{for(y.s();!(d=y.n()).done;){var p=d.value;e.childrenTiles.add(p),p.parentTile=e}}catch(b){y.e(b)}finally{y.f()}}s.set(e.id,e),a.addChild(e)}}},{key:"_removeFromContainer",value:function(e){if(this._visibleTiles.delete(e.id),this._container.removeChild(e),Object(v.i)(e.parentTile)){e.parentTile.childrenTiles.delete(e);var t,i=Object(r.a)(e.childrenTiles);try{for(i.s();!(t=i.n()).done;){var a=t.value;Object(v.i)(e.parentTile)&&e.parentTile.childrenTiles.add(a)}}catch(l){i.e(l)}finally{i.f()}}var n,s=Object(r.a)(e.childrenTiles);try{for(s.s();!(n=s.n()).done;){n.value.parentTile=e.parentTile}}catch(l){s.e(l)}finally{s.f()}e.parentTile=null,e.childrenTiles.clear()}},{key:"_canConnectDirectly",value:function(e,t){for(var i=e.key,r=t.key,a=r.level,n=r.row,s=r.col,l=r.world,o=this._visibleTiles;a>0;){if(a--,n>>=1,s>>=1,i.level===a&&i.row===n&&i.col===s&&i.world===l)return!0;if(o.has("".concat(a,"/").concat(n,"/").concat(s,"/").concat(l)))return!1}return!1}},{key:"_updateCacheSize",value:function(e){var t=e.state.size;if(t[0]!==this._viewSize[0]||t[1]!==this._viewSize[1]){var i=Math.ceil(t[0]/512)+1,r=Math.ceil(t[1]/512)+1;this._viewSize[0]=t[0],this._viewSize[1]=t[1],this._tileCache.maxSize=5*i*r}}}]),e}();function me(e){var t=e.split("/"),i=Object(T.a)(t,4),r=i[0],a=i[1],n=i[2],s=i[3],l=parseInt(r,10);return 0===l?null:"".concat(l-1,"/").concat(parseInt(a,10)>>1,"/").concat(parseInt(n,10)>>1,"/").concat(parseInt(s,10))}var Oe=i(37),je=i(781),we=i(858),ke=i(76);function xe(e,t,i,a,n,s){var l,o=a.iconRotationAlignment,c=a.textRotationAlignment,u=a.iconTranslate,h=a.iconTranslateAnchor,f=a.textTranslate,d=a.textTranslateAnchor,y=0,v=Object(r.a)(e.colliders);try{for(v.s();!(l=v.n()).done;){var p=l.value,b=0===p.partIndex?u:f,_=Object(T.a)(b,2),g=_[0],m=_[1],O=0===p.partIndex?h:d,j=p.minLod<=s&&s<=p.maxLod;y+=j?0:1,p.enabled=j,p.xScreen=p.xTile*n[0]+p.yTile*n[3]+n[6],p.yScreen=p.xTile*n[1]+p.yTile*n[4]+n[7],0===O?(p.xScreen+=i*g-t*m,p.yScreen+=t*g+i*m):(p.xScreen+=g,p.yScreen+=m),1===(0===p.partIndex?o:c)?(p.dxScreen=p.dxPixels,p.dyScreen=p.dyPixels):(p.dxScreen=i*(p.dxPixels+p.width/2)-t*(p.dyPixels+p.height/2)-p.width/2,p.dyScreen=t*(p.dxPixels+p.width/2)+i*(p.dyPixels+p.height/2)-p.height/2)}}catch(w){v.e(w)}finally{v.f()}e.colliders.length>0&&y===e.colliders.length&&(e.unique.show=!1)}var Se=function(){function e(t,i,a,n,s,o){Object(l.a)(this,e),this._symbols=t,this._styleRepository=n,this._zoom=s,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new L(i,a,C.a),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);var c,u=Object(r.a)(t);try{for(u.s();!(c=u.n()).done;){var h,f=c.value,d=Object(r.a)(f.symbols);try{for(d.s();!(h=d.n()).done;){var y=h.value;this._allNeededMatrices.has(y.tile)||this._allNeededMatrices.set(y.tile,Object(R.a)(y.tile.transforms.tileUnitsToPixels))}}catch(v){d.e(v)}finally{d.f()}}}catch(v){u.e(v)}finally{u.f()}}return Object(o.a)(e,[{key:"work",value:function(e){var t=this._gridIndex;function i(e){for(var i=e.xScreen+e.dxScreen,a=e.yScreen+e.dyScreen,n=i+e.width,s=a+e.height,l=t.getCellSpan(i,a,n,s),o=Object(T.a)(l,4),c=o[0],u=o[1],h=o[2],f=o[3],d=u;d<=f;d++)for(var y=c;y<=h;y++){var v,p=t.cells[d][y],b=Object(r.a)(p);try{for(b.s();!(v=b.n()).done;){var _=v.value,g=_.xScreen+_.dxScreen,m=_.yScreen+_.dyScreen,O=g+_.width,j=m+_.height;if(!(n<g||i>O||s<m||a>j))return!0}}catch(w){b.e(w)}finally{b.f()}}return!1}for(var a=performance.now();this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0)for(var n=this._symbols[this._currentLayerCursor],s=this._getProperties(n.styleLayerUID);this._currentSymbolCursor<n.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-a>e)return!1;var l=n.symbols[this._currentSymbolCursor];if(l.unique.show){xe(l,this._si,this._co,s,this._allNeededMatrices.get(l.tile),this._zoom);var o=l.unique;if(o.show){var c,u=s.iconAllowOverlap,h=s.iconIgnorePlacement,f=s.textAllowOverlap,d=s.textIgnorePlacement,y=Object(r.a)(l.colliders);try{for(y.s();!(c=y.n()).done;){var v=c.value;if(v.enabled){var p=o.parts[v.partIndex];p.show&&!(v.partIndex?f:u)&&i(v)&&(v.hard?o.show=!1:p.show=!1)}}}catch(A){y.e(A)}finally{y.f()}if(o.show){var b,_=Object(r.a)(l.colliders);try{for(_.s();!(b=_.n()).done;){var g=b.value;if(g.enabled&&(!(g.partIndex?d:h)&&o.parts[g.partIndex].show))for(var m=g.xScreen+g.dxScreen,O=g.yScreen+g.dyScreen,j=m+g.width,w=O+g.height,k=this._gridIndex.getCellSpan(m,O,j,w),x=Object(T.a)(k,4),S=x[0],I=x[1],R=x[2],C=x[3],D=I;D<=C;D++)for(var z=S;z<=R;z++)this._gridIndex.cells[D][z].push(g)}}catch(A){_.e(A)}finally{_.f()}}}}}return!0}},{key:"_getProperties",value:function(e){var t=this._styleProps.get(e);if(t)return t;var i=this._zoom,r=this._styleRepository.getStyleLayerByUID(e),a=0!==r.getLayoutValue("symbol-placement",i),n=r.getLayoutValue("icon-rotation-alignment",i);2===n&&(n=a?0:1);var s=r.getLayoutValue("text-rotation-alignment",i);2===s&&(s=a?0:1);var l=r.getPaintValue("icon-translate",i),o=r.getPaintValue("icon-translate-anchor",i),c=r.getPaintValue("text-translate",i),u=r.getPaintValue("text-translate-anchor",i),h={iconAllowOverlap:r.getLayoutValue("icon-allow-overlap",i),iconIgnorePlacement:r.getLayoutValue("icon-ignore-placement",i),textAllowOverlap:r.getLayoutValue("text-allow-overlap",i),textIgnorePlacement:r.getLayoutValue("text-ignore-placement",i),iconRotationAlignment:n,textRotationAlignment:s,iconTranslateAnchor:o,iconTranslate:l,textTranslateAnchor:u,textTranslate:c};return this._styleProps.set(e,h),h}}]),e}();function Te(e,t){if(e.priority-t.priority)return e.priority-t.priority;var i=e.tile.key,r=t.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}var Ie=function(){function e(t,i,r,a,n,s){Object(l.a)(this,e),this._visibleTiles=t,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=a,this._symbolLayerSorter=n,this._isLayerVisible=s,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}return Object(o.a)(e,[{key:"running",get:function(){return this._running}},{key:"setScreenSize",value:function(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}},{key:"restart",value:function(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}},{key:"continue",value:function(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){var t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){var i=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-i))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){var r=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-r))))return!1}return this._running=!1,!0}},{key:"_createSelectionJob",value:function(){var e=this._symbolRepository.uniqueSymbols,t=[],i=0,a=0,n=this._isLayerVisible,s=this._symbolLayerSorter;return{work:function(s){for(var l,o=performance.now();a<e.length;a++,i=0){var c=e[a],u=c.styleLayerUID;if(n(u)){t[a]=t[a]||{styleLayerUID:u,symbols:[]};for(var h=t[a];i<c.uniqueSymbols.length;i++){if(l=c.uniqueSymbols[i],i%100==99&&performance.now()-o>s)return!1;var f,d=null,y=!1,v=!1,p=Object(r.a)(l.tileSymbols);try{for(p.s();!(f=p.n()).done;){var b=f.value;if(b.selectedForRendering=!1,!v||!y){var _=b.tile;(!d||_.isCoverage||_.neededForCoverage&&!y)&&(d=b,(_.neededForCoverage||_.isCoverage)&&(v=!0),_.isCoverage&&(y=!0))}}}catch(w){p.e(w)}finally{p.f()}if(d.selectedForRendering=!0,v){h.symbols.push(d),l.show=!0;var g,m=Object(r.a)(l.parts);try{for(m.s();!(g=m.n()).done;){g.value.show=!0}}catch(w){m.e(w)}finally{m.f()}}else l.show=!1}}else t[a]||(t[a]={styleLayerUID:u,symbols:[]})}var O,j=Object(r.a)(t);try{for(j.s();!(O=j.n()).done;){O.value.symbols.sort(Te)}}catch(w){j.e(w)}finally{j.f()}return!0},get sortedSymbols(){return t.sort(s)}}}},{key:"_createOpacityJob",value:function(){var e=this._assignTileSymbolsOpacity,t=this._visibleTiles,i=0;function a(t,i){var n,s=t.symbols,l=Object(r.a)(s);try{for(l.s();!(n=l.n()).done;){var o=Object(T.a)(n.value,2);o[0];Re(o[1],i)}}catch(h){l.e(h)}finally{l.f()}e(t,i);var c,u=Object(r.a)(t.childrenTiles);try{for(u.s();!(c=u.n()).done;){a(c.value,i)}}catch(h){u.e(h)}finally{u.f()}}return{work:function(e){for(var r=performance.now();i<t.length;i++){if(performance.now()-r>e)return!1;var n=t[i];n.parentTile||a(n,performance.now())}return!0}}}}]),e}();function Re(e,t){var i,a=Object(r.a)(e);try{for(a.s();!(i=a.n()).done;){var n,s=i.value.unique,l=Object(r.a)(s.parts);try{for(l.s();!(n=l.n()).done;){var o=n.value,c=o.targetOpacity>.5?1:-1;o.startOpacity+=c*((t-o.startTime)/C.d),o.startOpacity=Math.min(Math.max(o.startOpacity,0),1),o.startTime=t,o.targetOpacity=s.show&&o.show?1:0}}catch(u){l.e(u)}finally{l.f()}}}catch(u){a.e(u)}finally{a.f()}}var Ce=function(){function e(t,i,r){Object(l.a)(this,e),this.tileCoordRange=t,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}return Object(o.a)(e,[{key:"uniqueSymbols",get:function(){return Object(v.h)(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}},{key:"add",value:function(e,t){this._uniqueSymbolLayerArray=null;var i=this._tiles.get(e.id);i||(i={symbols:new Map},this._tiles.set(e.id,i));var a=new Map;if(t){var n,s=Object(r.a)(t);try{for(s.s();!(n=s.n()).done;){var l=n.value;i.symbols.has(l)&&(a.set(l,i.symbols.get(l)),i.symbols.delete(l))}}catch(x){s.e(x)}finally{s.f()}}else{var o,c=Object(r.a)(e.layerData);try{for(c.s();!(o=c.n()).done;){var u=Object(T.a)(o.value,2),h=u[0];u[1];i.symbols.has(h)&&(a.set(h,i.symbols.get(h)),i.symbols.delete(h))}}catch(x){c.e(x)}finally{c.f()}}this._removeSymbols(a);var f,d=e.symbols,y=new Map,v=Object(r.a)(d);try{for(v.s();!(f=v.n()).done;){var p=Object(T.a)(f.value,2),b=p[0],_=p[1],g=_.length;if(g>=32){var m=this.tileCoordRange;do{m/=2,g/=4}while(g>8&&m>64);var O=new L(this.tileCoordRange,this.tileCoordRange,m);y.set(b,{flat:_,index:O}),i.symbols.set(b,{flat:_,index:O});var j,w=Object(r.a)(_);try{for(w.s();!(j=w.n()).done;){var k=j.value;O.getCell(k.xTile,k.yTile).push(k)}}catch(x){w.e(x)}finally{w.f()}}else y.set(b,{flat:_}),i.symbols.set(b,{flat:_})}}catch(x){v.e(x)}finally{v.f()}this._addSymbols(e.key,d)}},{key:"deleteStyleLayers",value:function(e){this._uniqueSymbolLayerArray=null;var t,i=Object(r.a)(this._tiles);try{for(i.s();!(t=i.n()).done;){var a,n=Object(T.a)(t.value,2),s=n[0],l=n[1],o=new Map,c=Object(r.a)(e);try{for(c.s();!(a=c.n()).done;){var u=a.value;l.symbols.has(u)&&(o.set(u,l.symbols.get(u)),l.symbols.delete(u))}}catch(h){c.e(h)}finally{c.f()}this._removeSymbols(o),0===l.symbols.size&&this._tiles.delete(s)}}catch(h){i.e(h)}finally{i.f()}}},{key:"removeTile",value:function(e){this._uniqueSymbolLayerArray=null;var t=this._tiles.get(e.id);if(t){var i,a=new Map,n=Object(r.a)(e.symbols);try{for(n.s();!(i=n.n()).done;){var s=Object(T.a)(i.value,2),l=s[0];s[1];t.symbols.has(l)&&(a.set(l,t.symbols.get(l)),t.symbols.delete(l))}}catch(o){n.e(o)}finally{n.f()}this._removeSymbols(a),0===t.symbols.size&&this._tiles.delete(e.id)}}},{key:"_removeSymbols",value:function(e){var t,i=Object(r.a)(e);try{for(i.s();!(t=i.n()).done;){var a,n=Object(T.a)(t.value,2),s=n[0],l=n[1].flat,o=Object(r.a)(l);try{for(o.s();!(a=o.n()).done;){for(var c=a.value,u=c.unique,h=u.tileSymbols,f=h.length-1,d=0;d<f;d++)if(h[d]===c){h[d]=h[f];break}if(h.length=f,0===f){var y=this._uniqueSymbolsReferences.get(s);y.delete(u),0===y.size&&this._uniqueSymbolsReferences.delete(s)}c.unique=null}}catch(v){o.e(v)}finally{o.f()}}}catch(v){i.e(v)}finally{i.f()}}},{key:"_addSymbols",value:function(e,t){if(0!==t.size){var i,a=this._visibleTiles,n=Object(r.a)(a);try{for(n.s();!(i=n.n()).done;){var s=i.value;s.parentTile||s.key.world!==e.world||s.key.level===e.level&&!s.key.equals(e)||this._matchSymbols(s,e,t)}}catch(_){n.e(_)}finally{n.f()}var l,o=Object(r.a)(t);try{for(o.s();!(l=o.n()).done;){var c,u=Object(T.a)(l.value,2),h=u[0],f=u[1],d=Object(r.a)(f);try{for(d.s();!(c=d.n()).done;){var y=c.value;if(Object(v.h)(y.unique)){var p=this._createUnique();y.unique=p,p.tileSymbols.push(y);var b=this._uniqueSymbolsReferences.get(h);b||(b=new Set,this._uniqueSymbolsReferences.set(h,b)),b.add(p)}}}catch(_){d.e(_)}finally{d.f()}}}catch(_){o.e(_)}finally{o.f()}}}},{key:"_matchSymbols",value:function(e,t,i){if(e.key.level>t.level){var a=e.key.level-t.level;if(e.key.row>>a!==t.row||e.key.col>>a!==t.col)return}if(t.level>e.key.level){var n=t.level-e.key.level;if(t.row>>n!==e.key.row||t.col>>n!==e.key.col)return}if(t.equals(e.key)){var s,l=Object(r.a)(e.childrenTiles);try{for(l.s();!(s=l.n()).done;){var o=s.value;this._matchSymbols(o,t,i)}}catch(N){l.e(N)}finally{l.f()}}else{var c,u=new Map,h=Object(r.a)(i);try{for(h.s();!(c=h.n()).done;){var f,d=Object(T.a)(c.value,2),y=d[0],p=d[1],b=[],_=Object(r.a)(p);try{for(_.s();!(f=_.n()).done;){var g=f.value,m=M(this.tileCoordRange,g.xTile,t.level,t.col,e.key.level,e.key.col),O=M(this.tileCoordRange,g.yTile,t.level,t.row,e.key.level,e.key.row);m>=0&&m<this.tileCoordRange&&O>=0&&O<this.tileCoordRange&&b.push({symbol:g,xTransformed:m,yTransformed:O})}}catch(N){_.e(N)}finally{_.f()}var j=[],w=e.key.level<t.level?1:1<<e.key.level-t.level,k=this._tiles.get(e.id).symbols.get(y);if(k){var x,S=k.flat,I=Object(r.a)(b);try{for(I.s();!(x=I.n()).done;){var R,C=x.value,D=!1,z=C.xTransformed,A=C.yTransformed;R=Object(v.i)(k.index)?k.index.getCell(z,A):S;var P,L=C.symbol,V=L.hash,U=Object(r.a)(R);try{for(U.s();!(P=U.n()).done;){var B=P.value;if(V===B.hash&&Math.abs(z-B.xTile)<=w&&Math.abs(A-B.yTile)<=w){var q=B.unique;L.unique=q,q.tileSymbols.push(L),D=!0;break}}}catch(N){U.e(N)}finally{U.f()}D||j.push(L)}}catch(N){I.e(N)}finally{I.f()}}j.length>0&&u.set(y,j)}}catch(N){h.e(N)}finally{h.f()}var F,H=Object(r.a)(e.childrenTiles);try{for(H.s();!(F=H.n()).done;){var E=F.value;this._matchSymbols(E,t,u)}}catch(N){H.e(N)}finally{H.f()}}}},{key:"_createUniqueSymbolLayerArray",value:function(){var e,t,i=this._uniqueSymbolsReferences,a=new Array(i.size),n=0,s=Object(r.a)(i);try{for(s.s();!(t=s.n()).done;){var l=Object(T.a)(t.value,2),o=l[0],c=l[1],u=new Array(c.size);e=0;var h,f=Object(r.a)(c);try{for(f.s();!(h=f.n()).done;){var d=h.value;u[e++]=d}}catch(y){f.e(y)}finally{f.f()}a[n]={styleLayerUID:o,uniqueSymbols:u},n++}}catch(y){s.e(y)}finally{s.f()}return a}}]),e}(),De=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e,a){var n;return Object(l.a)(this,i),(n=t.call(this)).styleRepository=e,n._tileToHandle=new Map,n._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},n._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},n._completed=!1,n._symbolRepository=new Ce(4096,a,(function(){return new P})),n._symbolDeclutterer=new Ie(a,n._symbolRepository,(function(e,t,i){return new Se(e,t,i,n.styleRepository,n._zoom,n._viewState.rotation)}),(function(e,t){e.allSymbolsFadingOut=!0,e.lastOpacityUpdate=t,function(e,t,i){var a,n=Object(r.a)(e.symbols);try{for(n.s();!(a=n.n()).done;){var s=Object(T.a)(a.value,2),l=s[0];V(e,t,i,s[1],l)}}catch(o){n.e(o)}finally{n.f()}}(e,t,!0),e.decluttered=!0,e.requestRender()}),(function(e,t){return n.styleRepository.getStyleLayerByUID(e.styleLayerUID).z-n.styleRepository.getStyleLayerByUID(t.styleLayerUID).z}),(function(e){var t=n.styleRepository.getStyleLayerByUID(e).getLayoutProperty("visibility");return!t||"none"!==t.getValue()})),n}return Object(o.a)(i,[{key:"addTile",value:function(e){var t=this;e.decluttered=!1,this._tileToHandle.set(e,e.on("symbols-changed",(function(){t._symbolRepository.add(e),t.restartDeclutter()}))),this._symbolRepository.add(e),this.restartDeclutter()}},{key:"removeTile",value:function(e){var t=this._tileToHandle.get(e);t&&(this._symbolRepository.removeTile(e),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(e))}},{key:"update",value:function(e,t){return this._zoom=e,this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]},this._continueDeclutter(),this._completed}},{key:"restartDeclutter",value:function(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}},{key:"clear",value:function(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach((function(e){return e.remove()})),this._tileToHandle.clear()}},{key:"stale",get:function(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}},{key:"deleteStyleLayers",value:function(e){this._symbolRepository.deleteStyleLayers(e)}},{key:"_continueDeclutter",value:function(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(C.b),this._completed&&this._scheduleNotifyStable())}},{key:"_scheduleNotifyStable",value:function(){var e=this;Object(v.i)(this._stableNotificationHandle)&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout((function(){e._stableNotificationHandle=null,e.emit("fade-complete")}),1.5*C.d)}},{key:"_notifyUnstable",value:function(){Object(v.i)(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this.emit("fade-start")}}]),i}(ke.a);function ze(e,t){if(e){var i=e.getLayoutProperty("visibility");if(!i||"none"!==i.getValue()&&(void 0===e.minzoom||e.minzoom<t+1e-6)&&(void 0===e.maxzoom||e.maxzoom>=t-1e-6))return!0}return!1}var Ae=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e){var r;return Object(l.a)(this,i),(r=t.call(this,e))._backgroundTiles=[],r._pointToCallbacks=new Map,r._fading=!1,r}return Object(o.a)(i,[{key:"destroy",value:function(){this.children.forEach((function(e){return e.destroy()})),this.removeAllChildren(),this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null),Object(v.i)(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[],this._pointToCallbacks.clear()}},{key:"setStyleResources",value:function(e,t,i){var r=this;if(this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=i,Object(v.h)(this._symbolFader)){var a=new De(this._styleRepository,this.children);a.on("fade-start",(function(){r.emit("fade-start"),r._fading=!0,r.requestRender()})),a.on("fade-complete",(function(){r.emit("fade-complete"),r._fading=!1,r.requestRender()})),this._symbolFader=a}Object(v.o)(this._symbolFader).styleRepository=i}},{key:"deleteStyleLayers",value:function(e){Object(v.i)(this._symbolFader)&&this._symbolFader.deleteStyleLayers(e)}},{key:"hitTest",value:function(){var e=Object(s.a)(n.a.mark((function e(t,i){var r,a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[t,i],a=Object(m.g)(),e.abrupt("return",(this._pointToCallbacks.set(r,a),this.requestRender(),a.promise));case 2:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"enterTileInvalidation",value:function(){var e,t=Object(r.a)(this.children);try{for(t.s();!(e=t.n()).done;){e.value.invalidating=!0}}catch(i){t.e(i)}finally{t.f()}}},{key:"createRenderParams",value:function(e){return Object(W.a)(Object(W.a)({},Object(c.a)(Object(u.a)(i.prototype),"createRenderParams",this).call(this,e)),{},{renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos})}},{key:"doRender",value:function(e){!this.visible||e.drawPhase!==je.c.MAP&&e.drawPhase!==je.c.DEBUG||void 0===this._spriteMosaic||Object(c.a)(Object(u.a)(i.prototype),"doRender",this).call(this,e)}},{key:"addChild",value:function(e){return Object(c.a)(Object(u.a)(i.prototype),"addChild",this).call(this,e),Object(v.i)(this._symbolFader)?this._symbolFader.addTile(e):e.decluttered=!0,this.requestRender(),e}},{key:"removeChild",value:function(e){return Object(v.i)(this._symbolFader)&&this._symbolFader.removeTile(e),this.requestRender(),Object(c.a)(Object(u.a)(i.prototype),"removeChild",this).call(this,e)}},{key:"renderChildren",value:function(e){if(e.drawPhase!==je.c.DEBUG){if(this._doRender(e),this._pointToCallbacks.size>0){var t=e.context,r=t.getBoundFramebufferObject();e.drawPhase=je.c.HITTEST;var a=e.painter.effects.hittest;a.bind(e),this._doRender(e),a.draw(e,this._pointToCallbacks),t.bindFramebuffer(r)}}else Object(c.a)(Object(u.a)(i.prototype),"renderChildren",this).call(this,e)}},{key:"removeAllChildren",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];Object(v.i)(this._symbolFader)&&this._symbolFader.removeTile(t),t.dispose()}Object(c.a)(Object(u.a)(i.prototype),"removeAllChildren",this).call(this)}},{key:"getStencilTarget",value:function(){return this.children.filter((function(e){return e.neededForCoverage&&e.hasData()}))}},{key:"restartDeclutter",value:function(){Object(v.i)(this._symbolFader)&&this._symbolFader.restartDeclutter()}},{key:"_doRender",value:function(e){var t=this,a=e.context,n=this._styleRepository;if(n){var s=n.layers,l=!0;e.drawPhase===je.c.HITTEST&&(l=!1),n.backgroundBucketIds.length>0&&(e.renderPass="background",this._renderBackgroundLayers(e,n.backgroundBucketIds)),Object(c.a)(Object(u.a)(i.prototype),"renderChildren",this).call(this,e);var o=this.children.filter((function(e){return e.visible&&e.hasData()}));if(o&&0!==o.length){var h,f=Object(r.a)(o);try{for(f.s();!(h=f.n()).done;){h.value.triangleCount=0}}catch(k){f.e(k)}finally{f.f()}a.setStencilWriteMask(0),a.setColorMask(!0,!0,!0,!0),a.setStencilOp(7680,7680,7681),a.setStencilTestEnabled(!0),a.setBlendingEnabled(!1),a.setDepthTestEnabled(!0),a.setDepthWriteEnabled(!0),a.setDepthFunction(515),a.setClearDepth(1),a.clear(a.gl.DEPTH_BUFFER_BIT),e.renderPass="opaque";for(var d=s.length-1;d>=0;d--)this._renderStyleLayer(s[d],e,o);a.setDepthWriteEnabled(!1),a.setBlendingEnabled(l),a.setBlendFunctionSeparate(1,771,1,771),e.renderPass="translucent";for(var y=0;y<s.length;y++)this._renderStyleLayer(s[y],e,o);a.setDepthTestEnabled(!1),e.renderPass="symbol";for(var p=0;p<s.length;p++)this._renderStyleLayer(s[p],e,o);if(a.bindVAO(),a.setStencilTestEnabled(!0),a.setBlendingEnabled(!0),e.drawPhase===je.c.MAP){this._fade(e.displayLevel,e.state);var b=window.COLLISION_DEBUG_CTX;if(b&&Object(v.i)(this._symbolFader)&&(b.clearRect(0,0,b.canvas.width,b.canvas.height),!this._fading||window.COLLISION_XRAY)){var _,g=Object(r.a)(this.children);try{for(g.s();!(_=g.n()).done;){var m,O,j,w=_.value;if(w.symbols)!function(){var e=[];if(w.symbols.forEach((function(t){e.push.apply(e,Object(Oe.a)(t))})),window.COLLISION_SHOW_GRID){var i=null==(m=t._symbolFader)||null==(O=m._symbolDeclutterer)||null==(j=O._collisionJob)?void 0:j._gridIndex;i&&he(b,i)}fe(b,e)}()}}catch(k){g.e(k)}finally{g.f()}}}}}}},{key:"_fade",value:function(e,t){Object(v.i)(this._symbolFader)&&(this._symbolFader.update(e,t)||this.requestRender())}},{key:"_renderStyleLayer",value:function(e,t,i){var a=t.painter,n=t.renderPass;if(void 0!==e){var s=e.getLayoutProperty("visibility");if(!s||"none"!==s.getValue()){var l;switch(e.type){case 0:return;case 1:if("opaque"!==n&&"translucent"!==t.renderPass)return;l="vtlFill";break;case 2:if("translucent"!==n)return;l="vtlLine";break;case 4:if("symbol"!==n)return;l="vtlCircle";break;case 3:if("symbol"!==n)return;l="vtlSymbol"}if(i=3===e.type?i.filter((function(e){return e.decluttered})):i.filter((function(e){return e.neededForCoverage})),"vtlSymbol"!==l){var o=t.displayLevel;if(0===i.length||void 0!==e.minzoom&&e.minzoom>=o+1e-6||void 0!==e.maxzoom&&e.maxzoom<o-1e-6)return}var c=e.uid;t.styleLayerUID=c,t.styleLayer=e;var u,h=Object(r.a)(i);try{for(h.s();!(u=h.n()).done;){if(u.value.layerData.has(c)){a.renderObjects(t,i,l);break}}}catch(f){h.e(f)}finally{h.f()}}}}},{key:"_renderBackgroundLayers",value:function(e,t){var i,a=e.context,n=e.displayLevel,s=e.painter,l=e.state,o=this._styleRepository,c=!1,u=Object(r.a)(t);try{for(u.s();!(i=u.n()).done;){var h=i.value;if(ze(o.getLayerById(h),n)){c=!0;break}}}catch(V){u.e(V)}finally{u.f()}if(c){var f=this._tileInfoView.getTileCoverage(e.state,0,"smallest"),d=f.spans,y=f.lodInfo,p=y.level,b=Object(w.g)(),_=[];if(this._renderPasses){var g=this._renderPasses[0];Object(v.i)(this._clippingInfos)&&(g.brushes[0].prepareState(e,this._clippingInfos[0]),g.brushes[0].drawMany(e,this._clippingInfos))}var m,O,j=this._backgroundTiles,k=0,x=Object(r.a)(d);try{for(x.s();!(O=x.n()).done;)for(var S=O.value,T=S.row,I=S.colFrom,R=S.colTo,C=I;C<=R;C++){if(k<j.length)(m=j[k]).key.set(p,T,y.normalizeCol(C),y.getWorldForColumn(C)),this._tileInfoView.getTileBounds(b,m.key,!1),m.bounds=b,m.coords[0]=b[0],m.coords[1]=b[3];else{var D=new Y.a(p,T,y.normalizeCol(C),y.getWorldForColumn(C));m=new E.a(D,this._tileInfoView.getTileBounds(Object(w.g)(),D),[512,512],[4096,4096]),j.push(m)}m.setTransform(l,this._tileInfoView.getTileResolution(m.key)),_.push(m),k++}}catch(V){x.e(V)}finally{x.f()}a.setStencilWriteMask(0),a.setColorMask(!0,!0,!0,!0),a.setStencilOp(7680,7680,7681),a.setStencilFunction(514,0,255);var z=!0;e.drawPhase===je.c.HITTEST&&(z=!1),a.setStencilTestEnabled(z);var A,P=Object(r.a)(t);try{for(P.s();!(A=P.n()).done;){var M=A.value,L=o.getLayerById(M);ze(L,n)&&(e.styleLayerUID=L.uid,e.styleLayer=L,s.renderObjects(e,_,"vtlBackground"))}}catch(V){P.e(V)}finally{P.f()}be.a.pool.release(f)}}}]),i}(we.a),Pe=i(383),Me=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(){var e;return Object(l.a)(this,i),(e=t.apply(this,arguments))._fullCacheLodInfos=null,e._levelByScale={},e}return Object(o.a)(i,[{key:"getTileParentId",value:function(e){var t=Y.a.pool.acquire(e),i=0===t.level?null:Y.a.getId(t.level-1,t.row>>1,t.col>>1,t.world);return Y.a.pool.release(t),i}},{key:"getTileCoverage",value:function(e,t,r){var a=Object(c.a)(Object(u.a)(i.prototype),"getTileCoverage",this).call(this,e,t,r);if(!a)return a;var n=1<<a.lodInfo.level;return a.spans=a.spans.filter((function(e){return e.row>=0&&e.row<n})),a}},{key:"scaleToLevel",value:function(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];var t,i,r=this._fullCacheLodInfos;if(e>r[0].scale)return r[0].level;for(var a=0;a<r.length-1;a++)if(e>(i=r[a+1]).scale)return(t=r[a]).level+(t.scale-e)/(t.scale-i.scale);return r[r.length-1].level}},{key:"_initializeFullCacheLODs",value:function(e){var t;if(0===e[0].level)t=e.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}));else{var i=this.tileInfo.size[0],r=this.tileInfo.spatialReference;t=Pe.a.create({size:i,spatialReference:r}).lods.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}))}for(var a=0;a<t.length;a++)this._levelByScale[t[a].scale]=t[a].level;this._fullCacheLodInfos=t}}]),i}(i(394).a),Le=p.a.getLogger("esri.views.2d.layers.VectorTileLayerView2D"),Ve=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(){var e;return Object(l.a)(this,i),(e=t.apply(this,arguments))._styleChanges=[],e._handles=new j.a,e._fetchQueue=null,e._parseQueue=null,e._isTileHandlerReady=!1,e.fading=!1,e}return Object(o.a)(i,[{key:"initialize",value:function(){var e=this,t=this.layer.tileInfo;if((t&&t.spatialReference).equals(this.view.spatialReference)){var i=this.layer.currentStyleInfo,r=i.style,a=i.spriteUrl,n=i.glyphsUrl;this._styleRepository=new x.a(r,{spriteUrl:a,glyphsUrl:n}),this._tileInfoView=new Me(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new Ae(this._tileInfoView),this._tileHandler=new ve(this.layer,this._styleRepository,window.devicePixelRatio||1,null),this.container.addChild(this._vectorTileContainer),this.handles.add([this._vectorTileContainer.on("fade-start",(function(){e.fading=!0})),this._vectorTileContainer.on("fade-complete",(function(){e.fading=!1,e.requestUpdate()}))])}else this.addResolvingPromise(Object(m.t)(new g.a("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))}},{key:"destroy",value:function(){var e;this._stop(),this.container.removeAllChildren(),this._vectorTileContainer&&(this._vectorTileContainer.destroy(),this._vectorTileContainer=null),null==(e=this._tileHandler)||e.destroy(),this._tileHandler=null}},{key:"hitTest",value:function(){var e=Object(s.a)(n.a.mark((function e(t,i){var r,a,s,l,o,c;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.suspended&&this._tileHandlerPromise){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this._tileHandlerPromise;case 4:return e.next=6,this._vectorTileContainer.hitTest(t,i);case 6:if((r=e.sent)&&0!==r.length){e.next=9;break}return e.abrupt("return",null);case 9:if(a=r[0]-1,s=this._styleRepository,l=s.getStyleLayerByUID(a)){e.next=12;break}return e.abrupt("return",null);case 12:return o=s.getStyleLayerIndex(l.id),c=new O.a({attributes:{layerId:o,layerName:l.id,layerUID:a}}),e.abrupt("return",(c.layer=this.layer,c.sourceLayer=this.layer,c));case 14:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"update",value:function(e){if(this._tileHandlerPromise&&this._isTileHandlerReady)return e.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),void(this._tileHandler.devicePixelRatio=e.pixelRatio)):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=e.state,this._parseQueue.state=e.state,this._tileManager.update(e)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}},{key:"attach",value:function(){var e=this;this._start(),this._handles.add([this.layer.on("paint-change",(function(t){if(t.isDataDriven)e._styleChanges.push({type:0,data:t}),e.notifyChange("updating"),e.requestUpdate();else{var i=e._styleRepository,r=i.getLayerById(t.layerName);if(!r)return;var a=3===r.type;i.setPaintProperties(t.layerName,t.paint),a&&e._vectorTileContainer.restartDeclutter(),e._vectorTileContainer.requestRender()}})),this.layer.on("layout-change",(function(t){var i=e._styleRepository,r=i.getLayerById(t.layer);if(r){var a=Object(k.a)(r.layout,t.layout);if(!Object(v.h)(a)){if(Object(k.b)(a,"visibility")&&1===function(e){if(Object(v.h)(e))return 0;switch(e.type){case"partial":return Object.keys(e.diff).length;case"complete":return Math.max(Object.keys(e.oldValue).length,Object.keys(e.newValue).length);case"collection":return Object.keys(e.added).length+Object.keys(e.changed).length+Object.keys(e.removed).length}}(a))return i.setLayoutProperties(t.layer,t.layout),3===r.type&&e._vectorTileContainer.restartDeclutter(),void e._vectorTileContainer.requestRender();e._styleChanges.push({type:1,data:t}),e.notifyChange("updating"),e.requestUpdate()}}})),this.layer.on("style-layer-visibility-change",(function(t){var i=e._styleRepository,r=i.getLayerById(t.layer);r&&(i.setStyleLayerVisibility(t.layer,t.visibility),3===r.type&&e._vectorTileContainer.restartDeclutter(),e._vectorTileContainer.requestRender())})),this.layer.on("style-layer-change",(function(t){e._styleChanges.push({type:2,data:t}),e.notifyChange("updating"),e.requestUpdate()})),this.layer.on("delete-style-layer",(function(t){e._styleChanges.push({type:3,data:t}),e.notifyChange("updating"),e.requestUpdate()})),this.layer.on("load-style",(function(){return e._loadStyle()}))])}},{key:"detach",value:function(){this._stop(),this._handles.removeAll()}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"canResume",value:function(){var e=Object(c.a)(Object(u.a)(i.prototype),"canResume",this).call(this),t=this.layer;if(e&&t.currentStyleInfo){var r=this.view.scale,a=t.currentStyleInfo;if(a&&a.layerDefinition){var n=a.layerDefinition;n.minScale&&n.minScale<r&&(e=!1),n.maxScale&&n.maxScale>r&&(e=!1)}}return e}},{key:"isUpdating",value:function(){var e=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||e.length>0&&e.filter((function(e){return e.invalidating})).length>0||this.fading}},{key:"acquireTile",value:function(e){var t=this,i=this._createVectorTile(e);return this._tileHandlerPromise.then((function(){t._fetchQueue.push(i.key).then((function(e){return t._parseQueue.push({key:i.key,data:e})})).then((function(e){i.once("attach",(function(){return t.requestUpdate()})),e&&(i.setData(e.tileData),t.requestUpdate(),t.notifyChange("updating"))})).catch((function(e){t.notifyChange("updating"),Object(m.n)(e)||Le.error(e)}))})),i}},{key:"releaseTile",value:function(e){var t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}},{key:"_start",value:function(){var e=this;if(this._stop(),this._tileManager=new ge({acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},tileInfoView:this._tileInfoView},this._vectorTileContainer),this.layer.currentStyleInfo){var t=new AbortController,i=this._tileHandler.start({signal:t.signal}).then((function(){e._fetchQueue=new S.a({tileInfoView:e._tileInfoView,process:function(t,i){return e._getTileData(t,i)},concurrency:15}),e._parseQueue=new S.a({tileInfoView:e._tileInfoView,process:function(t,i){return e._parseTileData(t,i)},concurrency:8}),e.requestUpdate(),e._isTileHandlerReady=!0}));this._tileHandler.spriteMosaic.then((function(t){e._vectorTileContainer.setStyleResources(t,e._tileHandler.glyphMosaic,e._styleRepository),e.requestUpdate()})),this._tileHandlerAbortController=t,this._tileHandlerPromise=i}}},{key:"_stop",value:function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null),this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null),this._tileManager&&(this._tileManager.destroy(),this._tileManager=null),this._vectorTileContainer.removeAllChildren()}}},{key:"_getTileData",value:function(){var e=Object(s.a)(n.a.mark((function e(t,i){var r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._tileHandler.fetchTileData(t,i);case 2:return r=e.sent,e.abrupt("return",(this.notifyChange("updating"),r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_parseTileData",value:function(){var e=Object(s.a)(n.a.mark((function e(t,i){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._tileHandler.parseTileData(t,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_applyStyleChanges",value:function(){var e=Object(s.a)(n.a.mark((function e(){var t,i,a,s,l,o,c,u,h,f,d,y,v=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this._tileManager.clearCache(),t=this._styleChanges,e.prev=2,e.next=5,this._tileHandler.updateStyle(t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),Le.error("error applying vector-tiles style update",e.t0.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0;case 10:if(i=this._styleRepository,a=[],t.forEach((function(e){if(3===e.type){var t=e.data,r=i.getLayerById(t.layerName);r&&a.push(r.uid)}})),s=[],t.forEach((function(e){var t=e.type,r=e.data;switch(t){case 0:i.setPaintProperties(r.layer,r.paint),l=r.layer;break;case 1:i.setLayoutProperties(r.layer,r.layout),l=r.layer;break;case 3:return void i.deleteStyleLayer(r.layerName);case 2:i.setStyleLayer(r.layer,r.index),l=r.layer.id}var a=i.getLayerById(l);a&&s.push(a.uid)})),o=this._vectorTileContainer.children,a.length>0){this._vectorTileContainer.deleteStyleLayers(a),c=Object(r.a)(o);try{for(c.s();!(u=c.n()).done;)u.value.deleteLayerData(a)}catch(n){c.e(n)}finally{c.f()}}if(this._fetchQueue.resume(),this._parseQueue.resume(),!(s.length>0)){e.next=22;break}h=[],f=Object(r.a)(o);try{for(y=function(){var e=d.value,t=v._fetchQueue.push(e.key).then((function(t){return v._parseQueue.push({key:e.key,data:t,styleLayerUIDs:s})})).then((function(t){return e.setData(t.tileData)}));h.push(t)},f.s();!(d=f.n()).done;)y()}catch(n){f.e(n)}finally{f.f()}return e.next=22,Object(m.b)(h);case 22:this._styleChanges=[],this._isTileHandlerReady=!0,this.notifyChange("updating"),this.requestUpdate();case 23:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"_loadStyle",value:function(){var e=Object(s.a)(n.a.mark((function e(){var t,i,r,a,s,l;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.currentStyleInfo,i=t.style,r=t.spriteUrl,a=t.glyphsUrl,this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this.notifyChange("updating"),this._styleRepository=new x.a(i,{spriteUrl:r,glyphsUrl:a}),this._vectorTileContainer.destroy(),this._tileManager.clear(),this._tileHandlerAbortController.abort(),this._tileHandlerAbortController=Object(m.d)(),s=this._tileHandlerAbortController.signal,this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,i),e.next=6,this._tileHandlerPromise;case 6:if(!s.aborted){e.next=8;break}return e.abrupt("return",(this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.notifyChange("updating"),void this.requestUpdate()));case 8:return e.next=10,this._tileHandler.spriteMosaic;case 10:l=e.sent,this._vectorTileContainer.setStyleResources(l,this._tileHandler.glyphMosaic,this._styleRepository),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.notifyChange("updating"),this.requestUpdate();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_createVectorTile",value:function(e){var t=this._tileInfoView.getTileBounds(Object(w.g)(),e);return new N(e,this._styleRepository,t,[512,512])}}]),i}(Object(J.a)(Q.a));Object(d.a)([Object(b.b)()],Ve.prototype,"_fetchQueue",void 0),Object(d.a)([Object(b.b)()],Ve.prototype,"_parseQueue",void 0),Object(d.a)([Object(b.b)()],Ve.prototype,"_isTileHandlerReady",void 0),Object(d.a)([Object(b.b)({dependsOn:["view.scale","layer.currentStyleInfo"]})],Ve.prototype,"suspended",void 0),Object(d.a)([Object(b.b)()],Ve.prototype,"fading",void 0),Object(d.a)([Object(b.b)({dependsOn:["_isTileHandlerPromiseFulfilled","_parseQueue.updating","_parseQueue.updating","fading"]})],Ve.prototype,"updating",void 0);var Ue=Ve=Object(d.a)([Object(_.a)("esri.views.2d.layers.VectorTileLayerView2D")],Ve);t.default=Ue},805:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return p}));var r=i(26),a=i(12),n=i(4),s=i(98),l=i(33),o=i(41),c=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function u(e){return e instanceof l.a}function h(e){return e instanceof o.a?Object.keys(e.items):u(e)?Object(s.a)(e).keys():e?Object.keys(e):[]}function f(e,t){return e instanceof o.a?e.items[t]:e[t]}function d(e){return e?e.declaredClass:null}function y(e,t){var i=e.diff;if(i&&"function"==typeof i)return i(e,t);var s=h(e),l=h(t);if(0!==s.length||0!==l.length){if(!s.length||!l.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};var o,v=l.filter((function(e){return-1===s.indexOf(e)})),p=s.filter((function(e){return-1===l.indexOf(e)})),b=s.filter((function(i){return l.indexOf(i)>-1&&f(e,i)!==f(t,i)})).concat(v,p).sort(),_=d(e);if(_&&c.indexOf(_)>-1&&b.length)return{type:"complete",oldValue:e,newValue:t};var g,m=u(e)&&u(t),O=Object(a.a)(b);try{for(O.s();!(g=O.n()).done;){var j=g.value,w=f(e,j),k=f(t,j),x=void 0;(m||"function"!=typeof w&&"function"!=typeof k)&&w!==k&&(null==w&&null==k||(x=i&&i[j]&&"function"==typeof i[j]?i[j](w,k):"object"==typeof w&&"object"==typeof k&&d(w)===d(k)?y(w,k):{type:"complete",oldValue:w,newValue:k},Object(n.i)(x)&&(Object(n.i)(o)?o.diff[j]=x:o={type:"partial",diff:Object(r.a)({},j,x)})))}}catch(S){O.e(S)}finally{O.f()}return o}}function v(e,t){if(Object(n.h)(e))return!1;var i,r=t.split("."),s=e,l=Object(a.a)(r);try{for(l.s();!(i=l.n()).done;){var o=i.value;if("complete"===s.type)return!0;if("partial"!==s.type)return!1;var c=s.diff[o];if(!c)return!1;s=c}}catch(u){l.e(u)}finally{l.f()}return!0}function p(e,t){var i,r=Object(a.a)(t);try{for(r.s();!(i=r.n()).done;){if(v(e,i.value))return!0}}catch(n){r.e(n)}finally{r.f()}return!1}function b(e,t){if("function"!=typeof e&&"function"!=typeof t&&(e||t))return!e||!t||"object"==typeof e&&"object"==typeof t&&d(e)!==d(t)?{type:"complete",oldValue:e,newValue:t}:y(e,t)}},807:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return u}));var r=i(32),a=i(12),n=i(2),s=i(3),l=i(129),o=-3,c=function(){function e(t,i,r){Object(n.a)(this,e),this._namespace=t,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}return Object(s.a)(e,[{key:"namespace",get:function(){return this._namespace.slice(0,-1)}},{key:"hitRate",get:function(){return this._hit/(this._hit+this._miss)}},{key:"size",get:function(){return this._storage.size}},{key:"maxSize",get:function(){return this._storage.maxSize}},{key:"resetHitRate",value:function(){this._hit=this._miss=0}},{key:"destroy",value:function(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this)}},{key:"put",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._storage.put(this._namespace+e,t,i,r)}},{key:"get",value:function(e){var t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}},{key:"pop",value:function(e){var t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}},{key:"updateSize",value:function(e,t,i){this._storage.updateSize(this._namespace+e,t,i)}},{key:"clear",value:function(){this._storage.clear(this._namespace)}},{key:"clearAll",value:function(){this._storage.clearAll()}},{key:"getStats",value:function(){return this._storage.getStats()}},{key:"resetStats",value:function(){this._storage.resetStats()}}]),e}(),u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10485760;Object(n.a)(this,e),this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=[],this._users=new l.a}return Object(s.a)(e,[{key:"register",value:function(e){this._users.push(e)}},{key:"deregister",value:function(e){this._users.removeUnordered(e)}},{key:"registerRemoveFunc",value:function(e,t){this._removeFuncs.push([e,t])}},{key:"deregisterRemoveFunc",value:function(e){this._removeFuncs=this._removeFuncs.filter((function(t){return t[0]!==e}))}},{key:"size",get:function(){return this._size}},{key:"maxSize",get:function(){return this._maxSize},set:function(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}},{key:"put",value:function(e,t,i,r){var a=this._db.get(e);if(a&&(this._size-=a.size,this._db.delete(e),a.entry!==t&&this._notifyRemoved(e,a.entry)),i>this._maxSize)this._notifyRemoved(e,t);else if(void 0!==t)if(!i||i<0)console.warn("Refusing to cache entry with invalid size "+i);else{var n=1+Math.max(r,-3)- -3;this._db.set(e,{entry:t,size:i,lifetime:n,lives:n}),this._size+=i,this._checkSizeLimit()}else console.warn("Refusing to cache undefined entry ")}},{key:"updateSize",value:function(e,t,i){var r=this._db.get(e);r&&r.entry===t&&(this._size-=r.size,i>this._maxSize?this._notifyRemoved(e,t):(r.size=i,this._size+=i,this._checkSizeLimit()))}},{key:"pop",value:function(e){var t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss}},{key:"get",value:function(e){var t=this._db.get(e);if(void 0!==t)return this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry;++this._miss}},{key:"getStats",value:function(){var e=this,t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((function(t,a){var n=t.lifetime;r[n]=(r[n]||0)+t.size,e._users.forAll((function(e){var r=e.namespace;if(a.startsWith(r)){var n=i[r]||0;i[r]=n+t.size}}))}));var a={};this._users.forAll((function(e){var t=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){var r=i[t]||0;i[t]=r,a[t]=Math.round(100*e.hitRate)+"%"}else a[t]="0%"}));var n=Object.keys(i);n.forEach((function(t){return i[t]=i[t]/e._size*100})),n.sort((function(e,t){return i[t]-i[e]})),n.forEach((function(e){return t[e]=Math.round(i[e])+"% / "+a[e]}));for(var s=r.length-1;s>=0;--s){var l=r[s];l&&(t["Priority "+(s+-3-1)]=Math.round(l/this.size*100)+"%")}return t}},{key:"resetStats",value:function(){this._hit=this._miss=0,this._users.forAll((function(e){return e.resetHitRate()}))}},{key:"clear",value:function(e){var t=this;this._db.forEach((function(i,r){r.startsWith(e)&&(t._size-=i.size,t._db.delete(r),t._notifyRemoved(r,i.entry))}))}},{key:"clearAll",value:function(){var e=this;this._db.forEach((function(t,i){return e._notifyRemoved(i,t.entry)})),this._size=0,this._db.clear()}},{key:"_getHitRate",value:function(){return this._hit/(this._hit+this._miss)}},{key:"_notifyRemoved",value:function(e,t){this._removeFuncs.forEach((function(i){e.startsWith(i[0])&&i[1](t)}))}},{key:"_checkSizeLimit",value:function(){if(!(this._size<=this._maxSize)){var e,t=Object(a.a)(this._db);try{for(t.s();!(e=t.n()).done;){var i=Object(r.a)(e.value,2),n=i[0],s=i[1];if(this._db.delete(n),s.lives<=1?(this._size-=s.size,this._notifyRemoved(n,s.entry)):(--s.lives,this._db.set(n,s)),this._size<=.9*this.maxSize)return}}catch(l){t.e(l)}finally{t.f()}}}}]),e}()},820:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(2),a=i(3),n=i(807),s=function(){function e(t,i){Object(r.a)(this,e),this._storage=new n.c,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}return Object(a.a)(e,[{key:"put",value:function(e,t,i){this._storage.put(e,t,i,1)}},{key:"pop",value:function(e){return this._storage.pop(e)}},{key:"get",value:function(e){return this._storage.get(e)}},{key:"clear",value:function(){this._storage.clearAll()}},{key:"destroy",value:function(){this._storage.clearAll()}},{key:"maxSize",get:function(){return this._storage.maxSize},set:function(e){this._storage.maxSize=e}}]),e}()},830:function(e,t,i){"use strict";var r=i(2),a=i(3),n=i(5),s=i(6),l=i(0),o=(i(13),i(14)),c=(i(15),i(1)),u=i(8),h=(i(11),i(19),i(20),i(33)),f=i(76),d=i(247),y=i(213),v=i(158),p=function(e){Object(n.a)(i,e);var t=Object(s.a)(i);function i(e){var a;return Object(r.a)(this,i),(a=t.call(this,e)).layer=null,a.parent=null,a}return Object(a.a)(i,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var i=e.layer&&e.layer.id||"no id",r=e.layer&&e.layer.title||"no title";throw o.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(r,"', id: '").concat(i,"')"),t),t}}))}},{key:"fullOpacity",get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){return!this.suspended&&!0===this.layer.legendEnabled}},{key:"updating",get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}},{key:"visible",get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),i}(Object(v.b)(Object(d.a)(Object(y.b)(f.a.EventedMixin(h.a)))));Object(l.a)([Object(c.b)({dependsOn:["layer.opacity","parent.fullOpacity"]})],p.prototype,"fullOpacity",null),Object(l.a)([Object(c.b)()],p.prototype,"layer",void 0),Object(l.a)([Object(c.b)()],p.prototype,"parent",void 0),Object(l.a)([Object(c.b)({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended","view?.ready"]})],p.prototype,"suspended",null),Object(l.a)([Object(c.b)({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended","view?.ready"]})],p.prototype,"suspendInfo",null),Object(l.a)([Object(c.b)({readOnly:!0,dependsOn:["suspended","layer.legendEnabled?"]})],p.prototype,"legendEnabled",null),Object(l.a)([Object(c.b)({type:Boolean,dependsOn:["updatingHandles.updating"],readOnly:!0})],p.prototype,"updating",null),Object(l.a)([Object(c.b)({dependsOn:["layer.visible"]})],p.prototype,"visible",null);var b=p=Object(l.a)([Object(u.a)("esri.views.layers.LayerView")],p);t.a=b},831:function(e,t,i){"use strict";i.d(t,"a",(function(){return z}));var r,a=i(2),n=i(3),s=i(61),l=i(55),o=i(5),c=i(6),u=i(0),h=(i(13),i(14),i(15),i(1)),f=i(8),d=(i(11),i(19),i(20),i(41)),y=i(139),v=i(30),p=function(e){Object(o.a)(i,e);var t=Object(c.a)(i);function i(){return Object(a.a)(this,i),t.apply(this,arguments)}return i}(i(28).a),b=p=Object(u.a)([Object(f.a)("esri.views.layers.support.ClipArea")],p),_=r=function(e){Object(o.a)(i,e);var t=Object(c.a)(i);function i(){var e;return Object(a.a)(this,i),(e=t.apply(this,arguments)).type="rect",e.left=null,e.right=null,e.top=null,e.bottom=null,e}return Object(n.a)(i,[{key:"clone",value:function(){return new r({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}},{key:"version",get:function(){return(this._get("version")||0)+1}}]),i}(b);Object(u.a)([Object(h.b)({type:[Number,String],json:{write:!0}})],_.prototype,"left",void 0),Object(u.a)([Object(h.b)({type:[Number,String],json:{write:!0}})],_.prototype,"right",void 0),Object(u.a)([Object(h.b)({type:[Number,String],json:{write:!0}})],_.prototype,"top",void 0),Object(u.a)([Object(h.b)({type:[Number,String],json:{write:!0}})],_.prototype,"bottom",void 0),Object(u.a)([Object(h.b)({readOnly:!0,dependsOn:["left","right","top","bottom"]})],_.prototype,"version",null);var g,m=_=r=Object(u.a)([Object(f.a)("esri.views.layers.support.ClipRect")],_),O=i(891),j=i(111),w=i(62),k=i(82),x=i(59),S=(i(77),{base:j.a,key:"type",typeMap:{extent:w.a,polygon:k.a}}),T=g=function(e){Object(o.a)(i,e);var t=Object(c.a)(i);function i(){var e;return Object(a.a)(this,i),(e=t.apply(this,arguments)).type="geometry",e.geometry=null,e}return Object(n.a)(i,[{key:"version",get:function(){return(this._get("version")||0)+1}},{key:"clone",value:function(){return new g({geometry:this.geometry.clone()})}}]),i}(b);Object(u.a)([Object(h.b)({types:S,json:{read:x.a,write:!0}})],T.prototype,"geometry",void 0),Object(u.a)([Object(h.b)({readOnly:!0,dependsOn:["geometry"]})],T.prototype,"version",null);var I=T=g=Object(u.a)([Object(f.a)("esri.views.layers.support.Geometry")],T),R=function(e){Object(o.a)(i,e);var t=Object(c.a)(i);function i(){var e;return Object(a.a)(this,i),(e=t.apply(this,arguments)).type="path",e.path=[],e}return Object(n.a)(i,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),i}(b);Object(u.a)([Object(h.b)({type:[[[Number]]],json:{write:!0}})],R.prototype,"path",void 0),Object(u.a)([Object(h.b)({readOnly:!0,dependsOn:["path"]})],R.prototype,"version",null);var C=R=Object(u.a)([Object(f.a)("esri.views.layers.support.Path")],R),D=d.a.ofType({key:"type",base:b,typeMap:{rect:m,path:C,geometry:I}}),z=function(e){var t=function(e){Object(o.a)(i,e);var t=Object(c.a)(i);function i(){var e;return Object(a.a)(this,i),(e=t.apply(this,arguments)).clips=new D,e.moving=!1,e.attached=!1,e.lastUpdateId=-1,e.updateRequested=!1,e}return Object(n.a)(i,[{key:"initialize",value:function(){var e,t=this;this.container||(this.container=new O.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(v.a)(this,"suspended",(function(e){t.container&&(t.container.visible=!e),t.view&&!e&&t.updateRequested&&t.view.requestUpdate()}),!0),Object(v.a)(this,["layer.opacity","container"],(function(){var e,i;t.container&&(t.container.opacity=null!=(e=null==(i=t.layer)?void 0:i.opacity)?e:1)}),!0),Object(v.a)(this,["layer.blendMode"],(function(e){t.container&&(t.container.blendMode=e)}),!0),Object(v.a)(this,["layer.effect"],(function(e){t.container&&(t.container.effect=e)}),!0),this.clips.on("change",(function(){t.container.clips=t.clips,t.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((function(e){e!==t||t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){})):this.when().then((function(){t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){}))}},{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}},{key:"isVisibleAtScale",value:function(e){var t=!0,i=this.layer,r=i.minScale,a=i.maxScale;if(null!=r&&null!=a){var n=!r,s=!a;!n&&e<=r&&(n=!0),!s&&e>=a&&(s=!0),t=n&&s}return t}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}},{key:"processUpdate",value:function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}},{key:"isUpdating",value:function(){return!1}},{key:"isRendering",value:function(){return!1}},{key:"canResume",value:function(){return!!Object(s.a)(Object(l.a)(i.prototype),"canResume",this).call(this)&&this.isVisibleAtScale(this.view.scale)}}]),i}(e);return Object(u.a)([Object(h.b)({type:D,set:function(e){var t=Object(y.b)(e,this._get("clips"),D);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(u.a)([Object(h.b)()],t.prototype,"moving",void 0),Object(u.a)([Object(h.b)()],t.prototype,"attached",void 0),Object(u.a)([Object(h.b)()],t.prototype,"container",void 0),Object(u.a)([Object(h.b)({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),Object(u.a)([Object(h.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(u.a)([Object(h.b)()],t.prototype,"updateRequested",void 0),Object(u.a)([Object(h.b)({dependsOn:["attached","updateRequested","suspended"]})],t.prototype,"updating",null),Object(u.a)([Object(h.b)()],t.prototype,"view",void 0),t=Object(u.a)([Object(f.a)("esri.views.2d.layers.LayerView2D")],t)}},842:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i(32),a=i(2),n=i(3),s=i(5),l=i(6),o=(i(13),i(177)),c=i(230),u=i(308),h=function(e){Object(s.a)(i,e);var t=Object(l.a)(i);function i(e,r,n){var s,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return Object(a.a)(this,i),(s=t.call(this)).triangleCountReportedInDebug=0,s.transforms={dvs:Object(u.b)(),tileMat3:Object(u.b)()},s.triangleCount=0,s.key=new c.a(e),s.bounds=r,s.size=n,s.coordRange=l,s}return Object(n.a)(i,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"coords",get:function(){return this._coords}},{key:"bounds",get:function(){return this._bounds},set:function(e){this._coords=[e[0],e[3]],this._bounds=e}},{key:"setTransform",value:function(e,t){var i=t/(e.resolution*e.pixelRatio),a=this.transforms.tileMat3,n=e.toScreenNoRotation([0,0],this.coords),s=Object(r.a)(n,2),l=s[0],c=s[1],u=this.size[0]/this.coordRange[0]*i,h=this.size[1]/this.coordRange[1]*i;Object(o.j)(a,u,0,0,0,h,0,l,c,1),Object(o.g)(this.transforms.dvs,e.displayViewMat3,a)}}]),i}(i(868).a)},858:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i(12),a=i(37),n=i(9),s=i(2),l=i(3),o=i(61),c=i(55),u=i(5),h=i(6),f=i(781),d=i(920),y=i(911),v=i(898),p=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},b=function(e){Object(u.a)(i,e);var t=Object(h.a)(i);function i(e){var r;return Object(s.a)(this,i),(r=t.call(this))._tileInfoView=e,r}return Object(l.a)(i,[{key:"renderChildren",value:function(e){this.sortChildren(p),this.setStencilReference(),Object(o.a)(Object(c.a)(i.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state;return Object(n.a)(Object(n.a)({},Object(o.a)(Object(c.a)(i.prototype),"createRenderParams",this).call(this,e)),{},{requiredLevel:this._tileInfoView.getClosestInfoForScale(t.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(t.scale)})}},{key:"prepareRenderPasses",value:function(e){var t=this,r=e.registerRenderPass({name:"stencil",brushes:[y.a],drawPhase:f.c.DEBUG|f.c.MAP|f.c.HIGHLIGHT,target:function(){return t.getStencilTarget()}}),n=e.registerRenderPass({name:"tileInfo",brushes:[d.a],drawPhase:f.c.DEBUG,target:function(){return t.children},has:"esri-tiles-debug"});return[].concat(Object(a.a)(Object(o.a)(Object(c.a)(i.prototype),"prepareRenderPasses",this).call(this,e)),[r,n])}},{key:"getStencilTarget",value:function(){return this.children}},{key:"updateTransforms",value:function(e){var t,i=Object(r.a)(this.children);try{for(i.s();!(t=i.n()).done;){var a=t.value,n=this._tileInfoView.getTileResolution(a.key);a.setTransform(e,n)}}catch(s){i.e(s)}finally{i.f()}}},{key:"setStencilReference",value:function(){var e,t=1,i=Object(r.a)(this.children);try{for(i.s();!(e=i.n()).done;){e.value.stencilRef=t++}}catch(a){i.e(a)}finally{i.f()}}}]),i}(v.a)},906:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(2),a=i(3),n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(r.a)(this,e),this.x=t,this.y=i,this.width=a,this.height=n}return Object(a.a)(e,[{key:"isEmpty",get:function(){return this.width<=0||this.height<=0}},{key:"union",value:function(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}]),e}()},921:function(e,t,i){"use strict";i.d(t,"a",(function(){return z}));var r=i(10),a=i.n(r),n=i(21),s=i(9),l=i(2),o=i(3),c=i(5),u=i(6),h=i(0),f=(i(13),i(14)),d=i(1),y=i(73),v=i(8),p=i(23),b=i(11),_=(i(19),i(20),i(129)),g=i(16),m=i(102),O=i(33),j=i(81),w=i(56),k=i(30),x=i(820),S=i(24),T=i(133),I=function(){function e(){Object(l.a)(this,e),this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}return Object(o.a)(e,[{key:"getAvailability",value:function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;var i=(e-this.location.top)*this.location.width+(t-this.location.left),r=i%8,a=i>>3,n=this._tileAvailabilityBitSet;return a<0||a>n.length?"unknown":n[a]&1<<r?"available":"unavailable"}},{key:"_updateFromData",value:function(e){for(var t=this.location.width,i=this.location.height,r=!0,a=!0,n=Math.ceil(t*i/8),s=new Uint8Array(n),l=0,o=0;o<e.length;o++){var c=o%8;e[o]?(a=!1,s[l]|=1<<c):r=!1,7===c&&++l}a?this._allAvailability="unavailable":r?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=s,this.byteSize+=s.length)}}],[{key:"fromDefinition",value:function(t,i){var r=t.service.request||j.default,a=t.row,n=t.col,l=t.width,o=t.height,c={query:{f:"json"}};return i=i?Object(s.a)(Object(s.a)({},c),i):c,r(function(e){var t;if("vector-tile"===e.service.type)t="".concat(e.service.url,"/tilemap/").concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height);else{var i=e.service.tileServers;t="".concat(i&&i.length?i[e.row%i.length]:e.service.url,"/tilemap/").concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height)}var r=e.service.query;return r&&(t="".concat(t,"?").concat(r)),t}(t),i).then((function(e){return e.data})).catch((function(e){if(e&&e.details&&422===e.details.httpStatus)return{location:{top:a,left:n,width:l,height:o},valid:!0,data:Object(T.b)(l*o,0)};throw e})).then((function(t){if(t.location&&(t.location.top!==a||t.location.left!==n||t.location.width!==l||t.location.height!==o))throw new p.a("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:a,left:n,width:l,height:o}});return e.fromJSON(t)}))}},{key:"fromJSON",value:function(t){e.validateJSON(t);var i=new e;return i.location=Object.freeze(Object(S.a)(t.location)),i._updateFromData(t.data),Object.freeze(i)}},{key:"validateJSON",value:function(e){if(!e||!e.location)throw new p.a("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new p.a("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new p.a("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new p.a("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new p.a("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}}]),e}();function R(e){return"".concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height)}var C,D=f.a.getLogger("esri.layers.support.TilemapCache"),z=C=function(e){Object(c.a)(i,e);var t=Object(u.a)(i);function i(e){var r;return Object(l.a)(this,i),(r=t.call(this,e))._handles=new w.a,r._pendingTilemapRequests={},r._availableLevels={},r.levels=5,r.cacheByteSize=2097152,r.request=j.default,r._prefetchingEnabled=!0,r}return Object(o.a)(i,[{key:"initialize",value:function(){var e=this;this._tilemapCache=new x.a(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(function(){return e._initializeTilemapDefinition()})),Object(k.a)(this,"layer.tileInfo.lods",(function(t){return e._initializeAvailableLevels(t)}),!0)]),this._initializeTilemapDefinition()}},{key:"destroy",value:function(){this._handles&&(this._handles.destroy(),this._handles=null)}},{key:"castLevels",value:function(e){return e<=2?(D.error("Minimum levels for Tilemap is 3, but got ",e),3):e}},{key:"size",get:function(){return 1<<this.levels}},{key:"fetchTilemap",value:function(e,t,i,r){var a=this;if(!this._availableLevels[e])return Object(g.t)(new p.a("tilemap-cache:level-unavailable","Level ".concat(e," is unavailable in the service")));var n=this._tmpTilemapDefinition,l=this._tilemapFromCache(e,t,i,n);if(l)return Object(g.u)(l);var o=r&&r.signal;return r=Object(s.a)(Object(s.a)({},r),{},{signal:null}),Object(g.c)((function(e,t){Object(g.r)(o,(function(){return t(Object(g.e)())}));var i=R(n),s=a._pendingTilemapRequests[i];if(!s){s=I.fromDefinition(n,r).then((function(e){return a._tilemapCache.put(i,e,e.byteSize),e}));var l=function(){return delete a._pendingTilemapRequests[i]};a._pendingTilemapRequests[i]=s,s.then(l,l)}s.then(e,t)}))}},{key:"getAvailability",value:function(e,t,i){if(!this._availableLevels[e])return"unavailable";var r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):"unknown"}},{key:"getAvailabilityUpsample",value:function(e,t,i,r){r.level=e,r.row=t,r.col=i;var a=this.layer.tileInfo;for(a.updateTileInfo(r);;){var n=this.getAvailability(r.level,r.row,r.col);if("unavailable"!==n)return n;if(!a.upsampleTile(r))return"unavailable"}}},{key:"fetchAvailability",value:function(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch((function(e){return e})).then((function(r){if(r instanceof I){var a=r.getAvailability(t,i);return"unavailable"===a?Object(g.t)(new p.a("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):a}if(Object(g.n)(r))throw r;return"unknown"})):Object(g.t)(new p.a("tilemap-cache:level-unavailable","Level ".concat(e," is unavailable in the service")))}},{key:"fetchAvailabilityUpsample",value:function(e,t,i,r,a){var n=this;r.level=e,r.row=t,r.col=i;var s=this.layer.tileInfo;s.updateTileInfo(r);var l=this.fetchAvailability(e,t,i,a).catch((function(e){if(Object(g.n)(e))throw e;if(s.upsampleTile(r))return n.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw e}));return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,a,l),l}},{key:"_fetchAvailabilityUpsamplePrefetch",value:function(){var e=Object(n.a)(a.a.mark((function e(t,i,r,n,l,o){var c,u,h,f,d,y,v,p,b,_=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._prefetchingEnabled){e.next=2;break}return e.abrupt("return");case 2:if(c="prefetch-".concat(t),!this._handles.has(c)){e.next=5;break}return e.abrupt("return");case 5:return u=Object(g.d)(),o.then((function(){return u.abort()}),(function(){return u.abort()})),h=!1,f={remove:function(){h||(h=!0,u.abort())}},this._handles.add(f,c),e.next=12,Object(m.c)(10,u.signal).catch((function(){}));case 12:if(h||(h=!0,this._handles.remove(c)),!Object(g.o)(u)){e.next=15;break}return e.abrupt("return");case 15:for(d={id:t,level:i,row:r,col:n},y=Object(s.a)(Object(s.a)({},l),{},{signal:u.signal}),v=this.layer.tileInfo,p=function(e){var t=_.fetchAvailability(d.level,d.row,d.col,y);C._prefetches.push(t);var i=function(){C._prefetches.removeUnordered(t)};t.then(i,i)},b=0;C._prefetches.length<C._maxPrefetch&&v.upsampleTile(d);++b)p();case 18:case"end":return e.stop()}}),e,this)})));return function(t,i,r,a,n,s){return e.apply(this,arguments)}}()},{key:"_initializeTilemapDefinition",value:function(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?Object(b.C)(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}}},{key:"_tilemapFromCache",value:function(e,t,i,r){r.level=e,r.row=t-t%this.size,r.col=i-i%this.size;var a=R(r);return this._tilemapCache.get(a)}},{key:"_initializeAvailableLevels",value:function(e){var t=this;this._availableLevels={},e&&e.forEach((function(e){return t._availableLevels[e.level]=!0}))}},{key:"test",get:function(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:function(t,i,r){return!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}}}]),i}(O.a);z._maxPrefetch=4,z._prefetches=new _.a({initialSize:C._maxPrefetch}),Object(h.a)([Object(d.b)({constructOnly:!0,type:Number})],z.prototype,"levels",void 0),Object(h.a)([Object(y.a)("levels")],z.prototype,"castLevels",null),Object(h.a)([Object(d.b)({readOnly:!0,dependsOn:["levels"],type:Number})],z.prototype,"size",null),Object(h.a)([Object(d.b)({constructOnly:!0,type:Number})],z.prototype,"cacheByteSize",void 0),Object(h.a)([Object(d.b)({constructOnly:!0})],z.prototype,"layer",void 0),Object(h.a)([Object(d.b)({constructOnly:!0})],z.prototype,"request",void 0),z=C=Object(h.a)([Object(v.a)("esri.layers.support.TilemapCache")],z)},946:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(2),a=i(3),n=i(807),s=function(){function e(t,i){Object(r.a)(this,e),this._storage=new n.c,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}return Object(a.a)(e,[{key:"put",value:function(e,t){this._storage.put(e,t,1,1)}},{key:"pop",value:function(e){return this._storage.pop(e)}},{key:"get",value:function(e){return this._storage.get(e)}},{key:"clear",value:function(){this._storage.clearAll()}},{key:"destroy",value:function(){this._storage.clearAll()}}]),e}()}}]);
//# sourceMappingURL=68.884661e0.chunk.js.map