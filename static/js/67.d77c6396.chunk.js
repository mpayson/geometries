(this.webpackJsonpgeometries=this.webpackJsonpgeometries||[]).push([[67],{1102:function(e,t,i){"use strict";var r=i(2),a=i(3),s=i(5),n=i(6),o=i(0),u=(i(13),i(14),i(15),i(1)),l=i(8),f=(i(11),i(19),i(20),function(e){Object(s.a)(i,e);var t=Object(n.a)(i);function i(e){var a;return Object(r.a)(this,i),(a=t.call(this,e)).tiles=new Map,a}return Object(a.a)(i,[{key:"destroy",value:function(){this.tiles.clear(),this.layer=this.layerView=this.tileInfoView=this.tiles=null}},{key:"updating",get:function(){return this.isUpdating()}},{key:"acquireTile",value:function(e){var t=this,i=this.createTile(e);return i.once("isReady",(function(){return t.notifyChange("updating")})),this.tiles.set(e.id,i),i}},{key:"forceAttributeTextureUpload",value:function(){}},{key:"forEachTile",value:function(e){this.tiles.forEach(e)}},{key:"releaseTile",value:function(e){this.tiles.delete(e.key.id),this.disposeTile(e)}},{key:"isUpdating",value:function(){var e=!0;return this.tiles.forEach((function(t){e=e&&t.isReady})),!e}},{key:"setHighlight",value:function(){}},{key:"invalidateLabels",value:function(){}},{key:"requestUpdate",value:function(){this.layerView.requestUpdate()}}]),i}(i(158).a));Object(o.a)([Object(u.b)()],f.prototype,"layer",void 0),Object(o.a)([Object(u.b)()],f.prototype,"layerView",void 0),Object(o.a)([Object(u.b)()],f.prototype,"tileInfoView",void 0),Object(o.a)([Object(u.b)()],f.prototype,"updating",null);var c=f=Object(o.a)([Object(l.a)("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],f);t.a=c},1314:function(e,t,i){"use strict";i.r(t);var r=i(10),a=i.n(r),s=i(21),n=i(2),o=i(3),u=i(5),l=i(6),f=i(0),c=(i(13),i(14),i(15),i(1),i(8)),d=(i(11),i(19),i(20),i(107)),h=i(861),v=i(980),y=i(888),p=i(1102),b=i(37),m=i(61),x=i(55),g=i(16),_=i(781),O=i(940),D=function(e){Object(u.a)(i,e);var t=Object(l.a)(i);function i(e,r,a){var s;return Object(n.a)(this,i),(s=t.call(this,e))._pointToCallbacks=new Map,s._layer=a,s._layerView=r,s}return Object(o.a)(i,[{key:"renderChildren",value:function(e){this.attributeView.update(),this.hasAnimation&&e.painter.effects.integrate.draw(e,e.attributeView),Object(m.a)(Object(x.a)(i.prototype),"renderChildren",this).call(this,e)}},{key:"hitTest",value:function(e,t){var i=[e,t],r=Object(g.g)();return this._pointToCallbacks.set(i,r),this.requestRender(),r.promise}},{key:"doRender",value:function(e){var t=this._layer,r=t.minScale,a=t.maxScale,s=e.state.scale;s<=(r||1/0)&&s>=a&&Object(m.a)(Object(x.a)(i.prototype),"doRender",this).call(this,e)}},{key:"hasAnimation",get:function(){return this.hasLabels}},{key:"hasLabels",get:function(){var e=this._layer.featureReduction,t=e&&"cluster"===e.type&&e.labelsVisible&&e.labelingInfo&&e.labelingInfo.length;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!t}},{key:"labelsVisible",get:function(){return this._layer.labelsVisible}},{key:"prepareRenderPasses",value:function(e){var t=this,r=e.registerRenderPass({name:"label",brushes:[O.a.label],target:function(){return t.hasLabels?t.children:null},drawPhase:_.c.LABEL|_.c.LABEL_ALPHA}),a=e.registerRenderPass({name:"geometry",brushes:[O.a.fill,O.a.line,O.a.marker,O.a.text],target:function(){return t.children},enableDefaultDraw:function(){return!t._layerView.hasEffects},effects:[{apply:e.effects.outsideEffect,enable:function(){return t._layerView.hasEffects},args:function(){return t._layerView.effectLists.excluded}},{apply:e.effects.insideEffect,enable:function(){return t._layerView.hasEffects},args:function(){return t._layerView.effectLists.included}},{apply:e.effects.hittest,enable:function(){return!!t._pointToCallbacks.size},args:function(){return t._pointToCallbacks}}]}),s=e.registerRenderPass({name:"highlight",brushes:[O.a.fill,O.a.line,O.a.marker,O.a.text],target:function(){return t.children},drawPhase:_.c.HIGHLIGHT,enableDefaultDraw:function(){return!1},effects:[{apply:e.effects.highlight,enable:function(){return!!t._layerView.hasHighlight()}}]});return[].concat(Object(b.a)(Object(m.a)(Object(x.a)(i.prototype),"prepareRenderPasses",this).call(this,e)),[a,s,r])}}]),i}(i(904).a),k=function(e){Object(u.a)(i,e);var t=Object(l.a)(i);function i(){return Object(n.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,[{key:"install",value:function(e){var t=new D(this.tileInfoView,this.layerView,this.layer);this.featuresView=t,e.addChild(t)}},{key:"uninstall",value:function(e){e.removeChild(this.featuresView),this.featuresView.destroy()}},{key:"hitTest",value:function(e,t){return this.featuresView.hitTest(e,t)}},{key:"supportsRenderer",value:function(e){return null!=e&&-1!==["simple","class-breaks","unique-value","dot-density","dictionary"].indexOf(e.type)}},{key:"onConfigUpdate",value:function(e){var t=null;if("visualVariables"in e){var i=(Object(v.a)(e).visualVariables||[]).map((function(e){var t=e.clone();return"normalizationField"in e&&(t.normalizationField=null),e.valueExpression&&"$view.scale"!==e.valueExpression&&(t.valueExpression=null,t.field="nop"),t}));t=Object(y.a)(i)}this.featuresView.setRendererInfo(e,t,this.layerView.effects)}},{key:"onTileData",value:function(e){var t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileData(t,e.data),this.layerView.view.labelManager.requestUpdate()}},{key:"onTileError",value:function(e){var t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileError(t)}},{key:"forceAttributeTextureUpload",value:function(){this.featuresView.attributeView.forceTextureUpload()}},{key:"lockGPUUploads",value:function(){this.featuresView.attributeView.lockTextureUpload(),this.tiles.forEach((function(e){return e.lockUploads()}))}},{key:"unlockGPUUploads",value:function(){this.featuresView.attributeView.unlockTextureUpload(),this.tiles.forEach((function(e){return e.unlockUploads()}))}},{key:"getMaterialItems",value:function(){var e=Object(s.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.featuresView.getMaterialItems(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"invalidateLabels",value:function(){this.featuresView.hasLabels&&(this.tiles.forEach((function(e){return e.isDirty=!0})),this.layerView.view.labelManager.requestUpdate())}},{key:"createTile",value:function(e){var t=this.tileInfoView.getTileBounds(Object(d.g)(),e),i=new h.a(e,t);return this.featuresView.hasLabels&&this.layerView.view.labelManager.addTile(this.layerView,i),i}},{key:"disposeTile",value:function(e){this.featuresView.removeChild(e),this.featuresView.hasLabels&&this.layerView.view.labelManager.removeTile(this.layerView,e.key.id),e.destroy(),this.layerView.view.labelManager.requestUpdate()}}]),i}(p.a),j=k=Object(f.a)([Object(c.a)("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],k);t.default=j},800:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a}));var r=i(12);function a(e,t){if(null!==t){e.push(t.length);var i,a=Object(r.a)(t);try{for(a.s();!(i=a.n()).done;){i.value.serialize(e)}}catch(s){a.e(s)}finally{a.f()}return e}e.push(0)}function s(e,t,i){for(var r=e.readInt32(),a=new Array(r),s=0;s<a.length;s++)a[s]=t.deserialize(e,i);return a}},812:function(e,t,i){"use strict";var r=i(12),a=i(2),s=i(3),n=i(14),o=i(780),u=i(361),l=i(907),f=i(800),c=n.a.getLogger("esri/views/2d/engine/webgl/collisions/Metric"),d=function(){function e(t,i,r,s,n){Object(a.a)(this,e),this.id=t,this.range=i,this.boxes=null,this.minZoom=-1,this.size=0,this.directionX=0,this.directionY=0,this.offsetX=0,this.offsetY=0,this.placementPadding=0,this.anchor=Object(u.b)(r,s),this.baseZoom=n}return Object(s.a)(e,[{key:"add",value:function(e,t,i){e.x=e.x+t,e.y=e.y+i,this.bounds?this.boxes?(this.boxes.push(e),this.bounds.extend(e)):(this.boxes=[this.bounds,e],this.bounds=this.bounds.clone(),this.bounds.extend(e)):this.bounds=e}},{key:"computeIndex",value:function(){var e=this.anchor[0],t=this.anchor[1],i=Math.floor(e/o.d),r=Math.floor(t/o.d);this.xBucket=i,this.yBucket=r;var a=o.F/o.d;if(this.hasVV)return this.xOverflow=a,void(this.yOverflow=a);this.xOverflow=Math.min(a,Math.ceil(2*this.bounds.width/o.d)),this.yOverflow=Math.min(a,Math.ceil(2*this.bounds.height/o.d))}},{key:"findCollisionDelta",value:function(e){var t=this.bounds.findCollisionDelta(e.bounds),i=this.boxes&&this.boxes.length,r=e.boxes&&e.boxes.length;return Math.abs(t)>o.f||!i&&!r?t:i&&r?this._boxesToBoxes(e):i?this._boxesToBox(e):this._boxToBoxes(e)}},{key:"computeVVOffset",value:function(e,t){t||c.error("mapview-labeling","Unable to compute label offset. Expected an evaluator function but found ".concat(t));var i=this.size;if(this.hasVV){var r=t(e);i=isNaN(r)||null==r||r===1/0?this.size:r}this._computeOffset(i)}},{key:"setPlacementOffset",value:function(e,t,i,r,a){this.hasVV=e,this.size=t,this.placementPadding=Math.round(i),this.directionX=r,this.directionY=a}},{key:"clone",value:function(){var t=new e(this.id,this.range,this.anchor[0],this.anchor[1],this.baseZoom);return t.minZoom=this.minZoom,this.bounds&&(t.bounds=this.bounds.clone()),this.boxes&&(t.boxes=this.boxes.map((function(e){return e.clone()}))),t.xBucket=this.xBucket,t.yBucket=this.yBucket,t.xOverflow=this.xOverflow,t.yOverflow=this.yOverflow,t.hasVV=this.hasVV,t.size=this.size,t.directionX=this.directionX,t.directionY=this.directionY,t.offsetX=this.offsetX,t.offsetY=this.offsetY,t}},{key:"_boxToBoxes",value:function(e){var t,i=-1/0,a=Object(r.a)(e.boxes);try{for(a.s();!(t=a.n()).done;){var s=t.value,n=this.bounds.findCollisionDelta(s);i=Math.max(n,i)}}catch(o){a.e(o)}finally{a.f()}return i}},{key:"_boxesToBox",value:function(e){for(var t=this.boxes[0].findCollisionDelta(e.bounds),i=1;i<this.boxes.length;i++){var r=this.boxes[i].findCollisionDelta(e.bounds);t=Math.max(r,t)}return t}},{key:"_boxesToBoxes",value:function(e){for(var t=-1/0,i=0;i<this.boxes.length;i++){var a,s=this.boxes[i],n=Object(r.a)(e.boxes);try{for(n.s();!(a=n.n()).done;){var o=a.value,u=s.findCollisionDelta(o);t=Math.max(u,t)}}catch(l){n.e(l)}finally{n.f()}}return t}},{key:"_computeOffset",value:function(e){this.offsetX=this.directionX*(e/2+this.placementPadding),this.offsetY=this.directionY*(e/2+this.placementPadding)}},{key:"serialize",value:function(e){return e.push(this.id),this.bounds.serialize(e),e.push(this.range.from),e.push(this.range.count),e.push(this.anchor[0]),e.push(this.anchor[1]),e.push(this.baseZoom),e.push(this.hasVV?1:0),e.push(this.size),e.writeF32(this.directionX),e.writeF32(this.directionY),e.push(this.offsetX),e.push(this.offsetY),e.push(this.placementPadding),Object(f.b)(e,this.boxes),e}}],[{key:"deserialize",value:function(t){var i=t.readInt32(),r=l.a.deserialize(t),a={from:t.readInt32(),count:t.readInt32()},s=t.readInt32(),n=t.readInt32(),o=t.readInt32(),u=t.readInt32(),c=t.readInt32(),d=t.readF32(),h=t.readF32(),v=t.readInt32(),y=t.readInt32(),p=t.readInt32(),b=Object(f.a)(t,l.a),m=new e(i,a,s,n,o);return m.bounds=r,m.boxes=b,m.setPlacementOffset(!!u,c,p,d,h),m.offsetX=v,m.offsetY=y,m.computeIndex(),u||m._computeOffset(c),m}}]),e}();t.a=d},815:function(e,t,i){"use strict";var r=i(12),a=i(2),s=i(3),n=i(782),o=function(){function e(){Object(a.a)(this,e),this.vertexData=new Map,this.vertexCount=0,this.indexData=[]}return Object(s.a)(e,[{key:"clear",value:function(){this.vertexData.clear(),this.vertexCount=0,this.indexData=[]}},{key:"update",value:function(e,t,i){for(var r in e)this.vertexData.set(r,e[r]);for(var a in this.vertexData)null===e[a]&&this.vertexData.delete(a);this.vertexCount=t,this.indexData=i}}]),e}(),u=function(){function e(t,i,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Object(a.a)(this,e),this.id=t,this.geometryType=i,this.materialKey=r,this.minZoom=s,this.maxZoom=n,this.meshData=null,this.symbolLevel=0,this.zOrder=0,this.vertexFrom=0,this.vertexCount=0,this.indexFrom=0,this.indexCount=0}return Object(s.a)(e,[{key:"sortKey",get:function(){return void 0===this._sortKey&&this._computeSortKey(),this._sortKey}},{key:"clone",value:function(){return this.copy()}},{key:"copy",value:function(){var t=new e(this.id,this.geometryType,this.materialKey);return t.vertexFrom=this.vertexFrom,t.vertexCount=this.vertexCount,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t.zOrder=this.zOrder,t.symbolLevel=this.symbolLevel,t.meshData=this.meshData,t.minZoom=this.minZoom,t.maxZoom=this.maxZoom,t}},{key:"setMeshDataFromBuffers",value:function(e,t,i){var r=new o;for(var a in t){for(var s=t[a].stride,u=t[a].data,l=[],f=Object(n.o)(s),c=0;c<s*e.vertexCount/f;++c)l[c]=u[c+s*e.vertexFrom/f];r.vertexData.set(a,l)}r.indexData.length=0;for(var d=0;d<e.indexCount;++d)r.indexData[d]=i[d+e.indexFrom]-e.vertexFrom;r.vertexCount=e.vertexCount,this.meshData=r}},{key:"readMeshDataFromBuffers",value:function(e,t){for(var i in this.meshData?this.meshData.clear():this.meshData=new o,e){for(var r=e[i].stride,a=e[i].data,s=[],u=Object(n.o)(r),l=0;l<r*this.vertexCount/u;++l)s[l]=a[l+r*this.vertexFrom/u];this.meshData.vertexData.set(i,s)}this.meshData.indexData.length=0;for(var f=0;f<this.indexCount;++f)this.meshData.indexData[f]=t[f+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount}},{key:"writeMeshDataToBuffers",value:function(e,t,i,r){for(var a in t)for(var s=t[a].stride,o=this.meshData.vertexData.get(a),u=t[a].data,l=Object(n.o)(s),f=0;f<s*this.meshData.vertexCount/l;++f)u[f+s*e/l]=o[f];for(var c=0;c<this.meshData.indexData.length;++c)r[c+i]=this.meshData.indexData[c]+e;this.vertexFrom=e,this.vertexCount=this.meshData.vertexCount,this.indexFrom=i,this.indexCount=this.meshData.indexData.length}},{key:"_computeSortKey",value:function(){this._sortKey=(31&this.symbolLevel)<<12|(127&this.zOrder)<<4|7&this.geometryType}},{key:"serialize",value:function(e){return e.push(this.geometryType),e.push(this.materialKey),e.push(this.vertexFrom),e.push(this.vertexCount),e.push(this.indexFrom),e.push(this.indexCount),e.push(this.minZoom),e.push(this.maxZoom),e}}],[{key:"writeAllMeshDataToBuffers",value:function(e,t,i){var a,s=0,n=0,o=Object(r.a)(e);try{for(o.s();!(a=o.n()).done;){var u=a.value;u.writeMeshDataToBuffers(s,t,n,i),s+=u.vertexCount,n+=u.indexCount}}catch(l){o.e(l)}finally{o.f()}}},{key:"deserialize",value:function(t,i){var r=t.readInt32(),a=t.readInt32(),s=new e(i.id,r,a);return s.vertexFrom=t.readInt32(),s.vertexCount=t.readInt32(),s.indexFrom=t.readInt32(),s.indexCount=t.readInt32(),s.minZoom=t.readInt32(),s.maxZoom=t.readInt32(),s}}]),e}();t.a=u},816:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(2),a=i(3),s=function(){function e(t,i){Object(r.a)(this,e),this._pos=0;var a=i?this._roundToNearest(i,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(a),this._buffer=new t(this._array),this._ctor=t}return Object(a.a)(e,[{key:"length",get:function(){return this._pos}},{key:"_roundToNearest",value:function(e,t){var i=Math.round(e);return i+(t-i%t)}},{key:"_ensureSize",value:function(e){if(this._pos+e>=this._buffer.length){var t=this._roundToNearest(1.5*(this._array.byteLength+e*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),i=new ArrayBuffer(t),r=new this._ctor(i);r.set(this._buffer,0),this._array=i,this._buffer=r}}},{key:"writeF32",value:function(e){this._ensureSize(1);var t=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=e,this._pos++,t}},{key:"push",value:function(e){this._ensureSize(1);var t=this._pos;return this._buffer[this._pos++]=e,t}},{key:"writeFixed",value:function(e){this._buffer[this._pos++]=e}},{key:"setValue",value:function(e,t){this._buffer[e]=t}},{key:"getValue",value:function(e){return this._buffer[e]}},{key:"incr",value:function(e){this._buffer[e]++}},{key:"decr",value:function(e){this._buffer[e]--}},{key:"writeRegion",value:function(e){this._ensureSize(e.length);var t=this._pos;return this._buffer.set(e,this._pos),this._pos+=e.length,t}},{key:"buffer",value:function(){var e=this._array.slice(0,4*this._pos);return this.destroy(),e}},{key:"toArray",value:function(){for(var e=this._array,t=[],i=0;i<e.byteLength/4;i++)t.push(e[i]);return t}},{key:"seek",value:function(e){this._pos=e}},{key:"destroy",value:function(){this._array=null,this._buffer=null}}]),e}()},839:function(e,t,i){"use strict";var r=i(2),a=i(3),s=i(815),n=i(800),o=i(812),u=function(){function e(t){Object(r.a)(this,e),this.insertAfter=null,this.id=t,this.displayRecords=[],this.metrics=[]}return Object(a.a)(e,[{key:"copy",value:function(){var t=new e(this.id);return t.set(this),t}},{key:"clone",value:function(){var t=new e(this.id);return t.displayRecords=this.displayRecords.map((function(e){return e.clone()})),t.metrics=this.metrics.map((function(e){return e.clone()})),t.insertAfter=this.insertAfter,t}},{key:"set",value:function(e){this.id=e.id,this.displayRecords=e.displayRecords,this.metrics=e.metrics,this.insertAfter=e.insertAfter}},{key:"serialize",value:function(e){return e.push(this.id),Object(n.b)(e,this.metrics),Object(n.b)(e,this.displayRecords),e}}],[{key:"deserialize",value:function(t){var i=t.readInt32(),r=new e(i),a={id:i},u=Object(n.a)(t,o.a);return u.length&&(r.metrics=u),r.displayRecords=Object(n.a)(t,s.a,a),r}}]),e}();t.a=u},841:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i(2),a=i(3),s=i(782),n=function(){function e(t,i,a){Object(r.a)(this,e),this.data=t,this.stride=i,this.vertexCount=a}return Object(a.a)(e,null,[{key:"decode",value:function(t){return new e(Object(s.c)(t.data,t.stride),t.stride,t.vertexCount)}},{key:"fromVertexVector",value:function(t){return new e(Object(s.c)(t.data.buffer(),t.stride),t.stride,t.vertexCount)}}]),e}(),o=function(){function e(t,i,a){Object(r.a)(this,e),this.geometryType=t,this.indexBuffer=new Uint32Array(i),this.namedBuffers=a}return Object(a.a)(e,null,[{key:"decode",value:function(t){var i=t.geometryType,r=t.indexBuffer,a={};for(var s in t.namedBuffers)a[s]=n.decode(t.namedBuffers[s]);return new e(i,r,a)}},{key:"fromVertexVectors",value:function(t){var i=t.geometryType,r=t.indexVector.buffer(),a={};for(var s in t.namedVectors)a[s]=n.fromVertexVector(t.namedVectors[s]);return new e(i,r,a)}}]),e}()},842:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i(32),a=i(2),s=i(3),n=i(5),o=i(6),u=(i(13),i(177)),l=i(230),f=i(308),c=function(e){Object(n.a)(i,e);var t=Object(o.a)(i);function i(e,r,s){var n,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s;return Object(a.a)(this,i),(n=t.call(this)).triangleCountReportedInDebug=0,n.transforms={dvs:Object(f.b)(),tileMat3:Object(f.b)()},n.triangleCount=0,n.key=new l.a(e),n.bounds=r,n.size=s,n.coordRange=o,n}return Object(s.a)(i,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"coords",get:function(){return this._coords}},{key:"bounds",get:function(){return this._bounds},set:function(e){this._coords=[e[0],e[3]],this._bounds=e}},{key:"setTransform",value:function(e,t){var i=t/(e.resolution*e.pixelRatio),a=this.transforms.tileMat3,s=e.toScreenNoRotation([0,0],this.coords),n=Object(r.a)(s,2),o=n[0],l=n[1],f=this.size[0]/this.coordRange[0]*i,c=this.size[1]/this.coordRange[1]*i;Object(u.j)(a,f,0,0,0,c,0,o,l,1),Object(u.g)(this.transforms.dvs,e.displayViewMat3,a)}}]),i}(i(868).a)},845:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return r}));var r=function(e,t){return e&&function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return t.warn.apply(t,["DEBUG:"].concat(i))}||function(){return null}},a=!1},847:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i(37),a=i(2),s=i(3),n=i(815),o=i(800),u=i(812),l=i(839),f=function(){function e(t){Object(a.a)(this,e),this._pos=0,this._buffer=t,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer)}return Object(s.a)(e,[{key:"readInt32",value:function(){return this._i32View[this._pos++]}},{key:"readF32",value:function(){return this._f32View[this._pos++]}}]),e}(),c=i(816),d=function(){function e(t,i){Object(a.a)(this,e),this.vertexVectorsMap=t,this._currentIndex=-1,this._currentRecordOffset=0,this._currentMetricOffset=0,this._currentMetrics=[];var r=4*(4*i.features+1),s=4*(8*i.records+1),n=4*(20*i.metrics+1);this._bufDisplayObjects=new c.a(Uint32Array,r+4),this._bufDisplayRecords=new c.a(Uint32Array,s+4),this._bufMetrics=new c.a(Uint32Array,n+4),this._bufDisplayObjects.push(0),this._bufDisplayRecords.push(0),this._bufMetrics.push(0)}return Object(s.a)(e,[{key:"vertexBuffersMap",get:function(){if(!this._vertexBuffersMap){this._vertexBuffersMap={};for(var e=0;e<this.vertexVectorsMap.length;e++)this._vertexBuffersMap[e]=this.vertexVectorsMap[e].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap}},{key:"get",value:function(e){return this.vertexVectorsMap[e]}},{key:"currentDisplayRecordCount",value:function(){return this._bufDisplayRecords[this._currentRecordOffset]}},{key:"writeDisplayObject",value:function(e,t){this._bufDisplayObjects.incr(0),this._currentIndex=this._bufDisplayObjects.push(e),this._bufDisplayObjects.push(t),this._bufDisplayObjects.push(0),this._bufDisplayObjects.push(0),this._currentRecordOffset=0,this._currentMetricOffset=0,this._currentMetrics=[]}},{key:"hasDisplayRecords",value:function(){return!(0===this._currentRecordOffset)}},{key:"endDisplayObject",value:function(){this.hasDisplayRecords()?this._currentMetrics&&(0===this._currentMetricOffset&&(this._bufDisplayObjects.setValue(this._currentIndex+3,this._bufMetrics.length),this._currentMetricOffset=this._bufMetrics.length),Object(o.b)(this._bufMetrics,this._currentMetrics)):this._rollbackDisplayObject()}},{key:"writeDisplayRecord",value:function(e,t,i,r,a,s){var n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;0===this._currentRecordOffset&&(this._currentRecordOffset=this._bufDisplayRecords.push(0),this._bufDisplayObjects.setValue(this._currentIndex+2,this._currentRecordOffset)),this._bufDisplayRecords.incr(this._currentRecordOffset),this._bufDisplayRecords.push(e),this._bufDisplayRecords.push(t),this._bufDisplayRecords.push(i),this._bufDisplayRecords.push(r),this._bufDisplayRecords.push(a),this._bufDisplayRecords.push(s),this._bufDisplayRecords.push(n),this._bufDisplayRecords.push(o)}},{key:"writeMetrics",value:function(e){var t;e&&(t=this._currentMetrics).push.apply(t,Object(r.a)(e))}},{key:"encode",value:function(e,t){for(var i={},r=0;r<this.vertexVectorsMap.length;r++){var a=this.vertexVectorsMap[r];i[r]={},a.transfer(i[r],t)}e.bufDisplayObjects=this._bufDisplayObjects.buffer(),e.bufRecords=this._bufDisplayRecords.buffer(),e.bufMetrics=this._bufMetrics.buffer(),t.push(e.bufDisplayObjects),t.push(e.bufMetrics),t.push(e.bufRecords),e.vertexBuffersMap=i,this.destroy()}},{key:"destroy",value:function(){this.vertexVectorsMap=null,this._bufDisplayObjects=null,this._bufDisplayRecords=null,this._bufMetrics=null}},{key:"_rollbackDisplayObject",value:function(){this._bufDisplayObjects.decr(0),this._bufDisplayObjects.seek(this._bufDisplayObjects.length-4),this._currentIndex=this._bufDisplayObjects.length}}],[{key:"deserializeDisplayObjects",value:function(e){var t=e.bufDisplayObjects,i=e.bufMetrics,r=e.bufRecords,a=new f(t),s=new f(r),c=new f(i),d=[],h=a.readInt32();for(s.readInt32(),c.readInt32();h--;){var v=a.readInt32(),y=a.readInt32(),p=a.readInt32(),b=a.readInt32(),m=new l.a(v);0!==y&&(m.insertAfter=y),0!==p&&(m.displayRecords=Object(o.a)(s,n.a,{id:v})),0!==b&&(m.metrics=Object(o.a)(c,u.a)),d.push(m)}return d}}]),e}()},858:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i(12),a=i(37),s=i(9),n=i(2),o=i(3),u=i(61),l=i(55),f=i(5),c=i(6),d=i(781),h=i(920),v=i(911),y=i(898),p=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},b=function(e){Object(f.a)(i,e);var t=Object(c.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this))._tileInfoView=e,r}return Object(o.a)(i,[{key:"renderChildren",value:function(e){this.sortChildren(p),this.setStencilReference(),Object(u.a)(Object(l.a)(i.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state;return Object(s.a)(Object(s.a)({},Object(u.a)(Object(l.a)(i.prototype),"createRenderParams",this).call(this,e)),{},{requiredLevel:this._tileInfoView.getClosestInfoForScale(t.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(t.scale)})}},{key:"prepareRenderPasses",value:function(e){var t=this,r=e.registerRenderPass({name:"stencil",brushes:[v.a],drawPhase:d.c.DEBUG|d.c.MAP|d.c.HIGHLIGHT,target:function(){return t.getStencilTarget()}}),s=e.registerRenderPass({name:"tileInfo",brushes:[h.a],drawPhase:d.c.DEBUG,target:function(){return t.children},has:"esri-tiles-debug"});return[].concat(Object(a.a)(Object(u.a)(Object(l.a)(i.prototype),"prepareRenderPasses",this).call(this,e)),[r,s])}},{key:"getStencilTarget",value:function(){return this.children}},{key:"updateTransforms",value:function(e){var t,i=Object(r.a)(this.children);try{for(i.s();!(t=i.n()).done;){var a=t.value,s=this._tileInfoView.getTileResolution(a.key);a.setTransform(e,s)}}catch(n){i.e(n)}finally{i.f()}}},{key:"setStencilReference",value:function(){var e,t=1,i=Object(r.a)(this.children);try{for(i.s();!(e=i.n()).done;){e.value.stencilRef=t++}}catch(a){i.e(a)}finally{i.f()}}}]),i}(y.a)},861:function(e,t,i){"use strict";i.d(t,"a",(function(){return F}));var r=i(12),a=i(2),s=i(3),n=i(61),o=i(55),u=i(5),l=i(6),f=(i(13),i(4)),c=i(878),d=i(29),h=i(780),v=i(109),y=i(378),p=i(361),b=i(842),m=i(781),x=i(782);function g(e,t,i){if(!e.allDirty)if(null!=e.from&&null!=e.count){var r=Math.min(e.from,t),a=Math.max(e.from+e.count,t+i)-r;e.from=r,e.count=a}else e.from=t,e.count=i}var _=function(){function e(){Object(a.a)(this,e),this._dirties=Object(x.e)((function(){return{indices:{from:null,count:null,allDirty:!1}}}),(function(){return{vertices:{from:null,count:null,allDirty:!1}}}))}return Object(s.a)(e,[{key:"hasDirty",value:function(){var e,t=Object(r.a)(this._dirties);try{for(t.s();!(e=t.n()).done;){var i=e.value;if(null!==i.data.indices.count||i.data.indices.allDirty)return!0}}catch(a){t.e(a)}finally{t.f()}return!1}},{key:"markAllClean",value:function(){var e,t=Object(r.a)(this._dirties);try{for(t.s();!(e=t.n()).done;){var i=e.value;for(var a in i.data.indices.from=null,i.data.indices.count=null,i.data.indices.allDirty=!1,i.buffers)i.buffers[a].data.vertices.from=null,i.buffers[a].data.vertices.count=null,i.buffers[a].data.vertices.allDirty=!1}}catch(s){t.e(s)}finally{t.f()}}},{key:"markAllDirty",value:function(){var e,t=Object(r.a)(this._dirties);try{for(t.s();!(e=t.n()).done;){var i=e.value;for(var a in i.data.indices.allDirty=!0,i.buffers)i.buffers[a].data.vertices.allDirty=!0}}catch(s){t.e(s)}finally{t.f()}}},{key:"forEach",value:function(e){for(var t=0;t<this._dirties.length;++t){var i=this._dirties[t],r={};for(var a in i.buffers){var s=i.buffers[a].data.vertices;(s.allDirty||null!=s.from&&null!=s.count&&s.count>0)&&(r[a]=s)}var n,o=i.data.indices;((n=o.allDirty||null!=o.from&&null!=o.count&&o.count>0?{indices:o,vertices:r}:{indices:null,vertices:r}).indices||Object.keys(n).length>0)&&e(n,t)}}},{key:"markDirtyIndices",value:function(e,t,i){g(this._dirties[e].data.indices,t,i)}},{key:"markDirtyVertices",value:function(e,t,i,r){g(this._dirties[e].buffers[t].data.vertices,i,r)}}]),e}(),O=i(32),D=function(){function e(t){Object(a.a)(this,e),this._largestRange=null,this._parent=t,this._updateLargestRange()}return Object(s.a)(e,[{key:"largestRange",get:function(){return this._largestRange}},{key:"rangeCreated",value:function(e){(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}},{key:"rangeResized",value:function(e,t){e===this._largestRange?e.count<t&&this._updateLargestRange():(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}},{key:"findBestRange",value:function(e){for(var t=this._parent._freeHead,i=null;null!==t;)t.count>=e&&(!i||t.count-e<i.count-e)&&(i=t),t=t.next;return i}},{key:"findAdjacentRanges",value:function(e,t){for(var i=!0,r=!1,a=null,s=this._parent._freeHead;i&&!r;){var n=null!==a?a.from+a.count:0,o=null!==s?s.from:this._parent._size;e>=n&&e+t<=o?(i=!1,r=!0):null!==s?(a=s,s=s.next):i=!1}return[a,s]}},{key:"_updateLargestRange",value:function(){for(var e=null,t=this._parent._freeHead;null!==t;)(!e||t.count>e.count)&&(e=t),t=t.next;this._largestRange=e}}]),e}(),k=function(){function e(t,i){Object(a.a)(this,e),this._allocated=0,this._size=t,this._freeHead=t>0?{from:0,count:t,prev:null,next:null}:null,this._bookKeeper=i||new D(this),this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}return Object(s.a)(e,[{key:"allocate",value:function(t){var i=this._bookKeeper.findBestRange(t);if(null===i)return-1;var r=i.from,a=i.count;if(i.from+=t,i.count-=t,this._bookKeeper.rangeResized(i,r,a),this._allocated+=t,0===i.count){var s=null!==i.prev?this._freeHead:i.next;e._removeRange(i),this._freeHead=s}return r}},{key:"free",value:function(t,i){var r=this._bookKeeper.findAdjacentRanges(t,i),a=Object(O.a)(r,2),s=a[0],n=a[1],o={from:t,count:i,prev:s,next:n};if(null!==s&&(s.next=o),null!==n&&(n.prev=o),this._bookKeeper.rangeCreated(o),this._allocated-=i,null!==n&&o.from+o.count===n.from){var u=o.from,l=o.count;e._fuse(o,n),e._removeRange(n),this._bookKeeper.rangeResized(o,u,l),this._bookKeeper.rangeResized(n,void 0,0)}if(null!==s&&s.from+s.count===o.from){var f=s.from,c=s.count;e._fuse(s,o),e._removeRange(o),this._bookKeeper.rangeResized(s,f,c),this._bookKeeper.rangeResized(o,void 0,0)}this._freeHead=null!==o.prev?this._freeHead:o}},{key:"fragmentation",get:function(){var e=this._size-this._allocated;return 0===e?0:1-this._bookKeeper.largestRange.count/e}}],[{key:"_removeRange",value:function(e){null!==e.prev?null!==e.next?(e.prev.next=e.next,e.next.prev=e.prev):e.prev.next=null:null!==e.next&&(e.next.prev=null)}},{key:"_fuse",value:function(e,t){e.count+=t.count,e.next=t.next,t.from+=t.count,t.count=0,null!==t.next&&(t.next.prev=e)}}]),e}(),j=["FILL","LINE","MARKER","TEXT","LABEL"],w=function(){function e(t,i,r,s){for(var n in Object(a.a)(this,e),this._strides=t,this._displayList=i,this._freeListsAndStorage={},this._dirtyMap=null,this._dirtyMap=r,t)for(var o in this._freeListsAndStorage[n]={vtxFreeList:s?new k(s):null,idxFreeList:s?new k(s):null,vertexBuffers:{},indexBuffer:s?new Uint32Array(s):null},t[n])this._freeListsAndStorage[n].vertexBuffers[o]={data:s?Object(x.b)(s,t[n][o]):null,stride:t[n][o]}}return Object(s.a)(e,[{key:"delete",value:function(e){var t=j[e.geometryType];this._freeVertices(t,e.vertexFrom,e.vertexCount),this._freeIndices(t,e.indexFrom,e.indexCount),this._displayList.removeFromList(e),e.vertexFrom=void 0,e.indexFrom=void 0}},{key:"setMeshData",value:function(e,t,i,r,a){var s,n,o=j[e.geometryType];e.meshData=null,void 0===e.vertexFrom?(n=t.vertexCount,s=this._allocateVertices(o,n)):t.vertexCount>e.vertexCount?(this._freeVertices(o,e.vertexFrom,e.vertexCount),n=t.vertexCount,s=this._allocateVertices(o,n)):t.vertexCount===e.vertexCount?(s=e.vertexFrom,n=e.vertexCount):(this._freeVertices(o,e.vertexFrom+t.vertexCount,e.vertexCount-t.vertexCount),s=e.vertexFrom,n=t.vertexCount);var u,l,f,c=!0;if(void 0===e.indexFrom?(u=a,f=t.indexCount,l=this._allocateIndices(o,f)):t.indexCount>e.indexCount?(u=this._displayList.removeFromList(e),this._freeIndices(o,e.indexFrom,e.indexCount),f=t.indexCount,l=this._allocateIndices(o,f)):t.indexCount===e.indexCount?(c=!1,l=e.indexFrom,f=e.indexCount):(u=this._displayList.removeFromList(e),this._freeIndices(o,e.indexFrom+t.indexCount,e.indexCount-t.indexCount),l=e.indexFrom,f=t.indexCount),-1!==s&&-1!==l){var d=this._storageFor(o);if(Object(x.d)(s,l,d.vertexBuffers,d.indexBuffer,t,i,r),e.vertexFrom=s,e.indexFrom=l,e.vertexCount=t.vertexCount,e.indexCount=t.indexCount,this._dirtyMap)for(var h in this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount),i)this._dirtyMap.markDirtyVertices(e.geometryType,h,e.vertexFrom,e.vertexCount);return c&&this._displayList.addToList(e,u),!0}return-1!==s&&this._freeVertices(o,s,n),-1!==l&&this._freeIndices(o,l,f),e.setMeshDataFromBuffers(t,i,r),e.vertexFrom=void 0,e.vertexCount=0,e.indexFrom=void 0,e.indexCount=0,!1}},{key:"tryAddMeshData",value:function(e,t){var i=t.vertexBuffer,r=t.indexBuffer,a=j[e.geometryType],s=this._allocateVertices(a,e.vertexCount);if(-1===s)return this._freeVertices(a,s,e.vertexCount),!1;var n=this._allocateIndices(a,e.indexCount);if(-1===n)return this._freeVertices(a,s,e.vertexCount),this._freeIndices(a,n,e.indexCount),!1;var o=this._storageFor(a);if(Object(x.d)(s,n,o.vertexBuffers,o.indexBuffer,e,i,r),e.vertexFrom=s,e.indexFrom=n,this._dirtyMap)for(var u in this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount),i)this._dirtyMap.markDirtyVertices(e.geometryType,u,s,e.vertexCount);return this._displayList.addToList(e),!0}},{key:"_allocateVertices",value:function(e,t){var i=this._storageFor(e),r=i.vtxFreeList.allocate(t);return-1===r||i.vtxFreeList.fragmentation>.5?-1:r}},{key:"_freeVertices",value:function(e,t,i){this._storageFor(e).vtxFreeList.free(t,i)}},{key:"_freeIndices",value:function(e,t,i){this._storageFor(e).idxFreeList.free(t,i)}},{key:"_allocateIndices",value:function(e,t){var i=this._storageFor(e),r=i.idxFreeList.allocate(t);return-1===r||i.idxFreeList.fragmentation>.5?-1:r}},{key:"_storageFor",value:function(e){return this._freeListsAndStorage[e]}},{key:"_stridesFor",value:function(e,t){return this._strides[e][t]}}],[{key:"fromTileData",value:function(t,i){var a,s=function(e){for(var t=e.getStrides(),i={},r=0;r<t.length;r++)i[j[r]]=t[r];return i}(t),n=[0,0,0,0,0],o=[0,0,0,0,0],u=t.tileDisplayData.displayObjects,l=Object(r.a)(u);try{for(l.s();!(a=l.n()).done;){var f,c=a.value,d=Object(r.a)(c.displayRecords);try{for(d.s();!(f=d.n()).done;){var h=f.value;n[h.geometryType]=Math.max(n[h.geometryType],h.vertexFrom+h.vertexCount),o[h.geometryType]=Math.max(o[h.geometryType],h.indexFrom+h.indexCount)}}catch(L){d.e(L)}finally{d.f()}}}catch(L){l.e(L)}finally{l.f()}for(var v=new e(s,t.tileDisplayData.displayList,i,null),y=0;y<t.tileBufferData.geometries.length;++y){var p=n[y],b=o[y],m=t.tileBufferData.geometries[y],g=j[y],_=v._storageFor(g),O=t.tileBufferData.geometries[y].indexBuffer,D=void 0;for(var w in _.indexBuffer=O,_.idxFreeList=new k(O.length),_.idxFreeList.allocate(b),m.vertexBuffer){var B=t.tileBufferData.geometries[y].vertexBuffer[w];_.vertexBuffers[w].data=B.data,_.vertexBuffers[w].stride=B.stride;var T=Object(x.o)(B.stride),R=B.data.length*T/B.stride;D||(D=R)}_.vtxFreeList=new k(D),_.vtxFreeList.allocate(p)}return v}}]),e}(),B=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:400;Object(a.a)(this,e),this.duration=t,this._lastTime=0,this._elapsed=0,this._value=0,this._finished=!1}return Object(s.a)(e,[{key:"value",get:function(){return this._value}},{key:"reset",value:function(){this._lastTime=0,this._elapsed=0,this._value=0}},{key:"step",value:function(){var e=performance.now();if(0===this._lastTime)return this._lastTime=e,this._value=0,!0;if(this._elapsed>=this.duration)return!0;var t=e-this._lastTime;return this._elapsed+=t,this._lastTime=e,this._value=Math.min(this._elapsed/this.duration,1),!1}}]),e}(),T=(i(39),i(243),i(307)),R=(i(362),i(464),function(){function e(t){Object(a.a)(this,e),this.geometryMap=Object(x.e)((function(){return{indexBuffer:T.a.createIndex(t,35044),vao:null}}),(function(e,i){return{vertexBuffer:T.a.createVertex(t,x.a[i])}}))}return Object(s.a)(e,[{key:"dispose",value:function(){for(var e=0;e<5;e++){var t=this.geometryMap[e];if(t)for(var i in t.data.vao&&t.data.vao.dispose(!1),t.data.indexBuffer&&t.data.indexBuffer.dispose(),t.buffers)t.buffers[i]&&t.buffers[i].data.vertexBuffer.dispose()}}},{key:"get",value:function(e){var t=this.geometryMap[e],i={};for(var r in t.buffers)i[r]=t.buffers[r].data.vertexBuffer;return{indexBuffer:t.data.indexBuffer,get vao(){return t.data.vao},set vao(e){t.data.vao=e},vertexBufferMap:i}}},{key:"has",value:function(e){return null!=this.geometryMap[e]}},{key:"upload",value:function(e,t){var i=this;t.forEach((function(t,r){i._upload(t,r,e)}))}},{key:"_upload",value:function(e,t,i){if(e.indices&&(e.indices.allDirty?this._uploadIndices(i,t):null!=e.indices.from&&null!=e.indices.count&&this._uploadIndices(i,t,e.indices.from,e.indices.count)),e.vertices){var r=e.vertices;for(var a in r){var s=r[a];s.allDirty?this._uploadVertices(i,t,a):null!=s.from&&null!=s.count&&this._uploadVertices(i,t,a,s.from,s.count)}}}},{key:"_uploadVertices",value:function(e,t,i,r,a){var s=this.geometryMap[t];if(s){var n=e.geometries[t].vertexBuffer[i];if(n){var o=n.stride,u=n.data.buffer;s.buffers[i]&&u.byteLength>0&&(null!=r&&null!=a?s.buffers[i].data.vertexBuffer.setSubData(u,r*o,r*o,(r+a)*o):s.buffers[i].data.vertexBuffer.setData(u))}}}},{key:"_uploadIndices",value:function(e,t,i,r){var a=this.geometryMap[t];if(a){var s=e.geometries[t].indexBuffer.buffer;a.data.indexBuffer&&s.byteLength>0&&(null!=i&&null!=r?a.data.indexBuffer.setSubData(s,4*i,4*i,4*(i+r)):a.data.indexBuffer.setData(s))}}}]),e}()),L=new Set,F=function(e){Object(u.a)(i,e);var t=Object(l.a)(i);function i(e,r){var s,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(a.a)(this,i),(s=t.call(this,e,r,[h.F,h.F]))._data=null,s._displayList=null,s._wglBuffers=null,s._deferPatches=!1,s._dirtyMap=new _,s._labelIndex=null,s._lastCommitTime=0,s._patchQueue=new c.a(100),s.fader=new B,s._dirty=!0,s._replaceBuffers=!1,s._uploadsLocked=!1,s._hasData=!1,s._invalidated=!1,s.transforms.labelMat2d=Object(y.a)(),s._ensureCorrectZOrder=n,s._deferPatches=!n,s}return Object(s.a)(i,[{key:"destroy",value:function(){Object(n.a)(Object(o.a)(i.prototype),"destroy",this).call(this),this.clear()}},{key:"displayObjects",get:function(){var e;return null!=(e=this._displayObjects)?e:[]}},{key:"isDirty",get:function(){return this._dirty},set:function(e){this._dirty=e,this.requestRender()}},{key:"hasData",get:function(){return!!this._hasData}},{key:"labelIndex",get:function(){return this._labelIndex}},{key:"getGeometry",value:function(e){return this._wglBuffers&&this._wglBuffers.has(e)?this._wglBuffers.get(e):null}},{key:"getDisplayList",value:function(){return this._displayList}},{key:"setTransform",value:function(e,t){Object(n.a)(Object(o.a)(i.prototype),"setTransform",this).call(this,e,t);var r=this.transforms.labelMat2d,a=e.getScreenTransform(r,t),s=Object(p.a)();Object(d.s)(s,this.coords,a),Object(v.d)(r),Object(v.h)(r,r,s),Object(v.e)(r,e.viewMat2d,r)}},{key:"setData",value:function(e){var t=e.addOrUpdate,i=e.remove;e.clear&&(this.clear(),this._patchQueue.clear(),this._hasData=!1),"replace"===e.type&&(this._replaceBuffers=!0,this._patchQueue.clear(),this._data=null),!this._data&&t&&t.tileDisplayData.displayObjects.length?(t.tileDisplayData.computeDisplayList(this._ensureCorrectZOrder),this._dirtyMap=new _,this._dispRecStore=w.fromTileData(t,this._dirtyMap),this._data=t,this._dirtyMap.markAllDirty(),this._hasData=!0,e.end&&this.ready()):this._data&&(t&&t.tileDisplayData.displayObjects.length||i.length)?this._deferPatches?this._patchQueue.enqueue(e):this._doPatchData(e):e.end&&this.ready(),e.end&&!this._data&&this.clear(),this.requestRender(),this.emit("change")}},{key:"lockUploads",value:function(){this._uploadsLocked=!0}},{key:"unlockUploads",value:function(){this._uploadsLocked=!1,this.requestRender()}},{key:"commitChanges",value:function(e){if(!e.time||e.time!==this._lastCommitTime){if(this._lastCommitTime=e.time,this.fader.step()||this.requestRender(),this._patchQueue.size){var t=this._patchQueue.dequeue();Object(f.i)(t)&&(t.end&&this.ready(),this._doPatchData(t),this.requestRender(),this._hasData=!0)}if(this._uploadsLocked)this.requestRender();else if(this.visible&&this._data){if(this._replaceBuffers)for(this._wglBuffers&&this._wglBuffers.dispose(),this._wglBuffers=null,this._replaceBuffers=!1;this._patchQueue.size;){var i=this._patchQueue.dequeue();Object(f.i)(i)&&(i.end&&this.ready(),this._doPatchData(i),this._hasData=!0)}this._wglBuffers||(this._wglBuffers=new R(e.context)),(this._dirtyMap.hasDirty()||this._invalidated)&&(this._invalidated=!1,this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap),this._displayList=this._data.tileDisplayData.displayList.clone(),this._displayObjects=this._data.tileDisplayData.displayObjects.slice(),this._rebuildLabelIndex(),this._dirtyMap.markAllClean())}}}},{key:"clear",value:function(){this._data=null,this._displayList=null,this._dispRecStore=null,this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)}},{key:"_doPatchData",value:function(e){try{if("new"===e.type){if(!e.addOrUpdate)return;this._invalidated=!0;var t=this._bulkAddFeatures(e);t&&(this._dirtyMap.markAllDirty(),this._data.reshuffleBulkAdd(e,t.objectIndex,t.recordIndex),this._dispRecStore=w.fromTileData(this._data,this._dirtyMap))}else this._invalidated=!0,this._patchData(e)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=w.fromTileData(this._data,this._dirtyMap))}catch(e){}this.requestRender()}},{key:"_rebuildLabelIndex",value:function(){var e,t;if(null!=(e=this._data)&&null!=(t=e.tileBufferData.geometries[m.d.LABEL])&&t.indexBuffer.length){this.isDirty=!0,this._labelIndex=this._initLabelIndex();var i,a=Object(r.a)(this.displayObjects);try{for(a.s();!(i=a.n()).done;){var s,n=i.value,o=Object(r.a)(n.metrics);try{for(o.s();!(s=o.n()).done;){var u=s.value;this._insertIntoLabelIndex(u)}}catch(l){o.e(l)}finally{o.f()}}}catch(l){a.e(l)}finally{a.f()}}}},{key:"_insertIntoLabelIndex",value:function(e){e.xBucket<0||e.yBucket<0||e.yBucket>3||e.xBucket>3||this.labelIndex[e.yBucket][e.xBucket].push(e)}},{key:"_initLabelIndex",value:function(){for(var e=[],t=0;t<h.F/h.d;t++){e.push([]);for(var i=0;i<h.F/h.d;i++)e[t].push([])}return e}},{key:"_bulkAddFeatures",value:function(e){for(var t=e.addOrUpdate.tileDisplayData.displayObjects,i=this._data.tileDisplayData.displayObjects,r=this._data.tileDisplayData.displayObjectRegistry,a=0;a<t.length;a++){for(var s=t[a],n=r.get(s.id),o=0;o<s.displayRecords.length;++o){var u=s.displayRecords[o];if(n){if(u.geometryType!==m.d.FILL&&u.geometryType!==m.d.LINE)continue;n.displayRecords.push(u)}var l=e.addOrUpdate.tileBufferData.geometries[u.geometryType];if(!this._dispRecStore.tryAddMeshData(u,l))return{objectIndex:a,recordIndex:o}}n||(r.set(s.id,s),i.push(s))}return null}},{key:"_patchData",value:function(e){var t,i=!0,a=e.addOrUpdate&&e.addOrUpdate.tileDisplayData&&e.addOrUpdate.tileDisplayData.displayObjects||[],s=(e.remove||[]).slice(),n=Object(r.a)(a);try{for(n.s();!(t=n.n()).done;){var o=t.value;null!=o.insertAfter&&s.push(o.id)}}catch(Q){n.e(Q)}finally{n.f()}var u,l=Object(r.a)(s);try{for(l.s();!(u=l.n()).done;){var f=u.value,c=this._data.tileDisplayData.displayObjectRegistry.get(f);if(c){this._data.tileDisplayData.displayList.removeFromList(c.displayRecords);var d,h=Object(r.a)(c.displayRecords);try{for(h.s();!(d=h.n()).done;){var v=d.value;this._dispRecStore.delete(v)}}catch(Q){h.e(Q)}finally{h.f()}this._data.tileDisplayData.displayObjectRegistry.delete(f);var y=this._data.tileDisplayData.displayObjects.indexOf(c);this._data.tileDisplayData.displayObjects.splice(y,1)}}}catch(Q){l.e(Q)}finally{l.f()}var p,b=Object(r.a)(a);try{for(b.s();!(p=b.n()).done;){var m=p.value,x=void 0,g=this._data.tileDisplayData.displayObjectRegistry.get(m.id);if(g){var _=g.displayRecords;g.set(m),g.displayRecords=_;for(var O=g.displayRecords.length,D=0;D<O;++D){var k=g.displayRecords[D],j=m.displayRecords[D];(D>=m.displayRecords.length||k.geometryType!==j.geometryType||k.symbolLevel!==j.symbolLevel||k.zOrder!==j.zOrder||k.materialKey!==j.materialKey)&&(this._dispRecStore.delete(g.displayRecords[D]),D<m.displayRecords.length&&(g.displayRecords[D]=void 0))}g.displayRecords.length=m.displayRecords.length,g.metrics=m.metrics}else{var w=void 0;(g=m.copy()).displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(m.id,g);var B=this._data.tileDisplayData.displayObjects;if(null!=g.insertAfter)if(x={},g.insertAfter>=0){var T=this._data.tileDisplayData.displayObjectRegistry.get(g.insertAfter);T?(w=B.indexOf(T)+1)<B.length?B.splice(w,0,g):(B.push(g),w=B.length):(B.push(g),w=B.length)}else B.unshift(g),w=0;else B.push(g),w=B.length;if(x){var R=void 0;if(this._data.tileDisplayData.displayList.unified)R=m.displayRecords.length>0?1:0;else{L.clear();var F,I=Object(r.a)(m.displayRecords);try{for(I.s();!(F=I.n()).done;){var C=F.value,M=this._data.tileDisplayData.displayList.getDPInfoType(C.geometryType);L.add(M)}}catch(Q){I.e(Q)}finally{I.f()}R=L.size}for(var z=0,V=w-1;V>=0&&z<R;--V)for(var A=B[V].displayRecords.length-1;A>=0&&z<R;--A){var S=B[V].displayRecords[A],E=this._data.tileDisplayData.displayList.getDPInfoType(S.geometryType);x[E]||(x[E]=S,++z)}}}for(var P=m.displayRecords.length,U=0;U<P;++U){var K=m.displayRecords[U],q=g.displayRecords[U];q?(q.meshData=K.meshData,q.materialKey=K.materialKey):((q=K.copy()).vertexFrom=void 0,q.indexFrom=void 0,g.displayRecords[U]=q);var N=K.geometryType,Z=this._data.tileDisplayData.displayList.getDPInfoType(N),G=e.addOrUpdate.tileBufferData.geometries[N],H=G.vertexBuffer,X=G.indexBuffer,Y=void 0;x&&(Y=x[Z]?this._data.tileDisplayData.displayList.splitAfter(x[Z]):-1),i=this._dispRecStore.setMeshData(q,K,H,X,Y)&&i,x&&null!=q.indexFrom&&null!=q.indexFrom&&(x[Z]=q)}}}catch(Q){b.e(Q)}finally{b.f()}return i}}]),i}(b.a)},865:function(e,t,i){"use strict";i.d(t,"a",(function(){return L}));var r=i(12),a=i(2),s=i(3),n=i(781),o=i(782),u=function(){function e(){Object(a.a)(this,e),this._byGeometryType=null}return Object(s.a)(e,[{key:"satisfied",get:function(){return!this._byGeometryType}},{key:"reset",value:function(){this._byGeometryType=null}},{key:"verticesFor",value:function(e){return this._byGeometryType?this._byGeometryType[e].vertices:0}},{key:"indicesFor",value:function(e){return this._byGeometryType?this._byGeometryType[e].indices:0}},{key:"needMore",value:function(e,t,i){if(t||i){this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]);var r=this._byGeometryType[e];r.vertices+=t,r.indices+=i}}}]),e}(),l=function(){function e(){Object(a.a)(this,e),this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}return Object(s.a)(e,[{key:"clone",value:function(){for(var t=new e,i=0;i<this.geometries.length;i++){var r=this.geometries[i],a=t.geometries[i];for(var s in a.indexBuffer=r.indexBuffer.slice(),a.vertexBuffer={},r.vertexBuffer){var n=r.vertexBuffer[s],o=n.data,u=n.stride;a.vertexBuffer[s]={data:o.slice(),stride:u}}}return t}},{key:"serialize",value:function(){for(var e={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]},t=0;t<5;++t)for(var i in this.geometries[t].vertexBuffer)e.geometries[t].vertexBuffer[i]={data:this.geometries[t].vertexBuffer[i].data.buffer,stride:this.geometries[t].vertexBuffer[i].stride};return e}},{key:"getBuffers",value:function(){for(var e=[],t=0;t<5;++t)for(var i in e.push(this.geometries[t].indexBuffer.buffer),this.geometries[t].vertexBuffer)e.push(this.geometries[t].vertexBuffer[i].data.buffer);return e}}],[{key:"deserialize",value:function(t){for(var i=new e,r=0;r<5;++r)for(var a in i.geometries[r].indexBuffer=new Uint32Array(t.geometries[r].indexBuffer),i.geometries[r].vertexBuffer={},t.geometries[r].vertexBuffer)i.geometries[r].vertexBuffer[a]={data:Object(o.c)(t.geometries[r].vertexBuffer[a].data,t.geometries[r].vertexBuffer[a].stride),stride:t.geometries[r].vertexBuffer[a].stride};return i}}]),e}(),f=i(815),c=i(14).a.getLogger("esri.views.2d.engine.webgl.WGLDisplayList");function d(e,t,i){for(var r=arguments.length,a=new Array(r>3?r-3:0),s=3;s<r;s++)a[s-3]=arguments[s];t<e.length?e.splice.apply(e,[t,i].concat(a)):e.push.apply(e,a)}var h=new Map;h.set(n.c.MAP,[n.d.FILL,n.d.LINE,n.d.MARKER,n.d.TEXT]),h.set(n.c.LABEL,[n.d.LABEL]),h.set(n.c.LABEL_ALPHA,[n.d.LABEL]);var v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(a.a)(this,e),this.symbolLevels=[],this.unified=t}return Object(s.a)(e,[{key:"replay",value:function(e,t,i){if(this.unified){var a,s=Object(r.a)(this.symbolLevels);try{for(s.s();!(a=s.n()).done;){var n,o=a.value,u=Object(r.a)(o.zLevels);try{for(u.s();!(n=u.n()).done;){var l=n.value.geometryDPInfo.unified;if(l){var f,c=Object(r.a)(l);try{for(c.s();!(f=c.n()).done;){var d=f.value,h=e.painter.getGeometryBrush(d.geometryType),v=t.getGeometry(d.geometryType);h.prepareState(e,t),h.drawGeometry(e,t,d,v,i)}}catch(y){c.e(y)}finally{c.f()}}}}catch(y){u.e(y)}finally{u.f()}}}catch(y){s.e(y)}finally{s.f()}}}},{key:"empty",get:function(){return!this.symbolLevels||0===this.symbolLevels.length}},{key:"clear",value:function(){this.symbolLevels.length=0}},{key:"addToList",value:function(e,t){if(Array.isArray(e)){var i,a=Object(r.a)(e);try{for(a.s();!(i=a.n()).done;){var s=i.value;this._addToList(s,t)}}catch(n){a.e(n)}finally{a.f()}}else this._addToList(e,t)}},{key:"removeFromList",value:function(e){Array.isArray(e)||(e=[e]);var t,i=null,a=Object(r.a)(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;i=this._removeFromList(s)}}catch(n){a.e(n)}finally{a.f()}return i}},{key:"byType",value:function(e,t){var i,a=Object(r.a)(this.symbolLevels);try{for(a.s();!(i=a.n()).done;){var s,n=i.value,o=Object(r.a)(n.zLevels);try{for(o.s();!(s=o.n()).done;){var u=s.value.geometryDPInfo,l=this.getDPInfoType(e);if(u[l]){var f,c=Object(r.a)(u[l]);try{for(c.s();!(f=c.n()).done;){t(f.value)}}catch(d){c.e(d)}finally{c.f()}}}}catch(d){o.e(d)}finally{o.f()}}}catch(d){a.e(d)}finally{a.f()}}},{key:"clone",value:function(){var t,i=new e(this.unified),a=Object(r.a)(this.symbolLevels);try{for(a.s();!(t=a.n()).done;){var s=t.value;i.symbolLevels.push(s.clone())}}catch(n){a.e(n)}finally{a.f()}return i}},{key:"splitAfter",value:function(e){for(var t=this._getDisplayList(e.symbolLevel,e.zOrder,e.geometryType),i=t.length,r=e.indexFrom+e.indexCount,a=0;a<i;++a){var s=t[a];if(s.geometryType===e.geometryType&&r>s.indexFrom&&r<=s.indexFrom+s.indexCount){if(r<s.indexFrom+s.indexCount){var n=new y;n.geometryType=s.geometryType,n.materialKey=s.materialKey,n.indexFrom=r,n.indexCount=s.indexFrom+s.indexCount-r,t.splice(a+1,0,n),s.indexCount=r-s.indexFrom}return a}}}},{key:"_addToList",value:function(e,t){var i=e.symbolLevel,r=e.zOrder,a=this._getDisplayList(i,r,e.geometryType),s=null!=t?t:a.length-1,n=s>=0&&s<a.length?a[s]:null;if(null===n||n.materialKey!==e.materialKey||n.indexFrom+n.indexCount!==e.indexFrom||this.unified&&n.geometryType!==e.geometryType){var o=new y;o.indexFrom=e.indexFrom,o.indexCount=e.indexCount,o.materialKey=e.materialKey,o.geometryType=e.geometryType,d(a,s+1,0,o)}else n.indexCount+=e.indexCount}},{key:"_removeFromList",value:function(e){for(var t,i=e.symbolLevel,r=e.zOrder,a=this._getDisplayList(i,r,e.geometryType),s=a.length,n=0;n<s;++n){var o=a[n];if(e.indexFrom+e.indexCount>o.indexFrom&&e.indexFrom<o.indexFrom+o.indexCount&&(!this.unified||o.geometryType===e.geometryType)){t=n;break}}if(void 0!==t){var u=a[t];if(e.indexFrom===u.indexFrom)return u.indexCount-=e.indexCount,u.indexFrom+=e.indexCount,0===u.indexCount&&d(a,t,1),t-1;if(e.indexFrom+e.indexCount===u.indexFrom+u.indexCount)return u.indexCount-=e.indexCount,0===u.indexCount?(d(a,t,1),t-1):t;var l=u.indexFrom,f=e.indexFrom-u.indexFrom,c=e.indexCount,h=u.indexFrom+u.indexCount-(e.indexFrom+e.indexCount);u.indexCount=f;var v=new y;return v.geometryType=u.geometryType,v.materialKey=u.materialKey,v.indexFrom=l+f+c,v.indexCount=h,d(a,t+1,0,v),t}return null}},{key:"_getDisplayList",value:function(e,t,i){for(var r,a,s=this.symbolLevels.length,o=0;o<s;o++)if(this.symbolLevels[o].symbolLevel===e){r=this.symbolLevels[o];break}r||((r=new m).symbolLevel=e,this.symbolLevels.push(r));for(var u,l=r.zLevels.length,f=0;f<l;f++)if(r.zLevels[f].zLevel===t){a=r.zLevels[f];break}if(a||((a=new b).geometryDPInfo=new p,a.zLevel=t,r.zLevels.push(a)),this.unified)a.geometryDPInfo.unified||(a.geometryDPInfo.unified=[]),u=a.geometryDPInfo.unified;else switch(i){case n.d.FILL:a.geometryDPInfo.fill||(a.geometryDPInfo.fill=[]),u=a.geometryDPInfo.fill;break;case n.d.LINE:a.geometryDPInfo.line||(a.geometryDPInfo.line=[]),u=a.geometryDPInfo.line;break;case n.d.MARKER:a.geometryDPInfo.marker||(a.geometryDPInfo.marker=[]),u=a.geometryDPInfo.marker;break;case n.d.TEXT:a.geometryDPInfo.text||(a.geometryDPInfo.text=[]),u=a.geometryDPInfo.text;break;case n.d.LABEL:a.geometryDPInfo.label||(a.geometryDPInfo.label=[]),u=a.geometryDPInfo.label;break;default:console.error("Trying to add a record with geometry type '"+i+"'.")}return u}},{key:"getDPInfoType",value:function(e){if(this.unified)return"unified";switch(e){case n.d.FILL:return"fill";case n.d.LINE:return"line";case n.d.MARKER:return"marker";case n.d.TEXT:return"text";case n.d.LABEL:return"label";default:return void c.error("DisplayList: Tried to convert unknown geometryType: ".concat(e))}}}]),e}(),y=function(){function e(){Object(a.a)(this,e),this.materialKey=null,this.indexFrom=0,this.indexCount=0}return Object(s.a)(e,[{key:"clone",value:function(){var t=new e;return t.geometryType=this.geometryType,t.materialKey=this.materialKey,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t}}]),e}(),p=function(){function e(){Object(a.a)(this,e),this.fill=null,this.line=null,this.marker=null,this.text=null,this.label=null,this.unified=null}return Object(s.a)(e,[{key:"clone",value:function(){var t=new e;return t.fill=this.fill&&this.fill.map((function(e){return e.clone()})),t.line=this.line&&this.line.map((function(e){return e.clone()})),t.marker=this.marker&&this.marker.map((function(e){return e.clone()})),t.text=this.text&&this.text.map((function(e){return e.clone()})),t.label=this.label&&this.label.map((function(e){return e.clone()})),t.unified=this.unified&&this.unified.map((function(e){return e.clone()})),t}}]),e}(),b=function(){function e(){Object(a.a)(this,e),this.geometryDPInfo=new p}return Object(s.a)(e,[{key:"clone",value:function(){var t=new e;return t.zLevel=this.zLevel,t.geometryDPInfo=this.geometryDPInfo.clone(),t}}]),e}(),m=function(){function e(){Object(a.a)(this,e),this.zLevels=[]}return Object(s.a)(e,[{key:"clone",value:function(){var t=new e;t.symbolLevel=this.symbolLevel;var i,a=Object(r.a)(this.zLevels);try{for(a.s();!(i=a.n()).done;){var s=i.value;t.zLevels.push(s.clone())}}catch(n){a.e(n)}finally{a.f()}return t}}]),e}(),x=v,g=i(800),_=i(839);function O(e){var t,i=[[],[],[],[],[]],a=e,s=Object(r.a)(a);try{for(s.s();!(t=s.n()).done;){var n,o=t.value,u=Object(r.a)(o.displayRecords);try{for(u.s();!(n=u.n()).done;){var l=n.value;i[l.geometryType].push(l)}}catch(f){u.e(f)}finally{u.f()}}}catch(f){s.e(f)}finally{s.f()}return i}var D=function(){function e(){Object(a.a)(this,e)}return Object(s.a)(e,[{key:"displayObjectRegistry",get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;var e,t=Object(r.a)(this.displayObjects);try{for(t.s();!(e=t.n()).done;){var i=e.value;this._displayObjectRegistry.set(i.id,i)}}catch(a){t.e(a)}finally{t.f()}}return this._displayObjectRegistry}},{key:"displayList",get:function(){return this._displayList}},{key:"computeDisplayList",value:function(e){if(this._displayList=new x(e),e){var t,i=Object(r.a)(this.displayObjects);try{for(i.s();!(t=i.n()).done;){var a,s=t.value,n=Object(r.a)(s.displayRecords);try{for(n.s();!(a=n.n()).done;){var o=a.value;this._displayList.addToList(o)}}catch(d){n.e(d)}finally{n.f()}}}catch(d){i.e(d)}finally{i.f()}}else for(var u=O(this.displayObjects),l=u.length,f=0;f<l;++f){var c=u[f];this._displayList.addToList(c)}}},{key:"clone",value:function(){var t=new e;return this.displayObjects&&(t.displayObjects=this.displayObjects.map((function(e){return e.clone()}))),t}},{key:"serialize",value:function(e){return Object(g.b)(e,this.displayObjects),e}},{key:"_deserializeObjects",value:function(e){for(var t=e.readInt32(),i=new Array(t),r=new Map,a=0;a<i.length;++a){var s=_.a.deserialize(e);i[a]=s,r.set(s.id,s)}this.displayObjects=i,this._displayList=null,this._displayObjectRegistry=r}}],[{key:"deserialize",value:function(t){var i=new e;return i._deserializeObjects(t),i}}]),e}(),k=i(816),j=i(847),w=i(841),B=new u,T=new u;function R(e,t){var i={};for(var r in e){var a={data:Object(o.b)(t,e[r]),stride:e[r]};i[r]=a}return i}var L=function(){function e(){Object(a.a)(this,e),this.tileDisplayData=null,this.tileBufferData=null}return Object(s.a)(e,[{key:"reshuffle",value:function(){B.reset();var t,i=O(this.tileDisplayData.displayObjects),a=Object(r.a)(i);try{for(a.s();!(t=a.n()).done;){var s,n=t.value,u=Object(r.a)(n);try{for(u.s();!(s=u.n()).done;){var f=s.value;f&&B.needMore(f.geometryType,f.meshData?f.meshData.vertexCount:f.vertexCount,f.meshData?f.meshData.indexData.length:f.indexCount)}}catch(S){u.e(S)}finally{u.f()}}}catch(S){a.e(S)}finally{a.f()}for(var c=i.length,d=new l,h=0;h<c;++h){d.geometries[h].indexBuffer=new Uint32Array(Math.round(1.5*B.indicesFor(h)));var v=[];for(var y in this.tileBufferData.geometries[h].vertexBuffer)v.push(this.tileBufferData.geometries[h].vertexBuffer[y].stride);var p=e._computeVertexAlignment(v),b=Math.round(1.5*B.verticesFor(h)),m=e._align(b,p);for(var x in this.tileBufferData.geometries[h].vertexBuffer){var g=this.tileBufferData.geometries[h].vertexBuffer[x].stride;d.geometries[h].vertexBuffer[x]={stride:g,data:Object(o.b)(m,g)}}}T.reset(),this.tileDisplayData.displayList.clear();for(var _=0;_<c;++_){var D,k=i[_],j=Object(r.a)(k);try{for(j.s();!(D=j.n()).done;){var w=D.value;if(w.meshData)w.writeMeshDataToBuffers(T.verticesFor(_),d.geometries[_].vertexBuffer,T.indicesFor(_),d.geometries[_].indexBuffer),w.meshData=null;else{var R=this.tileBufferData.geometries[_].vertexBuffer,L=this.tileBufferData.geometries[_].indexBuffer,F=d.geometries[_].vertexBuffer,I=d.geometries[_].indexBuffer,C=T.verticesFor(_),M=T.indicesFor(_);Object(o.d)(C,M,F,I,w,R,L),w.vertexFrom=C,w.indexFrom=M}T.needMore(_,w.vertexCount,w.indexCount)}}catch(S){j.e(S)}finally{j.f()}this.tileDisplayData.displayList.unified||this.tileDisplayData.displayList.addToList(k)}if(this.tileDisplayData.displayList.unified){var z,V=Object(r.a)(this.tileDisplayData.displayObjects);try{for(V.s();!(z=V.n()).done;){var A=z.value;this.tileDisplayData.displayList.addToList(A.displayRecords)}}catch(S){V.e(S)}finally{V.f()}}this.tileBufferData=d}},{key:"reshuffleBulkAdd",value:function(t,i,r){var a=t.addOrUpdate.tileDisplayData.displayObjects,s=this.tileDisplayData.displayObjects;B.reset();for(var u=0;u<s.length;u++)for(var f=s[u],c=0;c<f.displayRecords.length;c++){var d=f.displayRecords[c];B.needMore(d.geometryType,d.vertexCount,d.indexCount)}for(var h=i;h<a.length;h++)for(var v=a[h],y=h===i?r:0;y<v.displayRecords.length;y++){var p=v.displayRecords[y];B.needMore(p.geometryType,p.vertexCount,p.indexCount)}for(var b=new l,m=0;m<5;m++){b.geometries[m].indexBuffer=new Uint32Array(Math.round(1.5*B.indicesFor(m)));var x=[],g=this.tileBufferData.geometries[m].vertexBuffer;for(var _ in g)x.push(g[_].stride);var O=e._computeVertexAlignment(x),D=Math.round(1.5*B.verticesFor(m)),k=e._align(D,O);for(var j in g){var w=g[j].stride,R=Object(o.b)(k,w);b.geometries[m].vertexBuffer[j]={stride:w,data:R}}}T.reset(),this.tileDisplayData.displayList.clear();for(var L=0;L<s.length;L++)for(var F=s[L],I=0;I<F.displayRecords.length;I++){var C=F.displayRecords[I],M=C.geometryType,z=this.tileBufferData.geometries[M].vertexBuffer,V=this.tileBufferData.geometries[M].indexBuffer,A=b.geometries[M].vertexBuffer,S=b.geometries[M].indexBuffer,E=T.verticesFor(M),P=T.indicesFor(M);Object(o.d)(E,P,A,S,C,z,V),C.vertexFrom=E,C.indexFrom=P,T.needMore(M,C.vertexCount,C.indexCount),this.tileDisplayData.displayList.addToList(C)}var U=this.tileDisplayData.displayObjectRegistry;if(0!==r)for(var K=a[i],q=0;q<r;q++){var N=K.displayRecords[q];if(!U.get(K.id)||N.geometryType===n.d.FILL||N.geometryType===n.d.LINE){var Z=N.geometryType,G=this.tileBufferData.geometries[Z].vertexBuffer,H=this.tileBufferData.geometries[Z].indexBuffer,X=b.geometries[Z].vertexBuffer,Y=b.geometries[Z].indexBuffer,Q=T.verticesFor(Z),J=T.indicesFor(Z);Object(o.d)(Q,J,X,Y,N,G,H),N.vertexFrom=Q,N.indexFrom=J,T.needMore(Z,N.vertexCount,N.indexCount),this.tileDisplayData.displayList.addToList(N)}}for(var W=i;W<a.length;W++){for(var $=a[W],ee=W===i?r:0,te=U.get($.id),ie=ee;ie<$.displayRecords.length;ie++){var re=$.displayRecords[ie];if(te){if(re.geometryType!==n.d.FILL&&re.geometryType!==n.d.LINE)continue;te.displayRecords.push(re)}var ae=re.geometryType,se=t.addOrUpdate.tileBufferData.geometries[ae],ne=se.vertexBuffer,oe=se.indexBuffer,ue=b.geometries[ae].vertexBuffer,le=b.geometries[ae].indexBuffer,fe=T.verticesFor(ae),ce=T.indicesFor(ae);Object(o.d)(fe,ce,ue,le,re,ne,oe),re.vertexFrom=fe,re.indexFrom=ce,T.needMore(ae,re.vertexCount,re.indexCount),this.tileDisplayData.displayList.addToList(re)}te||(U.set($.id,$),this.tileDisplayData.displayObjects.push($))}this.tileBufferData=b}},{key:"getStrides",value:function(){for(var e=[],t=0;t<this.tileBufferData.geometries.length;++t){var i=this.tileBufferData.geometries[t];for(var r in e[t]={},i.vertexBuffer)e[t][r]=i.vertexBuffer[r].stride}return e}},{key:"clone",value:function(){var t=new e;return t.tileBufferData=this.tileBufferData.clone(),t.tileDisplayData=this.tileDisplayData.clone(),t}},{key:"_guessSize",value:function(){for(var e=this.tileDisplayData.displayObjects,t=Math.min(e.length,4),i=0,r=0;r<t;r++)i=Math.max(i,e[r].displayRecords.length);return 2*(12*e.length+e.length*i*40)}},{key:"serialize",value:function(){var e=this.tileBufferData.serialize(),t=this.tileBufferData.getBuffers(),i=this.tileDisplayData.serialize(new k.a(Int32Array,this._guessSize())).buffer();return t.push(i),{result:{displayData:i,bufferData:e},transferList:t}}}],[{key:"decode",value:function(t){var i=j.a.deserializeDisplayObjects(t),r={};for(var a in t.vertexBuffersMap)r[a]=w.a.decode(t.vertexBuffersMap[a]);return e.fromMeshData({displayObjects:i,vertexBuffersMap:r})}},{key:"fromMeshData",value:function(t){var i=new e,r=new D,a=new l;for(var s in r.displayObjects=t.displayObjects,t.vertexBuffersMap){var n=t.vertexBuffersMap[s];a.geometries[s].indexBuffer=n.indexBuffer,a.geometries[s].vertexBuffer=n.namedBuffers}return i.tileDisplayData=r,i.tileBufferData=a,i}},{key:"bind",value:function(t,i){var r=new e;return r.tileDisplayData=t,r.tileBufferData=i,r}},{key:"create",value:function(t,i){var a=new e;a.tileDisplayData=new D,a.tileDisplayData.displayObjects=t;var s,n=[0,0,0,0,0],o=[0,0,0,0,0],u=[[],[],[],[],[]],c=Object(r.a)(t);try{for(c.s();!(s=c.n()).done;){var d,h=s.value,v=Object(r.a)(h.displayRecords);try{for(v.s();!(d=v.n()).done;){var y=d.value;u[y.geometryType].push(y),n[y.geometryType]+=y.meshData.vertexCount,o[y.geometryType]+=y.meshData.indexData.length}}catch(_){v.e(_)}finally{v.f()}}}catch(_){c.e(_)}finally{c.f()}for(var p=new l,b=function(e){return[e.fill||{},e.line||{},e.icon||{},e.text||{},e.label||{}]}(i),m=0;m<5;m++){var x=new Uint32Array(o[m]),g=R(b[m],n[m]);f.a.writeAllMeshDataToBuffers(u[m],g,x),p.geometries[m]={indexBuffer:x,vertexBuffer:g}}return a.tileBufferData=p,a}},{key:"_align",value:function(e,t){var i=e%t;return 0===i?e:e+(t-i)}},{key:"_computeVertexAlignment",value:function(e){var t,i=!1,a=!1,s=Object(r.a)(e);try{for(s.s();!(t=s.n()).done;){var n=t.value;n%4==2?i=!0:n%4!=0&&(a=!0)}}catch(o){s.e(o)}finally{s.f()}return a?4:i?2:1}}]),e}()},878:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(2),a=i(3),s=i(4),n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;Object(r.a)(this,e),this.size=0,this._start=0,this.maxSize=t,this._buffer=isFinite(t)?new Array(t):[]}return Object(a.a)(e,[{key:"entries",get:function(){return this._buffer}},{key:"enqueue",value:function(e){if(this.size===this.maxSize){var t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return isFinite(this.maxSize)?this._buffer[(this._start+this.size++)%this.maxSize]=e:this._buffer[this._start+this.size++]=e,null}},{key:"dequeue",value:function(){if(0===this.size)return null;var e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}},{key:"clear",value:function(){for(;Object(s.i)(this.dequeue()););}}]),e}()},888:function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return c}));var r=i(9),a=i(12),s=i(4),n=i(36),o=i(780),u=i(781),l=i(786),f=i(876);function c(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function d(e){return e.map((function(e){return function(e){return{value:e.value,size:Object(n.j)(e.size)}}(e)}))}function h(e){if("string"==typeof e||"number"==typeof e)return Object(n.j)(e);var t=e;return{type:"size",expression:t.expression,stops:d(t.stops)}}var v=function(e){for(var t=[],i=[],r=d(e),a=r.length,s=0;s<6;s++){var u=r[Math.min(s,a-1)];t.push(u.value),i.push(null==u.size?o.p:Object(n.g)(u.size))}return{values:new Float32Array(t),sizes:new Float32Array(i)}};function y(e){var t=e&&e.length>0?{}:null,i=t?{}:null;if(!t)return{vvFields:t,vvRanges:i};var s,n=Object(a.a)(e);try{for(n.s();!(s=n.n()).done;){var o=s.value;if(o.field&&(t[o.type]=o.field),"size"===o.type){i.size||(i.size={});var l=o;switch(Object(f.a)(l)){case u.e.SIZE_MINMAX_VALUE:i.size.minMaxValue={minDataValue:l.minDataValue,maxDataValue:l.maxDataValue,minSize:h(l.minSize),maxSize:h(l.maxSize)};break;case u.e.SIZE_SCALE_STOPS:i.size.scaleStops={stops:d(l.stops)};break;case u.e.SIZE_FIELD_STOPS:if(l.levels){var c={};for(var y in l.levels)c[y]=v(l.levels[y]);i.size.fieldStops={type:"level-dependent",levels:c}}else i.size.fieldStops=Object(r.a)({type:"static"},v(l.stops));break;case u.e.SIZE_UNIT_VALUE:i.size.unitValue={unit:l.valueUnit,valueRepresentation:l.valueRepresentation}}}else if("color"===o.type)i.color=m(o);else if("opacity"===o.type)i.opacity=p(o);else if("rotation"===o.type){var b=o;i.rotation={type:b.rotationType}}}}catch(x){n.e(x)}finally{n.f()}return{vvFields:t,vvRanges:i}}function p(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;if(e.stops.length>8)return null;for(var i=e.stops,r=0;r<8;++r){var a=i[Math.min(r,i.length-1)];t.values[r]=a.value,t.opacities[r]=a.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;for(var s=e.stops&&e.stops.length>=0&&e.stops[0].opacity,n=0;n<8;n++)t.values[n]=1/0,t.opacities[n]=s}return t}function b(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function m(e){if(Object(s.h)(e))return null;if(e.normalizationField)return null;var t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;if(e.stops.length>8)return null;t.field=e.field;for(var i=e.stops,r=0;r<8;++r){var a=i[Math.min(r,i.length-1)];t.values[r]=a.value,b(t.colors,r,a.color)}}else{if(!(e.stops&&e.stops.length>=0))return null;for(var n=e.stops&&e.stops.length>=0&&e.stops[0].color,o=0;o<8;o++)t.values[o]=1/0,b(t.colors,o,n)}for(var u=0;u<32;u+=4)Object(l.b)(t.colors,u,!0);return t}},904:function(e,t,i){"use strict";i.d(t,"a",(function(){return K}));var r=i(12),a=i(9),s=i(10),n=i.n(s),o=i(21),u=i(2),l=i(3),f=i(61),c=i(55),d=i(5),h=i(6),v=i(16),y=i(107),p=i(286),b=i(865),m=i(861),x=i(13),g=i(4),_=i(14),O=i(23),D=i(780),k=(i(243),i(96)),j=i(362),w=(i(464),i(782)),B=i(845),T=_.a.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),R=Object(B.b)(B.a,T),L=function(e){return 2147483647&e},F=function(){function e(t,i,r){Object(u.a)(this,e),this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;var a=t.buffer,s=t.pixelType,n=t.textureOnly,o=Object(w.i)(s);this.shared=r,this.pixelType=s,this.size=i,this.textureOnly=n,n||(this.data=new o(Object(g.o)(a))),this._resetRange()}return Object(l.a)(e,[{key:"destroy",value:function(){var e=this;Object(g.a)(this._texture,(function(e){return e.dispose()}));var t=function(t){Object(g.a)(e._fbos[t],(function(e){"0"===t&&e.detachColorTexture(),e.dispose()})),e._fbos[t]=null};for(var i in this._fbos)t(i);this._texture=null}},{key:"_textureDesc",get:function(){return{target:3553,wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size}}},{key:"setData",value:function(e,t,i){var r=L(e),a=Object(g.o)(this.data),s=r*this.texelSize+t;!a||s>=a.length||(a[s]=i,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r))}},{key:"getData",value:function(e,t){if(Object(g.h)(this.data))return null;var i=L(e)*this.texelSize+t;return!this.data||i>=this.data.length?null:this.data[i]}},{key:"getTexture",value:function(e){var t=this;return Object(g.p)(this._texture,(function(){return t._initTexture(e)}))}},{key:"getFBO",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(Object(g.h)(this._fbos[t])){var i={colorTarget:0,depthStencilTarget:0},r=0===t?this.getTexture(e):this._textureDesc;this._fbos[t]=new j.a(e,i,r)}return this._fbos[t]}},{key:"locked",get:function(){return!(5121!==this.pixelType||!this.shared||this.textureOnly||!Object(x.a)("esri-atomics")||!this.data)&&1===Atomics.load(this.data,0)}},{key:"updateTexture",value:function(e){if(!this.locked)try{var t=this.dirtyStart,i=this.dirtyEnd;if(t>i)return;this._resetRange();var r=Object(g.o)(this.data).buffer,a=this.getTexture(e),s=(t-t%this.size)/this.size,n=(i-i%this.size)/this.size,o=s,u=this.size,l=n,f=s*this.size*4,c=4*(u+l*this.size)-f,d=Object(w.i)(this.pixelType),h=d.BYTES_PER_ELEMENT;try{new d(r,f*h,c)}catch(e){console.debug(e)}var v=new d(r,f*h,c),y=this.size,p=l-o+1;if(p>this.size)return void T.error(new O.a("mapview-webgl","Out-of-bounds index when updating AttributeData"));a.updateData(0,0,o,y,p,v)}catch(e){console.debug(e)}}},{key:"update",value:function(e){var t=e.data,i=e.start,r=e.end;if(Object(g.i)(t))for(var a=this.data,s=i*this.texelSize,n=0;n<t.length;n++){var o=1<<n%this.texelSize;e.layout&o&&(a[s+n]=t[n])}this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,r)}},{key:"resize",value:function(e,t){var i=this.size;if(this.size=t,this.textureOnly)i!==this.size&&(this._lastTexture=this._texture,this._texture=null);else{var r=Object(w.i)(this.pixelType);this.destroy(),this.data=new r(Object(g.o)(e.buffer))}}},{key:"_resetRange",value:function(){this.dirtyStart=2147483647,this.dirtyEnd=0}},{key:"_initTexture",value:function(e){var t=new k.a(e,this._textureDesc,Object(g.p)(this.data,void 0));if(Object(g.i)(this._lastTexture)&&this._fbos[0]){var i=this._lastTexture.descriptor.width,r=this._lastTexture.descriptor.height,a=this._lastTexture.descriptor.dataType,s=this._lastTexture.descriptor.pixelFormat,n=this.getFBO(e),o=Object(w.j)(a),u=new(Object(w.i)(a))(new ArrayBuffer(i*r*o*this.texelSize)),l=e.getBoundFramebufferObject(),f=e.getViewport(),c=f.x,d=f.y,h=f.width,v=f.height;e.bindFramebuffer(n),n.readPixels(0,0,i,r,s,a,u),t.updateData(0,0,0,2*i,r/2,u),e.setViewport(c,d,h,v),e.bindFramebuffer(l)}return this.destroy(),this._texture=t,this._texture}}]),e}(),I=function(){function e(){Object(u.a)(this,e),this._initialized=!1,this._forceNextUpload=!1,this._locked=!1}return Object(l.a)(e,[{key:"initialize",value:function(e){var t=e.blocks,i=e.shared,r=e.size;if(this.shared=i,this.size=r,R("Initializing AttributeStoreView",e),Object(g.h)(this._data))this._data=Object(g.k)(t,(function(e){return new F(e,r,i)}));else for(var a=0;a<this._data.length;a++){var s=this._data[a],n=t[a];Object(g.i)(n)&&(Object(g.h)(s)?this._data[a]=new F(n,r,i):s.resize(n,r))}this._initialized=!0}},{key:"destroy",value:function(){Object(g.a)(this._data,(function(e){return Object(g.k)(e,(function(e){return e.destroy()}))})),Object(g.a)(this._defaultTexture,(function(e){return e.dispose()}))}},{key:"getBlock",value:function(e){return Object(g.h)(this._data)?null:this._data[e]}},{key:"setLabelMinZoom",value:function(e,t){this.setData(e,0,1,t)}},{key:"getLabelMinZoom",value:function(e){return this.getData(e,0,1,255)}},{key:"getFilterFlags",value:function(e){return this.getData(e,0,0,0)}},{key:"getVVSize",value:function(e){return this.getData(e,D.b,0,0)}},{key:"getData",value:function(e,t,i,r){if(!this._data)return 0;var a=Object(g.o)(this._data)[t];if(Object(g.h)(a))return 0;var s=a.getData(e,i);return Object(g.i)(s)?s:r}},{key:"setData",value:function(e,t,i,r){var a=Object(g.o)(this._data)[t];Object(g.o)(a).setData(e,i,r)}},{key:"lockTextureUpload",value:function(){this._locked=!0}},{key:"unlockTextureUpload",value:function(){this._locked=!1}},{key:"forceTextureUpload",value:function(){this._forceNextUpload=!0}},{key:"requestUpdate",value:function(){var e=Object(o.a)(n.a.mark((function e(t){var i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._pendingAttributeUpdate){e.next=2;break}return e.abrupt("return",void T.error(new O.a("mapview-webgl","Tried to update attribute data with a pending update")));case 2:return i=Object(v.g)(),e.abrupt("return",(R("AttributeStoreView Update Requested",t),this._pendingAttributeUpdate={data:t,resolver:i},i.promise));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){if(this._initialized&&Object(g.i)(this._pendingAttributeUpdate)){for(var e=this._pendingAttributeUpdate,t=e.data,i=e.resolver,r=Object(g.o)(this._data),a=function(e){var i=t.blocks[e],a=r[e];Object(g.a)(a,(function(t){return Object(g.a)(i,(function(i){R("Updating block ".concat(e),i),t.update(i)}))}))},s=0;s<t.blocks.length;s++)a(s);this._pendingAttributeUpdate=null,i()}}},{key:"bindTextures",value:function(e){this.update();var t=this._getDefaultTexture(e);if(!this._initialized)return e.bindTexture(t,D.s),e.bindTexture(t,D.t),e.bindTexture(t,D.u),void e.bindTexture(t,D.v);var i=Object(g.o)(this._data);this._locked&&!this._forceNextUpload||(Object(g.f)(i,(function(t){return t.updateTexture(e)})),this._forceNextUpload=!1),e.bindTexture(Object(g.l)(i[0],t,(function(t){return t.getTexture(e)})),D.s),e.bindTexture(Object(g.l)(i[1],t,(function(t){return t.getTexture(e)})),D.t),e.bindTexture(Object(g.l)(i[2],t,(function(t){return t.getTexture(e)})),D.u),e.bindTexture(Object(g.l)(i[3],t,(function(t){return t.getTexture(e)})),D.v)}},{key:"_getDefaultTexture",value:function(e){if(Object(g.h)(this._defaultTexture)){this._defaultTexture=new k.a(e,{wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array(4))}return this._defaultTexture}}]),e}(),C=i(858),M=i(52),z=i(36),V=i(54),A=i(306),S=i(388);function E(e,t){var i=t.length;if(e<t[0].value||1===i)return t[0].size;for(var r=1;r<i;r++)if(e<t[r].value){var a=(e-t[r-1].value)/(t[r].value-t[r-1].value);return t[r-1].size+a*(t[r].size-t[r-1].size)}return t[i-1].size}function P(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(Object(g.h)(t))return e[i+0]=0,e[i+1]=0,e[i+2]=0,void(e[i+3]=0);var r=t.r,a=t.g,s=t.b,n=t.a;e[i+0]=r*n/255,e[i+1]=a*n/255,e[i+2]=s*n/255,e[i+3]=n}var U=function(){function e(){Object(u.a)(this,e),this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.ddColors=new Float32Array(32),this.ddBackgroundColor=new Float32Array(4),this.ddActiveDots=new Float32Array(8),this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1}}return Object(l.a)(e,[{key:"getSizeVVFieldStops",value:function(e){var t=this._vvSizeFieldStops;switch(t.type){case"static":return t;case"level-dependent":return Object(g.p)(t.levels[e],(function(){var i=1/0,r=0;for(var a in t.levels){var s=parseFloat(a),n=Math.abs(e-s);n<i&&(i=n,r=s)}if(i===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};var o=e-r,u=Math.pow(2,o/2),l=Object(g.o)(t.levels[r]),f=new Float32Array(l.values);return f[2]*=u,f[3]*=u,{sizes:Object(g.o)(l.sizes),values:f}}))}}},{key:"vvMaterialParameters",get:function(){return this._vvMaterialParameters}},{key:"update",value:function(e){Object(g.i)(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}},{key:"setInfo",value:function(e,t,i){var r=this;switch(Object(g.i)(i)&&i.forEach((function(e){return r._updateEffects(e)})),this._vvInfo=t,e.type){case"dot-density":this._updateDotDensityInfo(e)}}},{key:"getVariation",value:function(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,oesTextureFloat:Object(S.a)().supportsTextureFloat}}},{key:"getVariationHash",value:function(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1}},{key:"_updateEffects",value:function(e){Object(g.i)(e)&&e.filter&&e.filter.enabled&&(this.outsideLabelsVisible=e.excludedLabelsVisible)}},{key:"_updateVisualVariables",value:function(e,t){var i=this._vvMaterialParameters;if(i.vvOpacityEnabled=!1,i.vvSizeEnabled=!1,i.vvColorEnabled=!1,i.vvRotationEnabled=!1,e){var r=e.size;if(r){if(i.vvSizeEnabled=!0,r.minMaxValue){var a,s,n=r.minMaxValue;if(Object(w.m)(n.minSize)&&Object(w.m)(n.maxSize))if(Object(w.n)(n.minSize)&&Object(w.n)(n.maxSize))a=Object(z.g)(n.minSize),s=Object(z.g)(n.maxSize);else{var o=t.scale;a=Object(z.g)(E(o,n.minSize.stops)),s=Object(z.g)(E(o,n.maxSize.stops))}this.vvSizeMinMaxValue.set([n.minDataValue,n.maxDataValue,a,s])}if(r.scaleStops&&(this.vvSizeScaleStopsValue=Object(z.g)(E(t.scale,r.scaleStops.stops))),r.unitValue){var u=Object(V.c)(t.spatialReference)/A.a[r.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=u/t.resolution}r.fieldStops&&(this._vvSizeFieldStops=r.fieldStops)}var l=e.color;l&&(i.vvColorEnabled=!0,this.vvColorValues.set(l.values),this.vvColors.set(l.colors));var f=e.opacity;f&&(i.vvOpacityEnabled=!0,this.vvOpacityValues.set(f.values),this.vvOpacities.set(f.opacities));var c=e.rotation;c&&(i.vvRotationEnabled=!0,i.vvRotationType=c.type)}}},{key:"_updateDotDensityInfo",value:function(e){var t=e.attributes;this.ddDotValue=e.dotValue,this.ddDotScale=e.referenceScale,this.ddDotSize=e.dotSize,this.ddDotBlending=e.dotBlendingEnabled,this.ddSeed=e.seed;for(var i=0;i<D.g;i++){var r=i>=t.length?new M.a([0,0,0,0]):t[i].color;P(this.ddColors,r,4*i)}for(var a=0;a<8;a++)this.ddActiveDots[a]=a<e.attributes.length?1:0;P(this.ddBackgroundColor,e.backgroundColor)}}]),e}(),K=function(e){Object(d.a)(i,e);var t=Object(h.a)(i);function i(e){var r;return Object(u.a)(this,i),(r=t.call(this,e))._rendererInfo=new U,r._materialItemsRequestQueue=new p.a,r.attributeView=new I,r}return Object(l.a)(i,[{key:"destroy",value:function(){this.removeAllChildren(),this.children.forEach((function(e){return e.destroy()})),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}},{key:"setRendererInfo",value:function(e,t,i){this._rendererInfo.setInfo(e,t,i),this.requestRender()}},{key:"getMaterialItems",value:function(){var e=Object(o.a)(n.a.mark((function e(t,i){var r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&0!==t.length){e.next=2;break}return e.abrupt("return",null);case 2:return r=Object(v.g)(),e.abrupt("return",(this._materialItemsRequestQueue.push({items:t,abortOptions:i,resolver:r}),this.requestRender(),r.promise));case 4:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"onTileData",value:function(e,t){if(t.addOrUpdate&&"tileDisplayData"in t.addOrUpdate)e.setData(t);else{var i=t.addOrUpdate&&b.a.decode(t.addOrUpdate),r=Object(a.a)(Object(a.a)({},t),{},{addOrUpdate:i});e.setData(r)}this.contains(e)||this.addChild(e),this.requestRender()}},{key:"onTileError",value:function(e){e.clear(),this.contains(e)||this.addChild(e)}},{key:"doRender",value:function(e){if(e.context.capabilities.textureFloat,e.context.capabilities.vao,this._materialItemsRequestQueue.length>0)for(var t=this._materialItemsRequestQueue.pop();t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop();Object(f.a)(Object(c.a)(i.prototype),"doRender",this).call(this,e)}},{key:"renderChildren",value:function(e){var t,a=Object(r.a)(this.children);try{for(a.s();!(t=a.n()).done;){t.value.commitChanges(e)}}catch(s){a.e(s)}finally{a.f()}this._rendererInfo.update(e.state),Object(f.a)(Object(c.a)(i.prototype),"renderChildren",this).call(this,e)}},{key:"createTile",value:function(e){var t=this._tileInfoView.getTileBounds(Object(y.g)(),e);return new m.a(e,t)}},{key:"destroyTile",value:function(e){this.removeChild(e),e.destroy()}},{key:"createRenderParams",value:function(e){return Object(a.a)(Object(a.a)({},Object(f.a)(Object(c.a)(i.prototype),"createRenderParams",this).call(this,e)),{},{rendererInfo:this._rendererInfo,attributeView:this.attributeView})}},{key:"_processMaterialItemRequest",value:function(e,t){var i=this,r=t.items,a=t.abortOptions,s=t.resolver,n=e.painter,o=e.pixelRatio,u=r.map((function(e){return n.textureManager.rasterizeItem(e.symbol,o,e.glyphIds,a)}));Object(v.b)(u).then((function(e){if(i.stage){var t=e.map((function(e,t){return{id:r[t].id,mosaicItem:e}}));s.resolve(t)}else s.reject()}),s.reject)}}]),i}(C.a)}}]);
//# sourceMappingURL=67.d77c6396.chunk.js.map