{"version":3,"sources":["../node_modules/@arcgis/core/renderers/support/heatmapUtils.js","../node_modules/@arcgis/core/views/2d/layers/features/processors/BaseProcessor.js","../node_modules/@arcgis/core/views/2d/layers/features/processors/HeatmapProcessor.js"],"names":["r","t","e","document","createElement","getContext","height","width","clearRect","n","createLinearGradient","colorStops","ratio","color","addColorStop","Math","max","fillStyle","fillRect","getImageData","data","o","h","blurRadius","a","fieldOffset","f","field","c","Float64Array","l","i","s","round","m","Number","NEGATIVE_INFINITY","d","readAttribute","u","g","Set","getCursor","next","getObjectId","has","add","readLegacyPointGeometry","x","y","b","min","matrix","buffer","canvas","set","Uint8ClampedArray","Uint32Array","Uint8Array","length","floor","putImageData","exp","pow","sqrt","PI","this","get","toJSON","readOnly","prototype","constructOnly","dependsOn","p","arguments","type","_tileKeyToFeatureSets","Map","handles","tileStore","on","onTileUpdate","bind","schema","processors","_schema","mesh","removed","delete","key","id","addOrUpdate","instance","end","forEach","push","tileKey","intensityInfo","remoteClient","invoke","transferList","error"],"mappings":"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","file":"static/js/110.54d6c88e.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport t from\"../../core/global.js\";import{clamp as e}from\"../../core/mathUtils.js\";const r=(()=>{if(!(\"document\"in t))return()=>null;const e=document.createElement(\"canvas\"),r=e.getContext(\"2d\");return e.height=512,e.width=1,t=>{r.clearRect(0,0,1,e.height);const n=r.createLinearGradient(0,0,0,e.height);for(const{ratio:e,color:r}of t.colorStops)n.addColorStop(Math.max(e,.001),`rgba(${r[0]}, ${r[1]}, ${r[2]}, ${r[3]})`);return r.fillStyle=n,r.fillRect(0,0,1,e.height),r.getImageData(0,0,1,e.height).data}})();function n(t,e,r,n){const{blurRadius:o,fieldOffset:a,field:f}=e,u=new Float64Array(r*n),l=i(o),s=Math.round(3*o);let h,m=Number.NEGATIVE_INFINITY;const d=c(f,a);for(const{geometry:e,attributes:o}of t){const t=e.x-s,a=e.y-s,f=Math.max(0,t),i=Math.max(0,a),c=Math.min(n,e.y+s),g=Math.min(r,e.x+s),y=+d(o);for(let e=i;e<c;e++){const n=l[e-a];for(let o=f;o<g;o++){const a=l[o-t];h=u[e*r+o]+=n*a*y,h>m&&(m=h)}}}return{matrix:u.buffer,max:m}}function o(t,e,r,n){const{blurRadius:o,fieldOffset:a,field:f}=e,c=new Float64Array(r*n),l=i(o),s=Math.round(3*o);let h,m=Number.NEGATIVE_INFINITY;const d=u(f,a),g=new Set;for(const e of t){const t=e.getCursor();for(;t.next();){const e=t.getObjectId();if(g.has(e))continue;g.add(e);const o=t.readLegacyPointGeometry(),a=+d(t),f=o.x-s,i=o.y-s,u=Math.max(0,f),y=Math.max(0,i),b=Math.min(n,o.y+s),x=Math.min(r,o.x+s);for(let t=y;t<b;t++){const e=l[t-i];for(let n=u;n<x;n++){const o=l[n-f];h=c[t*r+n]+=e*o*a,h>m&&(m=h)}}}}return{matrix:c.buffer,max:m}}function a(t,e,r,n,o,a){t.canvas.width=t.canvas.height=e,t.clearRect(0,0,e,e);const i=t.getImageData(0,0,e,e);r&&n&&i.data.set(new Uint8ClampedArray(f(e,r,n,o,a))),t.putImageData(i,0,0)}function f(t,r,n,o,a){const f=new Uint32Array(t*t),i=\"buffer\"in r?r:new Float64Array(r),c=\"buffer\"in n?new Uint32Array(n.buffer):new Uint32Array(new Uint8Array(n).buffer),u=c.length/(a-o);for(let t=0;t<i.length;t++){const r=i[t],n=Math.floor((r-o)*u);f[t]=c[e(n,0,c.length-1)]}return f.buffer}function i(t){const e=Math.round(3*t),r=2*t*t,n=new Float64Array(2*e+1);for(let o=0;o<=n.length;o++)n[o]=Math.exp(-Math.pow(o-e,2)/r)/Math.sqrt(2*Math.PI)*(t/2);return n}function c(t,e){return\"function\"==typeof t?t:t?\"string\"==typeof e?e=>-1*+e[t]:r=>+r[t]+e:()=>1}function u(t,e){return null!=t?\"string\"==typeof e?e=>-1*+e.readAttribute(t):r=>+r.readAttribute(t)+e:t=>1}export{n as calculateHeatmapIntensityInfo,o as calculateHeatmapIntensityInfoReaders,f as createHeatmapImageData,i as createKernel,c as createValueFunction,u as createValueFunctionCursor,a as drawHeatmap,r as generateGradient};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import\"../../../../../core/has.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../../../core/accessorSupport/decorators/property.js\";import{subclass as t}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import\"../../../../../core/urlUtils.js\";import\"../../../../../core/uuid.js\";import\"../../../../../portal/support/resourceExtension.js\";import{HandleOwner as o}from\"../../../../../core/HandleOwner.js\";let s=class extends o{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get(\"tileStore.tileScheme.spatialReference\");return e&&e.toJSON()||null}};e([r({readOnly:!0})],s.prototype,\"supportsTileUpdates\",null),e([r({constructOnly:!0})],s.prototype,\"remoteClient\",void 0),e([r({constructOnly:!0})],s.prototype,\"service\",void 0),e([r({dependsOn:[\"tileStore.tileScheme.spatialReference\"]})],s.prototype,\"spatialReference\",null),e([r({constructOnly:!0})],s.prototype,\"tileInfo\",void 0),e([r({constructOnly:!0})],s.prototype,\"tileStore\",void 0),s=e([t(\"esri.views.2d.layers.features.processors.BaseProcessor\")],s);var p=s;export default p;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import\"../../../../../core/has.js\";import{isSome as t}from\"../../../../../core/maybe.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/accessorSupport/decorators/property.js\";import{subclass as r}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import\"../../../../../core/urlUtils.js\";import\"../../../../../core/uuid.js\";import\"../../../../../portal/support/resourceExtension.js\";import{diff as s}from\"../../../../../core/accessorSupport/diffUtils.js\";import{calculateHeatmapIntensityInfoReaders as o}from\"../../../../../renderers/support/heatmapUtils.js\";import i from\"./BaseProcessor.js\";let a=class extends i{constructor(){super(...arguments),this.type=\"heatmap\",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on(\"update\",this.onTileUpdate.bind(this))])}async update(e,t){const r=t.schema.processors[0];if(\"heatmap\"!==r.type)return;s(this._schema,r)&&(e.mesh=!0,this._schema=r)}onTileUpdate(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}async onTileData(e,r,s){this._tileKeyToFeatureSets.has(e.key.id)&&\"replace\"!==r.type||this._tileKeyToFeatureSets.set(e.key.id,new Map);const i=this._tileKeyToFeatureSets.get(e.key.id);t(r.addOrUpdate)&&i.set(r.addOrUpdate.instance,r);let a=r.end;if(i.forEach((e=>a=a||e.end)),!a)return;const p=[];i.forEach((e=>{t(e.addOrUpdate)&&p.push(e.addOrUpdate)}));const c=o(p,this._schema.mesh,512,512),n={tileKey:e.key.id,intensityInfo:c},d=[c.matrix];return this.remoteClient.invoke(\"tileRenderer.onTileData\",n,{...s,transferList:d})}onTileError(e,t,r){return this.remoteClient.invoke(\"tileRenderer.onTileError\",{tileKey:e.id,error:t},r)}};a=e([r(\"esri.views.2d.layers.features.processors.HeatmapProcessor\")],a);var p=a;export default p;\n"],"sourceRoot":""}