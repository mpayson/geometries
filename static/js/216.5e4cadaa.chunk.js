(this.webpackJsonpgeometries=this.webpackJsonpgeometries||[]).push([[216],{1193:function(e,t,i){"use strict";i.r(t);var a=i(32),n=i(10),r=i.n(n),u=i(21),l=i(2),s=i(3),c=i(61),h=i(55),o=i(5),f=i(6),d=i(0),p=(i(13),i(14),i(15),i(1)),y=i(8),v=(i(11),i(19),i(20),i(16)),b=i(53),_=i(56),w=i(318),k=i(394),O=i(465),g=i(466),j=i(830),m=i(831),S=i(1113),x=[102113,102100,3857,3785,900913],I=function(e){Object(o.a)(i,e);var t=Object(f.a)(i);function i(){var e;return Object(l.a)(this,i),(e=t.apply(this,arguments))._handles=new _.a,e._tileStrategy=null,e._fetchQueue=null,e._tileRequests=new Map,e.layer=null,e}return Object(s.a)(i,[{key:"tileMatrixSet",get:function(){if(this.layer.activeLayer.tileMatrixSetId)return this.layer.activeLayer.tileMatrixSet;var e=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return e?(this.layer.activeLayer.tileMatrixSetId=e.id,e):null}},{key:"hitTest",value:function(){return null}},{key:"update",value:function(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange("updating")}},{key:"attach",value:function(){var e=this,t=this.layer.activeLayer,a=this.tileMatrixSet;if(a){var n=a.tileInfo.spatialReference,r=t.fullExtent&&t.fullExtent.clone();n.isWebMercator?r=Object(b.b)(r):n.isWGS84||(r=a.fullExtent),this._tileInfoView=new k.a(a.tileInfo,r),this._fetchQueue=new O.a({tileInfoView:this._tileInfoView,process:function(t){return e.fetchTile(t)}}),this._tileStrategy=new g.a({cachePolicy:"keep",acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},tileInfoView:this._tileInfoView}),this._handles.add(this.watch(["layer.activeLayer.styleId","tileMatrixSet"],(function(){return e._refresh()}))),Object(c.a)(Object(h.a)(i.prototype),"attach",this).call(this)}}},{key:"detach",value:function(){Object(c.a)(Object(h.a)(i.prototype),"detach",this).call(this),this._handles.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"doRefresh",value:function(){var e=Object(u.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateRequested||this.suspended||this._refresh();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isUpdating",value:function(){return this._fetchQueue.length>0}},{key:"acquireTile",value:function(e){var t,i,n,r,u=this,l=this._bitmapView.createTile(e),s=l.bitmap;t=this._tileInfoView.getTileCoords([0,0],l.key),i=Object(a.a)(t,2),s.x=i[0],s.y=i[1],s.resolution=this._tileInfoView.getTileResolution(l.key),n=this._tileInfoView.tileInfo.size,r=Object(a.a)(n,2),s.width=r[0],s.height=r[1],this._tileInfoView.getTileCoords(s,l.key);var c={id:e.id,fulfilled:!1,promise:this._fetchQueue.push(l.key).then((function(e){l.bitmap.source=e,l.once("attach",(function(){return u.requestUpdate()})),u._bitmapView.addChild(l)})).catch((function(e){Object(v.n)(e)||(l.bitmap.source=null,l.once("attach",(function(){return u.requestUpdate()})),u._bitmapView.addChild(l))}))};return c.promise.finally((function(){return c.fulfilled=!0})),this._tileRequests.set(l,c),this.requestUpdate(),l}},{key:"releaseTile",value:function(e){var t=this._tileRequests.get(e);t.fulfilled||this._fetchQueue.abort(t.id),this._tileRequests.delete(e),this._bitmapView.removeChild(e),e.once("detach",(function(){return e.destroy()})),this.requestUpdate()}},{key:"fetchTile",value:function(){var e=Object(u.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.layer.fetchTile(t.level,t.row,t.col));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){var e=Object(c.a)(Object(h.a)(i.prototype),"canResume",this).call(this);return e?null!==this.tileMatrixSet:e}},{key:"_refresh",value:function(){var e=this;this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((function(t){if(t.bitmap.source){t.bitmap.source=null;var i={id:t.key.id,fulfilled:!1,promise:e._fetchQueue.push(t.key).then((function(i){t.bitmap.source=i,t.requestRender(),e.notifyChange("updating")}))};i.promise.then((function(){return i.fulfilled=!0}),(function(){return i.fulfilled=!0})),e._tileRequests.set(t,i)}})),this.notifyChange("updating")}},{key:"_getTileMatrixSetBySpatialReference",value:function(e){var t=this.view.spatialReference;if(!e.tileMatrixSets)return null;var i=e.tileMatrixSets.find((function(e){return e.tileInfo.spatialReference.wkid===t.wkid}));return!i&&t.isWebMercator&&(i=e.tileMatrixSets.find((function(e){return x.indexOf(e.tileInfo.spatialReference.wkid)>-1}))),i}}]),i}(Object(w.a)(Object(S.a)(Object(m.a)(j.a))));Object(d.a)([Object(p.b)({dependsOn:["tileMatrixSet"]})],I.prototype,"suspended",void 0),Object(d.a)([Object(p.b)({readOnly:!0,dependsOn:["view.spatialReference","layer.activeLayer"]})],I.prototype,"tileMatrixSet",null);var M=I=Object(d.a)([Object(y.a)("esri.views.2d.layers.WMTSLayerView2D")],I);t.default=M}}]);
//# sourceMappingURL=216.5e4cadaa.chunk.js.map