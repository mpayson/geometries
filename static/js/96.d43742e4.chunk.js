(this.webpackJsonpgeometries=this.webpackJsonpgeometries||[]).push([[96],{1294:function(e,t,r){"use strict";r.r(t);var a=r(9),n=r(10),i=r.n(n),s=r(41),o=r(12),l=r(21),c=r(2),u=r(3),p=r(5),b=r(6),f=r(0),d=(r(13),r(24)),y=r(14),v=(r(15),r(1)),h=r(50),m=r(8),O=r(23),g=r(11),j=(r(19),r(20),r(16)),S=r(85),x=r(36),w=r(104),k=r(81),_=r(820),V=r(276),P=r(312),L=r(174),J=r(44),M=r(61),D=r(380),N=r(244),G=r(360),T=r(943),I=r(28),F=function(e){Object(p.a)(r,e);var t=Object(b.a)(r);function r(){var e;return Object(c.a)(this,r),(e=t.apply(this,arguments)).extent=null,e.height=null,e.href=null,e.opacity=1,e.rotation=0,e.scale=null,e.visible=!0,e.width=null,e}return r}(I.a);Object(f.a)([Object(v.b)({type:M.a})],F.prototype,"extent",void 0),Object(f.a)([Object(v.b)()],F.prototype,"height",void 0),Object(f.a)([Object(v.b)()],F.prototype,"href",void 0),Object(f.a)([Object(v.b)()],F.prototype,"opacity",void 0),Object(f.a)([Object(v.b)()],F.prototype,"rotation",void 0),Object(f.a)([Object(v.b)()],F.prototype,"scale",void 0),Object(f.a)([Object(v.b)()],F.prototype,"visible",void 0),Object(f.a)([Object(v.b)()],F.prototype,"width",void 0);var R=F=Object(f.a)([Object(m.a)("esri.layer.support.MapImage")],F),E=function(e){Object(p.a)(r,e);var t=Object(b.a)(r);function r(e){var a;return Object(c.a)(this,r),(a=t.call(this,e)).itemId=null,a.url=null,a}return r}(I.a);Object(f.a)([Object(v.b)({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],E.prototype,"itemId",void 0),Object(f.a)([Object(v.b)({type:String,json:{write:!0}})],E.prototype,"url",void 0);var C=E=Object(f.a)([Object(m.a)("esri.tasks.support.DataFile")],E),U=new h.a({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"}),z=function(e){Object(p.a)(r,e);var t=Object(b.a)(r);function r(e){var a;return Object(c.a)(this,r),(a=t.call(this,e)).jobId=null,a.jobStatus=null,a.messages=null,a}return r}(I.a);Object(f.a)([Object(v.b)()],z.prototype,"jobId",void 0),Object(f.a)([Object(v.b)({json:{read:U.read}})],z.prototype,"jobStatus",void 0),Object(f.a)([Object(v.b)({type:[T.a]})],z.prototype,"messages",void 0);var A=z=Object(f.a)([Object(m.a)("esri.tasks.support.JobInfo")],z),q=new h.a({esriMeters:"meters",esriFeet:"feet",esriKilometers:"kilometers",esriMiles:"miles",esriNauticalMiles:"nautical-miles",esriYards:"yards"},{ignoreUnknown:!1}),B=function(e){Object(p.a)(r,e);var t=Object(b.a)(r);function r(e){var a;return Object(c.a)(this,r),(a=t.call(this,e)).distance=0,a.units=null,a}return r}(I.a);Object(f.a)([Object(v.b)({json:{write:!0}})],B.prototype,"distance",void 0),Object(f.a)([Object(v.b)({json:{read:q.read,write:q.write}})],B.prototype,"units",void 0);var W=B=Object(f.a)([Object(m.a)("esri/tasks/support/LinearUnit")],B),K=new h.a({GPBoolean:"boolean",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",GPField:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string","GPMultiValue:GPBoolean":"multi-value","GPMultiValue:GPDataFile":"multi-value","GPMultiValue:GPDate":"multi-value","GPMultiValue:GPDouble":"multi-value","GPMultiValue:GPFeatureRecordSetLayer":"multi-value","GPMultiValue:GPField":"multi-value","GPMultiValue:GPLinearUnit":"multi-value","GPMultiValue:GPLong":"multi-value","GPMultiValue:GPRasterData":"multi-value","GPMultiValue:GPRasterDataLayer":"multi-value","GPMultiValue:GPRecordSet":"multi-value","GPMultiValue:GPString":"multi-value"}),Z=function(e){Object(p.a)(r,e);var t=Object(b.a)(r);function r(e){var a;return Object(c.a)(this,r),(a=t.call(this,e)).dataType=null,a.value=null,a}return r}(I.a);Object(f.a)([Object(v.b)({json:{read:K.read,write:K.write}})],Z.prototype,"dataType",void 0),Object(f.a)([Object(v.b)()],Z.prototype,"value",void 0);var $=Z=Object(f.a)([Object(m.a)("esri.tasks.support.ParameterValue")],Z),Q=function(e){Object(p.a)(r,e);var t=Object(b.a)(r);function r(e){var a;return Object(c.a)(this,r),(a=t.call(this,e)).format=null,a.itemId=null,a.url=null,a}return r}(I.a);Object(f.a)([Object(v.b)()],Q.prototype,"format",void 0),Object(f.a)([Object(v.b)({json:{read:{source:"itemID"},write:{target:"itemID"}}})],Q.prototype,"itemId",void 0),Object(f.a)([Object(v.b)()],Q.prototype,"url",void 0);var Y=Q=Object(f.a)([Object(m.a)("esri/tasks/support/RasterData")],Q),H=function(e){Object(p.a)(n,e);var t=Object(b.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e))._timers=new Map,r.outSpatialReference=null,r.processExtent=null,r.processSpatialReference=null,r.returnFeatureCollection=!1,r.returnM=!1,r.returnZ=!1,r}return Object(u.a)(n,[{key:"destroy",value:function(){this._timers.forEach((function(e){clearInterval(e)}))}},{key:"cancelJob",value:function(e,t){var r=this.parsedUrl.path,n=Object(a.a)(Object(a.a)(Object(a.a)({},this.requestOptions),t),{},{query:{f:"json"}});return this._clearTimer(e),Object(k.default)("".concat(r,"/jobs/").concat(e,"/cancel"),n).then((function(e){return A.fromJSON(e.data)}))}},{key:"checkJobStatus",value:function(e,t){var r=this.parsedUrl.path,n=Object(a.a)(Object(a.a)(Object(a.a)({},this.requestOptions),t),{},{query:{f:"json"}});return Object(k.default)("".concat(r,"/jobs/").concat(e),n).then((function(e){return A.fromJSON(e.data)}))}},{key:"execute",value:function(e,t){var r=this;return this._constructRequest("execute",e,t).then((function(e){var t=e.data.results||[],a=e.data.messages||[];return{results:t.map(r._decode),messages:a.map((function(e){return T.a.fromJSON(e)}))}}))}},{key:"getResultData",value:function(e,t,r){var n=this,i=this.returnFeatureCollection,s=this.returnM,o=this.returnZ,l=this.outSpatialReference,c=this.parsedUrl.path,u={returnFeatureCollection:i||void 0,returnM:s||void 0,returnZ:o||void 0,outSR:l,returnType:"data",f:"json"},p=this._gpEncode(u,null),b=Object(a.a)(Object(a.a)(Object(a.a)({},this.requestOptions),r),{},{query:p});return Object(k.default)("".concat(c,"/jobs/").concat(e,"/results/").concat(t),b).then((function(e){return n._decode(e.data)}))}},{key:"getResultImage",value:function(e,t,r,n){var i=this,s=this.parsedUrl.path,o=Object(a.a)(Object(a.a)({},r.toJSON()),{},{f:"json"}),l=this._gpEncode(o),c=Object(a.a)(Object(a.a)(Object(a.a)({},this.requestOptions),n),{},{query:l});return Object(k.default)("".concat(s,"/jobs/").concat(e,"/results/").concat(t),c).then((function(e){return i._decode(e.data)}))}},{key:"getResultMapImageLayer",value:function(){var e=Object(l.a)(i.a.mark((function e(t){var a,n,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.parsedUrl.path,n=a.indexOf("/GPServer/"),s="".concat(a.substring(0,n),"/MapServer/jobs/").concat(t),e.next=4,Promise.all([r.e(3),r.e(5),r.e(4),r.e(6),r.e(63)]).then(r.bind(null,1001));case 4:return e.t0=e.sent.default,e.t1={url:s},e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"submitJob",value:function(e,t){return this._constructRequest("submitJob",e,t).then((function(e){return A.fromJSON(e.data)}))}},{key:"waitForJobCompletion",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.interval,n=void 0===a?1e3:a,i=r.signal,s=r.statusCallback;return Object(j.c)((function(r,a){Object(j.r)(i,(function(){t._clearTimer(e),a(Object(j.e)())})),t._clearTimer(e);var o=setInterval((function(){t._timers.has(e)||a(Object(j.e)()),t._getJobStatus(e,t.requestOptions).then((function(n){var i=n.jobStatus;switch(i){case"job-succeeded":t._clearTimer(e),r(n);break;case"job-submitted":case"job-executing":case"job-waiting":case"job-new":s&&s(n);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-timed-out":case"job-failed":t._clearTimer(e),a(n);break;default:Object(L.a)(i)}}))}),n);t._timers.set(e,o)}))}},{key:"_clearTimer",value:function(e){this._timers.has(e)&&(clearInterval(this._timers.get(e)),this._timers.delete(e))}},{key:"_constructRequest",value:function(e,t,r){var n=this,i={},s={},o=[];return this._collectGeometries(t,o,i),Object(D.a)(o).then((function(o){var l=n.outSpatialReference,c=n.parsedUrl,u=n.processExtent,p=n.processSpatialReference,b=n.returnFeatureCollection,f=n.returnM,d=n.returnZ,y=c.path;for(var v in i){var h=i[v];s[v]=o.slice(h[0],h[1])}var m=l?l.wkid||l:null,O=p?p.wkid||p:null,g="execute"===e?{returnFeatureCollection:b||void 0,returnM:f||void 0,returnZ:d||void 0}:null,j=Object(a.a)(Object(a.a)(Object(a.a)(Object(a.a)({},u?{context:{extent:u,outSR:m,processSR:O}}:{"env:outSR":m,"env:processSR":O}),t),g),{},{f:"json"}),S=n._gpEncode(j,null,s),x=Object(a.a)(Object(a.a)(Object(a.a)({},n.requestOptions),r),{},{query:S});return Object(k.default)("".concat(y,"/").concat(e),x)}))}},{key:"_collectGeometries",value:function(e,t,r){for(var a in e){var n=e[a];if(n&&"object"==typeof n&&n instanceof G.default){var i=n.features;r[a]=[t.length,t.length+i.length],i.forEach((function(e){t.push(e.geometry)}))}}}},{key:"_decode",value:function(e){var t=e.dataType,r=$.fromJSON(e);switch(t){case"GPBoolean":case"GPDouble":case"GPLong":case"GPString":return r;case"GPDate":r.value=new Date(r.value);break;case"GPDataFile":r.value=C.fromJSON(r.value);break;case"GPLinearUnit":r.value=W.fromJSON(r.value);break;case"GPFeatureRecordSetLayer":case"GPRecordSet":var a=e.value.url;r.value=a?C.fromJSON(r.value):G.default.fromJSON(r.value);break;case"GPRasterData":case"GPRasterDataLayer":var n=e.value.mapImage;r.value=n?R.fromJSON(n):Y.fromJSON(r.value);break;case"GPField":r.value=N.a.fromJSON(r.value);break;case"GPMultiValue:GPBoolean":case"GPMultiValue:GPDouble":case"GPMultiValue:GPLong":case"GPMultiValue:GPString":return r;case"GPMultiValue:GPDate":var i=r.value;r.value=i.map((function(e){return new Date(e)}));break;case"GPMultiValue:GPDataFile":r.value=r.value.map((function(e){return C.fromJSON(e)}));break;case"GPMultiValue:GPLinearUnit":r.value=r.value.map((function(e){return W.fromJSON(e)}));break;case"GPMultiValue:GPFeatureRecordSetLayer":case"GPMultiValue:GPRecordSet":r.value=r.value.map((function(e){return G.default.fromJSON(e)}));break;case"GPMultiValue:GPRasterData":case"GPMultiValue:GPRasterDataLayer":r.value=r.value.map((function(e){return e?R.fromJSON(e):Y.fromJSON(r.value)}));break;case"GPMultiValue:GPField":r.value=r.value.map((function(e){return N.a.fromJSON(e)}))}return r}},{key:"_gpEncode",value:function(e,t,r){var a=this;for(var n in e){var i=e[n];Array.isArray(i)?e[n]=JSON.stringify(i.map((function(e){return a._gpEncode({item:e},!0).item}),this)):i instanceof Date&&(e[n]=i.getTime())}return this._encode(e,t,r)}},{key:"_getJobStatus",value:function(e,t){var r=this.parsedUrl.path,n="".concat(r,"/jobs/").concat(e),i=Object(a.a)(Object(a.a)(Object(a.a)({},this.requestOptions),t),{},{query:{f:"json"}});return Object(k.default)(n,i).then((function(e){return A.fromJSON(e.data)}))}}]),n}(P.a);Object(f.a)([Object(v.b)({type:J.a})],H.prototype,"outSpatialReference",void 0),Object(f.a)([Object(v.b)({type:M.a})],H.prototype,"processExtent",void 0),Object(f.a)([Object(v.b)({type:J.a})],H.prototype,"processSpatialReference",void 0),Object(f.a)([Object(v.b)({nonNullable:!0})],H.prototype,"returnFeatureCollection",void 0),Object(f.a)([Object(v.b)({nonNullable:!0})],H.prototype,"returnM",void 0),Object(f.a)([Object(v.b)({nonNullable:!0})],H.prototype,"returnZ",void 0);var X=H=Object(f.a)([Object(m.a)("esri/tasks/Geoprocessor")],H),ee=new h.a({PDF:"pdf",PNG32:"png32",PNG8:"png8",JPG:"jpg",GIF:"gif",EPS:"eps",SVG:"svg",SVGZ:"svgz"}),te=(ee.fromJSON.bind(ee),ee.toJSON.bind(ee)),re=new h.a({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),ae=(re.fromJSON.bind(re),re.toJSON.bind(re));function ne(e,t){var r=t.graphic,a=t.renderer,n=t.symbol,i=n.type;if("text"!==i&&"shield-label-symbol"!==i&&"visualVariables"in a&&a.visualVariables){var s=a.getVisualVariablesForType("size"),o=a.getVisualVariablesForType("color"),l=a.getVisualVariablesForType("opacity"),c=a.getVisualVariablesForType("rotation"),u=s&&s[0],p=o&&o[0],b=l&&l[0],f=c&&c[0];if(u){var d="simple-marker"===i?n.style:null,y=Object(_.e)(u,r,{shape:d});null!=y&&("simple-marker"===i?e.size=Object(x.h)(y):"picture-marker"===i?(e.width=Object(x.h)(y),e.height=Object(x.h)(y)):"simple-line"===i?e.width=Object(x.h)(y):e.outline&&(e.outline.width=Object(x.h)(y)))}if(p){var v=Object(_.b)(p,r);(v&&"simple-marker"===i||"simple-line"===i||"simple-fill"===i)&&(e.color=v?v.toJSON():void 0)}if(b){var h=Object(_.c)(b,r);null!=h&&e.color&&(e.color[3]=Math.round(255*h))}f&&(e.angle=-Object(_.d)(a,r))}}function ie(e){var t,r,a,n,i,s,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,l=e.canvas.width,c=e.canvas.height,u=e.getImageData(0,0,l,c).data;e:for(r=c;r--;)for(t=l;t--;)if(u[4*(l*r+t)+3]>o){s=r;break e}if(!s)return null;e:for(t=l;t--;)for(r=s+1;r--;)if(u[4*(l*r+t)+3]>o){i=t;break e}e:for(t=0;t<=i;++t)for(r=s+1;r--;)if(u[4*(l*r+t)+3]>o){a=t;break e}e:for(r=0;r<=s;++r)for(t=a;t<=i;++t)if(u[4*(l*r+t)+3]>o){n=r;break e}return{x:a,y:n,width:i-a,height:s-n}}function se(e,t){var r=e.allLayerViews.items;if(t===e.scale)return r.filter((function(e){return!e.suspended}));var a,n=new Array,i=Object(o.a)(r);try{for(i.s();!(a=i.n()).done;){var s=a.value;fe(s.parent)&&!n.includes(s.parent)||!s.visible||t&&"isVisibleAtScale"in s&&!s.isVisibleAtScale(t)||n.push(s)}}catch(l){i.e(l)}finally{i.f()}return n}function oe(e){return e&&"bing-maps"===e.type}function le(e){return e&&"csv"===e.type}function ce(e){return e&&"feature"===e.type}function ue(e){return e&&"geojson"===e.type}function pe(e){return e&&"graphics"===e.type}function be(e){return e&&"group"===e.type}function fe(e){return e&&"esri.views.2d.layers.GroupLayerView2D"===e.declaredClass}function de(e){return e&&"imagery"===e.type}function ye(e){return e&&"kml"===e.type}function ve(e){return e&&"map-image"===e.type}function he(e){return e&&"map-notes"===e.type}function me(e){return e&&"open-street-map"===e.type}function Oe(e){return e&&"stream"===e.type}function ge(e){return e&&"tile"===e.type}function je(e){return e&&"vector-tile"===e.type}function Se(e){return e&&"web-tile"===e.type}function xe(e){return e&&"wms"===e.type}function we(e){return e&&"wmts"===e.type}var ke=r(327),_e=r(33),Ve=y.a.getLogger("esri.tasks.support.PrintTemplate");function Pe(){Object(ke.b)(Ve,"preserveScale",{replacement:"scalePreserved",version:"4.16"})}var Le=function(e){Object(p.a)(r,e);var t=Object(b.a)(r);function r(e){var a;return Object(c.a)(this,r),(a=t.call(this,e)).attributionVisible=!0,a.exportOptions={width:800,height:1100,dpi:96},a.forceFeatureAttributes=!1,a.format="png32",a.label=null,a.layout="map-only",a.layoutOptions=null,a.outScale=0,a.scalePreserved=!0,a.showLabels=!0,a}return Object(u.a)(r,[{key:"preserveScale",get:function(){return Pe(),this.scalePreserved},set:function(e){Pe(),this.scalePreserved=e}}]),r}(_e.a);Object(f.a)([Object(v.b)()],Le.prototype,"attributionVisible",void 0),Object(f.a)([Object(v.b)()],Le.prototype,"exportOptions",void 0),Object(f.a)([Object(v.b)()],Le.prototype,"forceFeatureAttributes",void 0),Object(f.a)([Object(v.b)()],Le.prototype,"format",void 0),Object(f.a)([Object(v.b)()],Le.prototype,"label",void 0),Object(f.a)([Object(v.b)()],Le.prototype,"layout",void 0),Object(f.a)([Object(v.b)()],Le.prototype,"layoutOptions",void 0),Object(f.a)([Object(v.b)()],Le.prototype,"outScale",void 0),Object(f.a)([Object(v.b)({dependsOn:["scalePreserved"]})],Le.prototype,"preserveScale",null),Object(f.a)([Object(v.b)()],Le.prototype,"scalePreserved",void 0),Object(f.a)([Object(v.b)()],Le.prototype,"showLabels",void 0);var Je=Le=Object(f.a)([Object(m.a)("esri.tasks.support.PrintTemplate")],Le),Me={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},De=new h.a({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),Ne=new h.a({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),Ge=new V.a({returnGeometry:!0});function Te(e){return e&&(e.path||"image/svg+xml"===e.contentType||e.url&&e.url.endsWith(".svg"))}var Ie=function(e){Object(p.a)(r,e);var t=Object(b.a)(r);function r(){var e;Object(c.a)(this,r);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n)))._ssExtent=null,e._legendLayers=[],e._legendLayerNameMap={},e._gpServerUrl=null,e._cimVersion=null,e._is11xService=!1,e._gpMetadata=null,e.updateDelay=1e3,e}return Object(u.a)(r,[{key:"_geoprocessor",get:function(){return new X({url:this.url})}},{key:"mode",get:function(){return this._gpMetadata&&this._gpMetadata.executionType?Ne.fromJSON(this._gpMetadata.executionType):"sync"}},{key:"execute",value:function(e,t){var r=this,a=this.url,n=a.lastIndexOf("/GPServer/");return n>0&&(a=a.slice(0,n+9)),Object(j.u)().then((function(){return r._gpServerUrl===a?{data:r._gpMetadata}:(r._gpServerUrl=a,Object(k.default)(a,{query:{f:"json"}}))})).then((function(t){return r._gpMetadata=t.data,r._cimVersion=r._gpMetadata.cimVersion,r._is11xService=!!r._cimVersion,r._getGpPrintParams(e)})).then((function(e){var a=function(e){return"sync"===r.mode?e.results&&e.results[0]&&e.results[0].value:r._geoprocessor.getResultData(e.jobId,"Output_File",t).then((function(e){return e.value}))};return"async"===r.mode?r._geoprocessor.submitJob(e,t).then((function(e){return r._geoprocessor.waitForJobCompletion(e.jobId,{interval:r.updateDelay}).then(a)})):r._geoprocessor.execute(e,t).then(a)}))}},{key:"_createOperationalLayers",value:function(){var e=Object(l.a)(i.a.mark((function e(t,r){var a,n,l,c,u,p,b,f,d,y;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],n={layerView:null,printTemplate:r,view:t},l=0,r.scalePreserved&&(l=r.outScale||t.scale),c=se(t,l),u=Object(o.a)(c),e.prev=5,u.s();case 7:if((p=u.n()).done){e.next=116;break}if(b=p.value,(f=b.layer).loaded&&!be(f)){e.next=12;break}return e.abrupt("continue",114);case 12:if(d=void 0,n.layerView=b,!oe(f)){e.next=18;break}e.t0=this._createBingMapsLayerJSON(f),e.next=112;break;case 18:if(!le(f)){e.next=24;break}return e.next=21,this._createCSVLayerJSON(f,n);case 21:e.t1=e.sent,e.next=111;break;case 24:if(!ce(f)){e.next=30;break}return e.next=27,this._createFeatureLayerJSON(f,n);case 27:e.t2=e.sent,e.next=110;break;case 30:if(!ue(f)){e.next=36;break}return e.next=33,this._createGeoJSONLayer(f,n);case 33:e.t3=e.sent,e.next=109;break;case 36:if(!pe(f)){e.next=42;break}return e.next=39,this._createGraphicsLayerJSON(f,n);case 39:e.t4=e.sent,e.next=108;break;case 42:if(!de(f)){e.next=46;break}e.t5=this._createImageryLayerJSON(f),e.next=107;break;case 46:if(!ye(f)){e.next=52;break}return e.next=49,this._createKMLLayerJSON(f,n);case 49:e.t6=e.sent,e.next=106;break;case 52:if(!ve(f)){e.next=56;break}e.t7=this._createMapImageLayerJSON(f,n),e.next=105;break;case 56:if(!he(f)){e.next=62;break}return e.next=59,this._createMapNotesLayerJSON(n);case 59:e.t8=e.sent,e.next=104;break;case 62:if(!me(f)){e.next=66;break}e.t9=this._createOpenStreetMapLayerJSON(),e.next=103;break;case 66:if(!Oe(f)){e.next=72;break}return e.next=69,this._createStreamLayerJSON(f,n);case 69:e.t10=e.sent,e.next=102;break;case 72:if(!ge(f)){e.next=76;break}e.t11=this._createTileLayerJSON(f),e.next=101;break;case 76:if(!je(f)){e.next=82;break}return e.next=79,this._createVectorTileLayerJSON(f,n);case 79:e.t12=e.sent,e.next=100;break;case 82:if(!Se(f)){e.next=86;break}e.t13=this._createWebTileLayerJSON(f),e.next=99;break;case 86:if(!xe(f)){e.next=90;break}e.t14=this._createWMSLayerJSON(f),e.next=98;break;case 90:if(!we(f)){e.next=94;break}e.t15=this._createWMTSLayerJSON(f),e.next=97;break;case 94:return e.next=96,this._createScreenshotJSON(f,n);case 96:e.t15=e.sent;case 97:e.t14=e.t15;case 98:e.t13=e.t14;case 99:e.t12=e.t13;case 100:e.t11=e.t12;case 101:e.t10=e.t11;case 102:e.t9=e.t10;case 103:e.t8=e.t9;case 104:e.t7=e.t8;case 105:e.t6=e.t7;case 106:e.t5=e.t6;case 107:e.t4=e.t5;case 108:e.t3=e.t4;case 109:e.t2=e.t3;case 110:e.t1=e.t2;case 111:e.t0=e.t1;case 112:(d=e.t0)&&(Array.isArray(d)?a.push.apply(a,Object(s.a)(d)):(d.id=f.id,d.title=this._legendLayerNameMap[f.id]||f.title,d.opacity=f.opacity,d.minScale=f.minScale||0,d.maxScale=f.maxScale||0,a.push(d)));case 114:e.next=7;break;case 116:e.next=121;break;case 118:e.prev=118,e.t16=e.catch(5),u.e(e.t16);case 121:return e.prev=121,u.f(),e.finish(121);case 124:if(l&&a.forEach((function(e){e.minScale=0,e.maxScale=0})),!t.graphics||!t.graphics.length){e.next=129;break}return e.next=127,this._createFeatureCollectionJSON(null,t.graphics,r);case 127:(y=e.sent)&&a.push(y);case 129:return e.abrupt("return",a);case 130:case"end":return e.stop()}}),e,this,[[5,118,121,124]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createBingMapsLayerJSON",value:function(e){return{culture:e.culture,key:e.key,type:"BingMaps"+("aerial"===e.style?"Aerial":"hybrid"===e.style?"Hybrid":"Road")}}},{key:"_createCSVLayerJSON",value:function(){var e=Object(l.a)(i.a.mark((function e(t,r){var a,n,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.layerView,n=r.printTemplate,this._legendLayers&&this._legendLayers.push({id:t.id}),this._is11xService){e.next=6;break}return e.next=4,this._getGraphics(a);case 4:return o=e.sent,e.abrupt("return",this._createFeatureCollectionJSON(t,o,n));case 6:return e.abrupt("return",(s={type:"CSV"},t.write(s,{origin:"web-map"}),delete s.popupInfo,delete s.layerType,s.showLabels=n.showLabels&&t.labelsVisible,s));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createFeatureCollectionJSON",value:function(){var e=Object(l.a)(i.a.mark((function e(t,r,a){var n,s,l,c,u,p,b,f,d,y,v,h,m,O,g,j,x,w,k,_,V,P,L,J,M,D,N;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s={layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}},l={layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}},c={layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}},u={layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}},(p={layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}).layerDefinition.name="textLayer",delete p.layerDefinition.drawingInfo,t&&("esri.layers.FeatureLayer"===t.declaredClass||"esri.layers.StreamLayer"===t.declaredClass?s.layerDefinition.name=l.layerDefinition.name=c.layerDefinition.name=u.layerDefinition.name=this._legendLayerNameMap[t.id]||t.get("arcgisProps.title")||t.title:"esri.layers.GraphicsLayer"===t.declaredClass&&(r=t.graphics.items),t.renderer&&(b=t.renderer.toJSON(),s.layerDefinition.drawingInfo.renderer=b,l.layerDefinition.drawingInfo.renderer=b,c.layerDefinition.drawingInfo.renderer=b,u.layerDefinition.drawingInfo.renderer=b),a.showLabels&&t.labelsVisible&&"function"==typeof t.write&&(y=null==(f=t.write({},{origin:"web-map"}).layerDefinition)||null==(d=f.drawingInfo)?void 0:d.labelingInfo)&&(n=!0,s.layerDefinition.drawingInfo.labelingInfo=y,l.layerDefinition.drawingInfo.labelingInfo=y,c.layerDefinition.drawingInfo.labelingInfo=y,u.layerDefinition.drawingInfo.labelingInfo=y)),null!=t&&t.renderer||n||(delete s.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo,delete c.layerDefinition.drawingInfo,delete u.layerDefinition.drawingInfo),h=t&&t.fields,m=t&&t.renderer,!h||!m||"function"!=typeof m.collectRequiredFields){e.next=9;break}return O=new Set,e.next=8,m.collectRequiredFields(O,h);case 8:v=Array.from(O);case 9:h&&(g=h.map((function(e){return e.toJSON()})),s.layerDefinition.fields=g,l.layerDefinition.fields=g,c.layerDefinition.fields=g,u.layerDefinition.fields=g),j=r&&r.length,w=0;case 12:if(!(w<j)){e.next=44;break}if(!1!==(k=r[w]||r.getItemAt(w)).visible&&k.geometry){e.next=16;break}return e.abrupt("continue",41);case 16:if((x=k.toJSON()).hasOwnProperty("popupTemplate")&&delete x.popupTemplate,x.geometry&&x.geometry.z&&delete x.geometry.z,!x.symbol||!x.symbol.outline||"esriCLS"!==x.symbol.outline.type||this._is11xService){e.next=18;break}return e.abrupt("continue",41);case 18:if(!this._is11xService&&x.symbol&&x.symbol.outline&&x.symbol.outline.color&&x.symbol.outline.color[3]&&(x.symbol.outline.color[3]=255),_=t&&t.renderer&&("valueExpression"in t.renderer&&t.renderer.valueExpression||"hasVisualVariables"in t.renderer&&t.renderer.hasVisualVariables()),x.symbol||!t||!t.renderer||!_||this._is11xService){e.next=28;break}return V=t.renderer,e.next=24,V.getSymbolAsync(k);case 24:if(P=e.sent){e.next=27;break}return e.abrupt("continue",41);case 27:x.symbol=P.toJSON(),"hasVisualVariables"in V&&V.hasVisualVariables()&&ne(x.symbol,{renderer:V,graphic:k,symbol:P});case 28:if(e.t0=x.symbol,!e.t0){e.next=38;break}if(x.symbol.angle||delete x.symbol.angle,!Te(x.symbol)){e.next=37;break}return e.next=34,this._convertSvgToPictureMarkerSymbolJson(x.symbol);case 34:x.symbol=e.sent,e.next=38;break;case 37:x.symbol.text&&delete x.attributes;case 38:if(a&&a.forceFeatureAttributes||!v||!v.length){e.next=40;break}!function(){var e={};v.forEach((function(t){x.attributes&&x.attributes.hasOwnProperty(t)&&(e[t]=x.attributes[t])})),x.attributes=e}();case 40:"polygon"===k.geometry.type?s.featureSet.features.push(x):"polyline"===k.geometry.type?l.featureSet.features.push(x):"point"===k.geometry.type?x.symbol&&x.symbol.text?p.featureSet.features.push(x):c.featureSet.features.push(x):"multipoint"===k.geometry.type?u.featureSet.features.push(x):"extent"===k.geometry.type&&(x.geometry=S.a.fromExtent(k.geometry).toJSON(),s.featureSet.features.push(x));case 41:w++,e.next=12;break;case 44:L=[s,l,u,c,p].filter((function(e){return e.featureSet.features.length>0})),J=Object(o.a)(L),e.prev=46,J.s();case 48:if((M=J.n()).done){e.next=59;break}if(D=M.value,!(N=D.featureSet.features.every((function(e){return e.symbol})))||a&&a.forceFeatureAttributes||D.featureSet.features.forEach((function(e){delete e.attributes})),N&&delete D.layerDefinition.drawingInfo,e.t1=D.layerDefinition.drawingInfo&&D.layerDefinition.drawingInfo.renderer,!e.t1){e.next=57;break}return e.next=57,this._convertSvgRenderer(D.layerDefinition.drawingInfo.renderer);case 57:e.next=48;break;case 59:e.next=64;break;case 61:e.prev=61,e.t2=e.catch(46),J.e(e.t2);case 64:return e.prev=64,J.f(),e.finish(64);case 67:return e.abrupt("return",L.length?{featureCollection:{layers:L},showLabels:n}:null);case 68:case"end":return e.stop()}}),e,this,[[46,61,64,67]])})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_createFeatureLayerJSON",value:function(){var e=Object(l.a)(i.a.mark((function e(t,r){var a,n,s,o,l,c,u,p,b,f,d,y,v,h,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._legendLayers&&this._legendLayers.push({id:t.id}),o=t.renderer,!(t.featureReduction||o&&"dot-density"===o.type&&(!this._is11xService||parseFloat(this._cimVersion)<2.6))){e.next=4;break}return e.abrupt("return",this._createScreenshotJSON(t,r));case 4:if(l=r.layerView,c=r.printTemplate,u=r.view,p=o&&("valueExpression"in o&&o.valueExpression||"hasVisualVariables"in o&&o.hasVisualVariables()),b="feature-layer"!==(null==(a=t.source)?void 0:a.type)&&"ogc-feature"!==(null==(n=t.source)?void 0:n.type),!(!this._is11xService&&p||t.featureReduction||b)&&o&&(!("field"in o)||null==o.field||"string"==typeof o.field&&t.getField(o.field))){e.next=14;break}return e.next=8,this._getGraphics(l);case 8:return f=e.sent,e.next=11,this._createFeatureCollectionJSON(t,f,c);case 11:s=e.sent,e.next=27;break;case 14:if((s={id:(m=t.write()).id,title:m.title,opacity:m.opacity,minScale:m.minScale,maxScale:m.maxScale,url:m.url,layerDefinition:m.layerDefinition}).showLabels=c.showLabels&&t.labelsVisible,this._setURLandToken(s,t),e.t0=null!=(d=s.layerDefinition)&&null!=(y=d.drawingInfo)&&y.renderer,!e.t0){e.next=24;break}return delete s.layerDefinition.minScale,delete s.layerDefinition.maxScale,e.next=23,this._convertSvgRenderer(s.layerDefinition.drawingInfo.renderer);case 23:e.t0="visualVariables"in o&&o.visualVariables&&o.visualVariables[0];case 24:if(!e.t0){e.next=27;break}"size"===(v=o.visualVariables[0]).type&&v.maxSize&&"number"!=typeof v.maxSize&&v.minSize&&"number"!=typeof v.minSize&&(h=Object(_.f)(v,u.scale),s.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=h.minSize,s.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=h.maxSize);case 27:return e.abrupt("return",s);case 28:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createGeoJSONLayer",value:function(){var e=Object(l.a)(i.a.mark((function e(t,r){var a,n,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.layerView,n=r.printTemplate,this._legendLayers&&this._legendLayers.push({id:t.id}),e.next=4,this._getGraphics(a);case 4:return s=e.sent,e.abrupt("return",this._createFeatureCollectionJSON(t,s,n));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createGraphicsLayerJSON",value:function(){var e=Object(l.a)(i.a.mark((function e(t,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.printTemplate,e.abrupt("return",this._createFeatureCollectionJSON(t,null,a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createImageryLayerJSON",value:function(e){this._legendLayers&&this._legendLayers.push({id:e.id});var t={bandIds:e.bandIds,compressionQuality:e.compressionQuality,format:e.format,interpolation:e.interpolation};if((e.mosaicRule||e.definitionExpression)&&(t.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.renderingRule||e.renderer)if(this._is11xService)e.renderingRule&&(t.renderingRule=e.renderingRule.toJSON()),e.renderer&&(t.layerDefinition=t.layerDefinition||{},t.layerDefinition.drawingInfo=t.layerDefinition.drawingInfo||{},t.layerDefinition.drawingInfo.renderer=e.renderer.toJSON());else{var r=e.exportImageServiceParameters.combineRendererWithRenderingRule();r&&(t.renderingRule=r.toJSON())}return this._setURLandToken(t,e),t}},{key:"_createKMLLayerJSON",value:function(){var e=Object(l.a)(i.a.mark((function e(t,r){var n,o,l,c,u,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.printTemplate,!this._is11xService){e.next=4;break}return o={type:"kml"},e.abrupt("return",(t.write(o,{origin:"web-map"}),delete o.layerType,o.url=Object(g.B)(t.url),o));case 4:return l=[],(c=r.layerView).allVisibleMapImages.forEach((function(e,r){var a={id:"".concat(t.id,"_image").concat(r),type:"image",title:t.id,minScale:t.minScale||0,maxScale:t.maxScale||0,opacity:t.opacity,extent:e.extent};"data:image/png;base64,"===e.href.substr(0,22)?a.imageData=e.href.substr(22):a.url=e.href,l.push(a)})),u=[].concat(Object(s.a)(c.allVisiblePoints.items),Object(s.a)(c.allVisiblePolylines.items),Object(s.a)(c.allVisiblePolygons.items)),e.t0=a.a,e.t1={id:t.id},e.next=11,this._createFeatureCollectionJSON(null,u,n);case 11:return e.t2=e.sent,p=(0,e.t0)(e.t1,e.t2),e.abrupt("return",(l.push(p),l));case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createMapImageLayerJSON",value:function(e,t){var r,a=t.view,n={id:e.id,subLayerIds:[]},i=[],s=a.scale;return e.sublayers&&e.sublayers.forEach((function e(t){var r=0===s,a=0===t.minScale||s<=t.minScale,o=0===t.maxScale||s>=t.maxScale;if(t.visible&&(r||a&&o))if(t.sublayers)t.sublayers.forEach(e);else{var l=t.toExportImageJSON(),c={id:t.id,name:t.title,layerDefinition:{drawingInfo:l.drawingInfo,definitionExpression:l.definitionExpression,source:l.source}};i.unshift(c),n.subLayerIds.push(t.id)}})),i.length&&(r={layers:i=i.map((function(e){return{id:e.id,name:e.name,layerDefinition:e.layerDefinition}})),visibleLayers:n.subLayerIds},this._setURLandToken(r,e),this._legendLayers.push(n)),r}},{key:"_createMapNotesLayerJSON",value:function(){var e=Object(l.a)(i.a.mark((function e(t){var r,a,n,l,c,u,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.layerView,a=t.printTemplate,n=[],l=Object(o.a)(r.graphicsViews()),e.prev=3,l.s();case 5:if((c=l.n()).done){e.next=13;break}return u=c.value,e.next=9,this._createFeatureCollectionJSON(u,u.graphics,a);case 9:(p=e.sent)&&n.push.apply(n,Object(s.a)(p.featureCollection.layers));case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),l.e(e.t0);case 18:return e.prev=18,l.f(),e.finish(18);case 21:return e.abrupt("return",{featureCollection:{layers:n}});case 22:case"end":return e.stop()}}),e,this,[[3,15,18,21]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_createOpenStreetMapLayerJSON",value:function(){return{type:"OpenStreetMap"}}},{key:"_createScreenshotJSON",value:function(){var e=Object(l.a)(i.a.mark((function e(t,r){var a,n,s,o,l,c,u,p,b,f,d,y;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.printTemplate,n=r.view,s={type:"image"},o={format:"png",ignoreBackground:!0,layers:[t],rotation:0},l=this._ssExtent||n.extent.clone(),c=96,u=!0,p=!0,a.exportOptions&&((b=a.exportOptions).dpi>0&&(c=b.dpi),b.width>0&&(u=b.width%2==n.width%2),b.height>0&&(p=b.height%2==n.height%2)),"map-only"!==a.layout||!a.scalePreserved||a.outScale&&a.outScale!==n.scale||96!==c||u&&p||(o.area={x:0,y:0,width:n.width,height:n.height},u||(o.area.width-=1),p||(o.area.height-=1),this._ssExtent)||(f=n.toMap(Object(x.e)(o.area.width,o.area.height)),l.ymin=f.y,l.xmax=f.x,this._ssExtent=l),s.extent=l.clone()._normalize(!0).toJSON(),e.next=8,n.takeScreenshot(o);case 8:return d=e.sent,y=Object(g.i)(d.dataUrl),e.abrupt("return",(s.imageData=y.data,s));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createStreamLayerJSON",value:function(){var e=Object(l.a)(i.a.mark((function e(t,r){var a,n,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.layerView,n=r.printTemplate,this._legendLayers&&this._legendLayers.push({id:t.id}),e.next=4,this._getGraphics(a);case 4:return s=e.sent,e.abrupt("return",this._createFeatureCollectionJSON(t,s,n));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createTileLayerJSON",value:function(e){var t={customParameters:e.customParameters};return this._setURLandToken(t,e),t}},{key:"_createVectorTileLayerJSON",value:function(){var e=Object(l.a)(i.a.mark((function e(t,r){var a,n,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._is11xService&&t.serviceUrl&&t.styleUrl)){e.next=5;break}if(a=w.b&&w.b.findCredential(t.styleUrl),n=w.b&&w.b.findCredential(t.serviceUrl),(a||n)&&"2.1.0"===this._cimVersion){e.next=5;break}return s={type:"VectorTileLayer"},e.abrupt("return",(s.styleUrl=Object(g.B)(t.styleUrl),a&&(s.token=a.token),n&&n.token!==s.token&&(s.additionalTokens=[{url:t.serviceUrl,token:n.token}]),s));case 5:return e.abrupt("return",this._createScreenshotJSON(t,r));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createWebTileLayerJSON",value:function(e){var t={type:"WebTiledLayer",urlTemplate:e.urlTemplate.replace(/\${/g,"{"),credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(t.subDomains=e.subDomains),t}},{key:"_createWMSLayerJSON",value:function(e){var t,r=[];return e.sublayers&&e.sublayers.forEach((function e(t){t.visible&&(t.sublayers?t.sublayers.forEach(e):t.name&&r.unshift(t.name))})),r.length&&(t={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:r,url:Object(g.B)(e.url),version:e.version}),t}},{key:"_createWMTSLayerJSON",value:function(e){var t=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:Object(g.B)(e.url)}}},{key:"_setURLandToken",value:function(e,t){var r;if(t.url){e.url=Object(g.B)(e.url||t.url);var a=null==(r=w.b)?void 0:r.findCredential(t.url);a&&(e.token=a.token)}}},{key:"_convertSvgToPictureMarkerSymbolJson",value:function(){var e=Object(l.a)(i.a.mark((function e(t){var r,a,n,s,o,l,c,u,p,b,f,d,y,v,h;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._canvas||(this._canvas=document.createElement("canvas")),r=1024,this._canvas.width=r,this._canvas.height=r,a=this._canvas.getContext("2d"),!t.path){e.next=20;break}if((l=new Path2D(t.path)).closePath(),a.fillStyle=Array.isArray(t.color)?"rgba(".concat(t.color[0],",").concat(t.color[1],",").concat(t.color[2],",").concat(t.color[3]/255,")"):"rgb(0,0,0)",a.fill(l),c=ie(a)){e.next=10;break}return e.abrupt("return",null);case 10:a.clearRect(0,0,r,r),u=Object(x.g)(t.size)/Math.max(c.width,c.height),a.scale(u,u),b=(p=r/u)/2-c.width/2-c.x,f=p/2-c.height/2-c.y,a.translate(b,f),Array.isArray(t.color)&&a.fill(l),null!=(o=t.outline)&&o.width&&Array.isArray(t.outline.color)&&(d=t.outline,a.lineWidth=Object(x.g)(d.width)/u,a.lineJoin="round",a.strokeStyle="rgba(".concat(d.color[0],",").concat(d.color[1],",").concat(d.color[2],",").concat(d.color[3]/255,")"),a.stroke(l),c.width+=a.lineWidth,c.height+=a.lineWidth),c.width*=u,c.height*=u,y=a.getImageData(512-c.width/2,512-c.height/2,Math.ceil(c.width),Math.ceil(c.height)),n=y.width,s=y.height,a.canvas.width=n,a.canvas.height=s,a.putImageData(y,0,0),e.next=25;break;case 20:return v="image/svg+xml"===t.contentType?"data:image/svg+xml;base64,"+t.imageData:t.url,e.next=23,Object(k.default)(v,{responseType:"image"});case 23:h=e.sent.data,n=Object(x.g)(t.width),s=Object(x.g)(t.height),a.canvas.width=n,a.canvas.height=s,a.drawImage(h,0,0,a.canvas.width,a.canvas.height);case 25:return e.abrupt("return",{type:"esriPMS",imageData:a.canvas.toDataURL("image/png").substr(22),angle:t.angle,contentType:"image/png",height:Object(x.h)(s),width:Object(x.h)(n),xoffset:t.xoffset,yoffset:t.yoffset});case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_convertSvgRenderer",value:function(){var e=Object(l.a)(i.a.mark((function e(t){var r,a,n,s,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("simple"!==(r=t.type)||!Te(t.symbol)){e.next=7;break}return e.next=4,this._convertSvgToPictureMarkerSymbolJson(t.symbol);case 4:t.symbol=e.sent,e.next=35;break;case 7:if("uniqueValue"!==r&&"classBreaks"!==r){e.next=35;break}if(e.t0=Te(t.defaultSymbol),!e.t0){e.next=13;break}return e.next=12,this._convertSvgToPictureMarkerSymbolJson(t.defaultSymbol);case 12:t.defaultSymbol=e.sent;case 13:if(!(a=t["uniqueValue"===r?"uniqueValueInfos":"classBreakInfos"])){e.next=35;break}n=Object(o.a)(a),e.prev=16,n.s();case 18:if((s=n.n()).done){e.next=27;break}if(l=s.value,e.t1=Te(l.symbol),!e.t1){e.next=25;break}return e.next=24,this._convertSvgToPictureMarkerSymbolJson(l.symbol);case 24:l.symbol=e.sent;case 25:e.next=18;break;case 27:e.next=32;break;case 29:e.prev=29,e.t2=e.catch(16),n.e(e.t2);case 32:return e.prev=32,n.f(),e.finish(32);case 35:case"end":return e.stop()}}),e,this,[[16,29,32,35]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_getGraphics",value:function(e){return e.queryFeatures(Ge).then((function(e){return e.features}))}},{key:"_getPrintDefinition",value:function(){var e=Object(l.a)(i.a.mark((function e(t,r){var a,n,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.view,n=a.spatialReference,e.next=4,this._createOperationalLayers(a,r);case 4:return e.t0=e.sent,s={operationalLayers:e.t0},o=this._ssExtent||t.extent||a.extent,e.abrupt("return",(n&&n.isWrappable&&(o=o.clone()._normalize(!0),n=o.spatialReference),s.mapOptions={extent:o&&o.toJSON(),spatialReference:n&&n.toJSON(),showAttribution:r.attributionVisible},this._ssExtent=null,a.background&&(s.background=a.background.toJSON()),a.rotation&&(s.mapOptions.rotation=-a.rotation),r.scalePreserved&&(s.mapOptions.scale=r.outScale||a.scale),s));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getGpPrintParams",value:function(){var e=Object(l.a)(i.a.mark((function e(t){var r,a,n,s,o,l,c,u,p,b,f,y,v,h,m,g,j,S=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==(r=t.template||new Je).showLabels&&(r.showLabels=!0),a=r.exportOptions,s=ae(r.layout),a&&(n={dpi:a.dpi},("map_only"===s.toLowerCase()||""===s)&&(o=a.width,l=a.height,n.outputSize=[o,l])),(c=r.layoutOptions)&&("Miles"===c.scalebarUnit||"Kilometers"===c.scalebarUnit?(p="Kilometers",b="Miles"):"Meters"!==c.scalebarUnit&&"Feet"!==c.scalebarUnit||(p="Meters",b="Feet"),u={titleText:c.titleText,authorText:c.authorText,copyrightText:c.copyrightText,customTextElements:c.customTextElements,scaleBarOptions:{metricUnit:De.toJSON(p),metricLabel:Me[p],nonMetricUnit:De.toJSON(b),nonMetricLabel:Me[b]}}),f=null,c&&c.legendLayers&&(f=c.legendLayers.map((function(e){S._legendLayerNameMap[e.layerId]=e.title;var t={id:e.layerId};return e.subLayerIds&&(t.subLayerIds=e.subLayerIds),t}))),e.next=11,this._getPrintDefinition(t,r);case 11:return(y=e.sent).operationalLayers&&(v=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),h=/[\u0600-\u06FF]/,m=function(e){var t=e.text,r=e.font,a=r&&r.family&&r.family.toLowerCase();t&&r&&("arial"===a||"arial unicode ms"===a)&&(r.family=v.test(t)?"Arial Unicode MS":"Arial","normal"!==r.style&&h.test(t)&&(r.family="Arial Unicode MS"))},g=function(){throw new O.a("print-task:cim-symbol-unsupported","CIMSymbol is not supported by a print service published from ArcMap")},y.operationalLayers.forEach((function(e){var t,r,a;null!=(t=e.featureCollection)&&t.layers?e.featureCollection.layers.forEach((function(e){var t,r,a,n;if(null!=(t=e.layerDefinition)&&null!=(r=t.drawingInfo)&&null!=(a=r.renderer)&&a.symbol){var i=e.layerDefinition.drawingInfo.renderer;"esriTS"===i.symbol.type?m(i.symbol):"CIMSymbolReference"!==i.symbol.type||S._is11xService||g()}null!=(n=e.featureSet)&&n.features&&e.featureSet.features.forEach((function(e){e.symbol&&("esriTS"===e.symbol.type?m(e.symbol):"CIMSymbolReference"!==e.symbol.type||S._is11xService||g())}))})):!S._is11xService&&null!=(r=e.layerDefinition)&&null!=(a=r.drawingInfo)&&a.renderer&&JSON.stringify(e.layerDefinition.drawingInfo.renderer).includes('"type":"CIMSymbolReference"')&&g()}))),t.outSpatialReference&&(y.mapOptions.spatialReference=t.outSpatialReference.toJSON()),Object(d.d)(y,{exportOptions:n,layoutOptions:u}),Object(d.d)(y.layoutOptions,{legendOptions:{operationalLayers:null!=f?f:this._legendLayers.slice()}}),this._legendLayers.length=0,j={Web_Map_as_JSON:JSON.stringify(y),Format:te(r.format),Layout_Template:s},e.abrupt("return",(t.extraParameters&&Object(d.d)(j,t.extraParameters),j));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(P.a);Object(f.a)([Object(v.b)({dependsOn:["url"]})],Ie.prototype,"_geoprocessor",null),Object(f.a)([Object(v.b)()],Ie.prototype,"_gpMetadata",void 0),Object(f.a)([Object(v.b)({dependsOn:["_gpMetadata"],readOnly:!0})],Ie.prototype,"mode",null),Object(f.a)([Object(v.b)()],Ie.prototype,"updateDelay",void 0);var Fe=Ie=Object(f.a)([Object(m.a)("esri.tasks.PrintTask")],Ie);t.default=Fe},794:function(e,t,r){"use strict";function a(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function n(e){return null!=e&&!isNaN(e)&&isFinite(e)}function i(e){return e.valueExpression?"expression":e.field&&"string"==typeof e.field?"field":"unknown"}function s(e,t){var r=t||i(e),a=e.valueUnit||"unknown";return"unknown"===r?"constant":e.stops?"stops":null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?"clamped-linear":"unknown"===a?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?"proportional":"additive":"identity":"real-world-size"}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return n}))},820:function(e,t,r){"use strict";r.d(t,"a",(function(){return w})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return h})),r.d(t,"d",(function(){return m})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return S})),r.d(t,"g",(function(){return y}));var a=r(12),n=r(32),i=r(174),s=r(4),o=r(14),l=r(52),c=r(76),u=r(304),p=r(794),b=o.a.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),f=new c.a,d=Math.PI,y=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function v(e,t,r){var a="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"color"===e.type}))[0]:e;if(a)if("esri.renderers.visualVariables.ColorVariable"===a.declaredClass){var n="number"==typeof t,i=n?null:t,o=i&&i.attributes,c=n?t:null,u=a.field,p=a.cache,f=p.ipData,d=p.hasExpression,y=a.cache.compiledFunc;if(!u&&!d){var v=a.stops;return v&&v[0]&&v[0].color}if("number"!=typeof c)if(d){if(!Object(s.i)(r)||!Object(s.i)(r.arcade))return void b.error("Use of arcade expressions requires an arcade context");var h={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},m=r.arcade.arcadeUtils,O=m.getViewInfo(h),g=m.createExecContext(i,O);if(!y){var j=m.createSyntaxTree(a.valueExpression);y=m.createFunction(j),a.cache.compiledFunc=y}c=m.executeFunction(y,g)}else o&&(c=o[u]);var S=a.normalizationField,w=o?parseFloat(o[S]):void 0;if(null!=c&&(!S||n||!isNaN(w)&&0!==w)){isNaN(w)||n||(c/=w);var k=x(c,f);if(k){var _=k[0],V=k[1],P=_===V?a.stops[_].color:l.a.blendColors(a.stops[_].color,a.stops[V].color,k[2],Object(s.i)(r)?r.color:void 0);return new l.a(P)}}}else b.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable")}function h(e,t,r){var a="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"opacity"===e.type}))[0]:e;if(a)if("esri.renderers.visualVariables.OpacityVariable"===a.declaredClass){var n="number"==typeof t,i=n?null:t,o=i&&i.attributes,l=n?t:null,c=a.field,u=a.cache,p=u.ipData,f=u.hasExpression,d=a.cache.compiledFunc;if(!c&&!f){var y=a.stops;return y&&y[0]&&y[0].opacity}if("number"!=typeof l)if(f){if(Object(s.h)(r)||Object(s.h)(r.arcade))return void b.error("Use of arcade expressions requires an arcade context");var v={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},h=r.arcade.arcadeUtils,m=h.getViewInfo(v),O=h.createExecContext(i,m);if(!d){var g=h.createSyntaxTree(a.valueExpression);d=h.createFunction(g),a.cache.compiledFunc=d}l=h.executeFunction(d,O)}else o&&(l=o[c]);var j=a.normalizationField,S=o?parseFloat(o[j]):void 0;if(null!=l&&(!j||n||!isNaN(S)&&0!==S)){isNaN(S)||n||(l/=S);var w=x(l,p);if(w){var k=w[0],_=w[1];if(k===_)return a.stops[k].opacity;var V=a.stops[k].opacity;return V+(a.stops[_].opacity-V)*w[2]}}}else b.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable")}function m(e,t,r){var a="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"rotation"===e.type}))[0]:e;if(a){if("esri.renderers.visualVariables.RotationVariable"===a.declaredClass){var n=a.axis||"heading",i="heading"===n&&"arithmetic"===a.rotationType?90:0,o="heading"===n&&"arithmetic"===a.rotationType?-1:1,l="number"==typeof t?null:t,c=l&&l.attributes,u=a.field,p=a.cache.hasExpression,f=a.cache.compiledFunc,d=0;if(!u&&!p)return d;if(p){if(Object(s.h)(r)||Object(s.h)(r.arcade))return void b.error("Use of arcade expressions requires an arcade context");var y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},v=r.arcade.arcadeUtils,h=v.getViewInfo(y),m=v.createExecContext(l,h);if(!f){var O=v.createSyntaxTree(a.valueExpression);f=v.createFunction(O),a.cache.compiledFunc=f}d=v.executeFunction(f,m)}else c&&(d=c[u]||0);return d="number"!=typeof d||isNaN(d)?null:i+o*d}b.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable")}}function O(e,t,r){var a="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"size"===e.type}))[0]:e;if(a){if("esri.renderers.visualVariables.SizeVariable"===a.declaredClass){var i=function(e,t,r,a,i){switch(t.transformationType){case"additive":return function(e,t,r,a){return e+(g(t.minSize,r,a)||t.minDataValue)}(e,t,r,a);case"constant":return function(e,t,r){var a=e.stops,n=a&&a.length&&a[0].size;return null==n&&(n=e.minSize),g(n,t,r)}(t,r,a);case"clamped-linear":return function(e,t,r,a){var n=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),i=g(t.minSize,r,a),o=g(t.maxSize,r,a),l=Object(s.i)(a)?a.shape:void 0;if(e<=t.minDataValue)return i;if(e>=t.maxDataValue)return o;if("area"===t.scaleBy&&l){var c="circle"===l,u=c?d*Math.pow(i/2,2):i*i,p=u+n*((c?d*Math.pow(o/2,2):o*o)-u);return c?2*Math.sqrt(p/d):Math.sqrt(p)}return i+n*(o-i)}(e,t,r,a);case"proportional":return function(e,t,r,a){var n=Object(s.i)(a)?a.shape:void 0,i=e/t.minDataValue,o=g(t.minSize,r,a),l=g(t.maxSize,r,a);return j("circle"===n?2*Math.sqrt(i*Math.pow(o/2,2)):"square"===n||"diamond"===n||"image"===n?Math.sqrt(i*Math.pow(o,2)):i*o,o,l)}(e,t,r,a);case"stops":return function(e,t,r,a,i){var s=x(e,i),o=Object(n.a)(s,3),l=o[0],c=o[1],u=o[2];if(l===c)return g(t.stops[l].size,r,a);var p=g(t.stops[l].size,r,a);return p+(g(t.stops[c].size,r,a)-p)*u}(e,t,r,a,i);case"real-world-size":return function(e,t,r,a){var n=(Object(s.i)(a)&&a.resolution?a.resolution:1)*u.a[t.valueUnit],i=g(t.minSize,r,a),o=g(t.maxSize,r,a),l=t.valueRepresentation;return j("area"===l?2*Math.sqrt(e/d)/n:"radius"===l||"distance"===l?2*e/n:e/n,i,o)}(e,t,r,a);case"identity":return e;case"unknown":return null}}(function(e,t,r){var a="number"==typeof t,n=a?null:t,i=n&&n.attributes,o=a?t:null,l=e.cache.isScaleDriven,c=e.cache.compiledFunc;if(l){var u=Object(s.i)(r)?r.scale:void 0,f=Object(s.i)(r)?r.view:void 0;o=null==u||"3d"===f?function(e){var t=null,r=null,a=e.stops;return a?(t=a[0].value,r=a[a.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):u}else if(!a)switch(e.inputValueType){case"expression":if(Object(s.h)(r)||Object(s.h)(r.arcade))return void b.error("Use of arcade expressions requires an arcade context");var d={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,v=y.getViewInfo(d),h=y.createExecContext(n,v);if(!c){var m=y.createSyntaxTree(e.valueExpression);c=y.createFunction(m),e.cache.compiledFunc=c}o=y.executeFunction(c,h);break;case"field":i&&(o=i[e.field]);break;case"unknown":o=null}if(!Object(p.d)(o))return null;if(a||!e.normalizationField)return o;var O=i?parseFloat(i[e.normalizationField]):null;return Object(p.d)(O)&&0!==O?o/O:null}(a,t,r),a,t,r,a.cache.ipData);return null==i||isNaN(i)?0:i}b.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable")}}function g(e,t,r){return null==e?null:Object(p.c)(e)?O(e,t,r):Object(p.d)(e)?e:null}function j(e,t,r){return Object(p.d)(r)&&e>r?r:Object(p.d)(t)&&e<t?t:e}function S(e,t,r){if(!(e.cache.isScaleDriven&&"3d"===r||t))return null;var a={scale:t,view:r},n=g(e.minSize,f,a),i=g(e.maxSize,f,a);if(null!=n||null!=i){if(n>i){var s=i;i=n,n=s}return{minSize:n,maxSize:i}}}function x(e,t){if(t){var r=0,a=t.length-1;return t.some((function(t,n){return e<t?(a=n,!0):(r=n,!1)})),[r,a,(e-t[r])/(t[a]-t[r])]}}function w(e,t,r){var n,s=["proportional","proportional","proportional"],o=Object(a.a)(e);try{for(o.s();!(n=o.n()).done;){var l=n.value,c=l.useSymbolValue?"symbol-value":O(l,t,r);switch(l.axis){case"width":s[0]=c;break;case"depth":s[1]=c;break;case"height":s[2]=c;break;case"width-and-depth":s[0]=c,s[1]=c;break;case"all":case void 0:case null:s[0]=c,s[1]=c,s[2]=c;break;default:Object(i.a)(l.axis)}}}catch(u){o.e(u)}finally{o.f()}return s}},943:function(e,t,r){"use strict";var a=r(2),n=r(5),i=r(6),s=r(0),o=(r(13),r(14),r(15),r(1)),l=r(50),c=r(8),u=(r(11),r(19),r(20),r(28)),p=new l.a({esriJobMessageTypeInformative:"informative",esriJobMessageTypeProcessDefinition:"process-definition",esriJobMessageTypeProcessStart:"process-start",esriJobMessageTypeProcessStop:"process-stop",esriJobMessageTypeWarning:"warning",esriJobMessageTypeError:"error",esriJobMessageTypeEmpty:"empty",esriJobMessageTypeAbort:"abort"}),b=function(e){Object(n.a)(r,e);var t=Object(i.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).description=null,n.type=null,n}return r}(u.a);Object(s.a)([Object(o.b)({type:String,json:{write:!0}})],b.prototype,"description",void 0),Object(s.a)([Object(o.b)({type:String,json:{read:p.read,write:p.write}})],b.prototype,"type",void 0);var f=b=Object(s.a)([Object(c.a)("esri.tasks.support.GPMessage")],b);t.a=f}}]);
//# sourceMappingURL=96.d43742e4.chunk.js.map