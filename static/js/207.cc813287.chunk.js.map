{"version":3,"sources":["../node_modules/@arcgis/core/renderers/DictionaryRenderer.js"],"names":["w","x","i","getLogger","v","e","_ongoingRequests","Map","_symbolCache","_","config","fieldMap","scaleExpression","scaleExpressionTitle","url","type","s","scalingExpressionInfo","expression","returnType","t","r","origin","this","visualVariables","a","_dictionaryPromise","fetchResources","c","_symbolFields","attributes","o","n","toString","get","catch","pop","l","split","p","u","length","indexOf","_itemNames","has","push","substr","map","Number","y","toRgba","primitiveName","propertyName","value","m","_cimPartsToCIMSymbol","put","collectVVRequiredFields","h","name","add","error","abortOptions","g","responseType","query","f","data","authoringInfo","_refSymbolUrlTemplate","cimRefTemplateUrl","Set","itemsNames","symbol","configuration","hasOwnProperty","fields","filter","spatialReference","then","scale","repurposeFeature","geometry","evaluate","$feature","$view","reduce","getAttributeHash","JSON","stringify","replace","set","delete","primitiveOverrides","symbolLayers","unshift","Array","_getSymbolPart","d","_combineSymbolParts","j","b","Object","json","read","source","write","target","prototype","String","overridePolicy","enabled","S"],"mappings":"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","file":"static/js/207.cc813287.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import\"../core/has.js\";import{clone as s}from\"../core/lang.js\";import{isSome as t}from\"../core/maybe.js\";import{numericHash as r}from\"../core/string.js\";import i from\"../core/Logger.js\";import\"../core/accessorSupport/ensureType.js\";import{property as o}from\"../core/accessorSupport/decorators/property.js\";import{subclass as n}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as a}from\"../core/accessorSupport/decorators/writer.js\";import l from\"../core/Error.js\";import\"../core/urlUtils.js\";import\"../core/uuid.js\";import\"../portal/support/resourceExtension.js\";import{isAbortError as c,all as p,reject as u}from\"../core/promiseUtils.js\";import{loadArcade as m,createDictionaryExpression as f}from\"../support/arcadeOnDemand.js\";import{collectArcadeFieldNames as h}from\"../layers/support/fieldUtils.js\";import y from\"../Color.js\";import d from\"../symbols/CIMSymbol.js\";import g from\"../request.js\";import b from\"./Renderer.js\";import{VisualVariablesMixin as j}from\"./mixins/VisualVariablesMixin.js\";import _ from\"../core/LRUCache.js\";var w;const x=i.getLogger(\"esri.renderers.DictionaryRenderer\");let v=w=class extends(j(b)){constructor(e){super(e),this._ongoingRequests=new Map,this._symbolCache=new _(100),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type=\"dictionary\"}writeData(e,s){e&&(s.scalingExpressionInfo={expression:e,returnType:\"number\"})}writeVisualVariables(e,s,t,r){null!=r&&r.origin||super.writeVisualVariables(e,s,t,r)}clone(){return new w({config:s(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:s(this.fieldMap),url:s(this.url),visualVariables:s(this.visualVariables)})}async getSymbolAsync(e,s){let t;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(s));try{t=await this._dictionaryPromise}catch(e){if(c(e))return this._dictionaryPromise=null,null}const i={};if(this.fieldMap)for(const s of this._symbolFields){const t=this.fieldMap[s];if(t&&null!==e.attributes[t]&&void 0!==e.attributes[t]){const r=\"\"+e.attributes[t];i[s]=r}else i[s]=\"\"}const o=t(i,s);if(!o||\"string\"!=typeof o)return null;const n=r(o).toString(),a=this._symbolCache.get(n);if(a)return a.catch((()=>{this._symbolCache.pop(n)})),a;const l=o.split(\";\"),p=[],u=[];for(const e of l)if(e&&0!==e.length)if(-1===e.indexOf(\"po:\"))if(-1!==e.indexOf(\"|\"))for(const s of e.split(\"|\"))this._itemNames.has(s)&&p.push(s);else this._itemNames.has(e)&&p.push(e);else{const s=e.substr(3).split(\"|\");if(3===s.length){const e=s[0],t=s[1];let r=s[2];if(\"DashTemplate\"===t)r=r.split(\" \").map((e=>Number(e)));else if(\"Color\"===t){const e=new y(r).toRgba();r=[e[0],e[1],e[2],255*e[3]]}else r=Number(r);u.push({primitiveName:e,propertyName:t,value:r})}}const m=this._cimPartsToCIMSymbol(p,u,s);return this._symbolCache.put(n,m,1),m}async collectRequiredFields(e,s){await this.collectVVRequiredFields(e,s),this.scaleExpression&&await h(e,s,this.scaleExpression);const t=s.map((e=>e.name));for(const s in this.fieldMap)t.indexOf(this.fieldMap[s])<0||e.add(this.fieldMap[s])}get arcadeRequired(){return!0}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void x.error(\"no valid URL!\");const s=t(e)?e.abortOptions:null,r=g(this.url+\"/resources/styles/dictionary-info.json\",{responseType:\"json\",query:{f:\"json\"},...s}),[{data:i}]=await p([r,m()]);if(!i)throw this._dictionaryPromise=null,new l(\"esri.renderers.DictionaryRenderer\",\"Bad dictionary data!\");const o=i.expression,n=i.authoringInfo;this._refSymbolUrlTemplate=this.url+\"/\"+i.cimRefTemplateUrl,this._itemNames=new Set(i.itemsNames),this._symbolFields=n.symbol;const a={};if(this.config){const e=this.config;for(const s in e)a[s]=e[s]}for(const e of n.configuration)a.hasOwnProperty(e.name)||(a[e.name]=e.value);const c=[];if(t(e)&&e.fields&&this.fieldMap)for(const s of this._symbolFields){const t=this.fieldMap[s],r=e.fields.filter((e=>e.name===t));r.length>0&&c.push({...r[0],name:s})}return this._dictionaryPromise=f(o,t(e)?e.spatialReference:null,c,a).then((e=>{const s={scale:0};return(r,i)=>{const o=e.repurposeFeature({geometry:null,attributes:r});return s.scale=t(i)?i.scale:void 0,e.evaluate({$feature:o,$view:s})}})).catch((e=>(x.error(\"Creating dictinoary expression failed:\",e),null))),this._dictionaryPromise}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,s)=>e+s.getAttributeHash()),\"\")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._symbolFields}async _getSymbolPart(e,s){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const t=this._refSymbolUrlTemplate.replace(/\\{itemName\\}/gi,e),r=g(t,{responseType:\"json\",query:{f:\"json\"},...s});this._ongoingRequests.set(e,r);try{return(await r).data}catch(s){return this._ongoingRequests.delete(e),u(s)}}_combineSymbolParts(e,s){if(!e||0===e.length)return null;if(1===e.length)return{type:\"CIMSymbolReference\",symbol:e[0],primitiveOverrides:s};const t={...e[0]};t.symbolLayers=[];for(const s of e){const e=s;t.symbolLayers.unshift(...e.symbolLayers)}return{type:\"CIMSymbolReference\",symbol:t,primitiveOverrides:s}}async _cimPartsToCIMSymbol(e,s,t){const r=new Array(e.length);for(let s=0;s<e.length;s++)r[s]=this._getSymbolPart(e[s],t);const i=await p(r);return new d({data:this._combineSymbolParts(i,s)})}};e([o({type:Object,json:{read:{source:\"configuration\"},write:{target:\"configuration\"}}})],v.prototype,\"config\",void 0),e([o({type:Object,json:{write:!0}})],v.prototype,\"fieldMap\",void 0),e([o({type:String,json:{read:{source:\"scalingExpressionInfo.expression\"},write:!0}})],v.prototype,\"scaleExpression\",void 0),e([a(\"scaleExpression\")],v.prototype,\"writeData\",null),e([o({type:String,json:{read:{source:\"scalingExpressionInfo.title\"},write:{target:\"scalingExpressionInfo.title\",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],v.prototype,\"scaleExpressionTitle\",void 0),e([o({type:String,json:{write:!0}})],v.prototype,\"url\",void 0),e([a(\"visualVariables\")],v.prototype,\"writeVisualVariables\",null),v=w=e([n(\"esri.renderers.DictionaryRenderer\")],v);var S=v;export default S;\n"],"sourceRoot":""}