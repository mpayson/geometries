(this.webpackJsonpgeometries=this.webpackJsonpgeometries||[]).push([[85],{1017:function(e,t,r){"use strict";function n(e,t){if(!e)return null;var r=t.featureAdapter,n=e.startTimeField,i=e.endTimeField,a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;if(n&&i)t.forEach((function(e){var t=r.getAttribute(e,n),u=r.getAttribute(e,i);null==t||isNaN(t)||(a=Math.min(a,t)),null==u||isNaN(u)||(s=Math.max(s,u))}));else{var u=n||i;t.forEach((function(e){var t=r.getAttribute(e,u);null==t||isNaN(t)||(a=Math.min(a,t),s=Math.max(s,t))}))}return{start:a,end:s}}function i(e,t,r){if(!t||!e)return null;var n=e.startTimeField,i=e.endTimeField;if(!n&&!i)return null;var a=t.start,s=t.end;return null===a&&null===s?null:void 0===a&&void 0===s?function(){return!1}:n&&i?function(e,t,r,n,i){return null!=n&&null!=i?function(a){var s=e.getAttribute(a,t),u=e.getAttribute(a,r);return(null==s||s<=i)&&(null==u||u>=n)}:null!=n?function(t){var i=e.getAttribute(t,r);return null==i||i>=n}:null!=i?function(r){var n=e.getAttribute(r,t);return null==n||n<=i}:void 0}(r,n,i,a,s):function(e,t,r,n){return null!=r&&null!=n&&r===n?function(n){return e.getAttribute(n,t)===r}:null!=r&&null!=n?function(i){var a=e.getAttribute(i,t);return a>=r&&a<=n}:null!=r?function(n){return e.getAttribute(n,t)>=r}:null!=n?function(r){return e.getAttribute(r,t)<=n}:void 0}(r,n||i,a,s)}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}))},1056:function(e,t,r){"use strict";r.d(t,"a",(function(){return k})),r.d(t,"b",(function(){return E})),r.d(t,"c",(function(){return z})),r.d(t,"d",(function(){return C})),r.d(t,"e",(function(){return X})),r.d(t,"f",(function(){return A})),r.d(t,"g",(function(){return J})),r.d(t,"h",(function(){return B})),r.d(t,"i",(function(){return T}));var n=r(10),i=r.n(n),a=r(12),s=r(21),u=r(4),o=r(50),c=r(23),l=r(16),f=r(46),d=r(115),h=r(312),p=r(314),b=r(58),y=r(54),v=r(381),m=r(142),_=r(359),g=(r(888),r(881));function I(e,t){return e?t?4:3:t?3:2}function O(e,t,r,n,i){if(!e)return!1;var s,u=I(t,r),o=e.coords,c=e.lengths,l=!1,f=0,d=Object(a.a)(c);try{for(d.s();!(s=d.n()).done;){var h=s.value;l=j(l,o,u,f,h,n,i),f+=h*u}}catch(p){d.e(p)}finally{d.f()}return l}function j(e,t,r,n,i,a,s){for(var u=e,o=n,c=n,l=n+i*r;c<l;c+=r){(o=c+r)===l&&(o=n);var f=t[c],d=t[c+1],h=t[o],p=t[o+1];(d<s&&p>=s||p<s&&d>=s)&&f+(s-d)/(p-d)*(h-f)<a&&(u=!u)}return u}var x=new o.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),k=Object.freeze({}),w=new m.a,S=new m.a,R=new m.a,F={esriGeometryPoint:_.m,esriGeometryPolyline:_.o,esriGeometryPolygon:_.n,esriGeometryMultipoint:_.l};function T(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.hasZ,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.hasM,a=e.hasZ&&n,s=e.hasM&&i;if(r){var u=Object(_.u)(R,t,e.hasZ,e.hasM,"esriGeometryPoint",r,n,i);return Object(_.m)(u,a,s)}return Object(_.m)(t,a,s)}function A(e,t,r,n,i,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:r,o=t&&s,c=r&&u,l=n?"coords"in n?n:n.geometry:null;if(!l)return null;if(i){var f=Object(_.q)(S,l,t,r,e,i,s,u);return a&&(f=Object(_.u)(R,f,o,c,e,a)),F[e](f,o,c)}if(a){var d=Object(_.u)(R,l,t,r,e,a,s,u);return F[e](d,o,c)}return Object(_.x)(w,l,t,r,s,u),F[e](w,o,c)}function E(e,t,r){return G.apply(this,arguments)}function G(){return(G=Object(s.a)(i.a.mark((function e(t,r,n){var a,s,u,o,c,l,f,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.outFields,s=t.orderByFields,u=t.groupByFieldsForStatistics,o=t.outStatistics,a)for(c=0;c<a.length;c++)a[c]=a[c].trim();if(s)for(l=0;l<s.length;l++)s[l]=s[l].trim();if(u)for(f=0;f<u.length;f++)u[f]=u[f].trim();if(o)for(d=0;d<o.length;d++)o[d].onStatisticField&&(o[d].onStatisticField=o[d].onStatisticField.trim());return e.abrupt("return",(t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),B(t,r,n)));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t,r){return M.apply(this,arguments)}function M(){return(M=Object(s.a)(i.a.mark((function e(t,r,n){var a,o,c,l,d,h;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(a=t.where,t.where=a=a&&a.trim(),(!a||/^1 *= *1$/.test(a)||r&&r===a)&&(t.where=null),t.geometry){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,function(){var e=Object(s.a)(i.a.mark((function e(t){var r,n,a,s,u,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.geometry,n=t.distance,a=t.units,null!=n&&!("vertexAttributes"in r)){e.next=3;break}return e.abrupt("return",r);case 3:if(s=r.spatialReference,u=a?x.fromJSON(a):Object(y.e)(s),!s||!Object(f.f)(s)&&!Object(f.m)(s)){e.next=9;break}e.t0=r,e.next=12;break;case 9:return e.next=11,Object(g.a)(s,f.a).then((function(){return Object(g.b)(r,f.a)}));case 11:e.t0=e.sent;case 12:return o=e.t0,e.next=15,H();case 15:return e.t1=e.sent,e.abrupt("return",(0,e.t1)(o.spatialReference,o,n,u));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(t);case 7:return o=e.sent,t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel&&(c=t.geometry.spatialReference,(o=Object(p.a)(o)).spatialReference=c),t.geometry=o,e.next=12,Object(g.a)(o.spatialReference,n);case 12:return e.next=14,Object(v.a)(Object(b.a)(o));case 14:if(l=e.sent[0],!Object(u.h)(l)){e.next=17;break}throw k;case 17:return d=l.toJSON(),e.next=20,Object(g.b)(d,d.spatialReference,n);case 20:if(h=e.sent){e.next=23;break}throw k;case 23:return e.abrupt("return",(h.spatialReference=n,t.geometry=h,t));case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return e&&D in e?JSON.parse(JSON.stringify(e,N)):e}var D="_geVersion",N=function(e,t){return e!==D?t:void 0},U={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},V={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},P={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},Y={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function q(){return r.e(35).then(r.bind(null,1089))}function H(){return q().then((function(e){return e.geodesicBuffer}))}function J(e,t,r,n,i){if(Object(b.g)(t)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var a=Object(_.g)(new m.a,t,!1,!1);return Object(l.u)((function(e){return function(e,t,r,n){return O(e,t,r,n.coords[0],n.coords[1])}(a,!1,!1,e)}))}if(Object(b.g)(t)&&"esriGeometryMultipoint"===r){var s=Object(_.g)(new m.a,t,!1,!1);if("esriSpatialRelContains"===e)return Object(l.u)((function(e){return function(e,t,r,n,i,a){var s=I(i,a),u=n.coords,o=n.lengths;if(!o)return!1;for(var c=0,l=0;c<o.length;c++,l+=s)if(!O(e,t,r,u[l],u[l+1]))return!1;return!0}(s,!1,!1,e,n,i)}))}if(Object(b.d)(t)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Object(l.u)((function(e){return Object(d.e)(t,A(r,n,i,e))}));if(Object(b.d)(t)&&"esriGeometryMultipoint"===r&&"esriSpatialRelContains"===e)return Object(l.u)((function(e){return Object(d.d)(t,A(r,n,i,e))}));if(Object(b.d)(t)&&"esriSpatialRelIntersects"===e){var u=Object(h.b)(r);return Object(l.u)((function(e){return u(t,A(r,n,i,e))}))}return q().then((function(a){var s=a[U[e]].bind(null,t.spatialReference,t);return function(e){return s(A(r,n,i,e))}}))}function X(e,t,r){return L.apply(this,arguments)}function L(){return(L=Object(s.a)(i.a.mark((function e(t,r,n){var a,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.spatialRel,!(s=t.geometry)){e.next=11;break}if(!0===V[a]){e.next=4;break}throw new c.a("feature-store:unsupported-query","Unsupported query spatial relationship",{query:t});case 4:if(!Object(f.i)(s.spatialReference)||!Object(f.i)(n)){e.next=11;break}if(function(e){return!0===P[Object(b.c)(e)]}(s)){e.next=7;break}throw new c.a("feature-store:unsupported-query","Unsupported query geometry type",{query:t});case 7:if(function(e){return!0===Y[e]}(r)){e.next=9;break}throw new c.a("feature-store:unsupported-query","Unsupported layer geometry type",{query:t});case 9:if(!t.outSR){e.next=11;break}return e.abrupt("return",Object(g.a)(t.geometry&&t.geometry.spatialReference,t.outSR));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){if(Object(b.d)(e))return!0;if(Object(b.g)(e)){var t,r=Object(a.a)(e.rings);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(5!==n.length)return!1;if(n[0][0]!==n[1][0]||n[0][0]!==n[4][0]||n[2][0]!==n[3][0]||n[0][1]!==n[3][1]||n[0][1]!==n[4][1]||n[1][1]!==n[2][1])return!1}}catch(i){r.e(i)}finally{r.f()}return!0}return!1}},1058:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var n=r(9),i=r(12),a=r(10),s=r.n(a),u=r(21),o=r(2),c=r(3),l=r(13),f=r(4),d=r(16),h=r(244),p=r(804),b=r(14);var y=function(e,t,r){e.referencesGeometry();var i=t.readArcadeFeature();try{return e.evaluate(Object(n.a)(Object(n.a)({},r),{},{$feature:i}))}catch(e){return b.a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}},v=r.e(141).then(r.bind(null,1279)),m=function(){function e(t,r){Object(o.a)(this,e),this._canCacheExpressionValue=!1,this._sourceInfo=t,this._bitsets={computed:r.getBitset(r.createBitset())}}return Object(c.a)(e,[{key:"updateSchema",value:function(){var e=Object(u.a)(s.a.mark((function e(t,r){var n,i,a,u,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object(p.a)(this._schema,r),this._schema=r,r&&!Object(f.h)(n)&&Object(p.b)(n,"attributes")){e.next=3;break}return e.abrupt("return");case 3:Object(l.a)("esri-2d-update-debug")&&console.debug("Applying Update - Store:",n),this._bitsets.computed.clear(),t.targets[r.name]=!0,i=r.attributes,a=[],u=[],e.t0=s.a.keys(i);case 6:if((e.t1=e.t0()).done){e.next=20;break}o=e.t1.value,c=i[o],e.t2=c.type,e.next="field"===e.t2?12:"expression"===e.t2?13:"label-expression"===e.t2?15:"statistic"===e.t2?17:18;break;case 12:return e.abrupt("break",18);case 13:return a.push(this._createArcadeComputedField(c)),e.abrupt("break",18);case 15:return a.push(this._createLabelArcadeComputedField(c)),e.abrupt("break",18);case 17:u.push(c);case 18:e.next=6;break;case 20:return e.next=22,Object(d.b)(a);case 22:this._computedFields=e.sent,this._canCacheExpressionValue=!this._computedFields.some((function(e){return"expression"===e.type&&e.expression.referencesScale()})),this._statisticFields=u;case 25:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setComputedAttributes",value:function(e,t,r,n){var a=this._bitsets.computed;if(!this._canCacheExpressionValue||!a.has(r)){a.set(r);var s,u=Object(i.a)(this._computedFields);try{for(u.s();!(s=u.n()).done;){var o=s.value,c=this._evaluateField(t,o,n);switch(o.resultType){case"numeric":e.setComputedNumericAtIndex(r,o.fieldIndex,c);break;case"string":e.setComputedStringAtIndex(r,o.fieldIndex,c)}}}catch(l){u.e(l)}finally{u.f()}}}},{key:"_createArcadeComputedField",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var r,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._sourceInfo.spatialReference,i=this._sourceInfo.fieldsIndex,e.t0=n.a,e.t1=Object(n.a)({},t),e.t2={},e.next=6,Object(h.d)(t.valueExpression,r,i);case 6:return e.t3=e.sent,e.t4={expression:e.t3},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t4));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createLabelArcadeComputedField",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var r,i,a,u,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._sourceInfo.spatialReference,i=this._sourceInfo.fields,e.next=4,v;case 4:return a=e.sent,u=a.createLabelFunction,e.next=8,u(t.label,i,r);case 8:return o=e.sent,e.abrupt("return",Object(n.a)(Object(n.a)({},t),{},{builder:o}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_evaluateField",value:function(e,t,r){switch(t.type){case"label-expression":var n=e.readArcadeFeature();return t.builder.evaluate(n)||"";case"expression":var i=t.expression;return y(i,e,{$view:{scale:r}})}}}]),e}()},1076:function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return b}));var n=r(12),i=r(2),a=r(3),s=r(5),u=r(6),o=r(4),c=r(76),l=r(131),f=r(856),d=r(1058);function h(e){return(4294901760&e)>>>16}function p(e){return 65535&e}var b={getObjectId:function(e){return e.getObjectId()},getAttributes:function(e){return e.readAttributes()},getAttribute:function(e,t){return e.readAttribute(t)},cloneWithGeometry:function(e,t){return e},getGeometry:function(e){return e.readHydratedGeometry()},getCentroid:function(e,t){return e.readCentroid()}},y=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e,n){var a;return Object(i.a)(this,r),(a=t.call(this,e,n)).featureAdapter=b,a.events=new c.a,a._featureSetsByInstance=new Map,a._objectIdToDisplayId=new Map,a._spatialIndexInvalid=!0,a._index=Object(f.a)(9,(function(e){return{minX:a._storage.getXMin(e),minY:a._storage.getYMin(e),maxX:a._storage.getXMax(e),maxY:a._storage.getYMax(e)}})),a}return Object(a.a)(r,[{key:"storeStatistics",get:function(){return{featureCount:0,vertexCount:0}}},{key:"onTileData",value:function(e,t,r){if(Object(o.h)(t.addOrUpdate))return t;this._featureSetsByInstance.set(t.addOrUpdate.instance,t.addOrUpdate),this._storage=r,t.addOrUpdate._storage=r;for(var n=t.addOrUpdate.getCursor();n.next();){var i=n.getObjectId(),a=n.instance<<16|n.getIndex(),s=this._objectIdToDisplayId.get(i);s||(s=r.createDisplayId(),this._objectIdToDisplayId.set(i,s),this._spatialIndexInvalid=!0),n.setDisplayId(s),r.setInstanceId(s,a),this.setComputedAttributes(r,n,s,e.scale)}return"update"===t.type&&(this._spatialIndexInvalid=!0),this.events.emit("changed"),t}},{key:"forEach",value:function(e){var t=this;this._objectIdToDisplayId.forEach((function(r){var n=t._storage.getInstanceId(r),i=t._lookupFeature(n);e(i)}))}},{key:"forEachUnsafe",value:function(e){var t=this;this._objectIdToDisplayId.forEach((function(r){var n=t._storage.getInstanceId(r),i=h(n),a=p(n),s=t._getFeatureSet(i);s.setIndex(a),e(s)}))}},{key:"forEachInBounds",value:function(e,t){var r,i=this._searchIndex(e),a=Object(n.a)(i);try{for(a.s();!(r=a.n()).done;){var s=r.value,u=this.lookupFeatureByDisplayId(s,this._storage);t(Object(o.o)(u))}}catch(c){a.e(c)}finally{a.f()}}},{key:"forEachBounds",value:function(e,t,r){this._rebuildIndex();var i,a=[0,0,0,0],s=Object(n.a)(e);try{for(s.s();!(i=s.n()).done;){var u=i.value;if(u.readGeometry()){var o=u.getDisplayId();a[0]=this._storage.getXMin(o),a[1]=this._storage.getYMin(o),a[2]=this._storage.getXMax(o),a[3]=this._storage.getYMax(o),t(Object(l.k)(r,a))}}}catch(c){s.e(c)}finally{s.f()}}},{key:"sweepFeatures",value:function(e,t,r){var n=this;this._objectIdToDisplayId.forEach((function(i,a){e.has(i)||(t.releaseDisplayId(i),r.unsetAttributeData(i),n._objectIdToDisplayId.delete(a))})),this.events.emit("changed")}},{key:"sweepFeatureSets",value:function(e){var t=this;this._featureSetsByInstance.forEach((function(r,n){e.has(n)||t._featureSetsByInstance.delete(n)}))}},{key:"lookupObjectId",value:function(e,t){var r=this.lookupFeatureByDisplayId(e,t);return Object(o.h)(r)?null:r.getObjectId()}},{key:"lookupDisplayId",value:function(e){return this._objectIdToDisplayId.get(e)}},{key:"lookupFeatureByDisplayId",value:function(e,t){var r=t.getInstanceId(e);return this._lookupFeature(r)}},{key:"lookupByDisplayIdUnsafe",value:function(e){var t=this._storage.getInstanceId(e),r=h(t),n=p(t),i=this._getFeatureSet(r);return i?(i.setIndex(n),i):null}},{key:"hasInstance",value:function(e){return this._featureSetsByInstance.has(e)}},{key:"_rebuildIndex",value:function(){var e=this;if(this._spatialIndexInvalid){this._index.clear();var t=[];this._objectIdToDisplayId.forEach((function(r){var n=e._storage.getInstanceId(r);e._storage.setBounds(r,e._lookupFeature(n))&&t.push(r)})),this._index.load(t),this._spatialIndexInvalid=!1}}},{key:"_lookupFeature",value:function(e){var t=h(e),r=p(e),n=this._getFeatureSet(t);if(!n)return null;var i=n.getCursor();return i.setIndex(r),i}},{key:"_getFeatureSet",value:function(e){return this._featureSetsByInstance.get(e)}},{key:"_searchIndex",value:function(e){this._rebuildIndex();var t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}}]),r}(d.a)},950:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return x}));var n=r(10),i=r.n(n),a=r(21),s=r(12),u=r(2),o=r(3),c=r(4),l=r(14),f=r(23),d=r(16),h=r(230),p=r(107),b=r(277),y=r(1056),v=r(1017),m=r(1076),_=l.a.getLogger("esri.views.2d.layers.features.support.whereUtils"),g={getAttribute:function(e,t){return e.field(t)}};function I(e,t){return O.apply(this,arguments)}function O(){return(O=Object(a.a)(i.a.mark((function e(t,n){var a,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(9).then(r.bind(null,709));case 2:return a=e.sent,e.prev=3,(s=a.WhereClause.create(t,n)).isStandardized||(u=new f.a("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",s),_.error(u)),e.abrupt("return",(function(e){var t=e.readArcadeFeature();return s.testFeature(t,g)}));case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",(_.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",t),function(e){return!0}));case 12:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}var j=l.a.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter"),x=function(){function e(t){Object(u.a)(this,e),this._geometryBounds=Object(p.g)(),this._idToVisibility=new Map,this._serviceInfo=t}return Object(o.a)(e,[{key:"hash",get:function(){return this._hash}},{key:"check",value:function(e){return this._applyFilter(e)}},{key:"clear",value:function(){var e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}},{key:"invalidate",value:function(){var e=this;this._idToVisibility.forEach((function(t,r){e._idToVisibility.set(r,0)}))}},{key:"setKnownIds",value:function(e){var t,r=Object(s.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this._idToVisibility.set(n,1)}}catch(i){r.e(i)}finally{r.f()}}},{key:"setTrue",value:function(e){var t=this,r=[],n=[],i=new Set(e);return this._idToVisibility.forEach((function(e,a){var s=!!(1&t._idToVisibility.get(a)),u=i.has(a);!s&&u?r.push(a):s&&!u&&n.push(a),t._idToVisibility.set(a,u?3:0)})),{show:r,hide:n}}},{key:"createQuery",value:function(){var e=this.geometry,t=this.spatialRel,r=this.where,n=this.timeExtent,i=this.objectIds;return b.a.fromJSON({geometry:e,spatialRel:t,where:r,timeExtent:n,objectIds:i})}},{key:"update",value:function(){var e=Object(a.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._hash=JSON.stringify(t),e.next=3,Object(y.h)(t,null,r);case 3:return n=e.sent,e.next=6,Object(d.b)([this._setGeometryFilter(n),this._setIdFilter(n),this._setAttributeFilter(n),this._setTimeFilter(n)]);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_setAttributeFilter",value:function(){var e=Object(a.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.where){e.next=2;break}return e.abrupt("return",(this._clause=null,void(this.where=null)));case 2:return e.next=4,I(t.where,this._serviceInfo.fieldsIndex);case 4:this._clause=e.sent,this.where=t.where;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setIdFilter",value:function(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}},{key:"_setGeometryFilter",value:function(){var e=Object(a.a)(i.a.mark((function e(t){var r,n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.geometry){e.next=2;break}return e.abrupt("return",(this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null)));case 2:return r=t.geometry,n=t.spatialRel||"esriSpatialRelIntersects",e.next=6,Object(y.g)(n,r,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);case 6:a=e.sent,Object(h.a)(this._geometryBounds,r),this._spatialQueryOperator=a,this.geometry=r,this.spatialRel=n;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setTimeFilter",value:function(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=Object(v.b)(this._serviceInfo.timeInfo,e.timeExtent,m.b);else{var t=new f.a("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);j.error(t)}}},{key:"_applyFilter",value:function(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}},{key:"_filterByExpression",value:function(e){return!this.where||this._clause(e)}},{key:"_filterById",value:function(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}},{key:"_filterByGeometry",value:function(e){if(!this.geometry)return!0;var t=e.readHydratedGeometry();return!!t&&this._spatialQueryOperator(t)}},{key:"_filterByTime",value:function(e){return!Object(c.i)(this._timeOperator)||this._timeOperator(e)}},{key:"_resetAllHiddenIds",value:function(){var e=this,t=[];return this._idToVisibility.forEach((function(r,n){1&r||(e._idToVisibility.set(n,1),t.push(n))})),t}}]),e}()}}]);
//# sourceMappingURL=85.6175d911.chunk.js.map