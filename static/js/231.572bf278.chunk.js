(this.webpackJsonpgeometries=this.webpackJsonpgeometries||[]).push([[231],{1195:function(e,t,i){"use strict";i.r(t);var a=i(9),s=i(32),n=i(12),r=i(3),c=i(5),o=i(6),h=i(2),l=i(0),p=(i(13),i(4)),d=(i(14),i(15),i(1)),v=i(8),u=(i(11),i(19),i(20),i(38)),y=i(103),f=(i(77),i(76)),b=i(118),m=i(75),_=i(56),g=i(30),O=i(40),k=i(400),x=i(369),G=i(1106),j=i(1118),w=function e(t,i,a){Object(h.a)(this,e),this.graphic=t,this.mover=i,this.selected=a,this.type="reshape-start"},S=function e(t,i,a){Object(h.a)(this,e),this.graphic=t,this.mover=i,this.selected=a,this.type="reshape"},H=function e(t,i,a){Object(h.a)(this,e),this.graphic=t,this.mover=i,this.selected=a,this.type="reshape-stop"},M=function e(t,i,a){Object(h.a)(this,e),this.mover=t,this.dx=i,this.dy=a,this.type="move-start"},E=function e(t,i,a){Object(h.a)(this,e),this.mover=t,this.dx=i,this.dy=a,this.type="move"},I=function e(t,i,a){Object(h.a)(this,e),this.mover=t,this.dx=i,this.dy=a,this.type="move-stop"},R=function e(t){Object(h.a)(this,e),this.added=t,this.type="vertex-select"},C=function e(t){Object(h.a)(this,e),this.removed=t,this.type="vertex-deselect"},V=function e(t,i,a,s){Object(h.a)(this,e),this.added=t,this.graphic=i,this.oldGraphic=a,this.vertices=s,this.type="vertex-add"},D=function e(t,i,a,s){Object(h.a)(this,e),this.removed=t,this.graphic=i,this.oldGraphic=a,this.vertices=s,this.type="vertex-remove"},A={removeVertex:["Backspace","Delete"]},z=j.a.reshapeGraphics,P={vertices:{default:new b.a({style:"circle",size:z.vertex.size,color:z.vertex.color,outline:{color:z.vertex.outlineColor,width:1}}),hover:new b.a({style:"circle",size:z.vertex.hoverSize,color:z.vertex.hoverColor,outline:{color:z.vertex.hoverOutlineColor,width:1}}),selected:new b.a({style:"circle",size:z.selected.size,color:z.selected.color,outline:{color:z.selected.outlineColor,width:1}})},midpoints:{default:new b.a({style:"circle",size:z.midpoint.size,color:z.midpoint.color,outline:{color:z.midpoint.outlineColor,width:1}}),hover:new b.a({style:"circle",size:z.midpoint.size,color:z.midpoint.color,outline:{color:z.midpoint.outlineColor,width:1}})}},L=function(e){Object(c.a)(i,e);var t=Object(o.a)(i);function i(e){var a;return Object(h.a)(this,i),(a=t.call(this,e))._handles=new _.a,a._graphicAttributes={esriSketchTool:"box"},a._mover=null,a._viewHandles=new _.a,a._totalDx=0,a._totalDy=0,a.callbacks={onReshapeStart:function(){},onReshape:function(){},onReshapeStop:function(){},onMoveStart:function(){},onMove:function(){},onMoveStop:function(){},onGraphicClick:function(){}},a.enableMidpoints=!0,a.graphic=null,a.handleGraphics=[],a.layer=null,a.midpointGraphics=[],a.midpointSymbol=new b.a({style:"circle",size:6,color:[200,200,200],outline:{color:[100,100,100],width:1}}),a.selectedHandles=[],a.type="reshape",a.view=null,a}return Object(r.a)(i,[{key:"initialize",value:function(){var e=this;this._setup(),this._handles.add([Object(g.j)(this,"view.ready",(function(){var t=e.layer,i=e.view;Object(x.a)(i,t),e._viewHandles.add([i.on("key-down",(function(t){return e._keyDownHandler(t)}),O.b.TOOL)])})),Object(g.c)(this,"graphic",(function(){return e.refresh()})),Object(g.c)(this,"layer",(function(t,i){i&&(e._clearSelection(),e._resetGraphics(i)),e.refresh()})),Object(g.c)(this,"enableMidpoints",(function(){e.refresh()}))])}},{key:"destroy",value:function(){this._reset(),this._mover&&this._mover.destroy(),this._mover=null,this._handles.removeAll(),this._handles=null,this._viewHandles.removeAll(),this._viewHandles=null}},{key:"state",get:function(){var e=!!this.get("view.ready"),t=!(!this.get("graphic")||!this.get("layer"));return e&&t?"active":e?"ready":"disabled"}},{key:"symbols",set:function(e){var t=e||{},i=t.midpoints,a=void 0===i?P.midpoints:i,s=t.vertices,n=void 0===s?P.vertices:s;this._set("symbols",{midpoints:a,vertices:n})}},{key:"isUIGraphic",value:function(e){var t=[];return this.graphic&&t.push(this.graphic),t.concat(this.handleGraphics,this.midpointGraphics),t.length&&t.includes(e)}},{key:"refresh",value:function(){this._reset(),this._setup()}},{key:"reset",value:function(){this.graphic=null}},{key:"clearSelection",value:function(){this._clearSelection()}},{key:"removeSelectedHandles",value:function(){this.selectedHandles.length&&this._removeVertex(this.selectedHandles)}},{key:"_setup",value:function(){this.graphic&&this.layer&&(this._setupGraphics(),this._setupMover())}},{key:"_reset",value:function(){this._clearSelection(),this._resetGraphicStateVars(),this._resetGraphics(),this._mover&&this._mover.destroy(),this._mover=null,this.view.cursor="default"}},{key:"_resetGraphicStateVars",value:function(){this._totalDx=0,this._totalDy=0}},{key:"_resetGraphics",value:function(e){var t=e||this.layer;t&&(t.removeMany(this.handleGraphics),t.removeMany(this.midpointGraphics)),this.handleGraphics.forEach((function(e){return e.destroy()})),this.midpointGraphics.forEach((function(e){return e.destroy()})),this._set("handleGraphics",[]),this._set("midpointGraphics",[]),this._set("selectedHandles",[])}},{key:"_setupGraphics",value:function(){var e=Object(p.o)(this.graphic.geometry),t=Object(y.b)(e.clone());if("polygon"===e.type){var i,a=Object(n.a)(t);try{for(a.s();!(i=a.n()).done;){var s=i.value,r=s[s.length-1];s[0][0]===r[0]&&s[0][1]===r[1]&&s.length>2&&s.pop()}}catch(c){a.e(c)}finally{a.f()}}this._set("handleGraphics",this._createHandleGraphics(t)),this.enableMidpoints&&this._set("midpointGraphics",this._createMidpointGraphics(t)),this._saveRelatedIndices(this.handleGraphics),this.layer.addMany(this.midpointGraphics),this.layer.addMany(this.handleGraphics)}},{key:"_createHandleGraphics",value:function(e){var t=this._graphicAttributes,i=this.symbols,n=this.view.spatialReference,r=[];return null==e||e.forEach((function(e,c){e.forEach((function(e,o){var h,l=Object(s.a)(e,2),p=l[0],d=l[1];r.push(new m.a({geometry:new u.a({x:p,y:d,spatialReference:n}),symbol:null==i||null==(h=i.vertices)?void 0:h.default,attributes:Object(a.a)(Object(a.a)({},t),{},{pathIndex:c,pointIndex:o})}))}))})),r}},{key:"_createMidpointGraphics",value:function(e){var t=this,i=this._graphicAttributes,n=this.symbols,r=this.view.spatialReference,c=[];return null==e||e.forEach((function(e,o){e.forEach((function(h,l){var d=Object(s.a)(h,2),v=d[0],f=d[1],b=e[l+1]?l+1:0;if("polygon"===Object(p.g)(t.graphic.geometry,"type")||0!==b){var _=Object(s.a)(e[b],2),g=_[0],O=_[1],k=Object(y.d)([v,f],[g,O]),x=Object(s.a)(k,2),G=x[0],j=x[1];c.push(new m.a({geometry:new u.a({x:G,y:j,spatialReference:r}),symbol:n.midpoints.default,attributes:Object(a.a)(Object(a.a)({},i),{},{pathIndex:o,pointIndexStart:l,pointIndexEnd:b})}))}}))})),c}},{key:"_saveRelatedIndices",value:function(e){if(e)for(var t=e.map((function(e){var t=e.geometry;return{x:t.x,y:t.y}})),i=0;i<t.length;i++){for(var a=[],s=0;s<t.length;s++)if(i!==s){var n=t[i],r=t[s];n.x===r.x&&n.y===r.y&&a.push(s)}e[i].attributes.relatedGraphicIndices=a}}},{key:"_setupMover",value:function(){var e=this;this._mover=new G.default({enableMoveAllGraphics:!1,graphics:[].concat(this.handleGraphics,this.midpointGraphics,this.graphic),view:this.view,callbacks:{onGraphicClick:function(t){return e._onGraphicClickCallback(t)},onGraphicMoveStart:function(t){return e._onGraphicMoveStartCallback(t)},onGraphicMove:function(t){return e._onGraphicMoveCallback(t)},onGraphicMoveStop:function(t){return e._onGraphicMoveStopCallback(t)},onGraphicPointerOver:function(t){return e._onGraphicPointerOverCallback(t)},onGraphicPointerOut:function(t){return e._onGraphicPointerOutCallback(t)}}})}},{key:"_onGraphicClickCallback",value:function(e){e.viewEvent.stopPropagation();var t=e.graphic;if(t===this.graphic)this.clearSelection(),this.emit("graphic-click",e),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(e);else if(this._isMidpoint(t)){if(2===e.viewEvent.button)return;var i=this.graphic.clone(),a=this._createHandleFromMidpoint(t);this.refresh(),this._emitVertexAddEvent([t],i,a)}else this._isHandle(t)&&(e.viewEvent.stopPropagation(),2===e.viewEvent.button?this._removeVertex(t):(e.viewEvent.native.shiftKey||this._clearSelection(),this.selectedHandles.includes(t)?this._removeFromSelection(t,!0):this._addToSelection(t)))}},{key:"_onGraphicMoveStartCallback",value:function(e){var t=e.graphic;if(this._resetGraphicStateVars(),t===this.graphic){var i=e.dx,a=e.dy;return this.handleGraphics.forEach((function(e){return e.visible=!1})),this.midpointGraphics.forEach((function(e){return e.visible=!1})),this._clearSelection(),void this._emitMoveStartEvent(i,a)}if(this._isMidpoint(t)){this._clearSelection();var s=this.graphic.clone(),n=this._createHandleFromMidpoint(t);this._emitVertexAddEvent([t],s,n),this._addToSelection(t)}else this.selectedHandles.includes(t)||(this._clearSelection(),this._addToSelection(t));this._emitReshapeStartEvent(t)}},{key:"_onGraphicMoveCallback",value:function(e){var t=e.graphic,i=e.dx,a=e.dy;this._totalDx+=i,this._totalDy+=a,t===this.graphic?this._emitMoveEvent(i,a):(this._syncGeometryAfterHandleMove(t,i,a),this._emitReshapeEvent(t))}},{key:"_onGraphicMoveStopCallback",value:function(e){var t=e.graphic,i=e.dx,a=e.dy;if(this._totalDx+=i,this._totalDy+=a,t===this.graphic){var s,r=Object(n.a)([].concat(this.handleGraphics,this.midpointGraphics));try{for(r.s();!(s=r.n()).done;){s.value.visible=!0}}catch(c){r.e(c)}finally{r.f()}this._syncGraphicsWithGeometry(),this._emitMoveStopEvent()}else this._syncGeometryAfterHandleMove(t,i,a),this._isMidpoint(t)&&this.refresh(),this._emitReshapeStopEvent(t);this._resetGraphicStateVars()}},{key:"_syncGraphicsWithGeometry",value:function(){var e=this.graphic.geometry,t="polyline"===e.type?e.paths:e.rings;this._updateHandleGraphicLocations(t),this._updateMidpointGraphicLocations(t)}},{key:"_updateHandleGraphicLocations",value:function(e){var t,i=Object(n.a)(this.handleGraphics);try{for(i.s();!(t=i.n()).done;){var a=t.value,r=a.attributes,c=r.pathIndex,o=r.pointIndex,h=Object(s.a)(e[c][o],2),l=h[0],p=h[1];a.set("geometry",new u.a(l,p,this.view.spatialReference))}}catch(d){i.e(d)}finally{i.f()}}},{key:"_updateMidpointGraphicLocations",value:function(e){var t,i=Object(n.a)(this.midpointGraphics);try{for(i.s();!(t=i.n()).done;){var a=t.value,r=a.attributes,c=r.pathIndex,o=r.pointIndexStart,h=r.pointIndexEnd,l=Object(s.a)(e[c][o],2),p=l[0],d=l[1],v=Object(s.a)(e[c][h],2),f=v[0],b=v[1],m=Object(y.d)([p,d],[f,b]),_=Object(s.a)(m,2),g=_[0],O=_[1];a.geometry=new u.a({x:g,y:O,spatialReference:this.view.spatialReference})}}catch(k){i.e(k)}finally{i.f()}}},{key:"_syncGeometryAfterHandleMove",value:function(e,t,i){var a=Object(p.o)(this.graphic.geometry).clone(),s="polyline"===a.type?a.paths:a.rings,r=e.attributes,c=r.pathIndex,o=r.pointIndex,h=e.geometry,l=h.x,d=h.y,v=s[c].length-1;if(s[c][o]=[l,d],"polygon"===a.type&&(0===o?s[c][v]=[l,d]:o===v&&(s[c][0]=[l,d])),this._isHandle(e)){var u,y=e.attributes.relatedGraphicIndices,f=Object(n.a)(y);try{for(f.s();!(u=f.n()).done;){var b=u.value,m=this.handleGraphics[b],_=m.attributes,g=_.pathIndex,O=_.pointIndex;s[g][O]=[l,d],m.geometry=e.geometry}}catch(L){f.e(L)}finally{f.f()}var x,G=Object(n.a)(this.selectedHandles);try{for(G.s();!(x=G.n()).done;){var j=x.value;if(j!==e){var w=j.attributes,S=w.pathIndex,H=w.pointIndex,M=w.relatedGraphicIndices,E=Object(k.a)(j.geometry,t,i,this.view),I=s[S].length-1;s[S][H]=[E.x,E.y],j.geometry=E,"polygon"===a.type&&(0===H?s[S][I]=[E.x,E.y]:H===I&&(s[S][0]=[E.x,E.y]));var R,C=Object(n.a)(M);try{for(C.s();!(R=C.n()).done;){var V=R.value,D=this.handleGraphics[V],A=D.attributes,z=A.pathIndex,P=A.pointIndex;s[z][P]=[E.x,E.y],D.geometry=E}}catch(L){C.e(L)}finally{C.f()}}}}catch(L){G.e(L)}finally{G.f()}this._updateMidpointGraphicLocations(s)}this.graphic.geometry=a}},{key:"_onGraphicPointerOverCallback",value:function(e){var t=e.graphic;this._isHandle(t)&&!this._isSelected(t)&&(t.symbol=this.symbols.vertices.hover),this._updateHoverCursor(t)}},{key:"_onGraphicPointerOutCallback",value:function(e){var t=e.graphic;this._isHandle(t)&&!this._isSelected(t)&&(t.symbol=this.symbols.vertices.default),this.view.cursor="default"}},{key:"_createHandleFromMidpoint",value:function(e){var t=this._graphicAttributes,i=[],s=Object(p.o)(this.graphic.geometry).clone(),n=e.attributes,r=n.pathIndex,c=n.pointIndexStart,o=n.pointIndexEnd,h=e.geometry,l=h.x,d=h.y,v=0===o?c+1:o,u="polyline"===s.type?s.paths:s.rings;return u[r].splice(v,0,[l,d]),e.attributes=Object(a.a)(Object(a.a)({},t),{},{pathIndex:r,pointIndex:v,relatedGraphicIndices:[]}),i.push({coordinates:u[r][v],componentIndex:r,vertexIndex:v}),this.graphic.geometry=s,i}},{key:"_removeHandles",value:function(e){var t=Object(p.o)(this.graphic.geometry).clone(),i="polygon"===t.type?t.rings:t.paths,a=[];e instanceof m.a&&(e=[e]);var r,c=Object(n.a)(e);try{for(c.s();!(r=c.n()).done;)for(var o=r.value.geometry,h=o.x,l=o.y,d=0;d<i.length;d++)for(var v=i[d],u=0;u<v.length;u++){var y=Object(s.a)(v[u],2),f=y[0],b=y[1];h===f&&l===b&&(a.push({coordinates:i[d][u],componentIndex:d,vertexIndex:u}),i[d].splice(Number(u),1))}}catch(I){c.e(I)}finally{c.f()}if("polygon"===t.type){var _,g=Object(n.a)(i);try{for(g.s();!(_=g.n()).done;){var O=_.value,k=Object(s.a)(O[0],2),x=k[0],G=k[1],j=Object(s.a)(O[O.length-1],2),w=j[0],S=j[1];(1===O.length||O.length<3&&x===w&&G===S)&&i.splice(i.indexOf(O),1),O.length>2&&(x!==w||G!==S)&&O.push(O[0])}}catch(I){g.e(I)}finally{g.f()}}else{var H,M=Object(n.a)(i);try{for(M.s();!(H=M.n()).done;){var E=H.value;1===E.length&&i.splice(i.indexOf(E),1)}}catch(I){M.e(I)}finally{M.f()}}return this.graphic.geometry=t,a}},{key:"_addToSelection",value:function(e){e instanceof m.a&&(e=[e]);var t,i=Object(n.a)(e);try{for(i.s();!(t=i.n()).done;){t.value.symbol=this.symbols.vertices.selected}}catch(a){i.e(a)}finally{i.f()}this._set("selectedHandles",this.selectedHandles.concat(e)),this._emitSelectEvent(e)}},{key:"_removeFromSelection",value:function(e,t){var i=this.symbols.vertices,a=t?i.hover:i.default;e instanceof m.a&&(e=[e]);var s,r=Object(n.a)(e);try{for(r.s();!(s=r.n()).done;){var c=s.value;this.selectedHandles.splice(this.selectedHandles.indexOf(c),1),this._set("selectedHandles",this.selectedHandles),c.set("symbol",a)}}catch(o){r.e(o)}finally{r.f()}this._emitDeselectEvent(e)}},{key:"_clearSelection",value:function(){if(this.selectedHandles.length){var e,t=this.selectedHandles,i=Object(n.a)(this.selectedHandles);try{for(i.s();!(e=i.n()).done;){e.value.set("symbol",this.symbols.vertices.default)}}catch(a){i.e(a)}finally{i.f()}this._set("selectedHandles",[]),this._emitDeselectEvent(t)}}},{key:"_keyDownHandler",value:function(e){A.removeVertex.includes(e.key)&&!e.repeat&&this.selectedHandles.length&&this._removeVertex(this.selectedHandles)}},{key:"_removeVertex",value:function(e){if(!("polygon"===this.graphic.geometry.type&&this.handleGraphics.length<4||this.handleGraphics.length<3)){var t=this.graphic.clone();e instanceof m.a&&(e=[e]);var i=this._removeHandles(e);this.refresh(),this._emitVertexRemoveEvent(e,t,i)}}},{key:"_isHandle",value:function(e){return this.handleGraphics.includes(e)}},{key:"_isSelected",value:function(e){return this._isHandle(e)&&this.selectedHandles.includes(e)}},{key:"_isMidpoint",value:function(e){return this.midpointGraphics.includes(e)}},{key:"_updateHoverCursor",value:function(e){this.view.cursor=this._isMidpoint(e)?"copy":"move"}},{key:"_emitMoveStartEvent",value:function(e,t){var i=new M(this.graphic,e,t);this.emit("move-start",i),this.callbacks.onMoveStart&&this.callbacks.onMoveStart(i)}},{key:"_emitMoveEvent",value:function(e,t){var i=new E(this.graphic,e,t);this.emit("move",i),this.callbacks.onMove&&this.callbacks.onMove(i)}},{key:"_emitMoveStopEvent",value:function(){var e=new I(this.graphic,this._totalDx,this._totalDy);this.emit("move-stop",e),this.callbacks.onMoveStop&&this.callbacks.onMoveStop(e)}},{key:"_emitReshapeStartEvent",value:function(e){var t=new w(this.graphic,e,this.selectedHandles);this.emit("reshape-start",t),this.callbacks.onReshapeStart&&this.callbacks.onReshapeStart(t)}},{key:"_emitReshapeEvent",value:function(e){var t=new S(this.graphic,e,this.selectedHandles);this.emit("reshape",t),this.callbacks.onReshape&&this.callbacks.onReshape(t)}},{key:"_emitReshapeStopEvent",value:function(e){var t=new H(this.graphic,e,this.selectedHandles);this.emit("reshape-stop",t),this.callbacks.onReshapeStop&&this.callbacks.onReshapeStop(t)}},{key:"_emitSelectEvent",value:function(e){var t=new R(e);this.emit("select",t),this.callbacks.onVertexSelect&&this.callbacks.onVertexSelect(t)}},{key:"_emitDeselectEvent",value:function(e){var t=new C(e);this.emit("deselect",t),this.callbacks.onVertexDeselect&&this.callbacks.onVertexDeselect(t)}},{key:"_emitVertexAddEvent",value:function(e,t,i){var a=new V(e,this.graphic,t,i);this.emit("vertex-add",a),this.callbacks.onVertexAdd&&this.callbacks.onVertexAdd(a)}},{key:"_emitVertexRemoveEvent",value:function(e,t,i){var a=new D(e,this.graphic,t,i);this.emit("vertex-remove",a),this.callbacks.onVertexRemove&&this.callbacks.onVertexRemove(a)}}]),i}(f.a.EventedAccessor);Object(l.a)([Object(d.b)()],L.prototype,"callbacks",void 0),Object(l.a)([Object(d.b)()],L.prototype,"enableMidpoints",void 0),Object(l.a)([Object(d.b)()],L.prototype,"graphic",void 0),Object(l.a)([Object(d.b)({readOnly:!0})],L.prototype,"handleGraphics",void 0),Object(l.a)([Object(d.b)()],L.prototype,"layer",void 0),Object(l.a)([Object(d.b)({readOnly:!0})],L.prototype,"midpointGraphics",void 0),Object(l.a)([Object(d.b)()],L.prototype,"midpointSymbol",void 0),Object(l.a)([Object(d.b)({readOnly:!0})],L.prototype,"selectedHandles",void 0),Object(l.a)([Object(d.b)({dependsOn:["view.ready","graphic","layer"],readOnly:!0})],L.prototype,"state",null),Object(l.a)([Object(d.b)({value:P})],L.prototype,"symbols",null),Object(l.a)([Object(d.b)({readOnly:!0})],L.prototype,"type",void 0),Object(l.a)([Object(d.b)()],L.prototype,"view",void 0);var T=L=Object(l.a)([Object(v.a)("esri.views.draw.support.Reshape")],L);t.default=T}}]);
//# sourceMappingURL=231.572bf278.chunk.js.map