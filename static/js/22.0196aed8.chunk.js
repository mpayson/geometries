(this.webpackJsonpgeometries=this.webpackJsonpgeometries||[]).push([[22],{1138:function(e,t,r){"use strict";r.r(t);var n,i=r(12),a=r(9),s=r(10),u=r.n(s),c=r(21),o=r(2),l=r(3),p=r(34),d=r(5),f=r(6),b=r(0),h=(r(13),r(24)),y=r(4),v=r(14),O=(r(15),r(1)),j=r(8),m=r(23),g=(r(11),r(19),r(20),r(133)),x=r(16),w=r(62),k=r(77),_=r(41),S=r(75),R=n=function(e){Object(d.a)(r,e);var t=Object(f.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).isAggregate=!0,e}return Object(l.a)(r,[{key:"getEffectivePopupTemplate",value:function(){if(this.popupTemplate)return this.popupTemplate;var e=this.sourceLayer&&this.sourceLayer.featureReduction;return e&&"popupTemplate"in e&&e.popupEnabled?e.popupTemplate:null}},{key:"getObjectId",value:function(){return this.objectId}},{key:"clone",value:function(){return new n(Object(a.a)({objectId:this.objectId},this.cloneProperties()))}}]),r}(S.a);Object(b.a)([Object(O.b)({type:Boolean})],R.prototype,"isAggregate",void 0),Object(b.a)([Object(O.b)({type:Number,json:{read:!0}})],R.prototype,"objectId",void 0);var E,I=R=n=Object(b.a)([Object(j.a)("esri.AggregateGraphic")],R),F=r(30),V=r(363),z=r(278),M=r(318),T=r(780),q=r(388),P=r(830),U=r(897),C=r(917),N=r(979),L=r(1127),A=r(953),D=r(838),H=r(50),G=r(47),J=r(28),B=r(59),W=r(305),Q=new H.a({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),X=new H.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),$=E=function(e){Object(d.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).where=null,n.geometry=null,n.spatialRelationship="intersects",n.hiddenIds=new Set,n.distance=void 0,n.objectIds=null,n.units=null,n.timeExtent=null,n.enabled=!1,n}return Object(l.a)(r,[{key:"writeWhere",value:function(e,t){t.where=e||"1=1"}},{key:"enable",value:function(){this._set("enabled",!0)}},{key:"createQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.where,r=this.geometry,n=this.spatialRelationship,i=this.timeExtent,s=this.objectIds,u=this.units,c=this.distance;return new z.a(Object(a.a)({geometry:Object(h.a)(r),objectIds:Object(h.a)(s),spatialRelationship:n,timeExtent:Object(h.a)(i),where:t,units:u,distance:c},e))}},{key:"clone",value:function(){var e=this.where,t=this.geometry,r=this.spatialRelationship,n=this.hiddenIds,i=this.timeExtent,a=this.objectIds,s=this.units,u=this.distance,c=new Set;return n.forEach((function(e){return c.add(e)})),new E({geometry:Object(h.a)(t),hiddenIds:c,objectIds:Object(h.a)(a),spatialRelationship:r,timeExtent:Object(h.a)(i),where:e,units:s,distance:u})}}]),r}(J.a);Object(b.a)([Object(O.b)({type:String})],$.prototype,"where",void 0),Object(b.a)([Object(G.a)("where")],$.prototype,"writeWhere",null),Object(b.a)([Object(O.b)({types:k.a,json:{read:B.a,write:!0}})],$.prototype,"geometry",void 0),Object(b.a)([Object(O.b)({type:String,json:{read:{source:"spatialRel",reader:Q.read},write:{target:"spatialRel",writer:Q.write}}})],$.prototype,"spatialRelationship",void 0),Object(b.a)([Object(O.b)({json:{write:function(e,t,r){return t[r]=Array.from(e)},read:function(e){return new Set(e)}}})],$.prototype,"hiddenIds",void 0),Object(b.a)([Object(O.b)({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],$.prototype,"distance",void 0),Object(b.a)([Object(O.b)({type:[Number],json:{write:!0}})],$.prototype,"objectIds",void 0),Object(b.a)([Object(O.b)({type:String,json:{read:X.read,write:{writer:X.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],$.prototype,"units",void 0),Object(b.a)([Object(O.b)({type:W.a,json:{write:!0}})],$.prototype,"timeExtent",void 0),Object(b.a)([Object(O.b)({readOnly:!0})],$.prototype,"enabled",void 0);var K,Z=$=E=Object(b.a)([Object(j.a)("esri.views.layers.support.FeatureFilter")],$),Y=K=function(e){Object(d.a)(r,e);var t=Object(f.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).filter=null,e.includedEffect=null,e.excludedEffect=null,e.excludedLabelsVisible=!1,e}return Object(l.a)(r,[{key:"clone",value:function(){return new K({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}}]),r}(J.a);Object(b.a)([Object(O.b)({type:Z,json:{write:!0}})],Y.prototype,"filter",void 0),Object(b.a)([Object(O.b)({json:{write:!0}})],Y.prototype,"includedEffect",void 0),Object(b.a)([Object(O.b)({json:{write:!0}})],Y.prototype,"excludedEffect",void 0),Object(b.a)([Object(O.b)({type:Boolean,json:{write:!0}})],Y.prototype,"excludedLabelsVisible",void 0);var ee=Y=K=Object(b.a)([Object(j.a)("esri.views.layers.support.FeatureEffect")],Y),te=r(37),re=r(61),ne=r(55),ie=r(245),ae=r(157),se=r(788),ue=r(955),ce=v.a.getLogger("esri.views.layers.FeatureLayerView"),oe=r(831);function le(e,t){return pe.apply(this,arguments)}function pe(){return(pe=Object(c.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:e.t0=t.type,e.next="class-breaks"===e.t0||"simple"===e.t0||"unique-value"===e.t0||"dot-density"===e.t0||"dictionary"===e.t0?5:"heatmap"===e.t0?10:15;break;case 5:return e.next=7,Promise.all([r.e(1),r.e(67)]).then(r.bind(null,1314));case 7:return e.t1=e.sent.default,e.t2=n,e.abrupt("return",new e.t1(e.t2));case 10:return e.next=12,Promise.all([r.e(1),r.e(74)]).then(r.bind(null,1315));case 12:return e.t3=e.sent.default,e.t4=n,e.abrupt("return",new e.t3(e.t4));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var de=r(36),fe=r(899),be=r(877),he=r(822),ye={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1};function ve(e,t,r){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(c.a)(u.a.mark((function e(t,r,n){var a,s,c,o,l,p,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&(!n||"cluster"!==n.type)){e.next=2;break}return e.abrupt("return",0);case 2:if("heatmap"!==t.type){e.next=4;break}return e.abrupt("return",Math.round(3*t.blurRadius));case 4:if("dot-density"!==t.type){e.next=6;break}return e.abrupt("return",0);case 6:if("dictionary"!==t.type){e.next=8;break}return e.abrupt("return","esriGeometryPoint"===r||"esriGeometryMultipoint"===r?100:200);case 8:a=t.getSymbols(),s=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];return"stops"===r.transformationType?r.stops.map((function(e){return e.size})).reduce(Re,0):"clamped-linear"===r.transformationType?"number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((function(e){return e.size})).reduce(Re,0):"real-world-size"===r.transformationType?30:void 0}(t),c=[],o=Object(i.a)(a);try{for(o.s();!(l=o.n()).done;)p=l.value,c.push(ke(p,s))}catch(u){o.e(u)}finally{o.f()}return e.next=13,Object(x.b)(c);case 13:return d=e.sent,e.abrupt("return",Object(de.g)(d.reduce(Re,0)));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var je=[0,0,0,0];function me(e,t){return null==e?t:e}var ge={sdf:!0,code:99,metrics:T.c.metrics,rect:new fe.a(0,0,24,24),page:0,textureBinding:2};function xe(e,t){return we.apply(this,arguments)}function we(){return(we=Object(c.a)(u.a.mark((function e(t,r){var n,i,s,c,o,l,p,d,f,b,h,y;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("simple-marker"!==t.type){e.next=3;break}return n=Math.max(me(t.size,12),r),e.abrupt("return",Se(t)+.707*n);case 3:if("picture-marker"!==t.type){e.next=6;break}return i=Math.max(me(t.height,12),r),s=me(t.width,12)*(i/me(t.height,12))/2,c=i/2,e.abrupt("return",Se(t)+Math.sqrt(s*s+c*c));case 6:if("text"!==t.type){e.next=11;break}return o=function(e){var t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[ge]};for(var r=[],n=0;n<t;n++)r.push(Object(a.a)(Object(a.a)({},ge),{},{code:e.text.charCodeAt(n)}));return{glyphMosaicItems:r}}(t),Object(he.e)(je,t.toJSON(),o),l=Math.abs(je[0]),p=Math.abs(je[1]),d=je[2],f=je[3],e.abrupt("return",Math.max(l,p)+Math.max(d,f));case 11:if("simple-line"!==t.type){e.next=14;break}return b=t,h=Math.max(me(b.width,.75),r)/2,e.abrupt("return",b.marker?Math.max(6*b.width,2*r):h);case 14:if("simple-fill"!==t.type&&"picture-fill"!==t.type){e.next=16;break}return e.abrupt("return",Math.max(function(e,t){return null==e.outline?0:me(e.outline.width,0)}(t),r)/2);case 16:if("cim"!==t.type){e.next=19;break}return y=be.a.getEnvelope(t.data),e.abrupt("return",y?Math.sqrt(y.width*y.width+y.height*y.height):0);case 19:if("web-style"!==t.type){e.next=28;break}return e.t1=xe,e.next=23,t.fetchCIMSymbol();case 23:e.t2=e.sent,e.t3=r,e.t0=(0,e.t1)(e.t2,e.t3),e.next=29;break;case 28:e.t0=0;case 29:return e.abrupt("return",e.t0);case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(e,t){return _e.apply(this,arguments)}function _e(){return(_e=Object(c.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!function(e){return e.type in ye}(t)){e.next=8;break}return e.t1=Math,e.next=4,xe(t,r);case 4:e.t2=e.sent,e.t0=e.t1.min.call(e.t1,e.t2,75),e.next=9;break;case 8:e.t0=0;case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Se(e){var t=me(e.xoffset,0),r=me(e.yoffset,0);return Math.sqrt(t*t+r*r)}function Re(e,t){return Math.max(e,t)}var Ee=r(213),Ie=r(384),Fe=function(e){Object(d.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e))._startupResolver=Object(x.g)(),n.isReady=!1,n}return Object(l.a)(r,[{key:"initialize",value:function(){this._controller=Object(x.d)(),this.addResolvingPromise(this._startWorker(this._controller.signal))}},{key:"destroy",value:function(){this._controller.abort(),this._connection&&this._connection.close()}},{key:"tileRenderer",set:function(e){this.client.tileRenderer=e}},{key:"closed",get:function(){return this._connection.closed}},{key:"startup",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r,n){var i,a,s,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.when();case 2:return i=this._controller.signal,s=n.source,a=Array.isArray(s)?{transferList:n.source,signal:i}:void 0,c={service:n,config:r,tileInfo:t.tileInfo.toJSON()},e.next=6,this._connection.invoke("startup",c,a);case 6:this._startupResolver.resolve(),this._set("isReady",!0);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"updateTiles",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(x.m)(this._connection.invoke("updateTiles",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={config:t,pause:r},e.next=3,this._startupResolver.promise;case 3:return e.abrupt("return",this._connection.invoke("update",n));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"invalidate",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("invalidate",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"resume",value:function(){var e=Object(c.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(x.m)(this._connection.invoke("controller.resume")));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setHighlight",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(x.m)(this._connection.invoke("controller.setHighlight",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=Object(c.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(x.m)(this._connection.invoke("controller.refresh")));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setViewState",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(x.m)(this._connection.invoke("setViewState",t.toJSON())));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryFeatures",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryObjectIds",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryObjectIds",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryFeatureCount",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryExtent",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._connection.invoke("controller.queryExtent",t.toJSON(),r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryLatestObservations",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryLatestObservations",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryStatistics",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryStatistics",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getObjectId",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getObjectId",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDisplayId",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getDisplayId",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeature",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getFeature",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAggregate",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getAggregate",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAggregateValueRanges",value:function(){var e=Object(c.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getAggregateValueRanges"));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"mapValidDisplayIds",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.mapValidDisplayIds",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEdits",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var r,n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return r=t.addedFeatures,n=t.deletedFeatures,i=t.updatedFeatures,e.abrupt("return",Object(x.m)(this._connection.invoke("controller.onEdits",{addedFeatures:r,deletedFeatures:n,updatedFeatures:i})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"enableEvent",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(x.m)(this._connection.invoke("controller.enableEvent",{name:t,value:r})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_startWorker",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(Ie.b)("Pipeline",{client:this.client,strategy:"dedicated",signal:t});case 3:this._connection=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),Object(x.x)(e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(Ee.a);Object(b.a)([Object(O.b)()],Fe.prototype,"isReady",void 0),Object(b.a)([Object(O.b)()],Fe.prototype,"client",void 0),Object(b.a)([Object(O.b)()],Fe.prototype,"tileRenderer",null);var Ve=Fe=Object(b.a)([Object(j.a)("esri.views.2d.layers.support.FeatureLayerProxy")],Fe),ze=r(230),Me=r(284),Te=function(){function e(t){Object(o.a)(this,e),this._tiles=new Map,this.buffer=0,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this.buffer=t.buffer}return Object(l.a)(e,[{key:"destroy",value:function(){}},{key:"clear",value:function(){var e=this;this._tiles.forEach((function(t){return e._releaseTile(t)}))}},{key:"tileKeys",value:function(){var e=[];return this._tiles.forEach((function(t,r){return e.push(r)})),e}},{key:"update",value:function(e){var t,r=this,n=this.tileInfoView.getTileCoverage(e.state,this.buffer,"closest"),a=n.spans,s=n.lodInfo,u=s.level,c=[],o=[],l=new Set,p=new Set,d=Object(i.a)(a);try{for(d.s();!(t=d.n()).done;)for(var f=t.value,b=f.row,h=f.colFrom,y=f.colTo,v=h;v<=y;v++){var O=ze.a.getId(u,b,s.normalizeCol(v),s.getWorldForColumn(v)),j=this._getOrAcquireTile(c,O);l.add(O),j.isReady?j.visible=!0:p.add(j.key)}}catch(m){d.e(m)}finally{d.f()}return p.forEach((function(e){return r._addPlaceholders(l,e)})),this._tiles.forEach((function(e){l.has(e.key.id)||(o.push(e.key.id),r._releaseTile(e))})),Me.a.pool.release(n),{hasMissingTiles:p.size>0,added:c,removed:o}}},{key:"_getOrAcquireTile",value:function(e,t){if(!this._tiles.has(t)){var r=this.acquireTile(new ze.a(t));e.push(t),this._tiles.set(t,r),r.visible=!1}return this._tiles.get(t)}},{key:"_getTile",value:function(e){return this._tiles.get(e)}},{key:"_releaseTile",value:function(e){this._tiles.delete(e.key.id),this.releaseTile(e)}},{key:"_addPlaceholders",value:function(e,t){var r=this._addPlaceholderChildren(e,t);Math.abs(1-r)<1e-6||this._addPlaceholderParent(e,t)||(this._getTile(t.id).visible=!0)}},{key:"_addPlaceholderChildren",value:function(e,t){var r=this,n=0;return this._tiles.forEach((function(i){n+=r._addPlaceholderChild(e,i,t)})),n}},{key:"_addPlaceholderChild",value:function(e,t,r){return t.key.level<=r.level||!t.hasData||!r.contains(t.key)?0:(t.visible=!0,e.add(t.key.id),1/(1<<2*(t.key.level-r.level)))}},{key:"_addPlaceholderParent",value:function(e,t){for(var r=t.getParentKey(),n=0,i=null;Object(y.i)(r);){if(e.has(r.id))return!0;var a=this._getTile(r.id);if(null!=a&&a.isReady)return a.visible=!0,e.add(a.key.id),!0;null!=a&&a.hasData&&a.patchCount>n&&(n=a.patchCount,i=a),r=r.getParentKey()}return!!i&&(i.visible=!0,e.add(i.key.id),!0)}}]),e}(),qe=v.a.getLogger("esri.views.2d.layers.FeatureLayerView2D"),Pe=function(e){Object(d.a)(r,e);var t=Object(f.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments))._pipelineIsUpdating=!0,e._updatingPipelineConfig=!1,e._onGoingEdits=0,e._isRefreshing=!1,e._viewStateId=-1,e._visibilityOverrides=new Set,e._effect=null,e._highlightIds=new Map,e._lastPixelBuffer=0,e.filter=null,e.effectLists={included:new L.a,excluded:new L.a},e.doRefresh=Object(x.i)(Object(c.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._onGoingEdits=0,t.t0=e.isUpdating(),!t.t0){t.next=5;break}return t.next=5,Object(F.g)(Object(p.a)(e),"updating");case 5:return t.prev=5,e._set("_isRefreshing",!0),e._lockGPUUploads(),t.next=10,e._proxy.refresh();case 10:e._unlockGPUUploads(),e._set("_isRefreshing",!1),t.next=17;break;case 14:t.prev=14,t.t1=t.catch(5),Object(x.n)(t.t1)||qe.error(t.t1);case 17:case"end":return t.stop()}}),t,null,[[5,14]])})))),e._doUpdate=Object(x.i)(Object(c.a)(u.a.mark((function t(){var r,n,i,s,c,o,l,d,f,b,h,v,O,j,m;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.destroyed&&e._hasRequiredSupport(e.layer)){t.next=2;break}return t.abrupt("return");case 2:return e._set("_updatingPipelineConfig",!0),t.next=5,Object(F.g)(Object(p.a)(e),"_isRefreshing");case 5:return r=Object(p.a)(e),n=r.effect,i=r.filter,t.next=8,e._updateRequiredFields();case 8:if(!e.destroyed){t.next=10;break}return t.abrupt("return");case 10:return s=e._getEffectiveRenderer(),c=s.renderer,e._set("_effectiveRenderer",c),o="feature"===e.layer.type?e.layer.historicMoment:null,l="feature"===e.layer.type?e.layer.gdbVersion:null,d={renderer:e.layer.renderer,spatialReference:e.layer.spatialReference,timeExtent:e.layer.timeExtent,definitionExpression:e.layer.definitionExpression,featureReduction:e.layer.featureReduction,fields:e.layer.fields,geometryType:e.layer.geometryType,historicMoment:o,labelsVisible:e.layer.labelsVisible,labelingInfo:e.layer.labelingInfo,availableFields:e.availableFields,effect:e.effect,filter:e.filter,gdbVersion:l,pixelBuffer:0},f=Object(A.a)(e.layer.geometryType),t.next=18,ve(c,f,e.layer.featureReduction);case 18:if(b=t.sent,h=e._createConfiguration(d,i,n),e._lastPixelBuffer=0===b?0:Math.max(b,e._lastPixelBuffer),h.schema.source.pixelBuffer=e._lastPixelBuffer,v=e._createTileRendererHash(c),e.destroyed){t.next=99;break}if(v===e._tileRendererHash){t.next=54;break}return t.next=26,e._initTileRenderer(c);case 26:if(!e.destroyed){t.next=28;break}return t.abrupt("return");case 28:return t.next=30,e._createServiceOptions();case 30:if(O=t.sent,!e.destroyed){t.next=33;break}return t.abrupt("return");case 33:return e.effects.forEach((function(e){return Object(y.i)(e)&&Object(y.i)(e.filter)&&e.filter.enable()})),e.tileRenderer.onConfigUpdate(c),t.next=37,e._proxy.startup(e.view.featuresTilingScheme,h,O);case 37:return t.next=39,e._proxy.updateTiles({added:e._tileStrategy.tileKeys(),removed:[]});case 39:if(!e.destroyed){t.next=41;break}return t.abrupt("return");case 41:if(t.t0=e.hasHighlight(),!t.t0){t.next=45;break}return t.next=45,e._proxy.setHighlight(Array.from(e._highlightIds.keys()));case 45:if(!e.destroyed){t.next=47;break}return t.abrupt("return");case 47:return t.next=49,e._onceTilesUpdated();case 49:if(!e.destroyed){t.next=51;break}return t.abrupt("return");case 51:e.tileRenderer.onConfigUpdate(c),t.next=98;break;case 54:return t.next=56,e._proxy.update(h,!0);case 56:if(j=t.sent,!e.destroyed){t.next=59;break}return t.abrupt("return");case 59:if(!j.queryFilter){t.next=74;break}return e._lockGPUUploads(),t.prev=61,t.next=64,e._proxy.invalidate(j);case 64:t.next=69;break;case 66:t.prev=66,t.t1=t.catch(61),Object(x.n)(t.t1)||qe.error(t.t1);case 69:if(!e.destroyed){t.next=71;break}return t.abrupt("return");case 71:e._unlockGPUUploads(),t.next=95;break;case 74:return t.prev=74,t.next=77,e._proxy.invalidate(Object(a.a)(Object(a.a)({},j),{},{mesh:!1}));case 77:t.next=82;break;case 79:t.prev=79,t.t2=t.catch(74),Object(x.n)(t.t2)||qe.error(t.t2);case 82:if(!e.destroyed){t.next=84;break}return t.abrupt("return");case 84:if(!j.mesh){t.next=95;break}return e._lockGPUUploads(),t.prev=86,t.next=89,e._proxy.invalidate({mesh:!0,targets:{aggregate:null==(m=j.targets)?void 0:m.aggregate}});case 89:t.next=94;break;case 91:t.prev=91,t.t3=t.catch(86),Object(x.n)(t.t3)||qe.error(t.t3);case 94:e._unlockGPUUploads();case 95:if(!e.destroyed){t.next=97;break}return t.abrupt("return");case 97:e._proxy.resume(),e.effects.forEach((function(e){return Object(y.i)(e)&&Object(y.i)(e.filter)&&e.filter.enable()})),e.tileRenderer.onConfigUpdate(c),e._forceAttributeTextureUpload();case 98:e._tileRendererHash=v,e.tileRenderer.invalidateLabels(),e.requestUpdate();case 99:case"end":return t.stop()}}),t,null,[[61,66],[74,79],[86,91]])})))),e._updateHighlight=Object(x.i)(Object(c.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._proxy.setHighlight(Array.from(e._highlightIds.keys())));case 1:case"end":return t.stop()}}),t)})))),e}return Object(l.a)(r,[{key:"destroy",value:function(){var e,t;null==(e=this._proxy)||e.destroy(),Object(y.a)(this._updateClusterSizeTask,(function(e){return e.remove()})),null==(t=this.tileRenderer)||t.destroy()}},{key:"initialize",value:function(){var e=this;this.addResolvingPromise(this._initProxy()),this.handles.add([this.on("valueRangesChanged",(function(t){e._set("_aggregateValueRanges",t.valueRanges)})),Object(F.a)(this,"effect",(function(t){e.effectLists.included.effect=null==t?void 0:t.includedEffect})),Object(F.a)(this,"effect",(function(t){e.effectLists.excluded.effect=null==t?void 0:t.excludedEffect}))])}},{key:"_initProxy",value:function(){var e=Object(c.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stream"===this.layer.type||"ogc-feature"===this.layer.type||!this.layer.isTable){e.next=2;break}throw new m.a("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});case 2:return this._proxy&&this._proxy.destroy(),t=this._createClientOptions(),e.abrupt("return",(this._set("_proxy",new Ve({client:t})),this._proxy.when()));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"labelsVisible",get:function(){return!this.suspended&&this.layer.labelingInfo&&this.layer.labelsVisible}},{key:"effect",get:function(){return Object(y.p)(this._effect,null)},set:function(e){var t=this._effect;Object(y.i)(t)&&Object(y.i)(t.filter)&&t.filter.enabled&&Object(y.i)(e)&&Object(y.i)(e.filter)&&e.filter.enable(),this._effect=e,this.notifyChange("effect")}},{key:"effects",get:function(){return this.effect&&[this.effect]||[]}},{key:"renderingConfigHash",get:function(){if(!this.layer)return null;var e=this.availableFields,t=this.layer,r=t.definitionExpression,n=t.renderer,i=t.labelingInfo,a="feature"===t.type?t.gdbVersion:void 0,s="feature"===t.type&&t.historicMoment?t.historicMoment.getTime():void 0,u=this.timeExtent,c="stream"===t.type?"".concat(JSON.stringify(t.geometryDefinition)).concat(t.definitionExpression):null,o=JSON.stringify(this.clips),l=t.featureReduction&&t.featureReduction.toJSON();return JSON.stringify({filterHash:Object(y.i)(this.filter)&&this.filter.toJSON(),effectHash:Object(y.i)(this.effect)&&this.effect.toJSON(),streamFilter:c,gdbVersion:a,definitionExpression:r,historicMoment:s,availableFields:e,renderer:n,labelingInfo:t.labelsVisible&&i,timeExtent:u,clipsHash:o,featureReduction:l})}},{key:"hasEffects",get:function(){return this.effectLists.included.hasEffects||this.effectLists.excluded.hasEffects}},{key:"highlight",value:function(e){var t,r=this;return e instanceof S.a?t=[e.getObjectId()]:"number"==typeof e?t=[e]:_.a.isCollection(e)?t=e.map((function(e){return e&&e.getAttribute(r.layer.objectIdField)})).toArray():Array.isArray(e)&&e.length>0&&(t="number"==typeof e[0]?e:e.map((function(e){return e&&e.getAttribute(r.layer.objectIdField)}))),t&&t.length?(t=t.filter((function(e){return null!=e})),this._addHighlight(t),{remove:function(){return r._removeHighlight(t)}}):{remove:function(){}}}},{key:"hasHighlight",value:function(){return!!this._highlightIds.size}},{key:"hitTest",value:function(e,t){return this._hitTest(e,t)}},{key:"queryStatistics",value:function(){return this._proxy.queryStatistics()}},{key:"queryFeatures",value:function(e,t){var r=this;return this.queryFeaturesJSON(e,t).then((function(e){var t=V.default.fromJSON(e);return t.features.forEach((function(e){e.layer=r.layer,e.sourceLayer=r.layer})),t}))}},{key:"queryFeaturesJSON",value:function(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)}},{key:"queryObjectIds",value:function(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)}},{key:"queryFeatureCount",value:function(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)}},{key:"queryExtent",value:function(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then((function(e){return{count:e.count,extent:w.a.fromJSON(e.extent)}}))}},{key:"setVisibility",value:function(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}},{key:"update",value:function(e){if(this._tileStrategy&&this.tileRenderer){var t=this._tileStrategy.update(e),r=t.hasMissingTiles,n=t.added,i=t.removed;(n.length||i.length)&&this._proxy.updateTiles({added:n,removed:i}),r&&this.requestUpdate();var a=e.state;this._viewStateId!==a.id&&(this._proxy.setViewState(a),this._viewStateId=a.id),this.notifyChange("updating")}}},{key:"attach",value:function(){var e=this;this.view.timeline.record("".concat(this.layer.title," (FeatureLayer) Attach")),this._tileStrategy=new Te({acquireTile:function(t){return e._acquireTile(t)},releaseTile:function(t){return e._releaseTile(t)},tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add(Object(F.a)(this,"renderingConfigHash",(function(){return e._update()})),"attach"),"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",function(){var t=Object(c.a)(u.a.mark((function t(r){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e._set("_onGoingEdits",e._onGoingEdits+1),t.next=3,e._proxy.onEdits(r);case 3:e._set("_onGoingEdits",Math.max(0,e._onGoingEdits-1));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),"attach")}},{key:"detach",value:function(){this.container.removeAllChildren(),this.handles.remove("attach"),this._updatingPipelineConfig=!1,this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"fetchPopupFeatures",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){var n,i,a,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(y.i)(r)||!r.clientGraphics.length){e.next=4;break}if(!((n=r.clientGraphics[0])instanceof I)){e.next=4;break}return e.abrupt("return",[n]);case 4:if(!(i=this.validateFetchPopupFeatures(r))){e.next=7;break}throw i;case 7:if(!Object(y.i)(r)||0!==r.clientGraphics.length){e.next=9;break}return e.abrupt("return",[]);case 9:if(a=this.fetchClientPopupFeatures(r),t){e.next=12;break}return e.abrupt("return",a);case 12:return s=this._fetchServicePopupFeatures(t,r),e.abrupt("return",Object(x.k)([a,s]).then(g.d));case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_fetchServicePopupFeatures",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){var n,a,s,c,o,l,p,d,f,b,h;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stream"!==this.layer.type){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,this.createPopupQuery(r);case 4:if(n=e.sent,a=this.layer,s=a.renderer,c=Object(y.i)(r)?r.event:null,o=Object(U.a)({renderer:s,event:c}),n.geometry=this.createFetchPopupFeaturesQueryGeometry(t,o),l=new Set,p=a.objectIdField,d=Object(y.i)(r)?r.clientGraphics:null){f=Object(i.a)(d);try{for(f.s();!(b=f.n()).done;)h=b.value,l.add(h.attributes[p])}catch(u){f.e(u)}finally{f.f()}}return e.abrupt("return",a.queryFeatures(n).then((function(e){return e.features.filter((function(e){return!l.has(e.attributes[p])}))})));case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"createFetchPopupFeaturesQueryGeometry",value:function(e,t){return Object(C.a)(e,t,this.view)}},{key:"isUpdating",value:function(){return null!=this.layer.renderer&&(null!=this._updatingRequiredFieldsPromise||null==this.tileRenderer||!this._proxy||!this._proxy.isReady||this._pipelineIsUpdating||this._updatingPipelineConfig||this.tileRenderer.updating||this._onGoingEdits>0)}},{key:"_createClientOptions",value:function(){var e=this;return{setUpdating:function(t){e._set("_pipelineIsUpdating",t)},emitEvent:function(t){e.emit(t.name,t.event)}}}},{key:"_createServiceOptions",value:function(){var e=Object(c.a)(u.a.mark((function e(){var t,r,n,i,a,s,c,o,l,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stream"!==(t=this.layer).type){e.next=3;break}return e.abrupt("return",null);case 3:if(r=t.capabilities,n=t.objectIdField,i=t.fields.map((function(e){return e.toJSON()})),a=t.fullExtent&&t.fullExtent.toJSON(),s=Object(A.a)(t.geometryType),c=t.timeInfo&&t.timeInfo.toJSON()||null,o=t.spatialReference?t.spatialReference.toJSON():null,l="feature"===t.type?t.customParameters:null,"ogc-feature"!==t.type){e.next=8;break}p=function(e){var t=e.capabilities,r=e.collectionId,n=e.source.layerDefinition;return{capabilities:t,collectionId:r,url:e.url,layerDefinition:n}}(t),e.next=15;break;case 8:if(function(e){return e&&"openPorts"in e}(t.source)){e.next=12;break}t.parsedUrl&&(p=Object(h.a)(t.parsedUrl),"dynamicDataSource"in t&&t.dynamicDataSource&&(p.query={layer:JSON.stringify({source:t.dynamicDataSource})})),e.next=15;break;case 12:return e.next=14,t.source.openPorts();case 14:p=e.sent;case 15:return e.abrupt("return",{type:"on-demand",maxRecordCount:r.query.maxRecordCount,tileMaxRecordCount:r.query.tileMaxRecordCount,capabilities:r,fields:i,fullExtent:a,geometryType:s,objectIdField:n,source:p,timeInfo:c,spatialReference:o,customParameters:l});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_createMemoryServiceOptions",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.openPorts();case 2:return r=e.sent,e.abrupt("return",Object(a.a)(Object(a.a)({},this._createServiceOptions()),{},{type:"memory",source:r}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_cleanUpQuery",value:function(e){var t=z.a.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t}},{key:"_createUpdateClusterSizeTask",value:function(e,t){var r=this;return this.watch("_aggregateValueRanges",function(){var n=Object(c.a)(u.a.mark((function n(i){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r._updateClusterEffectiveRendererSizeVariable(e,t,i),r._updatingPipelineConfig||r.tileRenderer.onConfigUpdate(r._effectiveRenderer);case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"_updateClusterEffectiveRendererSizeVariable",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r,n){var i,a,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.dynamicClusterSize&&"visualVariables"in t&&t.visualVariables&&(i=Object(N.c)(t.visualVariables),Object(y.i)(i)&&"cluster_count"===i.field&&(a=t.visualVariables.indexOf(i),t.visualVariables[a]=Object(N.a)(r,n),(s=t.clone()).dynamicClusterSize=!0,this._set("_effectiveRenderer",s)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_getEffectiveRenderer",value:function(){var e=this.layer.renderer,t=this.layer.featureReduction;if(Object(y.i)(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),t&&"cluster"===t.type&&Object(N.d)(e)){var r=t,n=[],i=Object(N.b)(n,e,r,this._aggregateValueRanges);return Object(y.a)(this._updateClusterSizeTask,(function(e){return e.remove()})),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(i,r),{renderer:i,aggregateFields:n,featureReduction:t}}return{renderer:e,aggregateFields:[],featureReduction:null}}},{key:"_acquireTile",value:function(e){var t=this,r=this.tileRenderer.acquireTile(e);return r.once("attach",(function(){t.requestUpdate()})),r}},{key:"_releaseTile",value:function(e){this.tileRenderer.releaseTile(e)}},{key:"_initTileRenderer",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le(t,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});case 2:return r=e.sent,e.abrupt("return",(this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null),this.destroyed?null:(this._proxy.tileRenderer=r,this._set("tileRenderer",r),this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(t),this.requestUpdate(),this.tileRenderer)));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createTileRendererHash",value:function(e){return"".concat("heatmap"===e.type?"heatmap":"symbol",".").concat("dot-density"===e.type)}},{key:"_createFeatureDataHash",value:function(e,t,r){var n=e.getAttributeHash(),i=JSON.stringify(t),a=Object(y.i)(r)&&JSON.stringify(r.filter),s=JSON.stringify(this.timeExtent),u="";return this._visibilityOverrides.forEach((function(e){return u+=e})),"".concat(n,".").concat(i,".").concat(a,".").concat(s,".").concat(u)}},{key:"_injectOverrides",value:function(e){var t=Object(y.i)(e)?e.timeExtent:null,r=Object(y.i)(this.timeExtent)&&Object(y.i)(t)?this.timeExtent.intersection(t):this.timeExtent||t;if(!this._visibilityOverrides.size&&!r)return e;var n=Object(y.i)(e)&&e.clone()||new Z;return n.hiddenIds=this._visibilityOverrides,n.timeExtent=r,n}},{key:"_createConfiguration",value:function(e,t,r){var n="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,i="feature"===this.layer.type?this.layer.gdbVersion:void 0,a=new Array(T.o),s=this._injectOverrides(t);a[0]=Object(y.i)(s)?s.toJSON():null,a[1]=Object(y.i)(r)&&r.filter?r.filter.toJSON():null;var u=Object(D.b)(e);if(Object(y.h)(u))return null;var c=Object(q.a)();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:i,historicMoment:n,devicePixelRatio:window.devicePixelRatio||1,filters:a,schema:u,supportsTextureFloat:c.supportsTextureFloat,maxTextureSize:c.maxTextureSize}}},{key:"_hasRequiredSupport",value:function(e){var t;return!("dot-density"===(null==(t=e.renderer)?void 0:t.type)&&!Object(q.a)().supportsTextureFloat)||(qe.error(new m.a("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1)}},{key:"_onceTilesUpdated",value:function(){return this.requestUpdate(),Object(F.g)(this,"_pipelineIsUpdating",!1)}},{key:"_lockGPUUploads",value:function(){this.tileRenderer&&this.tileRenderer.lockGPUUploads()}},{key:"_unlockGPUUploads",value:function(){this.tileRenderer&&this.tileRenderer.unlockGPUUploads()}},{key:"_forceAttributeTextureUpload",value:function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}},{key:"_update",value:function(){var e=this;this.view.timeline.begin("".concat(this.layer.title," (FeatureLayer) Initial Pipeline Config"));var t=this._doUpdate();this._updatingPromise=t;var r=function(){t===e._updatingPromise&&e._set("_updatingPipelineConfig",!1),e.view&&e.view.timeline.end("".concat(e.layer.title," (FeatureLayer) Initial Pipeline Config"))};t.then(r).catch((function(e){Object(x.n)(e)||qe.error(e),r()}))}},{key:"_addHighlight",value:function(e){var t,r=Object(i.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(this._highlightIds.has(n)){var a=this._highlightIds.get(n);this._highlightIds.set(n,a+1)}else this._highlightIds.set(n,1)}}catch(s){r.e(s)}finally{r.f()}this._updateHighlight().catch((function(e){Object(x.n)(e)||qe.error(e)}))}},{key:"_removeHighlight",value:function(e){var t,r=Object(i.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(this._highlightIds.has(n)){var a=this._highlightIds.get(n)-1;0===a?this._highlightIds.delete(n):this._highlightIds.set(n,a)}}}catch(s){r.e(s)}finally{r.f()}this._updateHighlight().catch((function(e){Object(x.n)(e)||qe.error(e)}))}},{key:"_createHittestResult",value:function(e){return e.layer=this.layer,e.sourceLayer=this.layer,Object(y.i)(e.geometry)&&(e.geometry.spatialReference=this.view.spatialReference),e}},{key:"_hitTest",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){var n,i,a,s,c,o=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.suspended&&this.tileRenderer){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.tileRenderer.hitTest(t,r);case 4:if(0!==(n=e.sent).length){e.next=9;break}return e.next=8,Object(x.a)(1);case 8:return e.abrupt("return",null);case 9:if(function(e){return(2147483648&e)>>>31==1}(i=n[0])){e.next=15;break}return e.next=13,this._proxy.getFeature(i);case 13:return a=e.sent,e.abrupt("return",Object(y.a)(a,(function(e){return o._createHittestResult(S.a.fromJSON(e))})));case 15:return e.next=17,this._proxy.getAggregate(i);case 17:if(s=e.sent,!Object(y.h)(s)){e.next=20;break}return e.abrupt("return",null);case 20:if(!Object(y.i)(s.referenceId)){e.next=25;break}return e.next=23,this._proxy.getFeature(s.referenceId);case 23:return c=e.sent,e.abrupt("return",Object(y.a)(c,(function(e){return o._createHittestResult(S.a.fromJSON(e))})));case 25:return e.abrupt("return",this._createHittestResult(I.fromJSON(s)));case 26:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(function(e){var t=function(e){Object(d.a)(r,e);var t=Object(f.a)(r);function r(){var e;Object(o.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i)))._updatingRequiredFieldsPromise=null,e.effect=null,e.filter=null,e.timeExtent=null,e.layer=null,e.requiredFields=[],e.view=null,e}return Object(l.a)(r,[{key:"initialize",value:function(){var e=this;Object(F.a)(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","effect","layer.timeInfo","timeExtent"],(function(){return e._handleRequiredFieldsChange()}),!0)}},{key:"availableFields",get:function(){var e=this.layer,t=this.layer.fields,r=this.requiredFields;return"outFields"in e&&e.outFields?Object(ae.i)(t,[].concat(Object(te.a)(Object(ae.t)(t,e.outFields)),Object(te.a)(r))):Object(ae.i)(t,r)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(e){ce.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"highlight",value:function(e){throw new Error("missing implementation")}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=Object(y.i)(this.filter)?this.filter.createQuery(e):new z.a(e);return Object(y.i)(this.timeExtent)&&(t.timeExtent=Object(y.i)(t.timeExtent)?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}},{key:"queryFeatures",value:function(e,t){throw new Error("missing implementation")}},{key:"queryObjectIds",value:function(e,t){throw new Error("missing implementation")}},{key:"queryFeatureCount",value:function(e,t){throw new Error("missing implementation")}},{key:"queryExtent",value:function(e,t){throw new Error("missing implementation")}},{key:"_loadArcadeModules",value:function(e){if(e.get("expressionInfos.length"))return Object(ie.e)()}},{key:"_handleRequiredFieldsChange",value:function(){var e=this,t=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",t),t.then((function(){e._updatingRequiredFieldsPromise===t&&e._set("_updatingRequiredFieldsPromise",null)}))}},{key:"_updateRequiredFields",value:function(){var e=Object(c.a)(u.a.mark((function e(){var t,r,n,a,s,c,o,l,p,d,f,b,h,v;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layer&&this.view){e.next=2;break}return e.abrupt("return");case 2:return t="3d"===this.view.type,r=this.layer,n=this.layer,a=n.fields,s=n.objectIdField,c=n.renderer,o=n.displayField,l=r.featureReduction,p=new Set,e.next=13,Object(x.j)([c?c.collectRequiredFields(p,a):null,Object(ae.g)(p,r),t?Object(ae.b)(p,r):null,Object(y.i)(this.filter)?Object(ae.f)(p,r,this.filter):null,this.effect?Object(ae.f)(p,r,this.effect.filter):null,l?Object(ae.c)(p,r,l):null]);case 13:d=e.sent,r.timeInfo&&this.timeExtent&&Object(ae.e)(p,r.fields,[r.timeInfo.startField,r.timeInfo.endField]),f=Object(i.a)(d);try{for(f.s();!(b=f.n()).done;)(h=b.value).error&&ce.error(h.error)}catch(u){f.e(u)}finally{f.f()}Object(ae.d)(p,a,s),t&&o&&Object(ae.d)(p,a,o),v=Array.from(p).sort(),this._set("requiredFields",v);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"validateFetchPopupFeatures",value:function(e){var t=this.layer;return this.layer.popupEnabled?Object(ue.a)(this.layer,e)?void 0:new m.a("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new m.a("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:t})}},{key:"fetchClientPopupFeatures",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var r,n,a,s,c,o,l,p,d,f,b,h;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=Object(y.i)(t)?t.clientGraphics:null)&&0!==r.length){e.next=3;break}return e.abrupt("return",Object(x.u)([]));case 3:if(n=[],a=[],s=this.layer,c=Object(ue.a)(s,t),Object(y.i)(c)){e.next=6;break}return e.abrupt("return",Object(x.u)([]));case 6:return e.next=8,this._loadArcadeModules(c);case 8:return o=e.sent,l=o&&o.arcadeUtils.hasGeometryOperations(c),e.next=12,this.createPopupQuery(t);case 12:p=e.sent,d=Object(ae.t)(s.fields,p.outFields),f=Object(i.a)(r);try{for(f.s();!(b=f.n()).done;)h=b.value,l||!Object(ae.h)(d,h)?a.push(h):n.push(h)}catch(u){f.e(u)}finally{f.f()}return e.abrupt("return","stream"===s.type||0===a.length?Object(x.u)(n):(p.objectIds=a.map((function(e){return e.attributes[s.objectIdField]})),s.queryFeatures(p).then((function(e){return n.concat(e.features)})).catch((function(){return a}))));case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createPopupQuery",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var r,n,i,a,s,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.layer,n=r.createQuery(),i=Object(ue.a)(r,t),e.t0=Object(y.i)(i),!e.t0){e.next=8;break}return e.next=7,this._loadArcadeModules(i);case 7:e.t0=e.sent;case 8:return a=e.t0,s=Object(y.i)(i)&&a&&a.arcadeUtils.hasGeometryOperations(i),c=!("point"!==r.geometryType&&!s),n.returnGeometry=c,n.returnZ=c,n.returnM=c,e.next=16,Object(ue.b)(this.layer,i);case 16:return n.outFields=e.sent,n.outSpatialReference=this.view.spatialReference,e.abrupt("return",n);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){return!!Object(re.a)(Object(ne.a)(r.prototype),"canResume",this).call(this)&&(!Object(y.i)(this.timeExtent)||!this.timeExtent.isEmpty)}}]),r}(e);return Object(b.a)([Object(O.b)()],t.prototype,"_updatingRequiredFieldsPromise",void 0),Object(b.a)([Object(O.b)({readOnly:!0,dependsOn:["layer.outFields?","requiredFields"]})],t.prototype,"availableFields",null),Object(b.a)([Object(O.b)({type:ee})],t.prototype,"effect",void 0),Object(b.a)([Object(O.b)({type:Z})],t.prototype,"filter",void 0),Object(b.a)([Object(O.b)(se.a)],t.prototype,"timeExtent",void 0),Object(b.a)([Object(O.b)()],t.prototype,"layer",void 0),Object(b.a)([Object(O.b)({type:Number})],t.prototype,"maximumNumberOfFeatures",null),Object(b.a)([Object(O.b)({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),Object(b.a)([Object(O.b)({readOnly:!0})],t.prototype,"requiredFields",void 0),Object(b.a)([Object(O.b)({dependsOn:["timeExtent"]})],t.prototype,"suspended",void 0),Object(b.a)([Object(O.b)()],t.prototype,"view",void 0),t=Object(b.a)([Object(j.a)("esri.views.layers.FeatureLayerView")],t),t}(Object(M.a)(Object(oe.a)(P.a))));Object(b.a)([Object(O.b)()],Pe.prototype,"_proxy",void 0),Object(b.a)([Object(O.b)()],Pe.prototype,"_pipelineIsUpdating",void 0),Object(b.a)([Object(O.b)()],Pe.prototype,"_updatingPipelineConfig",void 0),Object(b.a)([Object(O.b)()],Pe.prototype,"_effectiveRenderer",void 0),Object(b.a)([Object(O.b)()],Pe.prototype,"_aggregateValueRanges",void 0),Object(b.a)([Object(O.b)()],Pe.prototype,"_onGoingEdits",void 0),Object(b.a)([Object(O.b)()],Pe.prototype,"_isRefreshing",void 0),Object(b.a)([Object(O.b)({dependsOn:["suspended","layer.labelingInfo","layer.labelsVisible"]})],Pe.prototype,"labelsVisible",null),Object(b.a)([Object(O.b)({type:Z})],Pe.prototype,"filter",void 0),Object(b.a)([Object(O.b)({type:ee})],Pe.prototype,"effect",null),Object(b.a)([Object(O.b)({readOnly:!0,dependsOn:["effect"]})],Pe.prototype,"effects",null),Object(b.a)([Object(O.b)({dependsOn:["layer.renderer","layer.outFields","layer.definitionExpression","layer.gdbVersion?","layer.geometryDefinition?","layer.historicMoment?","layer.labelingInfo","layer.labelsVisible","layer.featureReduction","filter","effect","timeExtent","clips"]})],Pe.prototype,"renderingConfigHash",null),Object(b.a)([Object(O.b)()],Pe.prototype,"tileRenderer",void 0),Object(b.a)([Object(O.b)({dependsOn:["layer.renderer","tileRenderer","tileRenderer.updating","_updatingPipelineConfig","_pipelineIsUpdating","_updatingRequiredFieldsPromise","_proxy","_proxy.isReady?","_onGoingEdits"]})],Pe.prototype,"updating",void 0);var Ue=Pe=Object(b.a)([Object(j.a)("esri.views.2d.layers.FeatureLayerView2D")],Pe);t.default=Ue},788:function(e,t,r){"use strict";r.d(t,"a",(function(){return j})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return v})),r.d(t,"f",(function(){return O})),r.d(t,"g",(function(){return p})),r.d(t,"h",(function(){return y})),r.d(t,"i",(function(){return l})),r.d(t,"j",(function(){return f}));var n=r(9),i=r(98),a=r(119),s=r(379),u=r(248),c=r(305),o=r(389),l={type:Boolean,value:!0,json:{origins:{"web-scene":{read:{source:["id","url","layerType"],reader:function(e,t){if(null!=t.screenSizePerspective||"defaults"!==this.originOf("screenSizePerspectiveEnabled"))return t.screenSizePerspective;Object(i.a)(this).store.set("screenSizePerspectiveEnabled",!1,0)}},write:{ignoreOrigin:!0,target:"screenSizePerspective",writer:function(e,t,r,n){("defaults"===this.originOf("screenSizePerspectiveEnabled")&&e||Object(s.a)(this,"screenSizePerspectiveEnabled",{},n))&&(t[r]=e)}}}}}},p={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:function(e,t){return!t.disablePopup}},write:{enabled:!0,writer:function(e,t,r){t[r]=!e}}}},d={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},f={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:a.f}}},b={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},h={value:null,type:o.a,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function y(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}var v={type:Number,json:{origins:{"web-document":{default:1,write:!0,read:!0},"portal-item":{write:!0}}}},O=Object(n.a)(Object(n.a)({},v),{},{json:Object(n.a)(Object(n.a)({},v.json),{},{origins:{"web-document":Object(n.a)(Object(n.a)({},v.json.origins["web-document"]),{},{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:function(e,t,r){return r&&"service"!==r.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?Object(u.b)(t.layerDefinition.drawingInfo.transparency):void 0:Object(u.b)(t.drawingInfo.transparency)}}})}),j={type:c.a,dependsOn:["view.timeExtent","layer.timeExtent","layer.timeInfo","layer.timeOffset","layer.timeOffset.value","layer.timeOffset.unit","layer.useViewTime"],readOnly:!0,get:function(){var e,t;if(null==(e=this.layer)||!e.timeInfo)return null;var r=null==(t=this.view)?void 0:t.timeExtent,n=this.layer.timeExtent,i=this.layer.useViewTime?r&&n?r.intersection(n):r||n:n;if(!i||i.isEmpty)return i;var a=this.layer.timeOffset,s=a?i.offset(-a.value,a.unit):i,u=this._get("timeExtent");return s.equals(u)?u:s}}},822:function(e,t,r){"use strict";r.d(t,"a",(function(){return E})),r.d(t,"b",(function(){return L})),r.d(t,"c",(function(){return N})),r.d(t,"d",(function(){return A})),r.d(t,"e",(function(){return G})),r.d(t,"f",(function(){return F})),r.d(t,"g",(function(){return I})),r.d(t,"h",(function(){return C})),r.d(t,"i",(function(){return D}));var n=r(2),i=r(3),a=r(12),s=r(32),u=(r(13),r(4)),c=r(46),o=r(44),l=r(313),p=r(232),d=r(59),f=r(36),b=r(107),h=r(382),y=r(29),v=r(109),O=r(378),j=r(361),m=r(811),g=r(884),x=r(832),w=r(877),k=Math.PI/180,_=Object(O.a)(),S=Object(j.a)(),R=Object(b.g)();function E(e,t,r,n,i,a,u){if(!n||!r.symbol)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;var o=n;if(!Object(d.f)(o)){Object(p.a)(e,o);var l=t[0];0===l&&(l=H(r),t[0]=l);var f=i*l/2;return e[0]-=f,e[1]-=f,e[2]+=f,e[3]+=f,e}var b=o.x,y=o.y;return"esriTS"===r.symbol.type&&0===t[2]&&0===t[3]&&G(t,r.symbol,r.mosaicItem),function(e,t,r,n,i,a,u,o){var l;switch(n.type){case"esriSMS":case"esriPMS":l=N(t,r,n,a,u,0);break;case"esriTS":l=A(t,r,n,i,a,0);break;case"cim":case"CIMSymbolReference":case"expanded-cim":l=L(t,r,n,a,u,0)}for(var p,d,f=0,b=0;b<l.rings[0].length-1;b++)p=(t-(d=l.rings[0][b])[0])*(t-d[0])+(r-d[1])*(r-d[1]),f=Math.max(f,p);f=Math.sqrt(f);var y=Object(h.b)(t-f,o),v=Object(h.b)(t+f,o);if(y>v){var O=Object(c.d)(o);if(O){var j=Object(s.a)(O.valid,2);y=j[0],v=j[1]}}e[0]=y,e[1]=r-f,e[2]=v,e[3]=r+f}(e,b,y,r.symbol,t,i,a,u),e}function I(e){return"simple-marker"===e||"picture-marker"===e||"text"===e}function F(e){switch(Object(u.o)(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}var V=Object(j.a)(),z=Object(j.a)(),M=Object(j.a)(),T=Object(j.a)(),q=Object(j.a)(),P=Object(j.a)(),U=Object(j.a)();function C(e,t,r,n){Object(y.r)(M,t,r);for(var i,a,s,u,c,o,l,p,d,f=e.paths,b=1/0,h=0;h<f.length;h++){var v=f[h];if(!(v.length<2))for(var O=1;O<v.length;O++)i=v[O-1][0],s=v[O-1][1],a=v[O][0],u=v[O][1],c=Math.min(i,a)-n,o=Math.min(s,u)-n,l=Math.max(i,a)+n,p=Math.max(s,u)+n,t<c||t>l||r<o||r>p||(Object(y.r)(V,i,s),Object(y.r)(z,a,u),Object(y.d)(T,z,V),Object(y.d)(q,V,M),Object(y.a)(P,T,Object(y.g)(T,q)/Object(y.g)(T,T)),Object(y.d)(U,q,P),b>(d=Object(y.g)(U,U))&&(b=d))}return Math.sqrt(b)<=n}function N(e,t,r,n,i,a){var s,u,c=Object(f.g)(r.xoffset),o=Object(f.g)(r.yoffset),l=k*r.angle,p=k*a;switch(r.type){case"esriSMS":s=u=Object(f.g)(r.size);break;case"esriPMS":s=Object(f.g)(r.width),u=Object(f.g)(r.height)}i<.04&&(n=.04*n/i);var d=Object(v.d)(_);Object(v.h)(d,d,Object(y.r)(S,e,t)),Object(v.f)(d,d,p-l),Object(v.g)(d,d,Object(y.r)(S,n,-n)),Object(v.h)(d,d,Object(y.r)(S,c,-o));var b=[0,0];Object(y.s)(b,Object(y.r)(S,-.5*s,-.5*u),d);var h=[0,0];Object(y.s)(h,Object(y.r)(S,-.5*s,.5*u),d);var O=[0,0];Object(y.s)(O,Object(y.r)(S,.5*s,-.5*u),d);var j=[0,0];return Object(y.s)(j,Object(y.r)(S,.5*s,.5*u),d),{rings:[[b,O,j,h,b]]}}function L(e,t,r,n,i,a){var s=w.a.getEnvelope(r.data);if(!s)return null;i<.04&&(n=.04*n/i);var u=Object(f.g)(s.width),c=Object(f.g)(s.height),o=Object(f.g)(s.x),l=Object(f.g)(s.y),p=0*k,d=k*a,b=Object(v.d)(_);Object(v.h)(b,b,Object(y.r)(S,e,t)),Object(v.f)(b,b,d-p),Object(v.g)(b,b,Object(y.r)(S,n,n));var h=[0,0];Object(y.s)(h,Object(y.r)(S,o,l+c),b);var O=[0,0];Object(y.s)(O,Object(y.r)(S,o,l),b);var j=[0,0];Object(y.s)(j,Object(y.r)(S,o+u,l+c),b);var m=[0,0];return Object(y.s)(m,Object(y.r)(S,o+u,l),b),{rings:[[h,j,m,O,h]]}}function A(e,t,r,n,i,a){var s=Object(f.g)(r.xoffset),u=Object(f.g)(r.yoffset),c=k*r.angle,o=k*a,l=Object(v.d)(_);Object(v.h)(l,l,Object(y.r)(S,e,t)),Object(v.f)(l,l,o),Object(v.g)(l,l,Object(y.r)(S,i,-i));var p=n[0]+n[2]/2,d=n[1]+n[3]/2;Object(v.h)(l,l,Object(y.r)(S,s,-u)),Object(v.h)(l,l,Object(y.r)(S,p,d)),Object(v.f)(l,l,c),Object(v.h)(l,l,Object(y.r)(S,-p,-d));var b=[0,0];Object(y.s)(b,Object(y.r)(S,n[0],n[1]),l);var h=[0,0];Object(y.s)(h,Object(y.r)(S,n[0],n[1]+n[3]),l);var O=[0,0];Object(y.s)(O,Object(y.r)(S,n[0]+n[2],n[1]),l);var j=[0,0];return Object(y.s)(j,Object(y.r)(S,n[0]+n[2],n[1]+n[3]),l),{rings:[[b,O,j,h,b]]}}function D(e){var t,r,n,i,u,o,f,b,h,y=null;if(!e)return null;if("mesh"===e.type)return e.toJSON();if(t=e.spatialReference,!(r=Object(c.d)(t)))return e.toJSON();n=t.isWebMercator,i=J[o=n?102100:4326].maxX,u=J[o].minX,f=J[o].plus180Line,b=J[o].minus180Line;var v=e.toJSON();if(Object(d.f)(v))h=$(v,i,u);else if(Object(d.e)(v))v.points=v.points.map((function(e){return $(e,i,u)})),h=v;else if(Object(d.d)(v))h=function(e,t){if(!t)return e;var r=function(e,t){var r,n=[],i=e.ymin,a=e.ymax,u=e.xmax-e.xmin,c=e.xmin,o=e.xmax,l=Object(s.a)(t.valid,2),p=l[0],d=l[1],f=(r=W(e.xmin,t)).x,b=r.frameId,h=(r=W(e.xmax,t)).x,y=r.frameId,v=f===h&&u>0;if(u>2*d){var O={xmin:c<o?f:h,ymin:i,xmax:d,ymax:a},j={xmin:p,ymin:i,xmax:c<o?h:f,ymax:a},m={xmin:0,ymin:i,xmax:d,ymax:a},g={xmin:p,ymin:i,xmax:0,ymax:a},x=[],w=[];Q(O,m)&&x.push(b),Q(O,g)&&w.push(b),Q(j,m)&&x.push(y),Q(j,g)&&w.push(y);for(var k=b+1;k<y;k++)x.push(k),w.push(k);n.push({extent:O,frameIds:[b]},{extent:j,frameIds:[y]},{extent:m,frameIds:x},{extent:g,frameIds:w})}else f>h||v?n.push({extent:{xmin:f,ymin:i,xmax:d,ymax:a},frameIds:[b]},{extent:{xmin:p,ymin:i,xmax:h,ymax:a},frameIds:[y]}):n.push({extent:{xmin:f,ymin:i,xmax:h,ymax:a},frameIds:[b]});return n}(e,t).map((function(e){return e.extent}));return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map((function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}))}}(v,r);else if(Object(d.g)(v)||Object(d.h)(v)){var O=R;Object(p.a)(O,v);var j={xmin:O[0],ymin:O[1],xmax:O[2],ymax:O[3]},m=B(j.xmin,u)*(2*i),g=0===m?v:function(e,t){var r,n=function(e){return Object(d.g)(e)?e.rings:e.paths}(e),i=Object(a.a)(n);try{for(i.s();!(r=i.n()).done;){var s,u=r.value,c=Object(a.a)(u);try{for(c.s();!(s=c.n()).done;){s.value[0]+=t}}catch(o){c.e(o)}finally{c.f()}}}catch(o){i.e(o)}finally{i.f()}return e}(v,m);j.xmin+=m,j.xmax+=m,Object(l.a)(j,f)&&j.xmax!==i||Object(l.a)(j,b)&&j.xmin!==u?y=g:h=g}else h=e.clone();return null!==y?(new K).cut(y,i):h}function H(e){switch(e.symbol.type){case"esriSFS":case"esriPFS":var t=e.symbol.outline;return t?t.width:0;case"esriSLS":return Object(f.g)(e.symbol.width);case"esriSMS":return Object(f.g)(e.symbol.size);case"esriPMS":return Object(f.g)(Math.max(e.symbol.width,e.symbol.height));case"esriTS":var r=[0,0,0,0];G(r,e.symbol,e.mosaicItem);var n=Math.max(Math.abs(r[0]),Math.abs(r[1]));return Math.max(r[2],r[3])+n;case"expanded-cim":var i=w.a.getEnvelope(e.symbol.data);return Object(f.g)(Math.sqrt(i.width*i.width+i.height*i.height));case"composite-symbol":if(!e.symbol.layers.length)return 0;var a=e.symbol.layers.length-1;return H({symbol:e.symbol.layers[a],mosaicItem:null});case"label":default:return 0}}function G(e,t,r){if(!r||0===r.glyphMosaicItems.length)return e;var n=Object(x.a)(t.text)[1],i=r.glyphMosaicItems,a=Object(g.a)(i,n,{scale:Object(f.g)(t.font.size)/24,angle:t.angle,xOffset:t.xoffset,yOffset:t.yoffset,hAlign:Object(m.d)(t.horizontalAlignment||"center"),vAlign:Object(m.f)(t.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(t.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(t.lineHeight||1,4)),decoration:t.font.decoration||"none",isCIM:!1}).bounds;return e[0]=Object(f.g)(a.x-a.halfWidth),e[1]=Object(f.g)(a.y-a.halfHeight),e[2]=Object(f.g)(a.width),e[3]=Object(f.g)(a.height),e}var J={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:o.a.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:o.a.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:o.a.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:o.a.WGS84}}};function B(e,t){return Math.ceil((e-t)/(2*t))}function W(e,t){var r,n=Object(s.a)(t.valid,2),i=n[0],a=n[1],u=2*a,c=0;return e>a?(e-=(r=Math.ceil(Math.abs(e-a)/u))*u,c=r):e<i&&(e+=(r=Math.ceil(Math.abs(e-i)/u))*u,c=-r),{x:e,frameId:c}}function Q(e,t){var r=t.xmin,n=t.ymin,i=t.xmax,a=t.ymax;return X(e,r,n)&&X(e,r,a)&&X(e,i,a)&&X(e,i,n)}function X(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}function $(e,t,r){if(Array.isArray(e)){var n=e[0];if(n>t){var i=B(n,t);e[0]=n+i*(-2*t)}else if(n<r){var a=B(n,r);e[0]=n+a*(-2*r)}}else{var s=e.x;if(s>t){var u=B(s,t);e.x+=u*(-2*t)}else if(s<r){var c=B(s,r);e.x+=c*(-2*r)}}return e}var K=function(){function e(){Object(n.a)(this,e)}return Object(i.a)(e,[{key:"cut",value:function(e,t){var r;if(e.rings)this.closed=!0,r=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,r=e.paths,this.minPts=2}for(var n=r.length,i=-2*t,s=0;s<n;s++){var u=r[s];if(u&&u.length>=this.minPts){var c,o=[],l=Object(a.a)(u);try{for(l.s();!(c=l.n()).done;){var p=c.value;o.push([p[0]+i,p[1]])}}catch(d){l.e(d)}finally{l.f()}r.push(o)}}return this.closed?e.rings=r:e.paths=r,e}}]),e}()},830:function(e,t,r){"use strict";var n=r(2),i=r(3),a=r(5),s=r(6),u=r(0),c=(r(13),r(14)),o=(r(15),r(1)),l=r(8),p=(r(11),r(19),r(20),r(33)),d=r(76),f=r(247),b=r(213),h=r(158),y=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e)).layer=null,i.parent=null,i}return Object(i.a)(r,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";throw c.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(n,"', id: '").concat(r,"')"),t),t}}))}},{key:"fullOpacity",get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){return!this.suspended&&!0===this.layer.legendEnabled}},{key:"updating",get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}},{key:"visible",get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),r}(Object(h.b)(Object(f.a)(Object(b.b)(d.a.EventedMixin(p.a)))));Object(u.a)([Object(o.b)({dependsOn:["layer.opacity","parent.fullOpacity"]})],y.prototype,"fullOpacity",null),Object(u.a)([Object(o.b)()],y.prototype,"layer",void 0),Object(u.a)([Object(o.b)()],y.prototype,"parent",void 0),Object(u.a)([Object(o.b)({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended","view?.ready"]})],y.prototype,"suspended",null),Object(u.a)([Object(o.b)({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended","view?.ready"]})],y.prototype,"suspendInfo",null),Object(u.a)([Object(o.b)({readOnly:!0,dependsOn:["suspended","layer.legendEnabled?"]})],y.prototype,"legendEnabled",null),Object(u.a)([Object(o.b)({type:Boolean,dependsOn:["updatingHandles.updating"],readOnly:!0})],y.prototype,"updating",null),Object(u.a)([Object(o.b)({dependsOn:["layer.visible"]})],y.prototype,"visible",null);var v=y=Object(u.a)([Object(l.a)("esri.views.layers.LayerView")],y);t.a=v},831:function(e,t,r){"use strict";r.d(t,"a",(function(){return z}));var n,i=r(2),a=r(3),s=r(61),u=r(55),c=r(5),o=r(6),l=r(0),p=(r(13),r(14),r(15),r(1)),d=r(8),f=(r(11),r(19),r(20),r(41)),b=r(139),h=r(30),y=function(e){Object(c.a)(r,e);var t=Object(o.a)(r);function r(){return Object(i.a)(this,r),t.apply(this,arguments)}return r}(r(28).a),v=y=Object(l.a)([Object(d.a)("esri.views.layers.support.ClipArea")],y),O=n=function(e){Object(c.a)(r,e);var t=Object(o.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).type="rect",e.left=null,e.right=null,e.top=null,e.bottom=null,e}return Object(a.a)(r,[{key:"clone",value:function(){return new n({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}},{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(v);Object(l.a)([Object(p.b)({type:[Number,String],json:{write:!0}})],O.prototype,"left",void 0),Object(l.a)([Object(p.b)({type:[Number,String],json:{write:!0}})],O.prototype,"right",void 0),Object(l.a)([Object(p.b)({type:[Number,String],json:{write:!0}})],O.prototype,"top",void 0),Object(l.a)([Object(p.b)({type:[Number,String],json:{write:!0}})],O.prototype,"bottom",void 0),Object(l.a)([Object(p.b)({readOnly:!0,dependsOn:["left","right","top","bottom"]})],O.prototype,"version",null);var j,m=O=n=Object(l.a)([Object(d.a)("esri.views.layers.support.ClipRect")],O),g=r(891),x=r(111),w=r(62),k=r(82),_=r(59),S=(r(77),{base:x.a,key:"type",typeMap:{extent:w.a,polygon:k.a}}),R=j=function(e){Object(c.a)(r,e);var t=Object(o.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).type="geometry",e.geometry=null,e}return Object(a.a)(r,[{key:"version",get:function(){return(this._get("version")||0)+1}},{key:"clone",value:function(){return new j({geometry:this.geometry.clone()})}}]),r}(v);Object(l.a)([Object(p.b)({types:S,json:{read:_.a,write:!0}})],R.prototype,"geometry",void 0),Object(l.a)([Object(p.b)({readOnly:!0,dependsOn:["geometry"]})],R.prototype,"version",null);var E=R=j=Object(l.a)([Object(d.a)("esri.views.layers.support.Geometry")],R),I=function(e){Object(c.a)(r,e);var t=Object(o.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).type="path",e.path=[],e}return Object(a.a)(r,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(v);Object(l.a)([Object(p.b)({type:[[[Number]]],json:{write:!0}})],I.prototype,"path",void 0),Object(l.a)([Object(p.b)({readOnly:!0,dependsOn:["path"]})],I.prototype,"version",null);var F=I=Object(l.a)([Object(d.a)("esri.views.layers.support.Path")],I),V=f.a.ofType({key:"type",base:v,typeMap:{rect:m,path:F,geometry:E}}),z=function(e){var t=function(e){Object(c.a)(r,e);var t=Object(o.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).clips=new V,e.moving=!1,e.attached=!1,e.lastUpdateId=-1,e.updateRequested=!1,e}return Object(a.a)(r,[{key:"initialize",value:function(){var e,t=this;this.container||(this.container=new g.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(h.a)(this,"suspended",(function(e){t.container&&(t.container.visible=!e),t.view&&!e&&t.updateRequested&&t.view.requestUpdate()}),!0),Object(h.a)(this,["layer.opacity","container"],(function(){var e,r;t.container&&(t.container.opacity=null!=(e=null==(r=t.layer)?void 0:r.opacity)?e:1)}),!0),Object(h.a)(this,["layer.blendMode"],(function(e){t.container&&(t.container.blendMode=e)}),!0),Object(h.a)(this,["layer.effect"],(function(e){t.container&&(t.container.effect=e)}),!0),this.clips.on("change",(function(){t.container.clips=t.clips,t.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((function(e){e!==t||t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){})):this.when().then((function(){t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){}))}},{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}},{key:"isVisibleAtScale",value:function(e){var t=!0,r=this.layer,n=r.minScale,i=r.maxScale;if(null!=n&&null!=i){var a=!n,s=!i;!a&&e<=n&&(a=!0),!s&&e>=i&&(s=!0),t=a&&s}return t}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}},{key:"processUpdate",value:function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}},{key:"isUpdating",value:function(){return!1}},{key:"isRendering",value:function(){return!1}},{key:"canResume",value:function(){return!!Object(s.a)(Object(u.a)(r.prototype),"canResume",this).call(this)&&this.isVisibleAtScale(this.view.scale)}}]),r}(e);return Object(l.a)([Object(p.b)({type:V,set:function(e){var t=Object(b.b)(e,this._get("clips"),V);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(l.a)([Object(p.b)()],t.prototype,"moving",void 0),Object(l.a)([Object(p.b)()],t.prototype,"attached",void 0),Object(l.a)([Object(p.b)()],t.prototype,"container",void 0),Object(l.a)([Object(p.b)({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),Object(l.a)([Object(p.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(l.a)([Object(p.b)()],t.prototype,"updateRequested",void 0),Object(l.a)([Object(p.b)({dependsOn:["attached","updateRequested","suspended"]})],t.prototype,"updating",null),Object(l.a)([Object(p.b)()],t.prototype,"view",void 0),t=Object(l.a)([Object(d.a)("esri.views.2d.layers.LayerView2D")],t)}},851:function(e,t,r){"use strict";var n,i=r(2),a=r(3),s=r(5),u=r(6),c=r(0),o=(r(13),r(14),r(15),r(1)),l=r(8),p=(r(11),r(19),r(20),r(869)),d=n=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).showLegend=null,e}return Object(a.a)(r,[{key:"clone",value:function(){return new n({title:this.title,showLegend:this.showLegend})}}]),r}(p.a);Object(c.a)([Object(o.b)({type:Boolean,json:{write:!0}})],d.prototype,"showLegend",void 0);var f=d=n=Object(c.a)([Object(l.a)("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],d);t.a=f},869:function(e,t,r){"use strict";var n,i=r(2),a=r(3),s=r(5),u=r(6),c=r(0),o=(r(13),r(14),r(15),r(1)),l=r(8),p=(r(11),r(19),r(20),r(28)),d=n=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).title=null,e}return Object(a.a)(r,[{key:"clone",value:function(){return new n({title:this.title})}}]),r}(p.a);Object(c.a)([Object(o.b)({type:String,json:{write:!0}})],d.prototype,"title",void 0);var f=d=n=Object(c.a)([Object(l.a)("esri.renderers.support.LegendOptions")],d);t.a=f},876:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(14),i=r(23),a=r(781),s=r(782),u=n.a.getLogger("esri.views.2d.engine.webgl");function c(e){return Object(s.n)(e.minDataValue)&&Object(s.n)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?a.e.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?a.e.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?a.e.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?a.e.SIZE_UNIT_VALUE:(u.error(new i.a("mapview-bad-type","Found invalid size VisualVariable",e)),a.e.NONE)}},879:function(e,t,r){"use strict";var n=r(2),i=r(3),a=r(5),s=r(6),u=r(0),c=(r(13),r(14)),o=r(15),l=r(1),p=r(73),d=r(50),f=r(8),b=(r(11),r(19),r(20),r(28)),h=r(851),y=c.a.getLogger("esri.renderers.visualVariables.VisualVariable"),v=new d.a({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),O=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e)).index=null,i.type=null,i.field=null,i.valueExpression=null,i.valueExpressionTitle=null,i.legendOptions=null,i}return Object(i.a)(r,[{key:"castField",value:function(e){return null==e?e:"function"==typeof e?(y.error(".field: field must be a string value"),null):Object(o.l)(e)}},{key:"arcadeRequired",get:function(){return!!this.valueExpression}},{key:"clone",value:function(){}},{key:"getAttributeHash",value:function(){return"".concat(this.type,"-").concat(this.field,"-").concat(this.valueExpression)}}]),r}(b.a);Object(u.a)([Object(l.b)()],O.prototype,"index",void 0),Object(u.a)([Object(l.b)({type:v.apiValues,readOnly:!0,json:{read:v.read,write:v.write}})],O.prototype,"type",void 0),Object(u.a)([Object(l.b)({type:String,json:{write:!0}})],O.prototype,"field",void 0),Object(u.a)([Object(p.a)("field")],O.prototype,"castField",null),Object(u.a)([Object(l.b)({type:String,json:{write:!0}})],O.prototype,"valueExpression",void 0),Object(u.a)([Object(l.b)({type:String,json:{write:!0}})],O.prototype,"valueExpressionTitle",void 0),Object(u.a)([Object(l.b)({readOnly:!0,dependsOn:["valueExpression"]})],O.prototype,"arcadeRequired",null),Object(u.a)([Object(l.b)({type:h.a,json:{write:!0}})],O.prototype,"legendOptions",void 0);var j=O=Object(u.a)([Object(f.a)("esri.renderers.visualVariables.VisualVariable")],O);t.a=j},883:function(e,t,r){"use strict";var n,i=r(2),a=r(3),s=r(5),u=r(6),c=r(0),o=(r(13),r(14),r(15),r(1)),l=r(8),p=(r(11),r(19),r(20),r(28)),d=r(36),f=n=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).label=null,n.size=null,n.value=null,n}return Object(a.a)(r,[{key:"clone",value:function(){return new n({label:this.label,size:this.size,value:this.value})}}]),r}(p.a);Object(c.a)([Object(o.b)({type:String,json:{write:!0}})],f.prototype,"label",void 0),Object(c.a)([Object(o.b)({type:Number,cast:d.j,json:{write:!0}})],f.prototype,"size",void 0),Object(c.a)([Object(o.b)({type:Number,json:{write:!0}})],f.prototype,"value",void 0);var b=f=n=Object(c.a)([Object(l.a)("esri.renderers.visualVariables.support.SizeStop")],f);t.a=b},886:function(e,t,r){"use strict";var n,i=r(2),a=r(3),s=r(61),u=r(55),c=r(5),o=r(6),l=r(9),p=r(0),d=(r(13),r(14)),f=r(1),b=r(73),h=r(50),y=r(63),v=r(8),O=r(47),j=r(23),m=(r(11),r(19),r(20),r(36)),g=r(879),x=r(883),w=(r(15),r(851)),k=n=function(e){Object(c.a)(r,e);var t=Object(o.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).customValues=null,e}return Object(a.a)(r,[{key:"clone",value:function(){return new n({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}}]),r}(w.a);Object(p.a)([Object(f.b)({type:[Number],json:{write:!0}})],k.prototype,"customValues",void 0);var _,S=k=n=Object(p.a)([Object(v.a)("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],k),R=r(795),E=r(821),I=d.a.getLogger("esri.renderers.visualVariables.SizeVariable"),F=new h.a({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),V=new h.a({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function z(e){if(null!=e)return"string"==typeof e||"number"==typeof e?Object(m.j)(e):"size"===e.type?Object(R.c)(e)?e:(delete(e=Object(l.a)({},e)).type,new T(e)):void 0}function M(e,t,r){if("object"!=typeof e)return e;var n=new T;return n.read(e,r),n}var T=_=function(e){Object(c.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).axis=null,n.legendOptions=null,n.normalizationField=null,n.scaleBy=null,n.target=null,n.type="size",n.useSymbolValue=null,n.valueExpression=null,n.valueRepresentation=null,n.valueUnit=null,n}return Object(a.a)(r,[{key:"cache",get:function(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:E.g.test(this.valueExpression)}}},{key:"expression",set:function(e){I.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),"view.scale"===e?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}},{key:"index",set:function(e){Object(R.c)(this.maxSize)&&(this.maxSize.index="visualVariables[".concat(e,"].maxSize")),Object(R.c)(this.minSize)&&(this.minSize.index="visualVariables[".concat(e,"].minSize")),this._set("index",e)}},{key:"inputValueType",get:function(){return Object(R.a)(this)}},{key:"maxDataValue",set:function(e){e&&this.stops&&(I.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}},{key:"maxSize",set:function(e){e&&this.stops&&(I.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}},{key:"castMaxSize",value:function(e){return z(e)}},{key:"readMaxSize",value:function(e,t,r){return M(e,0,r)}},{key:"minDataValue",set:function(e){e&&this.stops&&(I.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}},{key:"minSize",set:function(e){e&&this.stops&&(I.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}},{key:"castMinSize",value:function(e){return z(e)}},{key:"readMinSize",value:function(e,t,r){return M(e,0,r)}},{key:"arcadeRequired",get:function(){return!!this.valueExpression||this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}},{key:"stops",set:function(e){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?e&&Array.isArray(e)&&(e=e.filter((function(e){return!!e}))).sort((function(e,t){return e.value-t.value})):e&&(I.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}},{key:"transformationType",get:function(){return Object(R.b)(this,this.inputValueType)}},{key:"readValueExpression",value:function(e,t){return e||t.expression&&"$view.scale"}},{key:"writeValueExpressionWebScene",value:function(e,t,r,n){if("$view.scale"===e){if(n&&n.messages){var i=this.index,a="string"==typeof i?i:"visualVariables[".concat(i,"]");n.messages.push(new j.a("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:a+".valueExpression",context:n}))}}else t[r]=e}},{key:"readValueUnit",value:function(e){return e?V.read(e):null}},{key:"clone",value:function(){return new _({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Object(R.c)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Object(R.c)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map((function(e){return e.clone()})),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}},{key:"flipSizes",value:function(){if("clamped-linear"===this.transformationType){var e=this.minSize,t=this.maxSize;return this.minSize=t,this.maxSize=e,this}if("stops"===this.transformationType){for(var r=this.stops,n=r.map((function(e){return e.size})).reverse(),i=r.length,a=0;a<i;a++)r[a].size=n[a];return this}return this}},{key:"getAttributeHash",value:function(){return"".concat(Object(s.a)(Object(u.a)(r.prototype),"getAttributeHash",this).call(this),"-").concat(this.target,"-").concat(this.normalizationField)}},{key:"_interpolateData",value:function(){return this.stops&&this.stops.map((function(e){return e.value||0}))}}]),r}(g.a);Object(p.a)([Object(f.b)({readOnly:!0,dependsOn:["valueExpression","stops"]})],T.prototype,"cache",null),Object(p.a)([Object(f.b)({type:F.apiValues,json:{type:F.jsonValues,origins:{"web-map":{read:!1}},read:F.read,write:F.write}})],T.prototype,"axis",void 0),Object(p.a)([Object(f.b)({type:String,value:null,json:{read:!1}})],T.prototype,"expression",null),Object(p.a)([Object(f.b)()],T.prototype,"index",null),Object(p.a)([Object(f.b)({type:String,readOnly:!0,dependsOn:["field","valueExpression"]})],T.prototype,"inputValueType",null),Object(p.a)([Object(f.b)({type:S,json:{write:!0}})],T.prototype,"legendOptions",void 0),Object(p.a)([Object(f.b)({type:Number,value:null,json:{write:!0}})],T.prototype,"maxDataValue",null),Object(p.a)([Object(f.b)({type:Number,value:null,json:{write:!0}})],T.prototype,"maxSize",null),Object(p.a)([Object(b.a)("maxSize")],T.prototype,"castMaxSize",null),Object(p.a)([Object(y.a)("maxSize")],T.prototype,"readMaxSize",null),Object(p.a)([Object(f.b)({type:Number,value:null,json:{write:!0}})],T.prototype,"minDataValue",null),Object(p.a)([Object(f.b)({type:Number,value:null,json:{write:!0}})],T.prototype,"minSize",null),Object(p.a)([Object(b.a)("minSize")],T.prototype,"castMinSize",null),Object(p.a)([Object(y.a)("minSize")],T.prototype,"readMinSize",null),Object(p.a)([Object(f.b)({type:String,json:{write:!0}})],T.prototype,"normalizationField",void 0),Object(p.a)([Object(f.b)({readOnly:!0,dependsOn:["valueExpression","minSize.arcadeRequired","maxSize.arcadeRequired"]})],T.prototype,"arcadeRequired",null),Object(p.a)([Object(f.b)({type:String})],T.prototype,"scaleBy",void 0),Object(p.a)([Object(f.b)({type:[x.a],value:null,json:{write:!0}})],T.prototype,"stops",null),Object(p.a)([Object(f.b)({type:["outline"],json:{write:!0}})],T.prototype,"target",void 0),Object(p.a)([Object(f.b)({type:String,readOnly:!0,dependsOn:["minDataValue","maxDataValue","minSize","maxSize","valueUnit","inputValueType","stops"]})],T.prototype,"transformationType",null),Object(p.a)([Object(f.b)({type:["size"],json:{type:["sizeInfo"]}})],T.prototype,"type",void 0),Object(p.a)([Object(f.b)({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],T.prototype,"useSymbolValue",void 0),Object(p.a)([Object(f.b)({type:String,json:{write:!0}})],T.prototype,"valueExpression",void 0),Object(p.a)([Object(y.a)("valueExpression",["valueExpression","expression"])],T.prototype,"readValueExpression",null),Object(p.a)([Object(O.a)("web-scene","valueExpression")],T.prototype,"writeValueExpressionWebScene",null),Object(p.a)([Object(f.b)({type:["radius","diameter","area","width","distance"],json:{write:!0}})],T.prototype,"valueRepresentation",void 0),Object(p.a)([Object(f.b)({type:V.apiValues,json:{write:V.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],T.prototype,"valueUnit",void 0),Object(p.a)([Object(y.a)("valueUnit")],T.prototype,"readValueUnit",null);var q=T=_=Object(p.a)([Object(v.a)("esri.renderers.visualVariables.SizeVariable")],T);t.a=q},897:function(e,t,r){"use strict";function n(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function i(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,r=0,n=0;n<e.length;n++){var i=e[n].size;"number"==typeof i&&(t+=i,r++)}return t/r}(e.stops):t}function a(e){var t=e&&e.renderer,r="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return r;var a="visualVariables"in t?function(e,t){if(!t)return e;var r=t.filter((function(e){return"size"===e.type})).map((function(t){var r=t.maxSize,n=t.minSize;return(i(r,e)+i(n,e))/2})),n=0,a=r.length;if(0===a)return e;for(var s=0;s<a;s++)n+=r[s];var u=Math.floor(n/a);return Math.max(u,e)}(r,t.visualVariables):r;if("simple"===t.type)return n(a,t.symbol);if("unique-value"===t.type){var s=a;return t.uniqueValueInfos.forEach((function(e){s=n(s,e.symbol)})),s}if("class-breaks"===t.type){var u=a;return t.classBreakInfos.forEach((function(e){u=n(u,e.symbol)})),u}return t.type,a}r.d(t,"a",(function(){return a}))},917:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return c}));var n=r(4),i=r(62),a=(r(77),r(54)),s=r(897);function u(e,t,r){var s,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new i.a;if("2d"===r.type)s=t*r.resolution;else if("3d"===r.type){var c=r.overlayPixelSizeInMapUnits(e),o=r.basemapSpatialReference;s=Object(n.i)(o)&&!o.equals(r.spatialReference)?Object(a.c)(o)/Object(a.c)(r.spatialReference):t*c}var l=e.x-s,p=e.y-s,d=e.x+s,f=e.y+s,b=r.spatialReference;return u.xmin=Math.min(l,d),u.ymin=Math.min(p,f),u.xmax=Math.max(l,d),u.ymax=Math.max(p,f),u.spatialReference=b,u}function c(e,t,r){var i=r.toMap(e);return!Object(n.h)(i)&&u(i,Object(s.a)(),r,o).intersects(t)}var o=new i.a},955:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return o}));var n=r(10),i=r.n(n),a=r(37),s=r(21),u=r(4),c=r(157);function o(e){return l.apply(this,arguments)}function l(){return(l=Object(s.a)(i.a.mark((function e(t){var r,n,s,o,l,p,d,f,b,h=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=h.length>1&&void 0!==h[1]?h[1]:t.popupTemplate,Object(u.i)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fields);case 5:if(n=e.sent,s=r.lastEditInfoEnabled,o=t.objectIdField,l=t.typeIdField,p=t.globalIdField,d=t.relationships,!n.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!s){e.next=19;break}return e.next=16,Object(c.m)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return f=e.t0,b=Object(c.i)(t.fields,[].concat(Object(a.a)(n),Object(a.a)(f))),e.abrupt("return",(l&&b.push(l),b&&o&&Object(c.p)(t.fields,o)&&-1===b.indexOf(o)&&b.push(o),b&&p&&Object(c.p)(t.fields,p)&&-1===b.indexOf(p)&&b.push(p),d&&d.forEach((function(e){var r=e.keyField;b&&r&&Object(c.p)(t.fields,r)&&-1===b.indexOf(r)&&b.push(r)})),b));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t){return e.popupTemplate?e.popupTemplate:Object(u.i)(t)&&t.defaultPopupTemplateEnabled&&Object(u.i)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=22.0196aed8.chunk.js.map