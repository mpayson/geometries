{"version":3,"sources":["../node_modules/@arcgis/core/views/2d/layers/MapImageLayerView2D.js","../node_modules/@arcgis/core/views/layers/MapImageLayerView.js","../node_modules/@arcgis/core/layers/support/commonProperties.js","../node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","../node_modules/@arcgis/core/views/support/drapedUtils.js","../node_modules/@arcgis/core/layers/support/sublayerUtils.js","../node_modules/@arcgis/core/views/layers/support/popupUtils.js","../node_modules/@arcgis/core/layers/support/ExportImageParameters.js"],"names":["c","t","getLogger","l","arguments","_exportImageVersion","e","this","strategy","update","catch","s","error","layer","imageMaxWidth","imageMaxHeight","r","version","i","_bitmapContainer","d","container","addChild","u","fetchSource","fetchImage","bind","requestUpdate","imageRotationSupported","imageNormalizationSupported","hidpi","imageParameters","p","view","handles","add","a","destroy","remove","removeChild","removeAllChildren","h","updating","updateRequested","timeExtent","timestamp","refreshTimestamp","n","o","get","minScale","maxScale","visible","sublayers","forEach","popupEnabled","m","defaultPopupTemplateEnabled","push","sublayer","popupTemplate","y","toArray","map","f","load","createQuery","event","renderer","createFetchPopupFeaturesQueryGeometry","geometry","outFields","_loadArcadeModules","arcadeUtils","hasGeometryOperations","maxAllowableOffset","width","queryFeatures","features","reduce","value","filter","isEmpty","prototype","dependsOn","g","type","Boolean","json","origins","read","source","reader","screenSizePerspective","originOf","store","set","write","ignoreOrigin","target","writer","name","disablePopup","enabled","String","isRequired","service","readOnly","Number","default","opacity","origin","drawingInfo","transparency","layerDefinition","timeInfo","useViewTime","intersection","timeOffset","offset","unit","_get","equals","xoffset","Math","max","abs","yoffset","stops","length","size","pointerType","maxSize","minSize","floor","visualVariables","symbol","uniqueValueInfos","classBreakInfos","resolution","overlayPixelSizeInMapUnits","basemapSpatialReference","spatialReference","x","xmin","min","ymin","xmax","ymax","toMap","intersects","flatten","some","originIdOf","mapLayerId","id","gdbVersion","slice","reverse","getRequiredFields","fields","lastEditInfoEnabled","objectIdField","typeIdField","globalIdField","relationships","includes","indexOf","keyField","defaultPopupTemplate","definitionExpression","labelingInfo","labelsVisible","_scale","hasDynamicLayers","visibleSublayers","toExportImageJSON","JSON","stringify","serviceSublayers","_set","allSublayers","on","notifyChange","propertyName","join","scale","layers","layerDefs","dynamicLayers","dpi","imageFormat","imageTransparency","unshift","format","transparent"],"mappings":"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","file":"static/js/76.adabe411.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import t from\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{isAbortError as s}from\"../../../core/promiseUtils.js\";import{init as a}from\"../../../core/watchUtils.js\";import{RefreshableLayerView as o}from\"../../layers/RefreshableLayerView.js\";import{ExportImageParameters as p}from\"../../../layers/support/ExportImageParameters.js\";import m from\"../../layers/LayerView.js\";import{createQueryGeometry as h}from\"../../support/drapedUtils.js\";import{MapImageLayerView as n}from\"../../layers/MapImageLayerView.js\";import{BitmapContainer as d}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as g}from\"./LayerView2D.js\";import u from\"./support/ExportStrategy.js\";const c=t.getLogger(\"esri.views.2d.layers.MapImageLayerView2D\");let l=class extends(n(o(g(m)))){constructor(){super(...arguments),this._exportImageVersion=-1}hitTest(){return null}update(e){this.strategy.update(e).catch((e=>{s(e)||c.error(e)}))}attach(){const{imageMaxWidth:e,imageMaxHeight:t,version:r}=this.layer,i=r>=10.3,s=r>=10;this._bitmapContainer=new d,this.container.addChild(this._bitmapContainer),this.strategy=new u({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:e,imageMaxHeight:t,imageRotationSupported:i,imageNormalizationSupported:s,hidpi:!0}),this.imageParameters=new p({view:this.view,layer:this.layer}),this.handles.add(a(this.imageParameters,\"version\",(e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())})),\"mapimagelayerview-update\")}detach(){this.strategy.destroy(),this.handles.remove(\"mapimagelayerview-update\"),this.imageParameters.destroy(),this.imageParameters=null,this._exportImageVersion=-1,this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,t){return h(e,t,this.view)}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,r,i){return this.layer.fetchImage(e,t,r,{timeExtent:this.imageParameters.timeExtent,timestamp:this.refreshTimestamp,...i})}};e([r()],l.prototype,\"strategy\",void 0),e([r({dependsOn:[\"strategy.updating\"]})],l.prototype,\"updating\",void 0),l=e([i(\"esri.views.2d.layers.MapImageLayerView2D\")],l);var y=l;export default y;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import{isSome as r}from\"../../core/maybe.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import o from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import{reject as a,all as p,eachAlways as i}from\"../../core/promiseUtils.js\";import{loadArcade as u}from\"../../support/arcadeOnDemand.js\";import{calculateTolerance as c}from\"../../renderers/support/clickToleranceUtils.js\";import{getRequiredFields as l,getFetchPopupTemplate as m}from\"./support/popupUtils.js\";const n=n=>{let d=class extends n{async fetchPopupFeatures(e,t){const{layer:s}=this;if(!e)return a(new o(\"mapimagelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:s}));const u=this.get(\"view.scale\"),n=[],d=async e=>{const s=0===e.minScale||u<=e.minScale,o=0===e.maxScale||u>=e.maxScale;if(e.visible&&s&&o)if(e.sublayers)e.sublayers.forEach(d);else if(e.popupEnabled){const s=m(e,{...t,defaultPopupTemplateEnabled:!1});r(s)&&n.push({sublayer:e,popupTemplate:s})}},y=s.sublayers.toArray().map(d);await p(y);const f=n.map((async({sublayer:s,popupTemplate:o})=>{await s.load().catch((()=>{}));const a=s.createQuery(),p=r(t)?t.event:null,i=c({renderer:s.renderer,event:p}),u=this.createFetchPopupFeaturesQueryGeometry(e,i);a.geometry=u,a.outFields=await l(s,o);const m=await this._loadArcadeModules(o);m&&m.arcadeUtils.hasGeometryOperations(o)||(a.maxAllowableOffset=u.width/i);return(await s.queryFeatures(a)).features}));return(await i(f)).reduce(((e,r)=>r.value?[...e,...r.value]:e),[]).filter((e=>null!=e))}canResume(){var e,r;return!!super.canResume()&&(null==(e=this.imageParameters)||null==(r=e.timeExtent)||!r.isEmpty)}_loadArcadeModules(e){if(e.get(\"expressionInfos.length\"))return u()}};return e([t()],d.prototype,\"imageParameters\",void 0),e([t()],d.prototype,\"layer\",void 0),e([t({dependsOn:[\"imageParameters.timeExtent\"]})],d.prototype,\"suspended\",void 0),d=e([s(\"esri.views.layers.MapImageLayerView\")],d),d};export{n as MapImageLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{getProperties as e}from\"../../core/accessorSupport/utils.js\";import{w as i}from\"../../chunks/persistableUrlUtils.js\";import{willPropertyWrite as r}from\"../../core/accessorSupport/write.js\";import{transparencyToOpacity as n}from\"../../webdoc/support/opacityUtils.js\";import t from\"../../TimeExtent.js\";import o from\"../../symbols/support/ElevationInfo.js\";const s={type:Boolean,value:!0,json:{origins:{\"web-scene\":{read:{source:[\"id\",\"url\",\"layerType\"],reader(i,r){if(null!=r.screenSizePerspective||\"defaults\"!==this.originOf(\"screenSizePerspectiveEnabled\"))return r.screenSizePerspective;e(this).store.set(\"screenSizePerspectiveEnabled\",!1,0)}},write:{ignoreOrigin:!0,target:\"screenSizePerspective\",writer(e,i,n,t){(\"defaults\"===this.originOf(\"screenSizePerspectiveEnabled\")&&e||r(this,\"screenSizePerspectiveEnabled\",{},t))&&(i[n]=e)}}}}}},a={type:Boolean,value:!0,json:{name:\"disablePopup\",read:{reader:(e,i)=>!i.disablePopup},write:{enabled:!0,writer(e,i,r){i[r]=!e}}}},l={type:Boolean,value:!0,json:{name:\"showLabels\",write:!0}},p={type:String,json:{origins:{\"portal-item\":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:i}}},c={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:\"showLegend\",write:!0}},d={value:null,type:o,json:{origins:{service:{name:\"elevationInfo\",write:!0}},name:\"layerDefinition.elevationInfo\",write:!0}};function f(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const u={type:Number,json:{origins:{\"web-document\":{default:1,write:!0,read:!0},\"portal-item\":{write:!0}}}},y={...u,json:{...u.json,origins:{\"web-document\":{...u.json.origins[\"web-document\"],write:{enabled:!0,target:{opacity:{type:Number},\"layerDefinition.drawingInfo.transparency\":{type:Number}}}}},read:{source:[\"layerDefinition.drawingInfo.transparency\",\"drawingInfo.transparency\"],reader:(e,i,r)=>r&&\"service\"!==r.origin||!i.drawingInfo||void 0===i.drawingInfo.transparency?i.layerDefinition&&i.layerDefinition.drawingInfo&&void 0!==i.layerDefinition.drawingInfo.transparency?n(i.layerDefinition.drawingInfo.transparency):void 0:n(i.drawingInfo.transparency)}}},m={type:t,dependsOn:[\"view.timeExtent\",\"layer.timeExtent\",\"layer.timeInfo\",\"layer.timeOffset\",\"layer.timeOffset.value\",\"layer.timeOffset.unit\",\"layer.useViewTime\"],readOnly:!0,get(){var e,i;if(null==(e=this.layer)||!e.timeInfo)return null;const r=null==(i=this.view)?void 0:i.timeExtent,n=this.layer.timeExtent,t=this.layer.useViewTime?r&&n?r.intersection(n):r||n:n;if(!t||t.isEmpty)return t;const o=this.layer.timeOffset,s=o?t.offset(-o.value,o.unit):t,a=this._get(\"timeExtent\");return s.equals(a)?a:s}};export{m as combinedViewLayerTimeExtentProperty,d as elevationInfo,l as labelsVisible,c as legendEnabled,u as opacity,y as opacityDrawingInfo,a as popupEnabled,f as readOnlyService,s as screenSizePerspectiveEnabled,p as url};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t,e){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?function(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}(t.stops):e}function n(n){const r=n&&n.renderer,s=\"touch\"===(n&&n.event&&n.event.pointerType)?9:6;if(!r)return s;const o=\"visualVariables\"in r?function(t,n){if(!n)return t;const r=n.filter((t=>\"size\"===t.type)).map((n=>{const{maxSize:r,minSize:s}=n;return(e(r,t)+e(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let t=0;t<o;t++)s+=r[t];const f=Math.floor(s/o);return Math.max(f,t)}(s,r.visualVariables):s;if(\"simple\"===r.type)return t(o,r.symbol);if(\"unique-value\"===r.type){let e=o;return r.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===r.type){let e=o;return r.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return r.type,o}export{n as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../core/maybe.js\";import r from\"../../geometry/Extent.js\";import\"../../geometry.js\";import{getMetersPerUnitForSR as n}from\"../../core/unitUtils.js\";import{calculateTolerance as i}from\"../../renderers/support/clickToleranceUtils.js\";function a(t,i,a,o=new r){let s;if(\"2d\"===a.type)s=i*a.resolution;else if(\"3d\"===a.type){const r=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?n(o)/n(a.spatialReference):i*r}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,n){const o=n.toMap(e);if(t(o))return!1;return a(o,i(),n,s).intersects(r)}const s=new r;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nfunction e(e,n,i){if(n.flatten((({sublayers:e})=>e)).length!==e.length)return!0;return!!e.some((e=>e.originIdOf(\"minScale\")>i||e.originIdOf(\"maxScale\")>i||e.originIdOf(\"renderer\")>i||e.originIdOf(\"labelingInfo\")>i||e.originIdOf(\"opacity\")>i||e.originIdOf(\"labelsVisible\")>i||e.originIdOf(\"source\")>i))||!r(e,n)}function n(e,n,i){return!!e.some((e=>{const n=e.source;return!(!n||\"map-layer\"===n.type&&n.mapLayerId===e.id&&(!n.gdbVersion||n.gdbVersion===i.gdbVersion))||e.originIdOf(\"renderer\")>2||e.originIdOf(\"labelingInfo\")>2||e.originIdOf(\"opacity\")>2||e.originIdOf(\"labelsVisible\")>2}))||!r(e,n)}function r(e,n){if(!e||!e.length)return!0;const r=n.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).map((e=>e.id)).toArray();if(e.length>r.length)return!1;let i=0;const o=r.length;for(const{id:n}of e){for(;i<o&&r[i]!==n;)i++;if(i>=o)return!1}return!0}function i(e){return!!e&&e.some((e=>null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale))}export{n as isExportDynamic,i as isSublayerOverhaul,e as shouldWriteSublayerStructure};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l,hasField as t}from\"../../../layers/support/fieldUtils.js\";async function i(i,d=i.popupTemplate){if(!e(d))return[];const o=await d.getRequiredFields(i.fields),{lastEditInfoEnabled:s}=d,{objectIdField:u,typeIdField:a,globalIdField:n,relationships:f}=i;if(o.includes(\"*\"))return[\"*\"];const r=s?await p(i):[],m=l(i.fields,[...o,...r]);return a&&m.push(a),m&&u&&t(i.fields,u)&&-1===m.indexOf(u)&&m.push(u),m&&n&&t(i.fields,n)&&-1===m.indexOf(n)&&m.push(n),f&&f.forEach((e=>{const{keyField:p}=e;m&&p&&t(i.fields,p)&&-1===m.indexOf(p)&&m.push(p)})),m}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,i as getRequiredFields};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as r}from\"../../core/accessorSupport/decorators/subclass.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import i from\"../../core/Accessor.js\";import{combinedViewLayerTimeExtentProperty as a}from\"./commonProperties.js\";import{HandleOwnerMixin as t}from\"../../core/HandleOwner.js\";import{isExportDynamic as l}from\"./sublayerUtils.js\";import n from\"../../views/View.js\";const o={visible:\"visibleSublayers\",definitionExpression:\"layerDefs\",labelingInfo:\"hasDynamicLayers\",labelsVisible:\"hasDynamicLayers\",opacity:\"hasDynamicLayers\",minScale:\"visibleSublayers\",maxScale:\"visibleSublayers\",renderer:\"hasDynamicLayers\",source:\"hasDynamicLayers\"};let y=class extends(t(i)){constructor(){super(...arguments),this._scale=null,this.view=null}destroy(){this.layer=this.view=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>e.toExportImageJSON()));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&l(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.allSublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"sublayer-update\",(e=>this.notifyChange(o[e.propertyName])))],\"layer\"))}get layers(){const e=this.visibleSublayers;return e?e.length?\"show:\"+e.map((e=>e.id)).join(\",\"):\"show:-1\":null}get layerDefs(){const e=this.visibleSublayers.filter((e=>null!=e.definitionExpression));return e.length?JSON.stringify(e.reduce(((e,s)=>(e[s.id]=s.definitionExpression,e)),{})):null}get scale(){return null!=this._scale?this._scale:this.view&&this.view.scale||0}set scale(e){this.view||(this._scale=e,this.notifyChange(\"scale\"))}get version(){const e=this;e.layers,e.layerDefs,e.dynamicLayers,e.timeExtent;const s=e.layer;return s&&(s.dpi,s.imageFormat,s.imageTransparency,s.gdbVersion),(this._get(\"version\")||0)+1}set version(e){this._set(\"version\",e)}get visibleSublayers(){const e=[];if(!this.layer)return e;const s=this.layer.sublayers,r=s=>{const i=this.scale,a=0===i,t=0===s.minScale||i<=s.minScale,l=0===s.maxScale||i>=s.maxScale;s.visible&&(a||t&&l)&&(s.sublayers?s.sublayers.forEach(r):e.unshift(s))};s&&s.forEach(r);const i=this._get(\"visibleSublayers\");return!i||i.length!==e.length||i.some(((s,r)=>e[r]!==s))?e:i}toJSON(){const e=this.layer;let s={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?s.dynamicLayers=this.dynamicLayers:s={...s,layers:this.layers,layerDefs:this.layerDefs},s}};e([s({readOnly:!0,dependsOn:[\"hasDynamicLayers\",\"visibleSublayers\"]})],y.prototype,\"dynamicLayers\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\",\"layer.serviceSublayers\",\"layer.capabilities\"]})],y.prototype,\"hasDynamicLayers\",null),e([s()],y.prototype,\"layer\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\"]})],y.prototype,\"layers\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\"]})],y.prototype,\"layerDefs\",null),e([s({type:Number,dependsOn:[\"view.scale\"]})],y.prototype,\"scale\",null),e([s(a)],y.prototype,\"timeExtent\",void 0),e([s({dependsOn:[\"layers\",\"layerDefs\",\"dynamicLayers\",\"layer.dpi\",\"layer.imageFormat\",\"layer.imageTransparency\",\"layer.gdbVersion\",\"timeExtent\"]})],y.prototype,\"version\",null),e([s({type:n})],y.prototype,\"view\",void 0),e([s({readOnly:!0,dependsOn:[\"layer.sublayers\",\"scale\"]})],y.prototype,\"visibleSublayers\",null),y=e([r(\"esri.layers.mixins.ExportImageParameters\")],y);export{y as ExportImageParameters};\n"],"sourceRoot":""}